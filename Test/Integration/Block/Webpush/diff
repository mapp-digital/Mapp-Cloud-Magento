diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/composer.json	2023-05-30 09:55:06.864888000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/composer.json	2023-04-12 20:44:20.000000000 +0100
@@ -5,7 +5,7 @@
     "license": [
         "OSL-3.0"
     ],
-    "version": "0.1.4",
+    "version": "0.1.5",
     "require": {
         "composer/composer": "^1.9 || ^2.0",
         "composer-plugin-api": "^1.0 || ^2.0"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/README.md /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/README.md
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/README.md	2023-05-30 09:55:06.864888000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/README.md	2023-04-12 20:44:20.000000000 +0100
@@ -1,2 +1,24 @@
-# composer-dependency-version-audit-plugin
-validating packages through a composer plugin
+# Composer dependency version audit plugin
+
+This composer plugin is used to protect Adobe Commerce merchants from Dependency confusion attacks. It will detect when a public version of a package
+at packagist.org has a higher version than the one available from a private like repo.magento.com. When you try to install/update packages with composer,
+if it detects a potential issue, the plugin will give you a recommendation message and stop the process.
+<br />
+<br />
+By default the plugin will obey the stability configuration in the composer.json config file which is `stable` by default. If you would like to be covered for unstable versions of a package (dev, alpha, beta, RC), you can either change the `minimum-stability` level or explicit require a dev version or only betas with the version constraint for ex: ‘^1.0.2-beta1’
+## Installation
+
+```shell
+composer require magento/composer-dependency-version-audit-plugin
+```
+
+## Usage
+
+When you install/update composer, the composer plugin will stop the process if it detects a potential Dependency Confusion attack.
+In that case, composer install/update will fail with an error message similar to:
+
+```composer log
+Higher matching version x.x.x of package/name was found in public repository packagist.org than x.x.x in private.repo.
+Public package might've been taken over by a malicious entity;
+please investigate and update package requirement to match the version from the private repository.
+```
\ No newline at end of file
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/src/Utils/Version.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/src/Utils/Version.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/src/Utils/Version.php	2023-05-30 09:55:06.864888000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/src/Utils/Version.php	2023-04-12 20:44:20.000000000 +0100
@@ -20,6 +20,12 @@
  */
 class Version
 {
+    /**
+     * Preferred stability level
+     *
+     * @var string
+     */
+    public const STABILITY_DEV = 'dev';

     /**
      * Get Highest version package
@@ -63,7 +69,7 @@
         }
         $pool = new Pool($minStability, $stabilityFlags);
         $pool->addRepository($repository);
-        return (new VersionSelector($pool))->findBestCandidate($packageName);
+        return (new VersionSelector($pool))->findBestCandidate($packageName, null, null, self::STABILITY_DEV);
     }

     /**
@@ -85,6 +91,7 @@

         $repositorySet = new RepositorySet($minStability, $stabilityFlags);
         $repositorySet->addRepository($repository);
-       return (new VersionSelector($repositorySet))->findBestCandidate($packageName);
+
+        return (new VersionSelector($repositorySet))->findBestCandidate($packageName, null, self::STABILITY_DEV);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/tests/Unit/Magento/ComposerDependencyVersionAuditPlugin/PluginTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/tests/Unit/Magento/ComposerDependencyVersionAuditPlugin/PluginTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/composer-dependency-version-audit-plugin/tests/Unit/Magento/ComposerDependencyVersionAuditPlugin/PluginTest.php	2023-05-30 09:55:06.864888000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/composer-dependency-version-audit-plugin/tests/Unit/Magento/ComposerDependencyVersionAuditPlugin/PluginTest.php	2023-04-12 20:44:20.000000000 +0100
@@ -432,4 +432,68 @@
         $this->plugin->packageUpdate($this->eventMock);
     }

+    /**
+     * Test update unstable package from public repo that should throw an exception
+     */
+    public function testUpdateUnstablePackageWithException(): void
+    {
+        $privateRepoUrl = 'https://example.org';
+        $publicRepoVersion ='1.9.0-beta1';
+        $privateRepoVersion = '1.8.0';
+
+        $this->repositoryMock1->expects($this->any())
+            ->method('getRepoConfig')
+            ->willReturn(['url' => 'https://repo.packagist.org']);
+
+        $this->repositoryMock2->expects($this->any())
+            ->method('getRepoConfig')
+            ->willReturn(['url' => $privateRepoUrl]);
+
+        $this->packageMock->expects($this->any())
+            ->method('getFullPrettyVersion')
+            ->willReturnOnConsecutiveCalls($publicRepoVersion, $privateRepoVersion);
+
+        $constraintMock = $this->getMockBuilder(Constraint::class)
+            ->onlyMethods(['getPrettyString'])
+            ->disableOriginalConstructor()
+            ->getMock();
+
+        $constraintMock->expects($this->any())
+            ->method('getPrettyString')
+            ->willReturn("^1.9.0-beta1");
+
+        $this->versionSelectorMock->expects($this->any())
+            ->method('findBestCandidate')
+            ->willReturn($this->packageMock);
+
+        if ((int)explode('.', Composer::VERSION)[0] === 1) {
+            $this->requestMock->expects($this->any())
+                ->method('getJobs')
+                ->willReturn([
+                    ['packageName' => self::PACKAGE_NAME, 'cmd' => 'install', 'fixed' => false, 'constraint' => $constraintMock]
+                ]);
+        } else {
+
+            $this->requestMock->expects($this->any())
+                ->method('getRequires')
+                ->willReturn([
+                    self::PACKAGE_NAME => $constraintMock
+                ]);
+
+            $this->prePoolCreateMock->expects($this->any())
+                ->method('getPackages')
+                ->willReturn([]);
+
+            $this->plugin->prePoolCreate($this->prePoolCreateMock);
+        }
+
+        $packageName = self::PACKAGE_NAME;
+        $exceptionMessage = "Higher matching version {$publicRepoVersion} of {$packageName} was found in public repository packagist.org
+                             than {$privateRepoVersion} in private {$privateRepoUrl}. Public package might've been taken over by a malicious entity,
+                             please investigate and update package requirement to match the version from the private repository";
+        $this->expectException(\Exception::class);
+        $this->expectExceptionMessage(sprintf($exceptionMessage, self::PACKAGE_NAME));
+
+        $this->plugin->packageUpdate($this->eventMock);
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/composer.json	2023-05-30 09:55:07.012889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/composer.json	2023-05-16 15:26:42.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "103.0.6",
+    "version": "103.0.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "ext-bcmath": "*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/DB/Adapter/SqlVersionProvider.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/DB/Adapter/SqlVersionProvider.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/DB/Adapter/SqlVersionProvider.php	2023-05-30 09:55:06.912888000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/DB/Adapter/SqlVersionProvider.php	2023-05-16 15:24:36.000000000 +0100
@@ -31,6 +31,10 @@

     public const MYSQL_8_0_29_VERSION = '8.0.29';

+    public const MARIA_DB_10_6_11_VERSION = '10.6.11';
+
+    public const MARIA_DB_10_4_27_VERSION = '10.4.27';
+
     /**#@-*/

     /**
@@ -138,5 +142,39 @@
             return true;
         }
         return false;
+    }
+
+    /**
+     * Check if MariaDB version is greater than equal to 10.6.11
+     *
+     * @return bool
+     * @throws ConnectionException
+     */
+    public function isMariaDBGte10611(): bool
+    {
+        $sqlVersion = $this->getSqlVersion();
+        $isMariaDB106 = str_contains($sqlVersion, SqlVersionProvider::MARIA_DB_10_6_VERSION);
+        $sqlExactVersion = $this->fetchSqlVersion(ResourceConnection::DEFAULT_CONNECTION);
+        if ($isMariaDB106 && version_compare($sqlExactVersion, '10.6.11', '>=')) {
+            return true;
+        }
+        return false;
+    }
+
+    /**
+     * Check if MariaDB version is greater than equal to 10.4.27
+     *
+     * @return bool
+     * @throws ConnectionException
+     */
+    public function isMariaDBGte10427(): bool
+    {
+        $sqlVersion = $this->getSqlVersion();
+        $isMariaDB104 = str_contains($sqlVersion, SqlVersionProvider::MARIA_DB_10_4_VERSION);
+        $sqlExactVersion = $this->fetchSqlVersion(ResourceConnection::DEFAULT_CONNECTION);
+        if ($isMariaDB104 && version_compare($sqlExactVersion, '10.4.27', '>=')) {
+            return true;
+        }
+        return false;
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/RegexValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/RegexValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/RegexValidator.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/RegexValidator.php	2023-05-16 15:26:42.000000000 +0100
@@ -0,0 +1,53 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\Framework;
+
+use Magento\Framework\App\ObjectManager;
+use Magento\Framework\Validator\RegexFactory;
+
+class RegexValidator extends RegexFactory
+{
+
+    /**
+     * @var RegexFactory
+     */
+    private RegexFactory $regexValidatorFactory;
+
+    /**
+     * Validation pattern for handles array
+     */
+    private const VALIDATION_RULE_PATTERN = '/^[a-z0-9,.]+[a-z0-9_,.]*$/i';
+
+    /**
+     * @param RegexFactory|null $regexValidatorFactory
+     */
+    public function __construct(
+        ?RegexFactory $regexValidatorFactory = null
+    ) {
+        $this->regexValidatorFactory = $regexValidatorFactory
+            ?: ObjectManager::getInstance()->get(RegexFactory::class);
+    }
+
+    /**
+     * Validates parameter regex
+     *
+     * @param string $params
+     * @param string $pattern
+     * @return bool
+     */
+    public function validateParamRegex(string $params, string $pattern = self::VALIDATION_RULE_PATTERN): bool
+    {
+        $validator = $this->regexValidatorFactory->create(['pattern' => $pattern]);
+
+        if ($params && !$validator->isValid($params)) {
+            return false;
+        }
+
+        return true;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/View/Element/AbstractBlock.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/View/Element/AbstractBlock.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/View/Element/AbstractBlock.php	2023-05-30 09:55:06.992889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/View/Element/AbstractBlock.php	2023-05-16 15:24:36.000000000 +0100
@@ -7,7 +7,10 @@

 namespace Magento\Framework\View\Element;

+use Magento\Framework\App\DeploymentConfig;
+use Magento\Framework\App\ObjectManager;
 use Magento\Framework\Cache\LockGuardedCacheLoader;
+use Magento\Framework\Config\ConfigOptionsListConstants;
 use Magento\Framework\DataObject\IdentityInterface;

 /**
@@ -51,6 +54,7 @@
     /**
      * @var \Magento\Framework\Session\SidResolverInterface
      * @deprecated 102.0.5 Not used anymore.
+     * @see Session Id's In URL
      */
     protected $_sidResolver;

@@ -167,6 +171,11 @@
     protected $_cache;

     /**
+     * @var DeploymentConfig
+     */
+    private $deploymentConfig;
+
+    /**
      * @var LockGuardedCacheLoader
      */
     private $lockQuery;
@@ -199,6 +208,7 @@
         $this->_localeDate = $context->getLocaleDate();
         $this->inlineTranslation = $context->getInlineTranslation();
         $this->lockQuery = $context->getLockGuardedCacheLoader();
+
         if (isset($data['jsLayout'])) {
             $this->jsLayout = $data['jsLayout'];
             unset($data['jsLayout']);
@@ -880,6 +890,7 @@
      * @param array|null $allowedTags
      * @return string
      * @deprecated 103.0.0 Use $escaper directly in templates and in blocks.
+     * @see Escaper Usage
      */
     public function escapeHtml($data, $allowedTags = null)
     {
@@ -893,6 +904,7 @@
      * @return string
      * @since 101.0.0
      * @deprecated 103.0.0 Use $escaper directly in templates and in blocks.
+     * @see Escaper Usage
      */
     public function escapeJs($string)
     {
@@ -907,6 +919,7 @@
      * @return string
      * @since 101.0.0
      * @deprecated 103.0.0 Use $escaper directly in templates and in blocks.
+     * @see Escaper Usage
      */
     public function escapeHtmlAttr($string, $escapeSingleQuote = true)
     {
@@ -920,6 +933,7 @@
      * @return string
      * @since 101.0.0
      * @deprecated 103.0.0 Use $escaper directly in templates and in blocks.
+     * @see Escaper Usage
      */
     public function escapeCss($string)
     {
@@ -947,6 +961,7 @@
      * @param string $string
      * @return string
      * @deprecated 103.0.0 Use $escaper directly in templates and in blocks.
+     * @see Escaper Usage
      */
     public function escapeUrl($string)
     {
@@ -959,6 +974,7 @@
      * @param string $data
      * @return string
      * @deprecated 101.0.0
+     * @see Escaper Usage
      */
     public function escapeXssInUrl($data)
     {
@@ -974,6 +990,7 @@
      * @param bool $addSlashes
      * @return string
      * @deprecated 101.0.0
+     * @see Escaper Usage
      */
     public function escapeQuote($data, $addSlashes = false)
     {
@@ -988,6 +1005,7 @@
      *
      * @return string|array
      * @deprecated 101.0.0
+     * @see Escaper Usage
      */
     public function escapeJsQuote($data, $quote = '\'')
     {
@@ -1035,8 +1053,12 @@

         $key = array_values($key);  // ignore array keys

+        $key[] = (string)$this->getDeploymentConfig()->get(
+            ConfigOptionsListConstants::CONFIG_PATH_CRYPT_KEY
+        );
+
         $key = implode('|', $key);
-        $key = sha1($key); // use hashing to hide potentially private data
+        $key = hash('sha256', $key); // use hashing to hide potentially private data
         return static::CACHE_KEY_PREFIX . $key;
     }

@@ -1175,10 +1197,25 @@
      *
      * @return bool
      * @deprecated
+     * @see https://developer.adobe.com/commerce/php/development/cache/page/private-content
      * @since 103.0.1
      */
     public function isScopePrivate()
     {
         return $this->_isScopePrivate;
     }
+
+    /**
+     * Get DeploymentConfig
+     *
+     * @return DeploymentConfig
+     */
+    private function getDeploymentConfig() : DeploymentConfig
+    {
+        if ($this->deploymentConfig === null) {
+            $this->deploymentConfig = ObjectManager::getInstance()
+                ->get(DeploymentConfig::class);
+        }
+        return $this->deploymentConfig;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/View/Test/Unit/Element/AbstractBlockTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/View/Test/Unit/Element/AbstractBlockTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/framework/View/Test/Unit/Element/AbstractBlockTest.php	2023-05-30 09:55:07.004889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/framework/View/Test/Unit/Element/AbstractBlockTest.php	2023-05-16 15:24:36.000000000 +0100
@@ -9,10 +9,13 @@

 use Magento\Framework\App\Cache\StateInterface as CacheStateInterface;
 use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\DeploymentConfig;
 use Magento\Framework\Cache\LockGuardedCacheLoader;
+use Magento\Framework\Config\ConfigOptionsListConstants;
 use Magento\Framework\Config\View;
 use Magento\Framework\Escaper;
 use Magento\Framework\Event\ManagerInterface as EventManagerInterface;
+use Magento\Framework\ObjectManagerInterface;
 use Magento\Framework\Session\SessionManagerInterface;
 use Magento\Framework\Session\SidResolverInterface;
 use Magento\Framework\TestFramework\Unit\Helper\ObjectManager;
@@ -70,10 +73,25 @@
     private $lockQuery;

     /**
+     * @var DeploymentConfig|MockObject
+     */
+    private $deploymentConfig;
+
+    /**
+     * @var ObjectManagerInterface|MockObject
+     */
+    private $objectManagerMock;
+
+    /**
      * @return void
      */
     protected function setUp(): void
     {
+        $this->objectManagerMock = $this->getMockBuilder(ObjectManagerInterface::class)
+            ->disableOriginalConstructor()
+            ->onlyMethods(['create'])
+            ->getMockForAbstractClass();
+        \Magento\Framework\App\ObjectManager::setInstance($this->objectManagerMock);
         $this->eventManagerMock = $this->getMockForAbstractClass(EventManagerInterface::class);
         $this->scopeConfigMock = $this->getMockForAbstractClass(ScopeConfigInterface::class);
         $this->cacheStateMock = $this->getMockForAbstractClass(CacheStateInterface::class);
@@ -108,13 +126,18 @@
         $contextMock->expects($this->once())
             ->method('getLockGuardedCacheLoader')
             ->willReturn($this->lockQuery);
+
         $this->block = $this->getMockForAbstractClass(
             AbstractBlock::class,
             [
                 'context' => $contextMock,
-                'data' => [],
+                'data' => []
             ]
         );
+        $this->deploymentConfig = $this->createPartialMock(
+            DeploymentConfig::class,
+            ['get']
+        );
     }

     /**
@@ -224,9 +247,20 @@
      */
     public function testGetCacheKeyByName()
     {
+        $this->objectManagerMock->expects($this->any())
+            ->method('get')
+            ->with(DeploymentConfig::class)
+            ->willReturn($this->deploymentConfig);
+
+        $this->deploymentConfig->expects($this->any())
+            ->method('get')
+            ->with(ConfigOptionsListConstants::CONFIG_PATH_CRYPT_KEY)
+            ->willReturn('448198e08af35844a42d3c93c1ef4e03');
+
         $nameInLayout = 'testBlock';
         $this->block->setNameInLayout($nameInLayout);
-        $cacheKey = sha1($nameInLayout);
+        $encryptionKey = $this->deploymentConfig->get(ConfigOptionsListConstants::CONFIG_PATH_CRYPT_KEY);
+        $cacheKey = hash('sha256', $nameInLayout . '|' . $encryptionKey);
         $this->assertEquals(AbstractBlock::CACHE_KEY_PREFIX . $cacheKey, $this->block->getCacheKey());
     }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/composer.json	2023-05-30 09:55:07.032889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/composer.json	2023-05-16 15:26:50.000000000 +0100
@@ -6,7 +6,7 @@
         "OSL-3.0",
         "AFL-3.0"
     ],
-    "version": "2.4.6",
+    "version": "2.4.6-p1",
     "require": {
         "magento/magento-composer-installer": "*",
         "php": "~8.1.0||~8.2.0",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/Customer/Api/AccountManagementTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/Customer/Api/AccountManagementTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/Customer/Api/AccountManagementTest.php	2023-05-30 09:55:07.096889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/Customer/Api/AccountManagementTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -8,10 +8,13 @@

 use Magento\Customer\Api\Data\CustomerInterface as Customer;
 use Magento\Customer\Model\AccountManagement;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\ObjectManager;
 use Magento\Framework\Exception\InputException;
 use Magento\Framework\Webapi\Exception as HTTPExceptionCodes;
 use Magento\Newsletter\Model\Subscriber;
 use Magento\Security\Model\Config;
+use Magento\Store\Model\ScopeInterface;
 use Magento\TestFramework\Helper\Bootstrap;
 use Magento\TestFramework\Helper\Customer as CustomerHelper;
 use Magento\TestFramework\TestCase\WebapiAbstract;
@@ -23,15 +26,20 @@
  */
 class AccountManagementTest extends WebapiAbstract
 {
-    const SERVICE_VERSION = 'V1';
-    const SERVICE_NAME = 'customerAccountManagementV1';
-    const RESOURCE_PATH = '/V1/customers';
+    public const SERVICE_VERSION = 'V1';
+    public const SERVICE_NAME = 'customerAccountManagementV1';
+    public const RESOURCE_PATH = '/V1/customers';

     /**
      * Sample values for testing
      */
-    const ATTRIBUTE_CODE = 'attribute_code';
-    const ATTRIBUTE_VALUE = 'attribute_value';
+    public const ATTRIBUTE_CODE = 'attribute_code';
+    public const ATTRIBUTE_VALUE = 'attribute_value';
+
+    /**
+     * @var ObjectManager
+     */
+    private $objectManager;

     /**
      * @var AccountManagementInterface
@@ -86,6 +94,8 @@
      */
     protected function setUp(): void
     {
+        $this->objectManager = Bootstrap::getObjectManager();
+
         $this->accountManagement = Bootstrap::getObjectManager()->get(
             \Magento\Customer\Api\AccountManagementInterface::class
         );
@@ -645,6 +655,8 @@

     public function testEmailAvailable()
     {
+        $config = $this->objectManager->get(ScopeConfigInterface::class);
+
         $customerData = $this->_createCustomer();

         $serviceInfo = [
@@ -662,7 +674,18 @@
             'customerEmail' => $customerData[Customer::EMAIL],
             'websiteId' => $customerData[Customer::WEBSITE_ID],
         ];
-        $this->assertFalse($this->_webApiCall($serviceInfo, $requestData));
+
+        $emailSetting = $config->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            $customerData[Customer::WEBSITE_ID]
+        );
+
+        if (!$emailSetting) {
+            $this->assertTrue($this->_webApiCall($serviceInfo, $requestData));
+        } else {
+            $this->assertFalse($this->_webApiCall($serviceInfo, $requestData));
+        }
     }

     public function testEmailAvailableInvalidEmail()
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Customer/IsEmailAvailableTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Customer/IsEmailAvailableTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Customer/IsEmailAvailableTest.php	2023-05-30 09:55:07.100889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Customer/IsEmailAvailableTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -7,6 +7,11 @@

 namespace Magento\GraphQl\Customer;

+use Magento\Customer\Model\AccountManagement;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Store\Api\StoreResolverInterface;
+use Magento\Store\Model\ScopeInterface;
+use Magento\TestFramework\Helper\Bootstrap;
 use Magento\TestFramework\TestCase\GraphQlAbstract;

 /**
@@ -15,6 +20,25 @@
 class IsEmailAvailableTest extends GraphQlAbstract
 {
     /**
+     * @var ScopeConfigInterface|null
+     */
+    private ?ScopeConfigInterface $scopeConfig;
+
+    /**
+     * @var string|null
+     */
+    private ?string $storeId;
+
+    public function setUp(): void
+    {
+        $objectManager = Bootstrap::getObjectManager();
+        $this->scopeConfig = $objectManager->get(ScopeConfigInterface::class);
+        /* @var StoreResolverInterface $storeResolver */
+        $storeResolver = $objectManager->get(StoreResolverInterface::class);
+        $this->storeId = $storeResolver->getCurrentStoreId();
+    }
+
+    /**
      * @magentoApiDataFixture Magento/Customer/_files/customer.php
      */
     public function testEmailNotAvailable()
@@ -31,7 +55,16 @@

         self::assertArrayHasKey('isEmailAvailable', $response);
         self::assertArrayHasKey('is_email_available', $response['isEmailAvailable']);
-        self::assertFalse($response['isEmailAvailable']['is_email_available']);
+        $emailConfig = $this->scopeConfig->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_STORE,
+            $this->storeId
+        );
+        if (!$emailConfig) {
+            self::assertTrue($response['isEmailAvailable']['is_email_available']);
+        } else {
+            self::assertFalse($response['isEmailAvailable']['is_email_available']);
+        }
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Newsletter/Customer/SubscribeEmailToNewsletterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Newsletter/Customer/SubscribeEmailToNewsletterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Newsletter/Customer/SubscribeEmailToNewsletterTest.php	2023-05-30 09:55:07.104889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Newsletter/Customer/SubscribeEmailToNewsletterTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -8,11 +8,14 @@
 namespace Magento\GraphQl\Newsletter\Customer;

 use Exception;
+use Magento\Customer\Model\AccountManagement;
 use Magento\Customer\Model\CustomerAuthUpdate;
 use Magento\Customer\Model\CustomerRegistry;
+use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\Framework\Exception\AuthenticationException;
 use Magento\Integration\Api\CustomerTokenServiceInterface;
 use Magento\Newsletter\Model\ResourceModel\Subscriber as SubscriberResourceModel;
+use Magento\Store\Model\ScopeInterface;
 use Magento\TestFramework\Helper\Bootstrap;
 use Magento\TestFramework\TestCase\GraphQlAbstract;

@@ -40,6 +43,10 @@
      * @var SubscriberResourceModel
      */
     private $subscriberResource;
+    /**
+     * @var ScopeConfigInterface
+     */
+    private $scopeConfig;

     /**
      * @inheritDoc
@@ -47,6 +54,7 @@
     protected function setUp(): void
     {
         $objectManager = Bootstrap::getObjectManager();
+        $this->scopeConfig = $objectManager->get(ScopeConfigInterface::class);
         $this->customerAuthUpdate = Bootstrap::getObjectManager()->get(CustomerAuthUpdate::class);
         $this->customerRegistry = Bootstrap::getObjectManager()->get(CustomerRegistry::class);
         $this->customerTokenService = $objectManager->get(CustomerTokenServiceInterface::class);
@@ -146,10 +154,17 @@
     {
         $query = $this->getQuery('customer2@search.example.com');

-        $this->expectException(Exception::class);
-        $this->expectExceptionMessage('Cannot create a newsletter subscription.' . "\n");
-
-        $this->graphQlMutation($query, [], '', $this->getHeaderMap('customer@search.example.com'));
+        $guestLoginConfig = $this->scopeConfig->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            1
+        );
+
+        if ($guestLoginConfig) {
+            $this->expectException(Exception::class);
+            $this->expectExceptionMessage('Cannot create a newsletter subscription.' . "\n");
+            $this->graphQlMutation($query, [], '', $this->getHeaderMap('customer@search.example.com'));
+        }
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Quote/Customer/RemoveItemFromCartTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Quote/Customer/RemoveItemFromCartTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Quote/Customer/RemoveItemFromCartTest.php	2023-05-30 09:55:07.104889000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/api-functional/testsuite/Magento/GraphQl/Quote/Customer/RemoveItemFromCartTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -11,6 +11,7 @@
 use Magento\GraphQl\Quote\GetQuoteItemIdByReservedQuoteIdAndSku;
 use Magento\Integration\Api\CustomerTokenServiceInterface;
 use Magento\TestFramework\Helper\Bootstrap;
+use Magento\TestFramework\TestCase\GraphQl\ResponseContainsErrorsException;
 use Magento\TestFramework\TestCase\GraphQlAbstract;

 /**
@@ -148,12 +149,56 @@
             'simple_product'
         );

-        $this->expectExceptionMessage(
-            "The current user cannot perform operations on cart \"$anotherCustomerQuoteMaskedId\""
-        );
-
         $query = $this->getQuery($anotherCustomerQuoteMaskedId, $anotherCustomerQuoteItemId);
-        $this->graphQlMutation($query, [], '', $this->getHeaderMap('customer2@search.example.com'));
+
+        try {
+            $this->graphQlMutation(
+                $query,
+                [],
+                '',
+                $this->getHeaderMap('customer2@search.example.com')
+            );
+            $this->fail('ResponseContainsErrorsException was not thrown');
+        } catch (ResponseContainsErrorsException $e) {
+            $this->assertStringContainsString(
+                "The current user cannot perform operations on cart \"$anotherCustomerQuoteMaskedId\"",
+                $e->getMessage()
+            );
+            $cartQuery = $this->getCartQuery($anotherCustomerQuoteMaskedId);
+            $cart = $this->graphQlQuery(
+                $cartQuery,
+                [],
+                '',
+                $this->getHeaderMap('customer@search.example.com')
+            );
+            $this->assertTrue(count($cart['cart']['items']) > 0, 'The cart is empty');
+            $this->assertTrue(
+                $cart['cart']['items'][0]['product']['sku'] === 'simple_product',
+                'The cart doesn\'t contain product'
+            );
+        }
+    }
+
+    /**
+     * @param string $maskedQuoteId
+     * @return string
+     */
+    private function getCartQuery(string $maskedQuoteId): string
+    {
+        return <<<QUERY
+{
+  cart(cart_id: "{$maskedQuoteId}") {
+    id
+    items {
+      id
+      quantity
+      product {
+        sku
+      }
+    }
+  }
+}
+QUERY;
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Customer/Model/AccountManagementTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Customer/Model/AccountManagementTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Customer/Model/AccountManagementTest.php	2023-05-30 09:55:07.188890000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Customer/Model/AccountManagementTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -9,6 +9,7 @@
 use Magento\Customer\Api\AccountManagementInterface;
 use Magento\Customer\Api\AddressRepositoryInterface;
 use Magento\Customer\Api\Data\AddressInterface;
+use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\Framework\Exception\InputException;
 use Magento\Framework\Exception\NoSuchEntityException;
 use Magento\Framework\Exception\State\ExpiredException;
@@ -16,6 +17,7 @@
 use Magento\Framework\Session\SessionManagerInterface;
 use Magento\Framework\Stdlib\DateTime;
 use Magento\Framework\Url as UrlBuilder;
+use Magento\Store\Model\ScopeInterface;
 use Magento\Store\Model\StoreManagerInterface;
 use Magento\TestFramework\Helper\Bootstrap;

@@ -604,7 +606,18 @@
      */
     public function testIsEmailAvailable()
     {
-        $this->assertFalse($this->accountManagement->isEmailAvailable('customer@example.com', 1));
+        $scopeConfig = $this->objectManager->get(ScopeConfigInterface::class);
+        $guestLoginConfig = $scopeConfig->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            1
+        );
+
+        if (!$guestLoginConfig) {
+            $this->assertTrue($this->accountManagement->isEmailAvailable('customer@example.com', 1));
+        } else {
+            $this->assertFalse($this->accountManagement->isEmailAvailable('customer@example.com', 1));
+        }
     }

     /**
@@ -612,7 +625,18 @@
      */
     public function testIsEmailAvailableNoWebsiteSpecified()
     {
-        $this->assertFalse($this->accountManagement->isEmailAvailable('customer@example.com'));
+        $scopeConfig = $this->objectManager->get(ScopeConfigInterface::class);
+        $guestLoginConfig = $scopeConfig->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            1
+        );
+
+        if (!$guestLoginConfig) {
+            $this->assertTrue($this->accountManagement->isEmailAvailable('customer@example.com'));
+        } else {
+            $this->assertFalse($this->accountManagement->isEmailAvailable('customer@example.com'));
+        }
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Framework/Backup/_files/var/backups/1474538269_filesystem_code.tgz /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Framework/Backup/_files/var/backups/1474538269_filesystem_code.tgz
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Framework/Backup/_files/var/backups/1474538269_filesystem_code.tgz	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Framework/Backup/_files/var/backups/1474538269_filesystem_code.tgz	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1 @@
+\8B\00\00\00\00\00\EC\D11\C20\85a\CF=EN\D9!	\E1\A9]\A8+\F5\F8\84\B2\B3\81T\F4˓\FC\DEf\9FV\8F\BE\BB|\91\AA֚\8F\D4k-Gj\CA\EF|\B1,v\A9%\F7֬\F6\BBYIIT~`[}|\84 ˸\CFˇ]\9F\B5&\E7\D6\FF\DA|\9Fb\00\00\00\00\00\00\00\00\00\A7\F7\00\00\FF\FF\00"g\FEK\00\00\00
\ No newline at end of file
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Newsletter/Controller/Subscriber/NewActionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Newsletter/Controller/Subscriber/NewActionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Newsletter/Controller/Subscriber/NewActionTest.php	2023-05-30 09:55:07.236890000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/integration/testsuite/Magento/Newsletter/Controller/Subscriber/NewActionTest.php	2023-05-16 15:26:28.000000000 +0100
@@ -8,12 +8,15 @@
 namespace Magento\Newsletter\Controller\Subscriber;

 use Magento\Customer\Api\CustomerRepositoryInterface;
+use Magento\Customer\Model\AccountManagement;
 use Magento\Customer\Model\Session;
 use Magento\Customer\Model\Url;
+use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\Framework\App\Request\Http as HttpRequest;
 use Magento\Newsletter\Model\ResourceModel\Subscriber as SubscriberResource;
 use Magento\Newsletter\Model\ResourceModel\Subscriber\CollectionFactory;
 use Magento\Newsletter\Model\ResourceModel\Subscriber\Grid\Collection as GridCollection;
+use Magento\Store\Model\ScopeInterface;
 use Magento\TestFramework\TestCase\AbstractController;
 use Laminas\Stdlib\Parameters;

@@ -222,8 +225,18 @@
         $this->session->loginById(1);
         $this->prepareRequest('customer2@search.example.com');
         $this->dispatch('newsletter/subscriber/new');
+        $scopeConfig = $this->_objectManager->get(ScopeConfigInterface::class);
+        $guestLoginConfig = $scopeConfig->getValue(
+            AccountManagement::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            1
+        );

-        $this->performAsserts('This email address is already assigned to another user.');
+        if ($guestLoginConfig) {
+            $this->performAsserts('This email address is already assigned to another user.');
+        } else {
+            $this->performAsserts('This email address is already subscribed.');
+        }
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,59 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+// @codingStandardsIgnoreFile
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'reference_table' => 'CREATE TABLE `reference_table` (
+  `tinyint_ref` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `tinyint_without_padding` tinyint(4) NOT NULL DEFAULT 0,
+  `bigint_without_padding` bigint(20) NOT NULL DEFAULT 0,
+  `smallint_without_padding` smallint(6) NOT NULL DEFAULT 0,
+  `integer_without_padding` int(11) NOT NULL DEFAULT 0,
+  `smallint_with_big_padding` smallint(6) NOT NULL DEFAULT 0,
+  `smallint_without_default` smallint(6) DEFAULT NULL,
+  `int_without_unsigned` int(11) DEFAULT NULL,
+  `int_unsigned` int(10) unsigned DEFAULT NULL,
+  `bigint_default_nullable` bigint(20) unsigned DEFAULT 1,
+  `bigint_not_default_not_nullable` bigint(20) unsigned NOT NULL,
+  `smallint_ref` smallint(6) NOT NULL DEFAULT 0,
+  PRIMARY KEY (`tinyint_ref`,`smallint_ref`),
+  UNIQUE KEY `REFERENCE_TABLE_SMALLINT_REF` (`smallint_ref`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'test_table' => 'CREATE TABLE `test_table` (
+  `smallint` smallint(6) DEFAULT NULL,
+  `tinyint` tinyint(4) DEFAULT NULL,
+  `bigint` bigint(20) DEFAULT 0,
+  `float` float(12,10) DEFAULT 0.0000000000,
+  `double` double(245,10) DEFAULT 11111111.1111110000,
+  `decimal` decimal(15,4) DEFAULT 0.0000,
+  `date` date DEFAULT NULL,
+  `timestamp` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
+  `datetime` datetime DEFAULT \'0000-00-00 00:00:00\',
+  `longtext` longtext DEFAULT NULL,
+  `mediumtext` mediumtext DEFAULT NULL,
+  `varchar` varchar(254) DEFAULT NULL,
+  `char` char(255) DEFAULT NULL,
+  `mediumblob` mediumblob DEFAULT NULL,
+  `blob` blob DEFAULT NULL,
+  `boolean` tinyint(1) DEFAULT NULL,
+  `integer_main` int(10) unsigned DEFAULT NULL,
+  `smallint_main` smallint(6) NOT NULL DEFAULT 0,
+  UNIQUE KEY `TEST_TABLE_SMALLINT_FLOAT` (`smallint`,`float`),
+  UNIQUE KEY `TEST_TABLE_DOUBLE` (`double`),
+  KEY `TEST_TABLE_TINYINT_BIGINT` (`tinyint`,`bigint`),
+  KEY `TEST_TABLE_SMALLINT_MAIN_REFERENCE_TABLE_SMALLINT_REF` (`smallint_main`),
+  KEY `FK_FB77604C299EB8612D01E4AF8D9931F2` (`integer_main`),
+  CONSTRAINT `FK_FB77604C299EB8612D01E4AF8D9931F2` FOREIGN KEY (`integer_main`) REFERENCES `auto_increment_test` (`int_auto_increment_with_nullable`) ON DELETE CASCADE,
+  CONSTRAINT `TEST_TABLE_SMALLINT_MAIN_REFERENCE_TABLE_SMALLINT_REF` FOREIGN KEY (`smallint_main`) REFERENCES `reference_table` (`smallint_ref`) ON DELETE CASCADE,
+  CONSTRAINT `TEST_TABLE_TINYINT_REFERENCE_TABLE_TINYINT_REF` FOREIGN KEY (`tinyint`) REFERENCES `reference_table` (`tinyint_ref`) ON DELETE SET NULL
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/constraint_modification.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,59 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+// @codingStandardsIgnoreFile
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'reference_table' => 'CREATE TABLE `reference_table` (
+  `tinyint_ref` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `tinyint_without_padding` tinyint(4) NOT NULL DEFAULT 0,
+  `bigint_without_padding` bigint(20) NOT NULL DEFAULT 0,
+  `smallint_without_padding` smallint(6) NOT NULL DEFAULT 0,
+  `integer_without_padding` int(11) NOT NULL DEFAULT 0,
+  `smallint_with_big_padding` smallint(6) NOT NULL DEFAULT 0,
+  `smallint_without_default` smallint(6) DEFAULT NULL,
+  `int_without_unsigned` int(11) DEFAULT NULL,
+  `int_unsigned` int(10) unsigned DEFAULT NULL,
+  `bigint_default_nullable` bigint(20) unsigned DEFAULT 1,
+  `bigint_not_default_not_nullable` bigint(20) unsigned NOT NULL,
+  `smallint_ref` smallint(6) NOT NULL DEFAULT 0,
+  PRIMARY KEY (`tinyint_ref`,`smallint_ref`),
+  UNIQUE KEY `REFERENCE_TABLE_SMALLINT_REF` (`smallint_ref`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'test_table' => 'CREATE TABLE `test_table` (
+  `smallint` smallint(6) DEFAULT NULL,
+  `tinyint` tinyint(4) DEFAULT NULL,
+  `bigint` bigint(20) DEFAULT 0,
+  `float` float(12,10) DEFAULT 0.0000000000,
+  `double` double(245,10) DEFAULT 11111111.1111110000,
+  `decimal` decimal(15,4) DEFAULT 0.0000,
+  `date` date DEFAULT NULL,
+  `timestamp` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
+  `datetime` datetime DEFAULT \'0000-00-00 00:00:00\',
+  `longtext` longtext DEFAULT NULL,
+  `mediumtext` mediumtext DEFAULT NULL,
+  `varchar` varchar(254) DEFAULT NULL,
+  `char` char(255) DEFAULT NULL,
+  `mediumblob` mediumblob DEFAULT NULL,
+  `blob` blob DEFAULT NULL,
+  `boolean` tinyint(1) DEFAULT NULL,
+  `integer_main` int(10) unsigned DEFAULT NULL,
+  `smallint_main` smallint(6) NOT NULL DEFAULT 0,
+  UNIQUE KEY `TEST_TABLE_SMALLINT_FLOAT` (`smallint`,`float`),
+  UNIQUE KEY `TEST_TABLE_DOUBLE` (`double`),
+  KEY `TEST_TABLE_TINYINT_BIGINT` (`tinyint`,`bigint`),
+  KEY `TEST_TABLE_SMALLINT_MAIN_REFERENCE_TABLE_SMALLINT_REF` (`smallint_main`),
+  KEY `FK_FB77604C299EB8612D01E4AF8D9931F2` (`integer_main`),
+  CONSTRAINT `FK_FB77604C299EB8612D01E4AF8D9931F2` FOREIGN KEY (`integer_main`) REFERENCES `auto_increment_test` (`int_auto_increment_with_nullable`) ON DELETE CASCADE,
+  CONSTRAINT `TEST_TABLE_SMALLINT_MAIN_REFERENCE_TABLE_SMALLINT_REF` FOREIGN KEY (`smallint_main`) REFERENCES `reference_table` (`smallint_ref`) ON DELETE CASCADE,
+  CONSTRAINT `TEST_TABLE_TINYINT_REFERENCE_TABLE_TINYINT_REF` FOREIGN KEY (`tinyint`) REFERENCES `reference_table` (`tinyint_ref`) ON DELETE SET NULL
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+// @codingStandardsIgnoreFile
+return [
+    'before' => [
+        'store' => 'CREATE TABLE `store` (
+  `store_owner_id` smallint(6) DEFAULT NULL COMMENT \'Store Owner Reference\',
+  KEY `STORE_STORE_OWNER_ID_STORE_OWNER_OWNER_ID` (`store_owner_id`),
+  CONSTRAINT `STORE_STORE_OWNER_ID_STORE_OWNER_OWNER_ID` FOREIGN KEY (`store_owner_id`) REFERENCES `store_owner` (`owner_id`) ON DELETE SET NULL
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+        'store_owner' => 'CREATE TABLE `store_owner` (
+  `owner_id` smallint(6) NOT NULL AUTO_INCREMENT,
+  `store_owner_name` varchar(255) DEFAULT NULL COMMENT \'Store Owner Name\',
+  PRIMARY KEY (`owner_id`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci COMMENT=\'Store owner information\''
+    ],
+    'after' => [
+        'store' => 'CREATE TABLE `store` (
+  `store_owner` varchar(255) DEFAULT NULL COMMENT \'Store Owner Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci'
+    ]
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/rollback.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+// @codingStandardsIgnoreFile
+return [
+    'before' => [
+        'store' => 'CREATE TABLE `store` (
+  `store_owner_id` smallint(6) DEFAULT NULL COMMENT \'Store Owner Reference\',
+  KEY `STORE_STORE_OWNER_ID_STORE_OWNER_OWNER_ID` (`store_owner_id`),
+  CONSTRAINT `STORE_STORE_OWNER_ID_STORE_OWNER_OWNER_ID` FOREIGN KEY (`store_owner_id`) REFERENCES `store_owner` (`owner_id`) ON DELETE SET NULL
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+        'store_owner' => 'CREATE TABLE `store_owner` (
+  `owner_id` smallint(6) NOT NULL AUTO_INCREMENT,
+  `store_owner_name` varchar(255) DEFAULT NULL COMMENT \'Store Owner Name\',
+  PRIMARY KEY (`owner_id`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci COMMENT=\'Store owner information\''
+    ],
+    'after' => [
+        'store' => 'CREATE TABLE `store` (
+  `store_owner` varchar(255) DEFAULT NULL COMMENT \'Store Owner Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci'
+    ]
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,14 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_removal.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,14 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,15 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'before' => 'CREATE TABLE `some_table` (
+  `some_column` varchar(255) DEFAULT NULL COMMENT \'Some Column Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'after' => 'CREATE TABLE `some_table_renamed` (
+  `some_column` varchar(255) DEFAULT NULL COMMENT \'Some Column Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/declarative_installer/table_rename.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,15 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'before' => 'CREATE TABLE `some_table` (
+  `some_column` varchar(255) DEFAULT NULL COMMENT \'Some Column Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'after' => 'CREATE TABLE `some_table_renamed` (
+  `some_column` varchar(255) DEFAULT NULL COMMENT \'Some Column Name\'
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/dry_run_log.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/dry_run_log.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/dry_run_log.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule1/fixture/dry_run_log.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,58 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+// @codingStandardsIgnoreFile
+return ['CREATE TABLE `reference_table` (
+`tinyint_ref` tinyint  NOT NULL  AUTO_INCREMENT ,
+`tinyint_without_padding` tinyint  NOT NULL DEFAULT 0  ,
+`bigint_without_padding` bigint  NOT NULL DEFAULT 0  ,
+`smallint_without_padding` smallint  NOT NULL DEFAULT 0  ,
+`integer_without_padding` int  NOT NULL DEFAULT 0  ,
+`smallint_with_big_padding` smallint  NOT NULL DEFAULT 0  ,
+`smallint_without_default` smallint  NULL   ,
+`int_without_unsigned` int  NULL   ,
+`int_unsigned` int UNSIGNED NULL   ,
+`bigint_default_nullable` bigint UNSIGNED NULL DEFAULT 1  ,
+`bigint_not_default_not_nullable` bigint UNSIGNED NOT NULL   ,
+CONSTRAINT  PRIMARY KEY (`tinyint_ref`)
+) ENGINE=innodb DEFAULT CHARSET=utf8mb3 DEFAULT COLLATE=utf8mb3_general_ci
+
+CREATE TABLE `auto_increment_test` (
+`int_auto_increment_with_nullable` int UNSIGNED NOT NULL  AUTO_INCREMENT ,
+`int_disabled_auto_increment` smallint UNSIGNED NULL DEFAULT 0  ,
+CONSTRAINT `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` UNIQUE KEY (`int_auto_increment_with_nullable`)
+) ENGINE=innodb DEFAULT CHARSET=utf8mb3 DEFAULT COLLATE=utf8mb3_general_ci
+
+CREATE TABLE `test_table` (
+`smallint` smallint  NOT NULL  AUTO_INCREMENT ,
+`tinyint` tinyint  NULL   ,
+`bigint` bigint  NULL DEFAULT 0  ,
+`float` float(12, 4)  NULL DEFAULT 0 ,
+`double` decimal(14, 6)  NULL DEFAULT 11111111.111111 ,
+`decimal` decimal(15, 4)  NULL DEFAULT 0 ,
+`date` date NULL ,
+`timestamp` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ,
+`datetime` datetime NULL DEFAULT 0  ,
+`longtext` longtext NULL ,
+`mediumtext` mediumtext NULL ,
+`varchar` varchar(254) NULL  ,
+`char` char(255) NULL  ,
+`mediumblob` mediumblob NULL ,
+`blob` blob NULL ,
+`boolean` BOOLEAN NULL  ,
+CONSTRAINT `TEST_TABLE_SMALLINT_BIGINT` UNIQUE KEY (`smallint`,`bigint`),
+CONSTRAINT `TEST_TABLE_TINYINT_REFERENCE_TABLE_TINYINT_REF` FOREIGN KEY (`tinyint`) REFERENCES `reference_table` (`tinyint_ref`)  ON DELETE NO ACTION,
+INDEX `TEST_TABLE_TINYINT_BIGINT` (`tinyint`,`bigint`)
+) ENGINE=innodb DEFAULT CHARSET=utf8mb3 DEFAULT COLLATE=utf8mb3_general_ci
+
+CREATE TABLE `patch_list` (
+`patch_id` int  NOT NULL  AUTO_INCREMENT COMMENT "Patch Auto Increment",
+`patch_name` varchar(1024) NOT NULL  COMMENT "Patch Class Name",
+CONSTRAINT  PRIMARY KEY (`patch_id`)
+) ENGINE=innodb DEFAULT CHARSET=utf8mb3 DEFAULT COLLATE=utf8mb3_general_ci COMMENT="List of data/schema patches"
+
+'];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,38 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'test_table_one' => 'CREATE TABLE `test_table_one` (
+  `smallint` smallint(6) NOT NULL AUTO_INCREMENT,
+  `varchar` varchar(254) DEFAULT NULL,
+  PRIMARY KEY (`smallint`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'test_table_two' => 'CREATE TABLE `test_table_two` (
+  `smallint` smallint(6) NOT NULL AUTO_INCREMENT,
+  `varchar` varchar(254) DEFAULT NULL,
+  PRIMARY KEY (`smallint`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'reference_table' => 'CREATE TABLE `reference_table` (
+  `tinyint_ref` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `tinyint_without_padding` tinyint(4) NOT NULL DEFAULT 0,
+  `bigint_without_padding` bigint(20) NOT NULL DEFAULT 0,
+  `smallint_without_padding` smallint(6) NOT NULL DEFAULT 0,
+  `integer_without_padding` int(11) NOT NULL DEFAULT 0,
+  `smallint_with_big_padding` smallint(6) NOT NULL DEFAULT 0,
+  `smallint_without_default` smallint(6) DEFAULT NULL,
+  `int_without_unsigned` int(11) DEFAULT NULL,
+  `int_unsigned` int(10) unsigned DEFAULT NULL,
+  `bigint_default_nullable` bigint(20) unsigned DEFAULT 1,
+  `bigint_not_default_not_nullable` bigint(20) unsigned NOT NULL,
+  PRIMARY KEY (`tinyint_ref`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci',
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule2/fixture/shards.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,38 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'test_table_one' => 'CREATE TABLE `test_table_one` (
+  `smallint` smallint(6) NOT NULL AUTO_INCREMENT,
+  `varchar` varchar(254) DEFAULT NULL,
+  PRIMARY KEY (`smallint`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'test_table_two' => 'CREATE TABLE `test_table_two` (
+  `smallint` smallint(6) NOT NULL AUTO_INCREMENT,
+  `varchar` varchar(254) DEFAULT NULL,
+  PRIMARY KEY (`smallint`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'reference_table' => 'CREATE TABLE `reference_table` (
+  `tinyint_ref` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `tinyint_without_padding` tinyint(4) NOT NULL DEFAULT 0,
+  `bigint_without_padding` bigint(20) NOT NULL DEFAULT 0,
+  `smallint_without_padding` smallint(6) NOT NULL DEFAULT 0,
+  `integer_without_padding` int(11) NOT NULL DEFAULT 0,
+  `smallint_with_big_padding` smallint(6) NOT NULL DEFAULT 0,
+  `smallint_without_default` smallint(6) DEFAULT NULL,
+  `int_without_unsigned` int(11) DEFAULT NULL,
+  `int_unsigned` int(10) unsigned DEFAULT NULL,
+  `bigint_default_nullable` bigint(20) unsigned DEFAULT 1,
+  `bigint_not_default_not_nullable` bigint(20) unsigned NOT NULL,
+  PRIMARY KEY (`tinyint_ref`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci',
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10427.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10427.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10427.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10427.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,14 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10611.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10611.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10611.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/_files/Magento/TestSetupDeclarationModule9/fixture/declarative_installer/disabling_tables.mariadb10611.php	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,14 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+return [
+    'auto_increment_test' => 'CREATE TABLE `auto_increment_test` (
+  `int_auto_increment_with_nullable` int(10) unsigned NOT NULL AUTO_INCREMENT,
+  `int_disabled_auto_increment` smallint(5) unsigned DEFAULT 0,
+  UNIQUE KEY `AUTO_INCREMENT_TEST_INT_AUTO_INCREMENT_WITH_NULLABLE` (`int_auto_increment_with_nullable`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_general_ci'
+];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/Annotation/DataProviderFromFile.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/Annotation/DataProviderFromFile.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/Annotation/DataProviderFromFile.php	2023-05-30 09:55:07.308890000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/Annotation/DataProviderFromFile.php	2023-05-16 15:26:28.000000000 +0100
@@ -29,7 +29,9 @@
         SqlVersionProvider::MYSQL_8_0_VERSION => 'mysql8',
         SqlVersionProvider::MARIA_DB_10_4_VERSION => 'mariadb10',
         SqlVersionProvider::MARIA_DB_10_6_VERSION => 'mariadb106',
-        SqlVersionProvider::MYSQL_8_0_29_VERSION => 'mysql829'
+        SqlVersionProvider::MYSQL_8_0_29_VERSION => 'mysql829',
+        SqlVersionProvider::MARIA_DB_10_4_27_VERSION => 'mariadb10427',
+        SqlVersionProvider::MARIA_DB_10_6_11_VERSION => 'mariadb10611'
     ];

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/TestCase/SetupTestCase.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/TestCase/SetupTestCase.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/TestCase/SetupTestCase.php	2023-05-30 09:55:07.308890000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/setup-integration/framework/Magento/TestFramework/TestCase/SetupTestCase.php	2023-05-16 15:26:28.000000000 +0100
@@ -110,6 +110,12 @@
             if ($this->sqlVersionProvider->isMysqlGte8029()) {
                 $this->dbKey = DataProviderFromFile::POSSIBLE_SUFFIXES[SqlVersionProvider::MYSQL_8_0_29_VERSION];
                 break;
+            } elseif ($this->sqlVersionProvider->isMariaDBGte10427()) {
+                $this->dbKey = DataProviderFromFile::POSSIBLE_SUFFIXES[SqlVersionProvider::MARIA_DB_10_4_27_VERSION];
+                break;
+            } elseif ($this->sqlVersionProvider->isMariaDBGte10611()) {
+                $this->dbKey = DataProviderFromFile::POSSIBLE_SUFFIXES[SqlVersionProvider::MARIA_DB_10_6_11_VERSION];
+                break;
             } elseif (strpos($this->getDatabaseVersion(), (string)$possibleVersion) !== false) {
                 $this->dbKey = $suffix;
                 break;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/static/testsuite/Magento/Test/Integrity/_files/extension_dependencies_test/allowed_dependencies/ce.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/static/testsuite/Magento/Test/Integrity/_files/extension_dependencies_test/allowed_dependencies/ce.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/static/testsuite/Magento/Test/Integrity/_files/extension_dependencies_test/allowed_dependencies/ce.php	2023-05-30 09:55:07.320890000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/static/testsuite/Magento/Test/Integrity/_files/extension_dependencies_test/allowed_dependencies/ce.php	2023-05-16 15:26:28.000000000 +0100
@@ -8,6 +8,7 @@
 return [
     'Magento\Elasticsearch' => [
         'Magento\Elasticsearch7',
+        'Magento\Elasticsearch8',
         'Magento\OpenSearch'
     ]
 ];
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/static/tmp/.gitignore /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/static/tmp/.gitignore
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/dev/tests/static/tmp/.gitignore	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/dev/tests/static/tmp/.gitignore	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,2 @@
+/*
+!/.gitignore
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/generated/.htaccess /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/generated/.htaccess
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/generated/.htaccess	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/generated/.htaccess	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,8 @@
+<IfVersion < 2.4>
+    order allow,deny
+    deny from all
+</IfVersion>
+<IfVersion >= 2.4>
+    Require all denied
+</IfVersion>
+
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/jquery/jquery-ui.js /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/jquery/jquery-ui.js
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/jquery/jquery-ui.js	2023-05-30 09:55:07.404891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/jquery/jquery-ui.js	2023-05-16 15:26:28.000000000 +0100
@@ -1,6 +1,6 @@
-/*! jQuery UI - v1.13.1 - 2022-02-22
+/*! jQuery UI - v1.13.2 - 2022-07-14
 * http://jqueryui.com
-* Includes: widget.js, position.js, data.js, disable-selection.js, focusable.js, form-reset-mixin.js, jquery-patch.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/draggable.js, widgets/droppable.js, widgets/resizable.js, widgets/selectable.js, widgets/sortable.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/selectmenu.js, widgets/slider.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js
+* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-patch.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */

 ( function( factory ) {
@@ -20,11 +20,11 @@

 $.ui = $.ui || {};

-var version = $.ui.version = "1.13.1";
+var version = $.ui.version = "1.13.2";


 /*!
- * jQuery UI Widget 1.13.1
+ * jQuery UI Widget 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -766,7 +766,7 @@


 /*!
- * jQuery UI Position 1.13.1
+ * jQuery UI Position 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -1263,7 +1263,7 @@


 /*!
- * jQuery UI :data 1.13.1
+ * jQuery UI :data 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -1292,7 +1292,7 @@
 } );

 /*!
- * jQuery UI Disable Selection 1.13.1
+ * jQuery UI Disable Selection 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -1326,1944 +1326,728 @@
 } );


-/*!
- * jQuery UI Focusable 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: :focusable Selector
-//>>group: Core
-//>>description: Selects elements which can be focused.
-//>>docs: http://api.jqueryui.com/focusable-selector/
-
-
-// Selectors
-$.ui.focusable = function( element, hasTabindex ) {
-	var map, mapName, img, focusableIfVisible, fieldset,
-		nodeName = element.nodeName.toLowerCase();
-
-	if ( "area" === nodeName ) {
-		map = element.parentNode;
-		mapName = map.name;
-		if ( !element.href || !mapName || map.nodeName.toLowerCase() !== "map" ) {
-			return false;
-		}
-		img = $( "img[usemap='#" + mapName + "']" );
-		return img.length > 0 && img.is( ":visible" );
-	}

-	if ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {
-		focusableIfVisible = !element.disabled;
-
-		if ( focusableIfVisible ) {
-
-			// Form controls within a disabled fieldset are disabled.
-			// However, controls within the fieldset's legend do not get disabled.
-			// Since controls generally aren't placed inside legends, we skip
-			// this portion of the check.
-			fieldset = $( element ).closest( "fieldset" )[ 0 ];
-			if ( fieldset ) {
-				focusableIfVisible = !fieldset.disabled;
-			}
-		}
-	} else if ( "a" === nodeName ) {
-		focusableIfVisible = element.href || hasTabindex;
-	} else {
-		focusableIfVisible = hasTabindex;
-	}
-
-	return focusableIfVisible && $( element ).is( ":visible" ) && visible( $( element ) );
-};
-
-// Support: IE 8 only
-// IE 8 doesn't resolve inherit to visible/hidden for computed values
-function visible( element ) {
-	var visibility = element.css( "visibility" );
-	while ( visibility === "inherit" ) {
-		element = element.parent();
-		visibility = element.css( "visibility" );
-	}
-	return visibility === "visible";
-}
-
-$.extend( $.expr.pseudos, {
-	focusable: function( element ) {
-		return $.ui.focusable( element, $.attr( element, "tabindex" ) != null );
-	}
-} );
-
-var focusable = $.ui.focusable;
-
-
-
-// Support: IE8 Only
-// IE8 does not support the form attribute and when it is supplied. It overwrites the form prop
-// with a string, so we need to find the proper form.
-var form = $.fn._form = function() {
-	return typeof this[ 0 ].form === "string" ? this.closest( "form" ) : $( this[ 0 ].form );
-};
-
-
-/*!
- * jQuery UI Form Reset Mixin 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Form Reset Mixin
-//>>group: Core
-//>>description: Refresh input widgets when their form is reset
-//>>docs: http://api.jqueryui.com/form-reset-mixin/
-
-
-var formResetMixin = $.ui.formResetMixin = {
-	_formResetHandler: function() {
-		var form = $( this );
-
-		// Wait for the form reset to actually happen before refreshing
-		setTimeout( function() {
-			var instances = form.data( "ui-form-reset-instances" );
-			$.each( instances, function() {
-				this.refresh();
-			} );
-		} );
-	},
-
-	_bindFormResetHandler: function() {
-		this.form = this.element._form();
-		if ( !this.form.length ) {
-			return;
-		}
-
-		var instances = this.form.data( "ui-form-reset-instances" ) || [];
-		if ( !instances.length ) {
-
-			// We don't use _on() here because we use a single event handler per form
-			this.form.on( "reset.ui-form-reset", this._formResetHandler );
-		}
-		instances.push( this );
-		this.form.data( "ui-form-reset-instances", instances );
-	},
-
-	_unbindFormResetHandler: function() {
-		if ( !this.form.length ) {
-			return;
-		}
-
-		var instances = this.form.data( "ui-form-reset-instances" );
-		instances.splice( $.inArray( this, instances ), 1 );
-		if ( instances.length ) {
-			this.form.data( "ui-form-reset-instances", instances );
-		} else {
-			this.form
-				.removeData( "ui-form-reset-instances" )
-				.off( "reset.ui-form-reset" );
-		}
-	}
-};
+// Create a local jQuery because jQuery Color relies on it and the
+// global may not exist with AMD and a custom build (#10199).
+// This module is a noop if used as a regular AMD module.
+// eslint-disable-next-line no-unused-vars
+var jQuery = $;


 /*!
- * jQuery UI Support for jQuery core 1.8.x and newer 1.13.1
- * http://jqueryui.com
+ * jQuery Color Animations v2.2.0
+ * https://github.com/jquery/jquery-color
  *
- * Copyright jQuery Foundation and other contributors
+ * Copyright OpenJS Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  *
+ * Date: Sun May 10 09:02:36 2020 +0200
  */

-//>>label: jQuery 1.8+ Support
-//>>group: Core
-//>>description: Support version 1.8.x and newer of jQuery core


-// Support: jQuery 1.9.x or older
-// $.expr[ ":" ] is deprecated.
-if ( !$.expr.pseudos ) {
-	$.expr.pseudos = $.expr[ ":" ];
-}
-
-// Support: jQuery 1.11.x or older
-// $.unique has been renamed to $.uniqueSort
-if ( !$.uniqueSort ) {
-	$.uniqueSort = $.unique;
-}
-
-// Support: jQuery 2.2.x or older.
-// This method has been defined in jQuery 3.0.0.
-// Code from https://github.com/jquery/jquery/blob/e539bac79e666bba95bba86d690b4e609dca2286/src/selector/escapeSelector.js
-if ( !$.escapeSelector ) {
+	var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor " +
+		"borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",

-	// CSS string/identifier serialization
-	// https://drafts.csswg.org/cssom/#common-serializing-idioms
-	var rcssescape = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;
+	class2type = {},
+	toString = class2type.toString,

-	var fcssescape = function( ch, asCodePoint ) {
-		if ( asCodePoint ) {
+	// plusequals test for += 100 -= 100
+	rplusequals = /^([\-+])=\s*(\d+\.?\d*)/,

-			// U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER
-			if ( ch === "\0" ) {
-				return "\uFFFD";
+	// a set of RE's that can match strings and generate color tuples.
+	stringParsers = [ {
+			re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
+			parse: function( execResult ) {
+				return [
+					execResult[ 1 ],
+					execResult[ 2 ],
+					execResult[ 3 ],
+					execResult[ 4 ]
+				];
 			}
-
-			// Control characters and (dependent upon position) numbers get escaped as code points
-			return ch.slice( 0, -1 ) + "\\" + ch.charCodeAt( ch.length - 1 ).toString( 16 ) + " ";
-		}
-
-		// Other potentially-special ASCII characters get backslash-escaped
-		return "\\" + ch;
-	};
-
-	$.escapeSelector = function( sel ) {
-		return ( sel + "" ).replace( rcssescape, fcssescape );
-	};
-}
-
-// Support: jQuery 3.4.x or older
-// These methods have been defined in jQuery 3.5.0.
-if ( !$.fn.even || !$.fn.odd ) {
-	$.fn.extend( {
-		even: function() {
-			return this.filter( function( i ) {
-				return i % 2 === 0;
-			} );
-		},
-		odd: function() {
-			return this.filter( function( i ) {
-				return i % 2 === 1;
-			} );
-		}
-	} );
-}
-
-;
-/*!
- * jQuery UI Keycode 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Keycode
-//>>group: Core
-//>>description: Provide keycodes as keynames
-//>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/
-
-
-var keycode = $.ui.keyCode = {
-	BACKSPACE: 8,
-	COMMA: 188,
-	DELETE: 46,
-	DOWN: 40,
-	END: 35,
-	ENTER: 13,
-	ESCAPE: 27,
-	HOME: 36,
-	LEFT: 37,
-	PAGE_DOWN: 34,
-	PAGE_UP: 33,
-	PERIOD: 190,
-	RIGHT: 39,
-	SPACE: 32,
-	TAB: 9,
-	UP: 38
-};
-
-
-/*!
- * jQuery UI Labels 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: labels
-//>>group: Core
-//>>description: Find all the labels associated with a given input
-//>>docs: http://api.jqueryui.com/labels/
-
-
-var labels = $.fn.labels = function() {
-	var ancestor, selector, id, labels, ancestors;
-
-	if ( !this.length ) {
-		return this.pushStack( [] );
-	}
-
-	// Check control.labels first
-	if ( this[ 0 ].labels && this[ 0 ].labels.length ) {
-		return this.pushStack( this[ 0 ].labels );
-	}
-
-	// Support: IE <= 11, FF <= 37, Android <= 2.3 only
-	// Above browsers do not support control.labels. Everything below is to support them
-	// as well as document fragments. control.labels does not work on document fragments
-	labels = this.eq( 0 ).parents( "label" );
-
-	// Look for the label based on the id
-	id = this.attr( "id" );
-	if ( id ) {
-
-		// We don't search against the document in case the element
-		// is disconnected from the DOM
-		ancestor = this.eq( 0 ).parents().last();
-
-		// Get a full set of top level ancestors
-		ancestors = ancestor.add( ancestor.length ? ancestor.siblings() : this.siblings() );
-
-		// Create a selector for the label based on the id
-		selector = "label[for='" + $.escapeSelector( id ) + "']";
-
-		labels = labels.add( ancestors.find( selector ).addBack( selector ) );
-
-	}
-
-	// Return whatever we have found for labels
-	return this.pushStack( labels );
-};
-
-
-/*!
- * jQuery UI Scroll Parent 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: scrollParent
-//>>group: Core
-//>>description: Get the closest ancestor element that is scrollable.
-//>>docs: http://api.jqueryui.com/scrollParent/
-
-
-var scrollParent = $.fn.scrollParent = function( includeHidden ) {
-	var position = this.css( "position" ),
-		excludeStaticParent = position === "absolute",
-		overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
-		scrollParent = this.parents().filter( function() {
-			var parent = $( this );
-			if ( excludeStaticParent && parent.css( "position" ) === "static" ) {
-				return false;
+		}, {
+			re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
+			parse: function( execResult ) {
+				return [
+					execResult[ 1 ] * 2.55,
+					execResult[ 2 ] * 2.55,
+					execResult[ 3 ] * 2.55,
+					execResult[ 4 ]
+				];
 			}
-			return overflowRegex.test( parent.css( "overflow" ) + parent.css( "overflow-y" ) +
-				parent.css( "overflow-x" ) );
-		} ).eq( 0 );
-
-	return position === "fixed" || !scrollParent.length ?
-		$( this[ 0 ].ownerDocument || document ) :
-		scrollParent;
-};
-
-
-/*!
- * jQuery UI Tabbable 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: :tabbable Selector
-//>>group: Core
-//>>description: Selects elements which can be tabbed to.
-//>>docs: http://api.jqueryui.com/tabbable-selector/
-
-
-var tabbable = $.extend( $.expr.pseudos, {
-	tabbable: function( element ) {
-		var tabIndex = $.attr( element, "tabindex" ),
-			hasTabindex = tabIndex != null;
-		return ( !hasTabindex || tabIndex >= 0 ) && $.ui.focusable( element, hasTabindex );
-	}
-} );
-
-
-/*!
- * jQuery UI Unique ID 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: uniqueId
-//>>group: Core
-//>>description: Functions to generate and remove uniqueId's
-//>>docs: http://api.jqueryui.com/uniqueId/
-
-
-var uniqueId = $.fn.extend( {
-	uniqueId: ( function() {
-		var uuid = 0;
-
-		return function() {
-			return this.each( function() {
-				if ( !this.id ) {
-					this.id = "ui-id-" + ( ++uuid );
-				}
-			} );
-		};
-	} )(),
+		}, {

-	removeUniqueId: function() {
-		return this.each( function() {
-			if ( /^ui-id-\d+$/.test( this.id ) ) {
-				$( this ).removeAttr( "id" );
+			// this regex ignores A-F because it's compared against an already lowercased string
+			re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,
+			parse: function( execResult ) {
+				return [
+					parseInt( execResult[ 1 ], 16 ),
+					parseInt( execResult[ 2 ], 16 ),
+					parseInt( execResult[ 3 ], 16 ),
+					execResult[ 4 ] ?
+						( parseInt( execResult[ 4 ], 16 ) / 255 ).toFixed( 2 ) :
+						1
+				];
 			}
-		} );
-	}
-} );
-
-
-
-// This file is deprecated
-var ie = $.ui.ie = !!/msie [\w.]+/.exec( navigator.userAgent.toLowerCase() );
-
-/*!
- * jQuery UI Mouse 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Mouse
-//>>group: Widgets
-//>>description: Abstracts mouse-based interactions to assist in creating certain widgets.
-//>>docs: http://api.jqueryui.com/mouse/
-
-
-var mouseHandled = false;
-$( document ).on( "mouseup", function() {
-	mouseHandled = false;
-} );
-
-var widgetsMouse = $.widget( "ui.mouse", {
-	version: "1.13.1",
-	options: {
-		cancel: "input, textarea, button, select, option",
-		distance: 1,
-		delay: 0
-	},
-	_mouseInit: function() {
-		var that = this;
-
-		this.element
-			.on( "mousedown." + this.widgetName, function( event ) {
-				return that._mouseDown( event );
-			} )
-			.on( "click." + this.widgetName, function( event ) {
-				if ( true === $.data( event.target, that.widgetName + ".preventClickEvent" ) ) {
-					$.removeData( event.target, that.widgetName + ".preventClickEvent" );
-					event.stopImmediatePropagation();
-					return false;
-				}
-			} );
-
-		this.started = false;
-	},
-
-	// TODO: make sure destroying one instance of mouse doesn't mess with
-	// other instances of mouse
-	_mouseDestroy: function() {
-		this.element.off( "." + this.widgetName );
-		if ( this._mouseMoveDelegate ) {
-			this.document
-				.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
-				.off( "mouseup." + this.widgetName, this._mouseUpDelegate );
-		}
-	},
-
-	_mouseDown: function( event ) {
-
-		// don't let more than one widget handle mouseStart
-		if ( mouseHandled ) {
-			return;
-		}
-
-		this._mouseMoved = false;
-
-		// We may have missed mouseup (out of window)
-		if ( this._mouseStarted ) {
-			this._mouseUp( event );
-		}
-
-		this._mouseDownEvent = event;
-
-		var that = this,
-			btnIsLeft = ( event.which === 1 ),
-
-			// event.target.nodeName works around a bug in IE 8 with
-			// disabled inputs (#7620)
-			elIsCancel = ( typeof this.options.cancel === "string" && event.target.nodeName ?
-				$( event.target ).closest( this.options.cancel ).length : false );
-		if ( !btnIsLeft || elIsCancel || !this._mouseCapture( event ) ) {
-			return true;
-		}
-
-		this.mouseDelayMet = !this.options.delay;
-		if ( !this.mouseDelayMet ) {
-			this._mouseDelayTimer = setTimeout( function() {
-				that.mouseDelayMet = true;
-			}, this.options.delay );
-		}
+		}, {

-		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
-			this._mouseStarted = ( this._mouseStart( event ) !== false );
-			if ( !this._mouseStarted ) {
-				event.preventDefault();
-				return true;
+			// this regex ignores A-F because it's compared against an already lowercased string
+			re: /#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,
+			parse: function( execResult ) {
+				return [
+					parseInt( execResult[ 1 ] + execResult[ 1 ], 16 ),
+					parseInt( execResult[ 2 ] + execResult[ 2 ], 16 ),
+					parseInt( execResult[ 3 ] + execResult[ 3 ], 16 ),
+					execResult[ 4 ] ?
+						( parseInt( execResult[ 4 ] + execResult[ 4 ], 16 ) / 255 )
+							.toFixed( 2 ) :
+						1
+				];
 			}
-		}
-
-		// Click event may never have fired (Gecko & Opera)
-		if ( true === $.data( event.target, this.widgetName + ".preventClickEvent" ) ) {
-			$.removeData( event.target, this.widgetName + ".preventClickEvent" );
-		}
-
-		// These delegates are required to keep context
-		this._mouseMoveDelegate = function( event ) {
-			return that._mouseMove( event );
-		};
-		this._mouseUpDelegate = function( event ) {
-			return that._mouseUp( event );
-		};
-
-		this.document
-			.on( "mousemove." + this.widgetName, this._mouseMoveDelegate )
-			.on( "mouseup." + this.widgetName, this._mouseUpDelegate );
-
-		event.preventDefault();
+		}, {
+			re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
+			space: "hsla",
+			parse: function( execResult ) {
+				return [
+					execResult[ 1 ],
+					execResult[ 2 ] / 100,
+					execResult[ 3 ] / 100,
+					execResult[ 4 ]
+				];
+			}
+		} ],

-		mouseHandled = true;
-		return true;
+	// jQuery.Color( )
+	color = jQuery.Color = function( color, green, blue, alpha ) {
+		return new jQuery.Color.fn.parse( color, green, blue, alpha );
 	},
-
-	_mouseMove: function( event ) {
-
-		// Only check for mouseups outside the document if you've moved inside the document
-		// at least once. This prevents the firing of mouseup in the case of IE<9, which will
-		// fire a mousemove event if content is placed under the cursor. See #7778
-		// Support: IE <9
-		if ( this._mouseMoved ) {
-
-			// IE mouseup check - mouseup happened when mouse was out of window
-			if ( $.ui.ie && ( !document.documentMode || document.documentMode < 9 ) &&
-					!event.button ) {
-				return this._mouseUp( event );
-
-			// Iframe mouseup check - mouseup occurred in another document
-			} else if ( !event.which ) {
-
-				// Support: Safari <=8 - 9
-				// Safari sets which to 0 if you press any of the following keys
-				// during a drag (#14461)
-				if ( event.originalEvent.altKey || event.originalEvent.ctrlKey ||
-						event.originalEvent.metaKey || event.originalEvent.shiftKey ) {
-					this.ignoreMissingWhich = true;
-				} else if ( !this.ignoreMissingWhich ) {
-					return this._mouseUp( event );
+	spaces = {
+		rgba: {
+			props: {
+				red: {
+					idx: 0,
+					type: "byte"
+				},
+				green: {
+					idx: 1,
+					type: "byte"
+				},
+				blue: {
+					idx: 2,
+					type: "byte"
 				}
 			}
-		}
-
-		if ( event.which || event.button ) {
-			this._mouseMoved = true;
-		}
-
-		if ( this._mouseStarted ) {
-			this._mouseDrag( event );
-			return event.preventDefault();
-		}
+		},

-		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
-			this._mouseStarted =
-				( this._mouseStart( this._mouseDownEvent, event ) !== false );
-			if ( this._mouseStarted ) {
-				this._mouseDrag( event );
-			} else {
-				this._mouseUp( event );
+		hsla: {
+			props: {
+				hue: {
+					idx: 0,
+					type: "degrees"
+				},
+				saturation: {
+					idx: 1,
+					type: "percent"
+				},
+				lightness: {
+					idx: 2,
+					type: "percent"
+				}
 			}
 		}
-
-		return !this._mouseStarted;
 	},
-
-	_mouseUp: function( event ) {
-		this.document
-			.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
-			.off( "mouseup." + this.widgetName, this._mouseUpDelegate );
-
-		if ( this._mouseStarted ) {
-			this._mouseStarted = false;
-
-			if ( event.target === this._mouseDownEvent.target ) {
-				$.data( event.target, this.widgetName + ".preventClickEvent", true );
-			}
-
-			this._mouseStop( event );
-		}
-
-		if ( this._mouseDelayTimer ) {
-			clearTimeout( this._mouseDelayTimer );
-			delete this._mouseDelayTimer;
+	propTypes = {
+		"byte": {
+			floor: true,
+			max: 255
+		},
+		"percent": {
+			max: 1
+		},
+		"degrees": {
+			mod: 360,
+			floor: true
 		}
-
-		this.ignoreMissingWhich = false;
-		mouseHandled = false;
-		event.preventDefault();
-	},
-
-	_mouseDistanceMet: function( event ) {
-		return ( Math.max(
-				Math.abs( this._mouseDownEvent.pageX - event.pageX ),
-				Math.abs( this._mouseDownEvent.pageY - event.pageY )
-			) >= this.options.distance
-		);
-	},
-
-	_mouseDelayMet: function( /* event */ ) {
-		return this.mouseDelayMet;
 	},
+	support = color.support = {},

-	// These are placeholder methods, to be overriden by extending plugin
-	_mouseStart: function( /* event */ ) {},
-	_mouseDrag: function( /* event */ ) {},
-	_mouseStop: function( /* event */ ) {},
-	_mouseCapture: function( /* event */ ) {
-		return true;
-	}
-} );
+	// element for support tests
+	supportElem = jQuery( "<p>" )[ 0 ],

+	// colors = jQuery.Color.names
+	colors,

+	// local aliases of functions called often
+	each = jQuery.each;

-// $.ui.plugin is deprecated. Use $.widget() extensions instead.
-var plugin = $.ui.plugin = {
-	add: function( module, option, set ) {
-		var i,
-			proto = $.ui[ module ].prototype;
-		for ( i in set ) {
-			proto.plugins[ i ] = proto.plugins[ i ] || [];
-			proto.plugins[ i ].push( [ option, set[ i ] ] );
-		}
-	},
-	call: function( instance, name, args, allowDisconnected ) {
-		var i,
-			set = instance.plugins[ name ];
+// determine rgba support immediately
+supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
+support.rgba = supportElem.style.backgroundColor.indexOf( "rgba" ) > -1;

-		if ( !set ) {
-			return;
-		}
+// define cache name and alpha properties
+// for rgba and hsla spaces
+each( spaces, function( spaceName, space ) {
+	space.cache = "_" + spaceName;
+	space.props.alpha = {
+		idx: 3,
+		type: "percent",
+		def: 1
+	};
+} );

-		if ( !allowDisconnected && ( !instance.element[ 0 ].parentNode ||
-				instance.element[ 0 ].parentNode.nodeType === 11 ) ) {
-			return;
-		}
+// Populate the class2type map
+jQuery.each( "Boolean Number String Function Array Date RegExp Object Error Symbol".split( " " ),
+	function( _i, name ) {
+		class2type[ "[object " + name + "]" ] = name.toLowerCase();
+	} );

-		for ( i = 0; i < set.length; i++ ) {
-			if ( instance.options[ set[ i ][ 0 ] ] ) {
-				set[ i ][ 1 ].apply( instance.element, args );
-			}
-		}
+function getType( obj ) {
+	if ( obj == null ) {
+		return obj + "";
 	}
-};
-

+	return typeof obj === "object" ?
+		class2type[ toString.call( obj ) ] || "object" :
+		typeof obj;
+}

-var safeActiveElement = $.ui.safeActiveElement = function( document ) {
-	var activeElement;
+function clamp( value, prop, allowEmpty ) {
+	var type = propTypes[ prop.type ] || {};

-	// Support: IE 9 only
-	// IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
-	try {
-		activeElement = document.activeElement;
-	} catch ( error ) {
-		activeElement = document.body;
+	if ( value == null ) {
+		return ( allowEmpty || !prop.def ) ? null : prop.def;
 	}

-	// Support: IE 9 - 11 only
-	// IE may return null instead of an element
-	// Interestingly, this only seems to occur when NOT in an iframe
-	if ( !activeElement ) {
-		activeElement = document.body;
-	}
+	// ~~ is an short way of doing floor for positive numbers
+	value = type.floor ? ~~value : parseFloat( value );

-	// Support: IE 11 only
-	// IE11 returns a seemingly empty object in some cases when accessing
-	// document.activeElement from an <iframe>
-	if ( !activeElement.nodeName ) {
-		activeElement = document.body;
+	// IE will pass in empty strings as value for alpha,
+	// which will hit this case
+	if ( isNaN( value ) ) {
+		return prop.def;
 	}

-	return activeElement;
-};
-
-
-
-var safeBlur = $.ui.safeBlur = function( element ) {
+	if ( type.mod ) {

-	// Support: IE9 - 10 only
-	// If the <body> is blurred, IE will switch windows, see #9420
-	if ( element && element.nodeName.toLowerCase() !== "body" ) {
-		$( element ).trigger( "blur" );
+		// we add mod before modding to make sure that negatives values
+		// get converted properly: -10 -> 350
+		return ( value + type.mod ) % type.mod;
 	}
-};
-
-
-/*!
- * jQuery UI Draggable 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Draggable
-//>>group: Interactions
-//>>description: Enables dragging functionality for any element.
-//>>docs: http://api.jqueryui.com/draggable/
-//>>demos: http://jqueryui.com/draggable/
-//>>css.structure: ../../themes/base/draggable.css
-

-$.widget( "ui.draggable", $.ui.mouse, {
-	version: "1.13.1",
-	widgetEventPrefix: "drag",
-	options: {
-		addClasses: true,
-		appendTo: "parent",
-		axis: false,
-		connectToSortable: false,
-		containment: false,
-		cursor: "auto",
-		cursorAt: false,
-		grid: false,
-		handle: false,
-		helper: "original",
-		iframeFix: false,
-		opacity: false,
-		refreshPositions: false,
-		revert: false,
-		revertDuration: 500,
-		scope: "default",
-		scroll: true,
-		scrollSensitivity: 20,
-		scrollSpeed: 20,
-		snap: false,
-		snapMode: "both",
-		snapTolerance: 20,
-		stack: false,
-		zIndex: false,
-
-		// Callbacks
-		drag: null,
-		start: null,
-		stop: null
-	},
-	_create: function() {
-
-		if ( this.options.helper === "original" ) {
-			this._setPositionRelative();
-		}
-		if ( this.options.addClasses ) {
-			this._addClass( "ui-draggable" );
-		}
-		this._setHandleClassName();
+	// for now all property types without mod have min and max
+	return Math.min( type.max, Math.max( 0, value ) );
+}

-		this._mouseInit();
-	},
+function stringParse( string ) {
+	var inst = color(),
+		rgba = inst._rgba = [];

-	_setOption: function( key, value ) {
-		this._super( key, value );
-		if ( key === "handle" ) {
-			this._removeHandleClassName();
-			this._setHandleClassName();
-		}
-	},
+	string = string.toLowerCase();

-	_destroy: function() {
-		if ( ( this.helper || this.element ).is( ".ui-draggable-dragging" ) ) {
-			this.destroyOnClear = true;
-			return;
-		}
-		this._removeHandleClassName();
-		this._mouseDestroy();
-	},
+	each( stringParsers, function( _i, parser ) {
+		var parsed,
+			match = parser.re.exec( string ),
+			values = match && parser.parse( match ),
+			spaceName = parser.space || "rgba";

-	_mouseCapture: function( event ) {
-		var o = this.options;
+		if ( values ) {
+			parsed = inst[ spaceName ]( values );

-		// Among others, prevent a drag on a resizable-handle
-		if ( this.helper || o.disabled ||
-				$( event.target ).closest( ".ui-resizable-handle" ).length > 0 ) {
-			return false;
-		}
+			// if this was an rgba parse the assignment might happen twice
+			// oh well....
+			inst[ spaces[ spaceName ].cache ] = parsed[ spaces[ spaceName ].cache ];
+			rgba = inst._rgba = parsed._rgba;

-		//Quit if we're not on a valid handle
-		this.handle = this._getHandle( event );
-		if ( !this.handle ) {
+			// exit each( stringParsers ) here because we matched
 			return false;
 		}
+	} );

-		this._blurActiveElement( event );
-
-		this._blockFrames( o.iframeFix === true ? "iframe" : o.iframeFix );
-
-		return true;
-
-	},
-
-	_blockFrames: function( selector ) {
-		this.iframeBlocks = this.document.find( selector ).map( function() {
-			var iframe = $( this );
-
-			return $( "<div>" )
-				.css( "position", "absolute" )
-				.appendTo( iframe.parent() )
-				.outerWidth( iframe.outerWidth() )
-				.outerHeight( iframe.outerHeight() )
-				.offset( iframe.offset() )[ 0 ];
-		} );
-	},
-
-	_unblockFrames: function() {
-		if ( this.iframeBlocks ) {
-			this.iframeBlocks.remove();
-			delete this.iframeBlocks;
-		}
-	},
-
-	_blurActiveElement: function( event ) {
-		var activeElement = $.ui.safeActiveElement( this.document[ 0 ] ),
-			target = $( event.target );
+	// Found a stringParser that handled it
+	if ( rgba.length ) {

-		// Don't blur if the event occurred on an element that is within
-		// the currently focused element
-		// See #10527, #12472
-		if ( target.closest( activeElement ).length ) {
-			return;
+		// if this came from a parsed string, force "transparent" when alpha is 0
+		// chrome, (and maybe others) return "transparent" as rgba(0,0,0,0)
+		if ( rgba.join() === "0,0,0,0" ) {
+			jQuery.extend( rgba, colors.transparent );
 		}
+		return inst;
+	}

-		// Blur any element that currently has focus, see #4261
-		$.ui.safeBlur( activeElement );
-	},
-
-	_mouseStart: function( event ) {
-
-		var o = this.options;
-
-		//Create and append the visible helper
-		this.helper = this._createHelper( event );
-
-		this._addClass( this.helper, "ui-draggable-dragging" );
-
-		//Cache the helper size
-		this._cacheHelperProportions();
+	// named colors
+	return colors[ string ];
+}

-		//If ddmanager is used for droppables, set the global draggable
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.current = this;
+color.fn = jQuery.extend( color.prototype, {
+	parse: function( red, green, blue, alpha ) {
+		if ( red === undefined ) {
+			this._rgba = [ null, null, null, null ];
+			return this;
 		}
-
-		/*
-		 * - Position generation -
-		 * This block generates everything position related - it's the core of draggables.
-		 */
-
-		//Cache the margins of the original element
-		this._cacheMargins();
-
-		//Store the helper's css position
-		this.cssPosition = this.helper.css( "position" );
-		this.scrollParent = this.helper.scrollParent( true );
-		this.offsetParent = this.helper.offsetParent();
-		this.hasFixedAncestor = this.helper.parents().filter( function() {
-				return $( this ).css( "position" ) === "fixed";
-			} ).length > 0;
-
-		//The element's absolute position on the page minus margins
-		this.positionAbs = this.element.offset();
-		this._refreshOffsets( event );
-
-		//Generate the original position
-		this.originalPosition = this.position = this._generatePosition( event, false );
-		this.originalPageX = event.pageX;
-		this.originalPageY = event.pageY;
-
-		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
-		if ( o.cursorAt ) {
-			this._adjustOffsetFromHelper( o.cursorAt );
+		if ( red.jquery || red.nodeType ) {
+			red = jQuery( red ).css( green );
+			green = undefined;
 		}

-		//Set a containment if given in the options
-		this._setContainment();
+		var inst = this,
+			type = getType( red ),
+			rgba = this._rgba = [];

-		//Trigger event + callbacks
-		if ( this._trigger( "start", event ) === false ) {
-			this._clear();
-			return false;
+		// more than 1 argument specified - assume ( red, green, blue, alpha )
+		if ( green !== undefined ) {
+			red = [ red, green, blue, alpha ];
+			type = "array";
 		}

-		//Recache the helper size
-		this._cacheHelperProportions();
-
-		//Prepare the droppable offsets
-		if ( $.ui.ddmanager && !o.dropBehaviour ) {
-			$.ui.ddmanager.prepareOffsets( this, event );
+		if ( type === "string" ) {
+			return this.parse( stringParse( red ) || colors._default );
 		}

-		// Execute the drag once - this causes the helper not to be visible before getting its
-		// correct position
-		this._mouseDrag( event, true );
-
-		// If the ddmanager is used for droppables, inform the manager that dragging has started
-		// (see #5003)
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.dragStart( this, event );
+		if ( type === "array" ) {
+			each( spaces.rgba.props, function( _key, prop ) {
+				rgba[ prop.idx ] = clamp( red[ prop.idx ], prop );
+			} );
+			return this;
 		}

-		return true;
-	},
+		if ( type === "object" ) {
+			if ( red instanceof color ) {
+				each( spaces, function( _spaceName, space ) {
+					if ( red[ space.cache ] ) {
+						inst[ space.cache ] = red[ space.cache ].slice();
+					}
+				} );
+			} else {
+				each( spaces, function( _spaceName, space ) {
+					var cache = space.cache;
+					each( space.props, function( key, prop ) {

-	_refreshOffsets: function( event ) {
-		this.offset = {
-			top: this.positionAbs.top - this.margins.top,
-			left: this.positionAbs.left - this.margins.left,
-			scroll: false,
-			parent: this._getParentOffset(),
-			relative: this._getRelativeOffset()
-		};
+						// if the cache doesn't exist, and we know how to convert
+						if ( !inst[ cache ] && space.to ) {

-		this.offset.click = {
-			left: event.pageX - this.offset.left,
-			top: event.pageY - this.offset.top
-		};
-	},
+							// if the value was null, we don't need to copy it
+							// if the key was alpha, we don't need to copy it either
+							if ( key === "alpha" || red[ key ] == null ) {
+								return;
+							}
+							inst[ cache ] = space.to( inst._rgba );
+						}

-	_mouseDrag: function( event, noPropagation ) {
+						// this is the only case where we allow nulls for ALL properties.
+						// call clamp with alwaysAllowEmpty
+						inst[ cache ][ prop.idx ] = clamp( red[ key ], prop, true );
+					} );

-		// reset any necessary cached properties (see #5009)
-		if ( this.hasFixedAncestor ) {
-			this.offset.parent = this._getParentOffset();
-		}
+					// everything defined but alpha?
+					if ( inst[ cache ] && jQuery.inArray( null, inst[ cache ].slice( 0, 3 ) ) < 0 ) {

-		//Compute the helpers position
-		this.position = this._generatePosition( event, true );
-		this.positionAbs = this._convertPositionTo( "absolute" );
+						// use the default of 1
+						if ( inst[ cache ][ 3 ] == null ) {
+							inst[ cache ][ 3 ] = 1;
+						}

-		//Call plugins and callbacks and use the resulting position if something is returned
-		if ( !noPropagation ) {
-			var ui = this._uiHash();
-			if ( this._trigger( "drag", event, ui ) === false ) {
-				this._mouseUp( new $.Event( "mouseup", event ) );
-				return false;
+						if ( space.from ) {
+							inst._rgba = space.from( inst[ cache ] );
+						}
+					}
+				} );
 			}
-			this.position = ui.position;
-		}
-
-		this.helper[ 0 ].style.left = this.position.left + "px";
-		this.helper[ 0 ].style.top = this.position.top + "px";
-
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.drag( this, event );
+			return this;
 		}
-
-		return false;
 	},
+	is: function( compare ) {
+		var is = color( compare ),
+			same = true,
+			inst = this;

-	_mouseStop: function( event ) {
-
-		//If we are using droppables, inform the manager about the drop
-		var that = this,
-			dropped = false;
-		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
-			dropped = $.ui.ddmanager.drop( this, event );
-		}
-
-		//if a drop comes from outside (a sortable)
-		if ( this.dropped ) {
-			dropped = this.dropped;
-			this.dropped = false;
-		}
-
-		if ( ( this.options.revert === "invalid" && !dropped ) ||
-				( this.options.revert === "valid" && dropped ) ||
-				this.options.revert === true || ( typeof this.options.revert === "function" &&
-				this.options.revert.call( this.element, dropped ) )
-		) {
-			$( this.helper ).animate(
-				this.originalPosition,
-				parseInt( this.options.revertDuration, 10 ),
-				function() {
-					if ( that._trigger( "stop", event ) !== false ) {
-						that._clear();
+		each( spaces, function( _, space ) {
+			var localCache,
+				isCache = is[ space.cache ];
+			if ( isCache ) {
+				localCache = inst[ space.cache ] || space.to && space.to( inst._rgba ) || [];
+				each( space.props, function( _, prop ) {
+					if ( isCache[ prop.idx ] != null ) {
+						same = ( isCache[ prop.idx ] === localCache[ prop.idx ] );
+						return same;
 					}
-				}
-			);
-		} else {
-			if ( this._trigger( "stop", event ) !== false ) {
-				this._clear();
+				} );
 			}
-		}
-
-		return false;
-	},
-
-	_mouseUp: function( event ) {
-		this._unblockFrames();
-
-		// If the ddmanager is used for droppables, inform the manager that dragging has stopped
-		// (see #5003)
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.dragStop( this, event );
-		}
-
-		// Only need to focus if the event occurred on the draggable itself, see #10527
-		if ( this.handleElement.is( event.target ) ) {
-
-			// The interaction is over; whether or not the click resulted in a drag,
-			// focus the element
-			this.element.trigger( "focus" );
-		}
-
-		return $.ui.mouse.prototype._mouseUp.call( this, event );
-	},
-
-	cancel: function() {
-
-		if ( this.helper.is( ".ui-draggable-dragging" ) ) {
-			this._mouseUp( new $.Event( "mouseup", { target: this.element[ 0 ] } ) );
-		} else {
-			this._clear();
-		}
-
-		return this;
-
-	},
-
-	_getHandle: function( event ) {
-		return this.options.handle ?
-			!!$( event.target ).closest( this.element.find( this.options.handle ) ).length :
-			true;
-	},
-
-	_setHandleClassName: function() {
-		this.handleElement = this.options.handle ?
-			this.element.find( this.options.handle ) : this.element;
-		this._addClass( this.handleElement, "ui-draggable-handle" );
-	},
-
-	_removeHandleClassName: function() {
-		this._removeClass( this.handleElement, "ui-draggable-handle" );
-	},
-
-	_createHelper: function( event ) {
-
-		var o = this.options,
-			helperIsFunction = typeof o.helper === "function",
-			helper = helperIsFunction ?
-				$( o.helper.apply( this.element[ 0 ], [ event ] ) ) :
-				( o.helper === "clone" ?
-					this.element.clone().removeAttr( "id" ) :
-					this.element );
-
-		if ( !helper.parents( "body" ).length ) {
-			helper.appendTo( ( o.appendTo === "parent" ?
-				this.element[ 0 ].parentNode :
-				o.appendTo ) );
-		}
-
-		// Http://bugs.jqueryui.com/ticket/9446
-		// a helper function can return the original element
-		// which wouldn't have been set to relative in _create
-		if ( helperIsFunction && helper[ 0 ] === this.element[ 0 ] ) {
-			this._setPositionRelative();
-		}
-
-		if ( helper[ 0 ] !== this.element[ 0 ] &&
-				!( /(fixed|absolute)/ ).test( helper.css( "position" ) ) ) {
-			helper.css( "position", "absolute" );
-		}
-
-		return helper;
-
-	},
-
-	_setPositionRelative: function() {
-		if ( !( /^(?:r|a|f)/ ).test( this.element.css( "position" ) ) ) {
-			this.element[ 0 ].style.position = "relative";
-		}
-	},
-
-	_adjustOffsetFromHelper: function( obj ) {
-		if ( typeof obj === "string" ) {
-			obj = obj.split( " " );
-		}
-		if ( Array.isArray( obj ) ) {
-			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
-		}
-		if ( "left" in obj ) {
-			this.offset.click.left = obj.left + this.margins.left;
-		}
-		if ( "right" in obj ) {
-			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
-		}
-		if ( "top" in obj ) {
-			this.offset.click.top = obj.top + this.margins.top;
-		}
-		if ( "bottom" in obj ) {
-			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
-		}
-	},
-
-	_isRootNode: function( element ) {
-		return ( /(html|body)/i ).test( element.tagName ) || element === this.document[ 0 ];
+			return same;
+		} );
+		return same;
 	},
-
-	_getParentOffset: function() {
-
-		//Get the offsetParent and cache its position
-		var po = this.offsetParent.offset(),
-			document = this.document[ 0 ];
-
-		// This is a special case where we need to modify a offset calculated on start, since the
-		// following happened:
-		// 1. The position of the helper is absolute, so it's position is calculated based on the
-		// next positioned parent
-		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
-		// the document, which means that the scroll is included in the initial calculation of the
-		// offset of the parent, and never recalculated upon drag
-		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== document &&
-				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
-			po.left += this.scrollParent.scrollLeft();
-			po.top += this.scrollParent.scrollTop();
-		}
-
-		if ( this._isRootNode( this.offsetParent[ 0 ] ) ) {
-			po = { top: 0, left: 0 };
-		}
-
-		return {
-			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
-			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
-		};
-
+	_space: function() {
+		var used = [],
+			inst = this;
+		each( spaces, function( spaceName, space ) {
+			if ( inst[ space.cache ] ) {
+				used.push( spaceName );
+			}
+		} );
+		return used.pop();
 	},
+	transition: function( other, distance ) {
+		var end = color( other ),
+			spaceName = end._space(),
+			space = spaces[ spaceName ],
+			startColor = this.alpha() === 0 ? color( "transparent" ) : this,
+			start = startColor[ space.cache ] || space.to( startColor._rgba ),
+			result = start.slice();

-	_getRelativeOffset: function() {
-		if ( this.cssPosition !== "relative" ) {
-			return { top: 0, left: 0 };
-		}
-
-		var p = this.element.position(),
-			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );
-
-		return {
-			top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
-				( !scrollIsRootNode ? this.scrollParent.scrollTop() : 0 ),
-			left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
-				( !scrollIsRootNode ? this.scrollParent.scrollLeft() : 0 )
-		};
-
-	},
+		end = end[ space.cache ];
+		each( space.props, function( _key, prop ) {
+			var index = prop.idx,
+				startValue = start[ index ],
+				endValue = end[ index ],
+				type = propTypes[ prop.type ] || {};

-	_cacheMargins: function() {
-		this.margins = {
-			left: ( parseInt( this.element.css( "marginLeft" ), 10 ) || 0 ),
-			top: ( parseInt( this.element.css( "marginTop" ), 10 ) || 0 ),
-			right: ( parseInt( this.element.css( "marginRight" ), 10 ) || 0 ),
-			bottom: ( parseInt( this.element.css( "marginBottom" ), 10 ) || 0 )
-		};
-	},
+			// if null, don't override start value
+			if ( endValue === null ) {
+				return;
+			}

-	_cacheHelperProportions: function() {
-		this.helperProportions = {
-			width: this.helper.outerWidth(),
-			height: this.helper.outerHeight()
-		};
+			// if null - use end
+			if ( startValue === null ) {
+				result[ index ] = endValue;
+			} else {
+				if ( type.mod ) {
+					if ( endValue - startValue > type.mod / 2 ) {
+						startValue += type.mod;
+					} else if ( startValue - endValue > type.mod / 2 ) {
+						startValue -= type.mod;
+					}
+				}
+				result[ index ] = clamp( ( endValue - startValue ) * distance + startValue, prop );
+			}
+		} );
+		return this[ spaceName ]( result );
 	},
+	blend: function( opaque ) {

-	_setContainment: function() {
-
-		var isUserScrollable, c, ce,
-			o = this.options,
-			document = this.document[ 0 ];
-
-		this.relativeContainer = null;
-
-		if ( !o.containment ) {
-			this.containment = null;
-			return;
-		}
-
-		if ( o.containment === "window" ) {
-			this.containment = [
-				$( window ).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
-				$( window ).scrollTop() - this.offset.relative.top - this.offset.parent.top,
-				$( window ).scrollLeft() + $( window ).width() -
-					this.helperProportions.width - this.margins.left,
-				$( window ).scrollTop() +
-					( $( window ).height() || document.body.parentNode.scrollHeight ) -
-					this.helperProportions.height - this.margins.top
-			];
-			return;
-		}
-
-		if ( o.containment === "document" ) {
-			this.containment = [
-				0,
-				0,
-				$( document ).width() - this.helperProportions.width - this.margins.left,
-				( $( document ).height() || document.body.parentNode.scrollHeight ) -
-					this.helperProportions.height - this.margins.top
-			];
-			return;
-		}
-
-		if ( o.containment.constructor === Array ) {
-			this.containment = o.containment;
-			return;
-		}
-
-		if ( o.containment === "parent" ) {
-			o.containment = this.helper[ 0 ].parentNode;
-		}
-
-		c = $( o.containment );
-		ce = c[ 0 ];
-
-		if ( !ce ) {
-			return;
+		// if we are already opaque - return ourself
+		if ( this._rgba[ 3 ] === 1 ) {
+			return this;
 		}

-		isUserScrollable = /(scroll|auto)/.test( c.css( "overflow" ) );
+		var rgb = this._rgba.slice(),
+			a = rgb.pop(),
+			blend = color( opaque )._rgba;

-		this.containment = [
-			( parseInt( c.css( "borderLeftWidth" ), 10 ) || 0 ) +
-				( parseInt( c.css( "paddingLeft" ), 10 ) || 0 ),
-			( parseInt( c.css( "borderTopWidth" ), 10 ) || 0 ) +
-				( parseInt( c.css( "paddingTop" ), 10 ) || 0 ),
-			( isUserScrollable ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
-				( parseInt( c.css( "borderRightWidth" ), 10 ) || 0 ) -
-				( parseInt( c.css( "paddingRight" ), 10 ) || 0 ) -
-				this.helperProportions.width -
-				this.margins.left -
-				this.margins.right,
-			( isUserScrollable ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
-				( parseInt( c.css( "borderBottomWidth" ), 10 ) || 0 ) -
-				( parseInt( c.css( "paddingBottom" ), 10 ) || 0 ) -
-				this.helperProportions.height -
-				this.margins.top -
-				this.margins.bottom
-		];
-		this.relativeContainer = c;
+		return color( jQuery.map( rgb, function( v, i ) {
+			return ( 1 - a ) * blend[ i ] + a * v;
+		} ) );
 	},
+	toRgbaString: function() {
+		var prefix = "rgba(",
+			rgba = jQuery.map( this._rgba, function( v, i ) {
+				if ( v != null ) {
+					return v;
+				}
+				return i > 2 ? 1 : 0;
+			} );

-	_convertPositionTo: function( d, pos ) {
-
-		if ( !pos ) {
-			pos = this.position;
+		if ( rgba[ 3 ] === 1 ) {
+			rgba.pop();
+			prefix = "rgb(";
 		}

-		var mod = d === "absolute" ? 1 : -1,
-			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );
-
-		return {
-			top: (
-
-				// The absolute mouse position
-				pos.top	+
-
-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.top * mod +
-
-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.top * mod -
-				( ( this.cssPosition === "fixed" ?
-					-this.offset.scroll.top :
-					( scrollIsRootNode ? 0 : this.offset.scroll.top ) ) * mod )
-			),
-			left: (
-
-				// The absolute mouse position
-				pos.left +
-
-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.left * mod +
-
-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.left * mod	-
-				( ( this.cssPosition === "fixed" ?
-					-this.offset.scroll.left :
-					( scrollIsRootNode ? 0 : this.offset.scroll.left ) ) * mod )
-			)
-		};
-
+		return prefix + rgba.join() + ")";
 	},
-
-	_generatePosition: function( event, constrainPosition ) {
-
-		var containment, co, top, left,
-			o = this.options,
-			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] ),
-			pageX = event.pageX,
-			pageY = event.pageY;
-
-		// Cache the scroll
-		if ( !scrollIsRootNode || !this.offset.scroll ) {
-			this.offset.scroll = {
-				top: this.scrollParent.scrollTop(),
-				left: this.scrollParent.scrollLeft()
-			};
-		}
-
-		/*
-		 * - Position constraining -
-		 * Constrain the position to a mix of grid, containment.
-		 */
-
-		// If we are not dragging yet, we won't check for options
-		if ( constrainPosition ) {
-			if ( this.containment ) {
-				if ( this.relativeContainer ) {
-					co = this.relativeContainer.offset();
-					containment = [
-						this.containment[ 0 ] + co.left,
-						this.containment[ 1 ] + co.top,
-						this.containment[ 2 ] + co.left,
-						this.containment[ 3 ] + co.top
-					];
-				} else {
-					containment = this.containment;
+	toHslaString: function() {
+		var prefix = "hsla(",
+			hsla = jQuery.map( this.hsla(), function( v, i ) {
+				if ( v == null ) {
+					v = i > 2 ? 1 : 0;
 				}

-				if ( event.pageX - this.offset.click.left < containment[ 0 ] ) {
-					pageX = containment[ 0 ] + this.offset.click.left;
-				}
-				if ( event.pageY - this.offset.click.top < containment[ 1 ] ) {
-					pageY = containment[ 1 ] + this.offset.click.top;
-				}
-				if ( event.pageX - this.offset.click.left > containment[ 2 ] ) {
-					pageX = containment[ 2 ] + this.offset.click.left;
-				}
-				if ( event.pageY - this.offset.click.top > containment[ 3 ] ) {
-					pageY = containment[ 3 ] + this.offset.click.top;
+				// catch 1 and 2
+				if ( i && i < 3 ) {
+					v = Math.round( v * 100 ) + "%";
 				}
-			}
-
-			if ( o.grid ) {
-
-				//Check for grid elements set to 0 to prevent divide by 0 error causing invalid
-				// argument errors in IE (see ticket #6950)
-				top = o.grid[ 1 ] ? this.originalPageY + Math.round( ( pageY -
-					this.originalPageY ) / o.grid[ 1 ] ) * o.grid[ 1 ] : this.originalPageY;
-				pageY = containment ? ( ( top - this.offset.click.top >= containment[ 1 ] ||
-					top - this.offset.click.top > containment[ 3 ] ) ?
-						top :
-						( ( top - this.offset.click.top >= containment[ 1 ] ) ?
-							top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) : top;
-
-				left = o.grid[ 0 ] ? this.originalPageX +
-					Math.round( ( pageX - this.originalPageX ) / o.grid[ 0 ] ) * o.grid[ 0 ] :
-					this.originalPageX;
-				pageX = containment ? ( ( left - this.offset.click.left >= containment[ 0 ] ||
-					left - this.offset.click.left > containment[ 2 ] ) ?
-						left :
-						( ( left - this.offset.click.left >= containment[ 0 ] ) ?
-							left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) : left;
-			}
-
-			if ( o.axis === "y" ) {
-				pageX = this.originalPageX;
-			}
+				return v;
+			} );

-			if ( o.axis === "x" ) {
-				pageY = this.originalPageY;
-			}
+		if ( hsla[ 3 ] === 1 ) {
+			hsla.pop();
+			prefix = "hsl(";
 		}
-
-		return {
-			top: (
-
-				// The absolute mouse position
-				pageY -
-
-				// Click offset (relative to the element)
-				this.offset.click.top -
-
-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.top -
-
-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.top +
-				( this.cssPosition === "fixed" ?
-					-this.offset.scroll.top :
-					( scrollIsRootNode ? 0 : this.offset.scroll.top ) )
-			),
-			left: (
-
-				// The absolute mouse position
-				pageX -
-
-				// Click offset (relative to the element)
-				this.offset.click.left -
-
-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.left -
-
-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.left +
-				( this.cssPosition === "fixed" ?
-					-this.offset.scroll.left :
-					( scrollIsRootNode ? 0 : this.offset.scroll.left ) )
-			)
-		};
-
+		return prefix + hsla.join() + ")";
 	},
+	toHexString: function( includeAlpha ) {
+		var rgba = this._rgba.slice(),
+			alpha = rgba.pop();

-	_clear: function() {
-		this._removeClass( this.helper, "ui-draggable-dragging" );
-		if ( this.helper[ 0 ] !== this.element[ 0 ] && !this.cancelHelperRemoval ) {
-			this.helper.remove();
-		}
-		this.helper = null;
-		this.cancelHelperRemoval = false;
-		if ( this.destroyOnClear ) {
-			this.destroy();
+		if ( includeAlpha ) {
+			rgba.push( ~~( alpha * 255 ) );
 		}
-	},
-
-	// From now on bulk stuff - mainly helpers

-	_trigger: function( type, event, ui ) {
-		ui = ui || this._uiHash();
-		$.ui.plugin.call( this, type, [ event, ui, this ], true );
+		return "#" + jQuery.map( rgba, function( v ) {

-		// Absolute position and offset (see #6884 ) have to be recalculated after plugins
-		if ( /^(drag|start|stop)/.test( type ) ) {
-			this.positionAbs = this._convertPositionTo( "absolute" );
-			ui.offset = this.positionAbs;
-		}
-		return $.Widget.prototype._trigger.call( this, type, event, ui );
+			// default to 0 when nulls exist
+			v = ( v || 0 ).toString( 16 );
+			return v.length === 1 ? "0" + v : v;
+		} ).join( "" );
 	},
-
-	plugins: {},
-
-	_uiHash: function() {
-		return {
-			helper: this.helper,
-			position: this.position,
-			originalPosition: this.originalPosition,
-			offset: this.positionAbs
-		};
+	toString: function() {
+		return this._rgba[ 3 ] === 0 ? "transparent" : this.toRgbaString();
 	}
-
 } );
+color.fn.parse.prototype = color.fn;

-$.ui.plugin.add( "draggable", "connectToSortable", {
-	start: function( event, ui, draggable ) {
-		var uiSortable = $.extend( {}, ui, {
-			item: draggable.element
-		} );
-
-		draggable.sortables = [];
-		$( draggable.options.connectToSortable ).each( function() {
-			var sortable = $( this ).sortable( "instance" );
-
-			if ( sortable && !sortable.options.disabled ) {
-				draggable.sortables.push( sortable );
-
-				// RefreshPositions is called at drag start to refresh the containerCache
-				// which is used in drag. This ensures it's initialized and synchronized
-				// with any changes that might have happened on the page since initialization.
-				sortable.refreshPositions();
-				sortable._trigger( "activate", event, uiSortable );
-			}
-		} );
-	},
-	stop: function( event, ui, draggable ) {
-		var uiSortable = $.extend( {}, ui, {
-			item: draggable.element
-		} );
-
-		draggable.cancelHelperRemoval = false;
-
-		$.each( draggable.sortables, function() {
-			var sortable = this;
-
-			if ( sortable.isOver ) {
-				sortable.isOver = 0;
-
-				// Allow this sortable to handle removing the helper
-				draggable.cancelHelperRemoval = true;
-				sortable.cancelHelperRemoval = false;
-
-				// Use _storedCSS To restore properties in the sortable,
-				// as this also handles revert (#9675) since the draggable
-				// may have modified them in unexpected ways (#8809)
-				sortable._storedCSS = {
-					position: sortable.placeholder.css( "position" ),
-					top: sortable.placeholder.css( "top" ),
-					left: sortable.placeholder.css( "left" )
-				};
-
-				sortable._mouseStop( event );
-
-				// Once drag has ended, the sortable should return to using
-				// its original helper, not the shared helper from draggable
-				sortable.options.helper = sortable.options._helper;
-			} else {
-
-				// Prevent this Sortable from removing the helper.
-				// However, don't set the draggable to remove the helper
-				// either as another connected Sortable may yet handle the removal.
-				sortable.cancelHelperRemoval = true;
-
-				sortable._trigger( "deactivate", event, uiSortable );
-			}
-		} );
-	},
-	drag: function( event, ui, draggable ) {
-		$.each( draggable.sortables, function() {
-			var innermostIntersecting = false,
-				sortable = this;
-
-			// Copy over variables that sortable's _intersectsWith uses
-			sortable.positionAbs = draggable.positionAbs;
-			sortable.helperProportions = draggable.helperProportions;
-			sortable.offset.click = draggable.offset.click;
-
-			if ( sortable._intersectsWith( sortable.containerCache ) ) {
-				innermostIntersecting = true;
-
-				$.each( draggable.sortables, function() {
-
-					// Copy over variables that sortable's _intersectsWith uses
-					this.positionAbs = draggable.positionAbs;
-					this.helperProportions = draggable.helperProportions;
-					this.offset.click = draggable.offset.click;
-
-					if ( this !== sortable &&
-							this._intersectsWith( this.containerCache ) &&
-							$.contains( sortable.element[ 0 ], this.element[ 0 ] ) ) {
-						innermostIntersecting = false;
-					}
-
-					return innermostIntersecting;
-				} );
-			}
-
-			if ( innermostIntersecting ) {
-
-				// If it intersects, we use a little isOver variable and set it once,
-				// so that the move-in stuff gets fired only once.
-				if ( !sortable.isOver ) {
-					sortable.isOver = 1;
-
-					// Store draggable's parent in case we need to reappend to it later.
-					draggable._parent = ui.helper.parent();
-
-					sortable.currentItem = ui.helper
-						.appendTo( sortable.element )
-						.data( "ui-sortable-item", true );
-
-					// Store helper option to later restore it
-					sortable.options._helper = sortable.options.helper;
-
-					sortable.options.helper = function() {
-						return ui.helper[ 0 ];
-					};
-
-					// Fire the start events of the sortable with our passed browser event,
-					// and our own helper (so it doesn't create a new one)
-					event.target = sortable.currentItem[ 0 ];
-					sortable._mouseCapture( event, true );
-					sortable._mouseStart( event, true, true );
-
-					// Because the browser event is way off the new appended portlet,
-					// modify necessary variables to reflect the changes
-					sortable.offset.click.top = draggable.offset.click.top;
-					sortable.offset.click.left = draggable.offset.click.left;
-					sortable.offset.parent.left -= draggable.offset.parent.left -
-						sortable.offset.parent.left;
-					sortable.offset.parent.top -= draggable.offset.parent.top -
-						sortable.offset.parent.top;
-
-					draggable._trigger( "toSortable", event );
-
-					// Inform draggable that the helper is in a valid drop zone,
-					// used solely in the revert option to handle "valid/invalid".
-					draggable.dropped = sortable.element;
-
-					// Need to refreshPositions of all sortables in the case that
-					// adding to one sortable changes the location of the other sortables (#9675)
-					$.each( draggable.sortables, function() {
-						this.refreshPositions();
-					} );
-
-					// Hack so receive/update callbacks work (mostly)
-					draggable.currentItem = draggable.element;
-					sortable.fromOutside = draggable;
-				}
+// hsla conversions adapted from:
+// https://code.google.com/p/maashaack/source/browse/packages/graphics/trunk/src/graphics/colors/HUE2RGB.as?r=5021

-				if ( sortable.currentItem ) {
-					sortable._mouseDrag( event );
+function hue2rgb( p, q, h ) {
+	h = ( h + 1 ) % 1;
+	if ( h * 6 < 1 ) {
+		return p + ( q - p ) * h * 6;
+	}
+	if ( h * 2 < 1 ) {
+		return q;
+	}
+	if ( h * 3 < 2 ) {
+		return p + ( q - p ) * ( ( 2 / 3 ) - h ) * 6;
+	}
+	return p;
+}

-					// Copy the sortable's position because the draggable's can potentially reflect
-					// a relative position, while sortable is always absolute, which the dragged
-					// element has now become. (#8809)
-					ui.position = sortable.position;
-				}
-			} else {
+spaces.hsla.to = function( rgba ) {
+	if ( rgba[ 0 ] == null || rgba[ 1 ] == null || rgba[ 2 ] == null ) {
+		return [ null, null, null, rgba[ 3 ] ];
+	}
+	var r = rgba[ 0 ] / 255,
+		g = rgba[ 1 ] / 255,
+		b = rgba[ 2 ] / 255,
+		a = rgba[ 3 ],
+		max = Math.max( r, g, b ),
+		min = Math.min( r, g, b ),
+		diff = max - min,
+		add = max + min,
+		l = add * 0.5,
+		h, s;

-				// If it doesn't intersect with the sortable, and it intersected before,
-				// we fake the drag stop of the sortable, but make sure it doesn't remove
-				// the helper by using cancelHelperRemoval.
-				if ( sortable.isOver ) {
+	if ( min === max ) {
+		h = 0;
+	} else if ( r === max ) {
+		h = ( 60 * ( g - b ) / diff ) + 360;
+	} else if ( g === max ) {
+		h = ( 60 * ( b - r ) / diff ) + 120;
+	} else {
+		h = ( 60 * ( r - g ) / diff ) + 240;
+	}

-					sortable.isOver = 0;
-					sortable.cancelHelperRemoval = true;
+	// chroma (diff) == 0 means greyscale which, by definition, saturation = 0%
+	// otherwise, saturation is based on the ratio of chroma (diff) to lightness (add)
+	if ( diff === 0 ) {
+		s = 0;
+	} else if ( l <= 0.5 ) {
+		s = diff / add;
+	} else {
+		s = diff / ( 2 - add );
+	}
+	return [ Math.round( h ) % 360, s, l, a == null ? 1 : a ];
+};

-					// Calling sortable's mouseStop would trigger a revert,
-					// so revert must be temporarily false until after mouseStop is called.
-					sortable.options._revert = sortable.options.revert;
-					sortable.options.revert = false;
+spaces.hsla.from = function( hsla ) {
+	if ( hsla[ 0 ] == null || hsla[ 1 ] == null || hsla[ 2 ] == null ) {
+		return [ null, null, null, hsla[ 3 ] ];
+	}
+	var h = hsla[ 0 ] / 360,
+		s = hsla[ 1 ],
+		l = hsla[ 2 ],
+		a = hsla[ 3 ],
+		q = l <= 0.5 ? l * ( 1 + s ) : l + s - l * s,
+		p = 2 * l - q;

-					sortable._trigger( "out", event, sortable._uiHash( sortable ) );
-					sortable._mouseStop( event, true );
+	return [
+		Math.round( hue2rgb( p, q, h + ( 1 / 3 ) ) * 255 ),
+		Math.round( hue2rgb( p, q, h ) * 255 ),
+		Math.round( hue2rgb( p, q, h - ( 1 / 3 ) ) * 255 ),
+		a
+	];
+};

-					// Restore sortable behaviors that were modfied
-					// when the draggable entered the sortable area (#9481)
-					sortable.options.revert = sortable.options._revert;
-					sortable.options.helper = sortable.options._helper;

-					if ( sortable.placeholder ) {
-						sortable.placeholder.remove();
-					}
+each( spaces, function( spaceName, space ) {
+	var props = space.props,
+		cache = space.cache,
+		to = space.to,
+		from = space.from;

-					// Restore and recalculate the draggable's offset considering the sortable
-					// may have modified them in unexpected ways. (#8809, #10669)
-					ui.helper.appendTo( draggable._parent );
-					draggable._refreshOffsets( event );
-					ui.position = draggable._generatePosition( event, true );
+	// makes rgba() and hsla()
+	color.fn[ spaceName ] = function( value ) {

-					draggable._trigger( "fromSortable", event );
+		// generate a cache for this space if it doesn't exist
+		if ( to && !this[ cache ] ) {
+			this[ cache ] = to( this._rgba );
+		}
+		if ( value === undefined ) {
+			return this[ cache ].slice();
+		}

-					// Inform draggable that the helper is no longer in a valid drop zone
-					draggable.dropped = false;
+		var ret,
+			type = getType( value ),
+			arr = ( type === "array" || type === "object" ) ? value : arguments,
+			local = this[ cache ].slice();

-					// Need to refreshPositions of all sortables just in case removing
-					// from one sortable changes the location of other sortables (#9675)
-					$.each( draggable.sortables, function() {
-						this.refreshPositions();
-					} );
-				}
+		each( props, function( key, prop ) {
+			var val = arr[ type === "object" ? key : prop.idx ];
+			if ( val == null ) {
+				val = local[ prop.idx ];
 			}
+			local[ prop.idx ] = clamp( val, prop );
 		} );
-	}
-} );

-$.ui.plugin.add( "draggable", "cursor", {
-	start: function( event, ui, instance ) {
-		var t = $( "body" ),
-			o = instance.options;
-
-		if ( t.css( "cursor" ) ) {
-			o._cursor = t.css( "cursor" );
-		}
-		t.css( "cursor", o.cursor );
-	},
-	stop: function( event, ui, instance ) {
-		var o = instance.options;
-		if ( o._cursor ) {
-			$( "body" ).css( "cursor", o._cursor );
-		}
-	}
-} );
-
-$.ui.plugin.add( "draggable", "opacity", {
-	start: function( event, ui, instance ) {
-		var t = $( ui.helper ),
-			o = instance.options;
-		if ( t.css( "opacity" ) ) {
-			o._opacity = t.css( "opacity" );
-		}
-		t.css( "opacity", o.opacity );
-	},
-	stop: function( event, ui, instance ) {
-		var o = instance.options;
-		if ( o._opacity ) {
-			$( ui.helper ).css( "opacity", o._opacity );
+		if ( from ) {
+			ret = color( from( local ) );
+			ret[ cache ] = local;
+			return ret;
+		} else {
+			return color( local );
 		}
-	}
-} );
+	};

-$.ui.plugin.add( "draggable", "scroll", {
-	start: function( event, ui, i ) {
-		if ( !i.scrollParentNotHidden ) {
-			i.scrollParentNotHidden = i.helper.scrollParent( false );
-		}
+	// makes red() green() blue() alpha() hue() saturation() lightness()
+	each( props, function( key, prop ) {

-		if ( i.scrollParentNotHidden[ 0 ] !== i.document[ 0 ] &&
-				i.scrollParentNotHidden[ 0 ].tagName !== "HTML" ) {
-			i.overflowOffset = i.scrollParentNotHidden.offset();
+		// alpha is included in more than one space
+		if ( color.fn[ key ] ) {
+			return;
 		}
-	},
-	drag: function( event, ui, i  ) {
-
-		var o = i.options,
-			scrolled = false,
-			scrollParent = i.scrollParentNotHidden[ 0 ],
-			document = i.document[ 0 ];
+		color.fn[ key ] = function( value ) {
+			var local, cur, match, fn,
+				vtype = getType( value );

-		if ( scrollParent !== document && scrollParent.tagName !== "HTML" ) {
-			if ( !o.axis || o.axis !== "x" ) {
-				if ( ( i.overflowOffset.top + scrollParent.offsetHeight ) - event.pageY <
-						o.scrollSensitivity ) {
-					scrollParent.scrollTop = scrolled = scrollParent.scrollTop + o.scrollSpeed;
-				} else if ( event.pageY - i.overflowOffset.top < o.scrollSensitivity ) {
-					scrollParent.scrollTop = scrolled = scrollParent.scrollTop - o.scrollSpeed;
-				}
+			if ( key === "alpha" ) {
+				fn = this._hsla ? "hsla" : "rgba";
+			} else {
+				fn = spaceName;
 			}
+			local = this[ fn ]();
+			cur = local[ prop.idx ];

-			if ( !o.axis || o.axis !== "y" ) {
-				if ( ( i.overflowOffset.left + scrollParent.offsetWidth ) - event.pageX <
-						o.scrollSensitivity ) {
-					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + o.scrollSpeed;
-				} else if ( event.pageX - i.overflowOffset.left < o.scrollSensitivity ) {
-					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - o.scrollSpeed;
-				}
+			if ( vtype === "undefined" ) {
+				return cur;
 			}

-		} else {
-
-			if ( !o.axis || o.axis !== "x" ) {
-				if ( event.pageY - $( document ).scrollTop() < o.scrollSensitivity ) {
-					scrolled = $( document ).scrollTop( $( document ).scrollTop() - o.scrollSpeed );
-				} else if ( $( window ).height() - ( event.pageY - $( document ).scrollTop() ) <
-						o.scrollSensitivity ) {
-					scrolled = $( document ).scrollTop( $( document ).scrollTop() + o.scrollSpeed );
-				}
+			if ( vtype === "function" ) {
+				value = value.call( this, cur );
+				vtype = getType( value );
 			}
-
-			if ( !o.axis || o.axis !== "y" ) {
-				if ( event.pageX - $( document ).scrollLeft() < o.scrollSensitivity ) {
-					scrolled = $( document ).scrollLeft(
-						$( document ).scrollLeft() - o.scrollSpeed
-					);
-				} else if ( $( window ).width() - ( event.pageX - $( document ).scrollLeft() ) <
-						o.scrollSensitivity ) {
-					scrolled = $( document ).scrollLeft(
-						$( document ).scrollLeft() + o.scrollSpeed
-					);
+			if ( value == null && prop.empty ) {
+				return this;
+			}
+			if ( vtype === "string" ) {
+				match = rplusequals.exec( value );
+				if ( match ) {
+					value = cur + parseFloat( match[ 2 ] ) * ( match[ 1 ] === "+" ? 1 : -1 );
 				}
 			}
-
-		}
-
-		if ( scrolled !== false && $.ui.ddmanager && !o.dropBehaviour ) {
-			$.ui.ddmanager.prepareOffsets( i, event );
-		}
-
-	}
+			local[ prop.idx ] = value;
+			return this[ fn ]( local );
+		};
+	} );
 } );

-$.ui.plugin.add( "draggable", "snap", {
-	start: function( event, ui, i ) {
-
-		var o = i.options;
-
-		i.snapElements = [];
-
-		$( o.snap.constructor !== String ? ( o.snap.items || ":data(ui-draggable)" ) : o.snap )
-			.each( function() {
-				var $t = $( this ),
-					$o = $t.offset();
-				if ( this !== i.element[ 0 ] ) {
-					i.snapElements.push( {
-						item: this,
-						width: $t.outerWidth(), height: $t.outerHeight(),
-						top: $o.top, left: $o.left
-					} );
-				}
-			} );
-
-	},
-	drag: function( event, ui, inst ) {
-
-		var ts, bs, ls, rs, l, r, t, b, i, first,
-			o = inst.options,
-			d = o.snapTolerance,
-			x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width,
-			y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;
-
-		for ( i = inst.snapElements.length - 1; i >= 0; i-- ) {
+// add cssHook and .fx.step function for each named hook.
+// accept a space separated string of properties
+color.hook = function( hook ) {
+	var hooks = hook.split( " " );
+	each( hooks, function( _i, hook ) {
+		jQuery.cssHooks[ hook ] = {
+			set: function( elem, value ) {
+				var parsed, curElem,
+					backgroundColor = "";

-			l = inst.snapElements[ i ].left - inst.margins.left;
-			r = l + inst.snapElements[ i ].width;
-			t = inst.snapElements[ i ].top - inst.margins.top;
-			b = t + inst.snapElements[ i ].height;
+				if ( value !== "transparent" && ( getType( value ) !== "string" || ( parsed = stringParse( value ) ) ) ) {
+					value = color( parsed || value );
+					if ( !support.rgba && value._rgba[ 3 ] !== 1 ) {
+						curElem = hook === "backgroundColor" ? elem.parentNode : elem;
+						while (
+							( backgroundColor === "" || backgroundColor === "transparent" ) &&
+							curElem && curElem.style
+						) {
+							try {
+								backgroundColor = jQuery.css( curElem, "backgroundColor" );
+								curElem = curElem.parentNode;
+							} catch ( e ) {
+							}
+						}

-			if ( x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d ||
-					!$.contains( inst.snapElements[ i ].item.ownerDocument,
-					inst.snapElements[ i ].item ) ) {
-				if ( inst.snapElements[ i ].snapping ) {
-					if ( inst.options.snap.release ) {
-						inst.options.snap.release.call(
-							inst.element,
-							event,
-							$.extend( inst._uiHash(), { snapItem: inst.snapElements[ i ].item } )
-						);
+						value = value.blend( backgroundColor && backgroundColor !== "transparent" ?
+							backgroundColor :
+							"_default" );
 					}
-				}
-				inst.snapElements[ i ].snapping = false;
-				continue;
-			}

-			if ( o.snapMode !== "inner" ) {
-				ts = Math.abs( t - y2 ) <= d;
-				bs = Math.abs( b - y1 ) <= d;
-				ls = Math.abs( l - x2 ) <= d;
-				rs = Math.abs( r - x1 ) <= d;
-				if ( ts ) {
-					ui.position.top = inst._convertPositionTo( "relative", {
-						top: t - inst.helperProportions.height,
-						left: 0
-					} ).top;
-				}
-				if ( bs ) {
-					ui.position.top = inst._convertPositionTo( "relative", {
-						top: b,
-						left: 0
-					} ).top;
-				}
-				if ( ls ) {
-					ui.position.left = inst._convertPositionTo( "relative", {
-						top: 0,
-						left: l - inst.helperProportions.width
-					} ).left;
-				}
-				if ( rs ) {
-					ui.position.left = inst._convertPositionTo( "relative", {
-						top: 0,
-						left: r
-					} ).left;
+					value = value.toRgbaString();
 				}
-			}
-
-			first = ( ts || bs || ls || rs );
+				try {
+					elem.style[ hook ] = value;
+				} catch ( e ) {

-			if ( o.snapMode !== "outer" ) {
-				ts = Math.abs( t - y1 ) <= d;
-				bs = Math.abs( b - y2 ) <= d;
-				ls = Math.abs( l - x1 ) <= d;
-				rs = Math.abs( r - x2 ) <= d;
-				if ( ts ) {
-					ui.position.top = inst._convertPositionTo( "relative", {
-						top: t,
-						left: 0
-					} ).top;
-				}
-				if ( bs ) {
-					ui.position.top = inst._convertPositionTo( "relative", {
-						top: b - inst.helperProportions.height,
-						left: 0
-					} ).top;
-				}
-				if ( ls ) {
-					ui.position.left = inst._convertPositionTo( "relative", {
-						top: 0,
-						left: l
-					} ).left;
-				}
-				if ( rs ) {
-					ui.position.left = inst._convertPositionTo( "relative", {
-						top: 0,
-						left: r - inst.helperProportions.width
-					} ).left;
+					// wrapped to prevent IE from throwing errors on "invalid" values like 'auto' or 'inherit'
 				}
 			}
-
-			if ( !inst.snapElements[ i ].snapping && ( ts || bs || ls || rs || first ) ) {
-				if ( inst.options.snap.snap ) {
-					inst.options.snap.snap.call(
-						inst.element,
-						event,
-						$.extend( inst._uiHash(), {
-							snapItem: inst.snapElements[ i ].item
-						} ) );
-				}
+		};
+		jQuery.fx.step[ hook ] = function( fx ) {
+			if ( !fx.colorInit ) {
+				fx.start = color( fx.elem, hook );
+				fx.end = color( fx.end );
+				fx.colorInit = true;
 			}
-			inst.snapElements[ i ].snapping = ( ts || bs || ls || rs || first );
-
-		}
+			jQuery.cssHooks[ hook ].set( fx.elem, fx.start.transition( fx.end, fx.pos ) );
+		};
+	} );

-	}
-} );
+};

-$.ui.plugin.add( "draggable", "stack", {
-	start: function( event, ui, instance ) {
-		var min,
-			o = instance.options,
-			group = $.makeArray( $( o.stack ) ).sort( function( a, b ) {
-				return ( parseInt( $( a ).css( "zIndex" ), 10 ) || 0 ) -
-					( parseInt( $( b ).css( "zIndex" ), 10 ) || 0 );
-			} );
+color.hook( stepHooks );

-		if ( !group.length ) {
-			return;
-		}
+jQuery.cssHooks.borderColor = {
+	expand: function( value ) {
+		var expanded = {};

-		min = parseInt( $( group[ 0 ] ).css( "zIndex" ), 10 ) || 0;
-		$( group ).each( function( i ) {
-			$( this ).css( "zIndex", min + i );
+		each( [ "Top", "Right", "Bottom", "Left" ], function( _i, part ) {
+			expanded[ "border" + part + "Color" ] = value;
 		} );
-		this.css( "zIndex", ( min + group.length ) );
+		return expanded;
 	}
-} );
+};

-$.ui.plugin.add( "draggable", "zIndex", {
-	start: function( event, ui, instance ) {
-		var t = $( ui.helper ),
-			o = instance.options;
+// Basic color names only.
+// Usage of any of the other color names requires adding yourself or including
+// jquery.color.svg-names.js.
+colors = jQuery.Color.names = {

-		if ( t.css( "zIndex" ) ) {
-			o._zIndex = t.css( "zIndex" );
-		}
-		t.css( "zIndex", o.zIndex );
-	},
-	stop: function( event, ui, instance ) {
-		var o = instance.options;
+	// 4.1. Basic color keywords
+	aqua: "#00ffff",
+	black: "#000000",
+	blue: "#0000ff",
+	fuchsia: "#ff00ff",
+	gray: "#808080",
+	green: "#008000",
+	lime: "#00ff00",
+	maroon: "#800000",
+	navy: "#000080",
+	olive: "#808000",
+	purple: "#800080",
+	red: "#ff0000",
+	silver: "#c0c0c0",
+	teal: "#008080",
+	white: "#ffffff",
+	yellow: "#ffff00",

-		if ( o._zIndex ) {
-			$( ui.helper ).css( "zIndex", o._zIndex );
-		}
-	}
-} );
+	// 4.2.3. "transparent" color keyword
+	transparent: [ null, null, null, 0 ],

-var widgetsDraggable = $.ui.draggable;
+	_default: "#ffffff"
+};


 /*!
- * jQuery UI Droppable 1.13.1
+ * jQuery UI Effects 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -3271,1680 +2055,1006 @@
  * http://jquery.org/license
  */

-//>>label: Droppable
-//>>group: Interactions
-//>>description: Enables drop targets for draggable elements.
-//>>docs: http://api.jqueryui.com/droppable/
-//>>demos: http://jqueryui.com/droppable/
-
-
-$.widget( "ui.droppable", {
-	version: "1.13.1",
-	widgetEventPrefix: "drop",
-	options: {
-		accept: "*",
-		addClasses: true,
-		greedy: false,
-		scope: "default",
-		tolerance: "intersect",
-
-		// Callbacks
-		activate: null,
-		deactivate: null,
-		drop: null,
-		out: null,
-		over: null
-	},
-	_create: function() {
+//>>label: Effects Core
+//>>group: Effects
+/* eslint-disable max-len */
+//>>description: Extends the internal jQuery effects. Includes morphing and easing. Required by all other effects.
+/* eslint-enable max-len */
+//>>docs: http://api.jqueryui.com/category/effects-core/
+//>>demos: http://jqueryui.com/effect/

-		var proportions,
-			o = this.options,
-			accept = o.accept;

-		this.isover = false;
-		this.isout = true;
+var dataSpace = "ui-effects-",
+	dataSpaceStyle = "ui-effects-style",
+	dataSpaceAnimated = "ui-effects-animated";

-		this.accept = typeof accept === "function" ? accept : function( d ) {
-			return d.is( accept );
-		};
+$.effects = {
+	effect: {}
+};

-		this.proportions = function( /* valueToWrite */ ) {
-			if ( arguments.length ) {
+/******************************************************************************/
+/****************************** CLASS ANIMATIONS ******************************/
+/******************************************************************************/
+( function() {

-				// Store the droppable's proportions
-				proportions = arguments[ 0 ];
-			} else {
+var classAnimationActions = [ "add", "remove", "toggle" ],
+	shorthandStyles = {
+		border: 1,
+		borderBottom: 1,
+		borderColor: 1,
+		borderLeft: 1,
+		borderRight: 1,
+		borderTop: 1,
+		borderWidth: 1,
+		margin: 1,
+		padding: 1
+	};

-				// Retrieve or derive the droppable's proportions
-				return proportions ?
-					proportions :
-					proportions = {
-						width: this.element[ 0 ].offsetWidth,
-						height: this.element[ 0 ].offsetHeight
-					};
+$.each(
+	[ "borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle" ],
+	function( _, prop ) {
+		$.fx.step[ prop ] = function( fx ) {
+			if ( fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr ) {
+				jQuery.style( fx.elem, prop, fx.end );
+				fx.setAttr = true;
 			}
 		};
+	}
+);

-		this._addToManager( o.scope );
-
-		if ( o.addClasses ) {
-			this._addClass( "ui-droppable" );
-		}
-
-	},
-
-	_addToManager: function( scope ) {
+function camelCase( string ) {
+	return string.replace( /-([\da-z])/gi, function( all, letter ) {
+		return letter.toUpperCase();
+	} );
+}

-		// Add the reference and positions to the manager
-		$.ui.ddmanager.droppables[ scope ] = $.ui.ddmanager.droppables[ scope ] || [];
-		$.ui.ddmanager.droppables[ scope ].push( this );
-	},
+function getElementStyles( elem ) {
+	var key, len,
+		style = elem.ownerDocument.defaultView ?
+			elem.ownerDocument.defaultView.getComputedStyle( elem, null ) :
+			elem.currentStyle,
+		styles = {};

-	_splice: function( drop ) {
-		var i = 0;
-		for ( ; i < drop.length; i++ ) {
-			if ( drop[ i ] === this ) {
-				drop.splice( i, 1 );
+	if ( style && style.length && style[ 0 ] && style[ style[ 0 ] ] ) {
+		len = style.length;
+		while ( len-- ) {
+			key = style[ len ];
+			if ( typeof style[ key ] === "string" ) {
+				styles[ camelCase( key ) ] = style[ key ];
 			}
 		}
-	},
-
-	_destroy: function() {
-		var drop = $.ui.ddmanager.droppables[ this.options.scope ];
-
-		this._splice( drop );
-	},
-
-	_setOption: function( key, value ) {
-
-		if ( key === "accept" ) {
-			this.accept = typeof value === "function" ? value : function( d ) {
-				return d.is( value );
-			};
-		} else if ( key === "scope" ) {
-			var drop = $.ui.ddmanager.droppables[ this.options.scope ];

-			this._splice( drop );
-			this._addToManager( value );
+	// Support: Opera, IE <9
+	} else {
+		for ( key in style ) {
+			if ( typeof style[ key ] === "string" ) {
+				styles[ key ] = style[ key ];
+			}
 		}
+	}

-		this._super( key, value );
-	},
-
-	_activate: function( event ) {
-		var draggable = $.ui.ddmanager.current;
-
-		this._addActiveClass();
-		if ( draggable ) {
-			this._trigger( "activate", event, this.ui( draggable ) );
-		}
-	},
+	return styles;
+}

-	_deactivate: function( event ) {
-		var draggable = $.ui.ddmanager.current;
+function styleDifference( oldStyle, newStyle ) {
+	var diff = {},
+		name, value;

-		this._removeActiveClass();
-		if ( draggable ) {
-			this._trigger( "deactivate", event, this.ui( draggable ) );
+	for ( name in newStyle ) {
+		value = newStyle[ name ];
+		if ( oldStyle[ name ] !== value ) {
+			if ( !shorthandStyles[ name ] ) {
+				if ( $.fx.step[ name ] || !isNaN( parseFloat( value ) ) ) {
+					diff[ name ] = value;
+				}
+			}
 		}
-	},
-
-	_over: function( event ) {
+	}

-		var draggable = $.ui.ddmanager.current;
+	return diff;
+}

-		// Bail if draggable and droppable are same element
-		if ( !draggable || ( draggable.currentItem ||
-				draggable.element )[ 0 ] === this.element[ 0 ] ) {
-			return;
-		}
+// Support: jQuery <1.8
+if ( !$.fn.addBack ) {
+	$.fn.addBack = function( selector ) {
+		return this.add( selector == null ?
+			this.prevObject : this.prevObject.filter( selector )
+		);
+	};
+}

-		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
-				draggable.element ) ) ) {
-			this._addHoverClass();
-			this._trigger( "over", event, this.ui( draggable ) );
-		}
+$.effects.animateClass = function( value, duration, easing, callback ) {
+	var o = $.speed( duration, easing, callback );

-	},
+	return this.queue( function() {
+		var animated = $( this ),
+			baseClass = animated.attr( "class" ) || "",
+			applyClassChange,
+			allAnimations = o.children ? animated.find( "*" ).addBack() : animated;

-	_out: function( event ) {
+		// Map the animated objects to store the original styles.
+		allAnimations = allAnimations.map( function() {
+			var el = $( this );
+			return {
+				el: el,
+				start: getElementStyles( this )
+			};
+		} );

-		var draggable = $.ui.ddmanager.current;
+		// Apply class change
+		applyClassChange = function() {
+			$.each( classAnimationActions, function( i, action ) {
+				if ( value[ action ] ) {
+					animated[ action + "Class" ]( value[ action ] );
+				}
+			} );
+		};
+		applyClassChange();

-		// Bail if draggable and droppable are same element
-		if ( !draggable || ( draggable.currentItem ||
-				draggable.element )[ 0 ] === this.element[ 0 ] ) {
-			return;
-		}
+		// Map all animated objects again - calculate new styles and diff
+		allAnimations = allAnimations.map( function() {
+			this.end = getElementStyles( this.el[ 0 ] );
+			this.diff = styleDifference( this.start, this.end );
+			return this;
+		} );

-		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
-				draggable.element ) ) ) {
-			this._removeHoverClass();
-			this._trigger( "out", event, this.ui( draggable ) );
-		}
+		// Apply original class
+		animated.attr( "class", baseClass );

-	},
+		// Map all animated objects again - this time collecting a promise
+		allAnimations = allAnimations.map( function() {
+			var styleInfo = this,
+				dfd = $.Deferred(),
+				opts = $.extend( {}, o, {
+					queue: false,
+					complete: function() {
+						dfd.resolve( styleInfo );
+					}
+				} );

-	_drop: function( event, custom ) {
+			this.el.animate( this.diff, opts );
+			return dfd.promise();
+		} );

-		var draggable = custom || $.ui.ddmanager.current,
-			childrenIntersection = false;
+		// Once all animations have completed:
+		$.when.apply( $, allAnimations.get() ).done( function() {

-		// Bail if draggable and droppable are same element
-		if ( !draggable || ( draggable.currentItem ||
-				draggable.element )[ 0 ] === this.element[ 0 ] ) {
-			return false;
-		}
+			// Set the final class
+			applyClassChange();

-		this.element
-			.find( ":data(ui-droppable)" )
-			.not( ".ui-draggable-dragging" )
-			.each( function() {
-				var inst = $( this ).droppable( "instance" );
-				if (
-					inst.options.greedy &&
-					!inst.options.disabled &&
-					inst.options.scope === draggable.options.scope &&
-					inst.accept.call(
-						inst.element[ 0 ], ( draggable.currentItem || draggable.element )
-					) &&
-					$.ui.intersect(
-						draggable,
-						$.extend( inst, { offset: inst.element.offset() } ),
-						inst.options.tolerance, event
-					)
-				) {
-					childrenIntersection = true;
-					return false;
-				}
+			// For each animated element,
+			// clear all css properties that were animated
+			$.each( arguments, function() {
+				var el = this.el;
+				$.each( this.diff, function( key ) {
+					el.css( key, "" );
+				} );
 			} );
-		if ( childrenIntersection ) {
-			return false;
-		}
-
-		if ( this.accept.call( this.element[ 0 ],
-				( draggable.currentItem || draggable.element ) ) ) {
-			this._removeActiveClass();
-			this._removeHoverClass();

-			this._trigger( "drop", event, this.ui( draggable ) );
-			return this.element;
-		}
-
-		return false;
+			// This is guarnteed to be there if you use jQuery.speed()
+			// it also handles dequeuing the next anim...
+			o.complete.call( animated[ 0 ] );
+		} );
+	} );
+};

-	},
+$.fn.extend( {
+	addClass: ( function( orig ) {
+		return function( classNames, speed, easing, callback ) {
+			return speed ?
+				$.effects.animateClass.call( this,
+					{ add: classNames }, speed, easing, callback ) :
+				orig.apply( this, arguments );
+		};
+	} )( $.fn.addClass ),

-	ui: function( c ) {
-		return {
-			draggable: ( c.currentItem || c.element ),
-			helper: c.helper,
-			position: c.position,
-			offset: c.positionAbs
+	removeClass: ( function( orig ) {
+		return function( classNames, speed, easing, callback ) {
+			return arguments.length > 1 ?
+				$.effects.animateClass.call( this,
+					{ remove: classNames }, speed, easing, callback ) :
+				orig.apply( this, arguments );
 		};
-	},
+	} )( $.fn.removeClass ),

-	// Extension points just to make backcompat sane and avoid duplicating logic
-	// TODO: Remove in 1.14 along with call to it below
-	_addHoverClass: function() {
-		this._addClass( "ui-droppable-hover" );
-	},
+	toggleClass: ( function( orig ) {
+		return function( classNames, force, speed, easing, callback ) {
+			if ( typeof force === "boolean" || force === undefined ) {
+				if ( !speed ) {

-	_removeHoverClass: function() {
-		this._removeClass( "ui-droppable-hover" );
-	},
+					// Without speed parameter
+					return orig.apply( this, arguments );
+				} else {
+					return $.effects.animateClass.call( this,
+						( force ? { add: classNames } : { remove: classNames } ),
+						speed, easing, callback );
+				}
+			} else {

-	_addActiveClass: function() {
-		this._addClass( "ui-droppable-active" );
-	},
+				// Without force parameter
+				return $.effects.animateClass.call( this,
+					{ toggle: classNames }, force, speed, easing );
+			}
+		};
+	} )( $.fn.toggleClass ),

-	_removeActiveClass: function() {
-		this._removeClass( "ui-droppable-active" );
+	switchClass: function( remove, add, speed, easing, callback ) {
+		return $.effects.animateClass.call( this, {
+			add: add,
+			remove: remove
+		}, speed, easing, callback );
 	}
 } );

-$.ui.intersect = ( function() {
-	function isOverAxis( x, reference, size ) {
-		return ( x >= reference ) && ( x < ( reference + size ) );
-	}
-
-	return function( draggable, droppable, toleranceMode, event ) {
-
-		if ( !droppable.offset ) {
-			return false;
-		}
-
-		var x1 = ( draggable.positionAbs ||
-				draggable.position.absolute ).left + draggable.margins.left,
-			y1 = ( draggable.positionAbs ||
-				draggable.position.absolute ).top + draggable.margins.top,
-			x2 = x1 + draggable.helperProportions.width,
-			y2 = y1 + draggable.helperProportions.height,
-			l = droppable.offset.left,
-			t = droppable.offset.top,
-			r = l + droppable.proportions().width,
-			b = t + droppable.proportions().height;
-
-		switch ( toleranceMode ) {
-		case "fit":
-			return ( l <= x1 && x2 <= r && t <= y1 && y2 <= b );
-		case "intersect":
-			return ( l < x1 + ( draggable.helperProportions.width / 2 ) && // Right Half
-				x2 - ( draggable.helperProportions.width / 2 ) < r && // Left Half
-				t < y1 + ( draggable.helperProportions.height / 2 ) && // Bottom Half
-				y2 - ( draggable.helperProportions.height / 2 ) < b ); // Top Half
-		case "pointer":
-			return isOverAxis( event.pageY, t, droppable.proportions().height ) &&
-				isOverAxis( event.pageX, l, droppable.proportions().width );
-		case "touch":
-			return (
-				( y1 >= t && y1 <= b ) || // Top edge touching
-				( y2 >= t && y2 <= b ) || // Bottom edge touching
-				( y1 < t && y2 > b ) // Surrounded vertically
-			) && (
-				( x1 >= l && x1 <= r ) || // Left edge touching
-				( x2 >= l && x2 <= r ) || // Right edge touching
-				( x1 < l && x2 > r ) // Surrounded horizontally
-			);
-		default:
-			return false;
-		}
-	};
 } )();

-/*
-	This manager tracks offsets of draggables and droppables
-*/
-$.ui.ddmanager = {
-	current: null,
-	droppables: { "default": [] },
-	prepareOffsets: function( t, event ) {
+/******************************************************************************/
+/*********************************** EFFECTS **********************************/
+/******************************************************************************/

-		var i, j,
-			m = $.ui.ddmanager.droppables[ t.options.scope ] || [],
-			type = event ? event.type : null, // workaround for #2317
-			list = ( t.currentItem || t.element ).find( ":data(ui-droppable)" ).addBack();
+( function() {

-		droppablesLoop: for ( i = 0; i < m.length; i++ ) {
+if ( $.expr && $.expr.pseudos && $.expr.pseudos.animated ) {
+	$.expr.pseudos.animated = ( function( orig ) {
+		return function( elem ) {
+			return !!$( elem ).data( dataSpaceAnimated ) || orig( elem );
+		};
+	} )( $.expr.pseudos.animated );
+}

-			// No disabled and non-accepted
-			if ( m[ i ].options.disabled || ( t && !m[ i ].accept.call( m[ i ].element[ 0 ],
-					( t.currentItem || t.element ) ) ) ) {
-				continue;
-			}
+if ( $.uiBackCompat !== false ) {
+	$.extend( $.effects, {

-			// Filter out elements in the current dragged item
-			for ( j = 0; j < list.length; j++ ) {
-				if ( list[ j ] === m[ i ].element[ 0 ] ) {
-					m[ i ].proportions().height = 0;
-					continue droppablesLoop;
+		// Saves a set of properties in a data storage
+		save: function( element, set ) {
+			var i = 0, length = set.length;
+			for ( ; i < length; i++ ) {
+				if ( set[ i ] !== null ) {
+					element.data( dataSpace + set[ i ], element[ 0 ].style[ set[ i ] ] );
 				}
 			}
+		},

-			m[ i ].visible = m[ i ].element.css( "display" ) !== "none";
-			if ( !m[ i ].visible ) {
-				continue;
+		// Restores a set of previously saved properties from a data storage
+		restore: function( element, set ) {
+			var val, i = 0, length = set.length;
+			for ( ; i < length; i++ ) {
+				if ( set[ i ] !== null ) {
+					val = element.data( dataSpace + set[ i ] );
+					element.css( set[ i ], val );
+				}
 			}
+		},

-			// Activate the droppable if used directly from draggables
-			if ( type === "mousedown" ) {
-				m[ i ]._activate.call( m[ i ], event );
+		setMode: function( el, mode ) {
+			if ( mode === "toggle" ) {
+				mode = el.is( ":hidden" ) ? "show" : "hide";
 			}
+			return mode;
+		},

-			m[ i ].offset = m[ i ].element.offset();
-			m[ i ].proportions( {
-				width: m[ i ].element[ 0 ].offsetWidth,
-				height: m[ i ].element[ 0 ].offsetHeight
-			} );
-
-		}
-
-	},
-	drop: function( draggable, event ) {
-
-		var dropped = false;
-
-		// Create a copy of the droppables in case the list changes during the drop (#9116)
-		$.each( ( $.ui.ddmanager.droppables[ draggable.options.scope ] || [] ).slice(), function() {
-
-			if ( !this.options ) {
-				return;
-			}
-			if ( !this.options.disabled && this.visible &&
-					$.ui.intersect( draggable, this, this.options.tolerance, event ) ) {
-				dropped = this._drop.call( this, event ) || dropped;
-			}
+		// Wraps the element around a wrapper that copies position properties
+		createWrapper: function( element ) {

-			if ( !this.options.disabled && this.visible && this.accept.call( this.element[ 0 ],
-					( draggable.currentItem || draggable.element ) ) ) {
-				this.isout = true;
-				this.isover = false;
-				this._deactivate.call( this, event );
+			// If the element is already wrapped, return it
+			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
+				return element.parent();
 			}

-		} );
-		return dropped;
+			// Wrap the element
+			var props = {
+					width: element.outerWidth( true ),
+					height: element.outerHeight( true ),
+					"float": element.css( "float" )
+				},
+				wrapper = $( "<div></div>" )
+					.addClass( "ui-effects-wrapper" )
+					.css( {
+						fontSize: "100%",
+						background: "transparent",
+						border: "none",
+						margin: 0,
+						padding: 0
+					} ),

-	},
-	dragStart: function( draggable, event ) {
+				// Store the size in case width/height are defined in % - Fixes #5245
+				size = {
+					width: element.width(),
+					height: element.height()
+				},
+				active = document.activeElement;

-		// Listen for scrolling so that if the dragging causes scrolling the position of the
-		// droppables can be recalculated (see #5003)
-		draggable.element.parentsUntil( "body" ).on( "scroll.droppable", function() {
-			if ( !draggable.options.refreshPositions ) {
-				$.ui.ddmanager.prepareOffsets( draggable, event );
+			// Support: Firefox
+			// Firefox incorrectly exposes anonymous content
+			// https://bugzilla.mozilla.org/show_bug.cgi?id=561664
+			try {
+				// eslint-disable-next-line no-unused-expressions
+				active.id;
+			} catch ( e ) {
+				active = document.body;
 			}
-		} );
-	},
-	drag: function( draggable, event ) {
-
-		// If you have a highly dynamic page, you might try this option. It renders positions
-		// every time you move the mouse.
-		if ( draggable.options.refreshPositions ) {
-			$.ui.ddmanager.prepareOffsets( draggable, event );
-		}
-
-		// Run through all droppables and check their positions based on specific tolerance options
-		$.each( $.ui.ddmanager.droppables[ draggable.options.scope ] || [], function() {

-			if ( this.options.disabled || this.greedyChild || !this.visible ) {
-				return;
-			}
+			element.wrap( wrapper );

-			var parentInstance, scope, parent,
-				intersects = $.ui.intersect( draggable, this, this.options.tolerance, event ),
-				c = !intersects && this.isover ?
-					"isout" :
-					( intersects && !this.isover ? "isover" : null );
-			if ( !c ) {
-				return;
+			// Fixes #7595 - Elements lose focus when wrapped.
+			if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
+				$( active ).trigger( "focus" );
 			}

-			if ( this.options.greedy ) {
+			// Hotfix for jQuery 1.4 since some change in wrap() seems to actually
+			// lose the reference to the wrapped element
+			wrapper = element.parent();

-				// find droppable parents with same scope
-				scope = this.options.scope;
-				parent = this.element.parents( ":data(ui-droppable)" ).filter( function() {
-					return $( this ).droppable( "instance" ).options.scope === scope;
+			// Transfer positioning properties to the wrapper
+			if ( element.css( "position" ) === "static" ) {
+				wrapper.css( { position: "relative" } );
+				element.css( { position: "relative" } );
+			} else {
+				$.extend( props, {
+					position: element.css( "position" ),
+					zIndex: element.css( "z-index" )
+				} );
+				$.each( [ "top", "left", "bottom", "right" ], function( i, pos ) {
+					props[ pos ] = element.css( pos );
+					if ( isNaN( parseInt( props[ pos ], 10 ) ) ) {
+						props[ pos ] = "auto";
+					}
+				} );
+				element.css( {
+					position: "relative",
+					top: 0,
+					left: 0,
+					right: "auto",
+					bottom: "auto"
 				} );
-
-				if ( parent.length ) {
-					parentInstance = $( parent[ 0 ] ).droppable( "instance" );
-					parentInstance.greedyChild = ( c === "isover" );
-				}
-			}
-
-			// We just moved into a greedy child
-			if ( parentInstance && c === "isover" ) {
-				parentInstance.isover = false;
-				parentInstance.isout = true;
-				parentInstance._out.call( parentInstance, event );
-			}
-
-			this[ c ] = true;
-			this[ c === "isout" ? "isover" : "isout" ] = false;
-			this[ c === "isover" ? "_over" : "_out" ].call( this, event );
-
-			// We just moved out of a greedy child
-			if ( parentInstance && c === "isout" ) {
-				parentInstance.isout = false;
-				parentInstance.isover = true;
-				parentInstance._over.call( parentInstance, event );
 			}
-		} );
+			element.css( size );

-	},
-	dragStop: function( draggable, event ) {
-		draggable.element.parentsUntil( "body" ).off( "scroll.droppable" );
+			return wrapper.css( props ).show();
+		},

-		// Call prepareOffsets one final time since IE does not fire return scroll events when
-		// overflow was caused by drag (see #5003)
-		if ( !draggable.options.refreshPositions ) {
-			$.ui.ddmanager.prepareOffsets( draggable, event );
-		}
-	}
-};
+		removeWrapper: function( element ) {
+			var active = document.activeElement;

-// DEPRECATED
-// TODO: switch return back to widget declaration at top of file when this is removed
-if ( $.uiBackCompat !== false ) {
+			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
+				element.parent().replaceWith( element );

-	// Backcompat for activeClass and hoverClass options
-	$.widget( "ui.droppable", $.ui.droppable, {
-		options: {
-			hoverClass: false,
-			activeClass: false
-		},
-		_addActiveClass: function() {
-			this._super();
-			if ( this.options.activeClass ) {
-				this.element.addClass( this.options.activeClass );
-			}
-		},
-		_removeActiveClass: function() {
-			this._super();
-			if ( this.options.activeClass ) {
-				this.element.removeClass( this.options.activeClass );
-			}
-		},
-		_addHoverClass: function() {
-			this._super();
-			if ( this.options.hoverClass ) {
-				this.element.addClass( this.options.hoverClass );
-			}
-		},
-		_removeHoverClass: function() {
-			this._super();
-			if ( this.options.hoverClass ) {
-				this.element.removeClass( this.options.hoverClass );
+				// Fixes #7595 - Elements lose focus when wrapped.
+				if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
+					$( active ).trigger( "focus" );
+				}
 			}
+
+			return element;
 		}
 	} );
 }

-var widgetsDroppable = $.ui.droppable;
-
+$.extend( $.effects, {
+	version: "1.13.2",

-/*!
- * jQuery UI Resizable 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
+	define: function( name, mode, effect ) {
+		if ( !effect ) {
+			effect = mode;
+			mode = "effect";
+		}

-//>>label: Resizable
-//>>group: Interactions
-//>>description: Enables resize functionality for any element.
-//>>docs: http://api.jqueryui.com/resizable/
-//>>demos: http://jqueryui.com/resizable/
-//>>css.structure: ../../themes/base/core.css
-//>>css.structure: ../../themes/base/resizable.css
-//>>css.theme: ../../themes/base/theme.css
+		$.effects.effect[ name ] = effect;
+		$.effects.effect[ name ].mode = mode;

+		return effect;
+	},

-$.widget( "ui.resizable", $.ui.mouse, {
-	version: "1.13.1",
-	widgetEventPrefix: "resize",
-	options: {
-		alsoResize: false,
-		animate: false,
-		animateDuration: "slow",
-		animateEasing: "swing",
-		aspectRatio: false,
-		autoHide: false,
-		classes: {
-			"ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
-		},
-		containment: false,
-		ghost: false,
-		grid: false,
-		handles: "e,s,se",
-		helper: false,
-		maxHeight: null,
-		maxWidth: null,
-		minHeight: 10,
-		minWidth: 10,
+	scaledDimensions: function( element, percent, direction ) {
+		if ( percent === 0 ) {
+			return {
+				height: 0,
+				width: 0,
+				outerHeight: 0,
+				outerWidth: 0
+			};
+		}

-		// See #7960
-		zIndex: 90,
+		var x = direction !== "horizontal" ? ( ( percent || 100 ) / 100 ) : 1,
+			y = direction !== "vertical" ? ( ( percent || 100 ) / 100 ) : 1;

-		// Callbacks
-		resize: null,
-		start: null,
-		stop: null
-	},
+		return {
+			height: element.height() * y,
+			width: element.width() * x,
+			outerHeight: element.outerHeight() * y,
+			outerWidth: element.outerWidth() * x
+		};

-	_num: function( value ) {
-		return parseFloat( value ) || 0;
 	},

-	_isNumber: function( value ) {
-		return !isNaN( parseFloat( value ) );
+	clipToBox: function( animation ) {
+		return {
+			width: animation.clip.right - animation.clip.left,
+			height: animation.clip.bottom - animation.clip.top,
+			left: animation.clip.left,
+			top: animation.clip.top
+		};
 	},

-	_hasScroll: function( el, a ) {
-
-		if ( $( el ).css( "overflow" ) === "hidden" ) {
-			return false;
-		}
-
-		var scroll = ( a && a === "left" ) ? "scrollLeft" : "scrollTop",
-			has = false;
-
-		if ( el[ scroll ] > 0 ) {
-			return true;
-		}
-
-		// TODO: determine which cases actually cause this to happen
-		// if the element doesn't have the scroll set, see if it's possible to
-		// set the scroll
-		try {
-			el[ scroll ] = 1;
-			has = ( el[ scroll ] > 0 );
-			el[ scroll ] = 0;
-		} catch ( e ) {
+	// Injects recently queued functions to be first in line (after "inprogress")
+	unshift: function( element, queueLength, count ) {
+		var queue = element.queue();

-			// `el` might be a string, then setting `scroll` will throw
-			// an error in strict mode; ignore it.
+		if ( queueLength > 1 ) {
+			queue.splice.apply( queue,
+				[ 1, 0 ].concat( queue.splice( queueLength, count ) ) );
 		}
-		return has;
+		element.dequeue();
 	},

-	_create: function() {
-
-		var margins,
-			o = this.options,
-			that = this;
-		this._addClass( "ui-resizable" );
-
-		$.extend( this, {
-			_aspectRatio: !!( o.aspectRatio ),
-			aspectRatio: o.aspectRatio,
-			originalElement: this.element,
-			_proportionallyResizeElements: [],
-			_helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
-		} );
-
-		// Wrap the element if it cannot hold child nodes
-		if ( this.element[ 0 ].nodeName.match( /^(canvas|textarea|input|select|button|img)$/i ) ) {
-
-			this.element.wrap(
-				$( "<div class='ui-wrapper'></div>" ).css( {
-					overflow: "hidden",
-					position: this.element.css( "position" ),
-					width: this.element.outerWidth(),
-					height: this.element.outerHeight(),
-					top: this.element.css( "top" ),
-					left: this.element.css( "left" )
-				} )
-			);
-
-			this.element = this.element.parent().data(
-				"ui-resizable", this.element.resizable( "instance" )
-			);
-
-			this.elementIsWrapper = true;
-
-			margins = {
-				marginTop: this.originalElement.css( "marginTop" ),
-				marginRight: this.originalElement.css( "marginRight" ),
-				marginBottom: this.originalElement.css( "marginBottom" ),
-				marginLeft: this.originalElement.css( "marginLeft" )
-			};
-
-			this.element.css( margins );
-			this.originalElement.css( "margin", 0 );
-
-			// support: Safari
-			// Prevent Safari textarea resize
-			this.originalResizeStyle = this.originalElement.css( "resize" );
-			this.originalElement.css( "resize", "none" );
+	saveStyle: function( element ) {
+		element.data( dataSpaceStyle, element[ 0 ].style.cssText );
+	},

-			this._proportionallyResizeElements.push( this.originalElement.css( {
-				position: "static",
-				zoom: 1,
-				display: "block"
-			} ) );
+	restoreStyle: function( element ) {
+		element[ 0 ].style.cssText = element.data( dataSpaceStyle ) || "";
+		element.removeData( dataSpaceStyle );
+	},

-			// Support: IE9
-			// avoid IE jump (hard set the margin)
-			this.originalElement.css( margins );
+	mode: function( element, mode ) {
+		var hidden = element.is( ":hidden" );

-			this._proportionallyResize();
+		if ( mode === "toggle" ) {
+			mode = hidden ? "show" : "hide";
 		}
-
-		this._setupHandles();
-
-		if ( o.autoHide ) {
-			$( this.element )
-				.on( "mouseenter", function() {
-					if ( o.disabled ) {
-						return;
-					}
-					that._removeClass( "ui-resizable-autohide" );
-					that._handles.show();
-				} )
-				.on( "mouseleave", function() {
-					if ( o.disabled ) {
-						return;
-					}
-					if ( !that.resizing ) {
-						that._addClass( "ui-resizable-autohide" );
-						that._handles.hide();
-					}
-				} );
+		if ( hidden ? mode === "hide" : mode === "show" ) {
+			mode = "none";
 		}
-
-		this._mouseInit();
+		return mode;
 	},

-	_destroy: function() {
-
-		this._mouseDestroy();
-		this._addedHandles.remove();
-
-		var wrapper,
-			_destroy = function( exp ) {
-				$( exp )
-					.removeData( "resizable" )
-					.removeData( "ui-resizable" )
-					.off( ".resizable" );
-			};
+	// Translates a [top,left] array into a baseline value
+	getBaseline: function( origin, original ) {
+		var y, x;

-		// TODO: Unwrap at same DOM position
-		if ( this.elementIsWrapper ) {
-			_destroy( this.element );
-			wrapper = this.element;
-			this.originalElement.css( {
-				position: wrapper.css( "position" ),
-				width: wrapper.outerWidth(),
-				height: wrapper.outerHeight(),
-				top: wrapper.css( "top" ),
-				left: wrapper.css( "left" )
-			} ).insertAfter( wrapper );
-			wrapper.remove();
+		switch ( origin[ 0 ] ) {
+		case "top":
+			y = 0;
+			break;
+		case "middle":
+			y = 0.5;
+			break;
+		case "bottom":
+			y = 1;
+			break;
+		default:
+			y = origin[ 0 ] / original.height;
 		}

-		this.originalElement.css( "resize", this.originalResizeStyle );
-		_destroy( this.originalElement );
-
-		return this;
-	},
-
-	_setOption: function( key, value ) {
-		this._super( key, value );
-
-		switch ( key ) {
-		case "handles":
-			this._removeHandles();
-			this._setupHandles();
+		switch ( origin[ 1 ] ) {
+		case "left":
+			x = 0;
 			break;
-		case "aspectRatio":
-			this._aspectRatio = !!value;
+		case "center":
+			x = 0.5;
 			break;
-		default:
+		case "right":
+			x = 1;
 			break;
+		default:
+			x = origin[ 1 ] / original.width;
 		}
-	},
-
-	_setupHandles: function() {
-		var o = this.options, handle, i, n, hname, axis, that = this;
-		this.handles = o.handles ||
-			( !$( ".ui-resizable-handle", this.element ).length ?
-				"e,s,se" : {
-					n: ".ui-resizable-n",
-					e: ".ui-resizable-e",
-					s: ".ui-resizable-s",
-					w: ".ui-resizable-w",
-					se: ".ui-resizable-se",
-					sw: ".ui-resizable-sw",
-					ne: ".ui-resizable-ne",
-					nw: ".ui-resizable-nw"
-				} );

-		this._handles = $();
-		this._addedHandles = $();
-		if ( this.handles.constructor === String ) {
+		return {
+			x: x,
+			y: y
+		};
+	},

-			if ( this.handles === "all" ) {
-				this.handles = "n,e,s,w,se,sw,ne,nw";
-			}
+	// Creates a placeholder element so that the original element can be made absolute
+	createPlaceholder: function( element ) {
+		var placeholder,
+			cssPosition = element.css( "position" ),
+			position = element.position();

-			n = this.handles.split( "," );
-			this.handles = {};
+		// Lock in margins first to account for form elements, which
+		// will change margin if you explicitly set height
+		// see: http://jsfiddle.net/JZSMt/3/ https://bugs.webkit.org/show_bug.cgi?id=107380
+		// Support: Safari
+		element.css( {
+			marginTop: element.css( "marginTop" ),
+			marginBottom: element.css( "marginBottom" ),
+			marginLeft: element.css( "marginLeft" ),
+			marginRight: element.css( "marginRight" )
+		} )
+		.outerWidth( element.outerWidth() )
+		.outerHeight( element.outerHeight() );

-			for ( i = 0; i < n.length; i++ ) {
+		if ( /^(static|relative)/.test( cssPosition ) ) {
+			cssPosition = "absolute";

-				handle = String.prototype.trim.call( n[ i ] );
-				hname = "ui-resizable-" + handle;
-				axis = $( "<div>" );
-				this._addClass( axis, "ui-resizable-handle " + hname );
+			placeholder = $( "<" + element[ 0 ].nodeName + ">" ).insertAfter( element ).css( {

-				axis.css( { zIndex: o.zIndex } );
+				// Convert inline to inline block to account for inline elements
+				// that turn to inline block based on content (like img)
+				display: /^(inline|ruby)/.test( element.css( "display" ) ) ?
+					"inline-block" :
+					"block",
+				visibility: "hidden",

-				this.handles[ handle ] = ".ui-resizable-" + handle;
-				if ( !this.element.children( this.handles[ handle ] ).length ) {
-					this.element.append( axis );
-					this._addedHandles = this._addedHandles.add( axis );
-				}
-			}
+				// Margins need to be set to account for margin collapse
+				marginTop: element.css( "marginTop" ),
+				marginBottom: element.css( "marginBottom" ),
+				marginLeft: element.css( "marginLeft" ),
+				marginRight: element.css( "marginRight" ),
+				"float": element.css( "float" )
+			} )
+			.outerWidth( element.outerWidth() )
+			.outerHeight( element.outerHeight() )
+			.addClass( "ui-effects-placeholder" );

+			element.data( dataSpace + "placeholder", placeholder );
 		}

-		this._renderAxis = function( target ) {
-
-			var i, axis, padPos, padWrapper;
-
-			target = target || this.element;
-
-			for ( i in this.handles ) {
-
-				if ( this.handles[ i ].constructor === String ) {
-					this.handles[ i ] = this.element.children( this.handles[ i ] ).first().show();
-				} else if ( this.handles[ i ].jquery || this.handles[ i ].nodeType ) {
-					this.handles[ i ] = $( this.handles[ i ] );
-					this._on( this.handles[ i ], { "mousedown": that._mouseDown } );
-				}
-
-				if ( this.elementIsWrapper &&
-						this.originalElement[ 0 ]
-							.nodeName
-							.match( /^(textarea|input|select|button)$/i ) ) {
-					axis = $( this.handles[ i ], this.element );
-
-					padWrapper = /sw|ne|nw|se|n|s/.test( i ) ?
-						axis.outerHeight() :
-						axis.outerWidth();
-
-					padPos = [ "padding",
-						/ne|nw|n/.test( i ) ? "Top" :
-						/se|sw|s/.test( i ) ? "Bottom" :
-						/^e$/.test( i ) ? "Right" : "Left" ].join( "" );
-
-					target.css( padPos, padWrapper );
-
-					this._proportionallyResize();
-				}
-
-				this._handles = this._handles.add( this.handles[ i ] );
-			}
-		};
-
-		// TODO: make renderAxis a prototype function
-		this._renderAxis( this.element );
-
-		this._handles = this._handles.add( this.element.find( ".ui-resizable-handle" ) );
-		this._handles.disableSelection();
-
-		this._handles.on( "mouseover", function() {
-			if ( !that.resizing ) {
-				if ( this.className ) {
-					axis = this.className.match( /ui-resizable-(se|sw|ne|nw|n|e|s|w)/i );
-				}
-				that.axis = axis && axis[ 1 ] ? axis[ 1 ] : "se";
-			}
+		element.css( {
+			position: cssPosition,
+			left: position.left,
+			top: position.top
 		} );

-		if ( o.autoHide ) {
-			this._handles.hide();
-			this._addClass( "ui-resizable-autohide" );
-		}
-	},
-
-	_removeHandles: function() {
-		this._addedHandles.remove();
+		return placeholder;
 	},

-	_mouseCapture: function( event ) {
-		var i, handle,
-			capture = false;
+	removePlaceholder: function( element ) {
+		var dataKey = dataSpace + "placeholder",
+				placeholder = element.data( dataKey );

-		for ( i in this.handles ) {
-			handle = $( this.handles[ i ] )[ 0 ];
-			if ( handle === event.target || $.contains( handle, event.target ) ) {
-				capture = true;
-			}
+		if ( placeholder ) {
+			placeholder.remove();
+			element.removeData( dataKey );
 		}
+	},

-		return !this.options.disabled && capture;
+	// Removes a placeholder if it exists and restores
+	// properties that were modified during placeholder creation
+	cleanUp: function( element ) {
+		$.effects.restoreStyle( element );
+		$.effects.removePlaceholder( element );
 	},

-	_mouseStart: function( event ) {
+	setTransition: function( element, list, factor, value ) {
+		value = value || {};
+		$.each( list, function( i, x ) {
+			var unit = element.cssUnit( x );
+			if ( unit[ 0 ] > 0 ) {
+				value[ x ] = unit[ 0 ] * factor + unit[ 1 ];
+			}
+		} );
+		return value;
+	}
+} );

-		var curleft, curtop, cursor,
-			o = this.options,
-			el = this.element;
+// Return an effect options object for the given parameters:
+function _normalizeArguments( effect, options, speed, callback ) {

-		this.resizing = true;
+	// Allow passing all options as the first parameter
+	if ( $.isPlainObject( effect ) ) {
+		options = effect;
+		effect = effect.effect;
+	}

-		this._renderProxy();
+	// Convert to an object
+	effect = { effect: effect };

-		curleft = this._num( this.helper.css( "left" ) );
-		curtop = this._num( this.helper.css( "top" ) );
+	// Catch (effect, null, ...)
+	if ( options == null ) {
+		options = {};
+	}

-		if ( o.containment ) {
-			curleft += $( o.containment ).scrollLeft() || 0;
-			curtop += $( o.containment ).scrollTop() || 0;
-		}
+	// Catch (effect, callback)
+	if ( typeof options === "function" ) {
+		callback = options;
+		speed = null;
+		options = {};
+	}

-		this.offset = this.helper.offset();
-		this.position = { left: curleft, top: curtop };
+	// Catch (effect, speed, ?)
+	if ( typeof options === "number" || $.fx.speeds[ options ] ) {
+		callback = speed;
+		speed = options;
+		options = {};
+	}

-		this.size = this._helper ? {
-				width: this.helper.width(),
-				height: this.helper.height()
-			} : {
-				width: el.width(),
-				height: el.height()
-			};
+	// Catch (effect, options, callback)
+	if ( typeof speed === "function" ) {
+		callback = speed;
+		speed = null;
+	}

-		this.originalSize = this._helper ? {
-				width: el.outerWidth(),
-				height: el.outerHeight()
-			} : {
-				width: el.width(),
-				height: el.height()
-			};
+	// Add options to effect
+	if ( options ) {
+		$.extend( effect, options );
+	}

-		this.sizeDiff = {
-			width: el.outerWidth() - el.width(),
-			height: el.outerHeight() - el.height()
-		};
+	speed = speed || options.duration;
+	effect.duration = $.fx.off ? 0 :
+		typeof speed === "number" ? speed :
+		speed in $.fx.speeds ? $.fx.speeds[ speed ] :
+		$.fx.speeds._default;

-		this.originalPosition = { left: curleft, top: curtop };
-		this.originalMousePosition = { left: event.pageX, top: event.pageY };
+	effect.complete = callback || options.complete;

-		this.aspectRatio = ( typeof o.aspectRatio === "number" ) ?
-			o.aspectRatio :
-			( ( this.originalSize.width / this.originalSize.height ) || 1 );
+	return effect;
+}

-		cursor = $( ".ui-resizable-" + this.axis ).css( "cursor" );
-		$( "body" ).css( "cursor", cursor === "auto" ? this.axis + "-resize" : cursor );
+function standardAnimationOption( option ) {

-		this._addClass( "ui-resizable-resizing" );
-		this._propagate( "start", event );
+	// Valid standard speeds (nothing, number, named speed)
+	if ( !option || typeof option === "number" || $.fx.speeds[ option ] ) {
 		return true;
-	},
+	}

-	_mouseDrag: function( event ) {
+	// Invalid strings - treat as "normal" speed
+	if ( typeof option === "string" && !$.effects.effect[ option ] ) {
+		return true;
+	}

-		var data, props,
-			smp = this.originalMousePosition,
-			a = this.axis,
-			dx = ( event.pageX - smp.left ) || 0,
-			dy = ( event.pageY - smp.top ) || 0,
-			trigger = this._change[ a ];
+	// Complete callback
+	if ( typeof option === "function" ) {
+		return true;
+	}

-		this._updatePrevProperties();
+	// Options hash (but not naming an effect)
+	if ( typeof option === "object" && !option.effect ) {
+		return true;
+	}

-		if ( !trigger ) {
-			return false;
-		}
+	// Didn't match any standard API
+	return false;
+}

-		data = trigger.apply( this, [ event, dx, dy ] );
+$.fn.extend( {
+	effect: function( /* effect, options, speed, callback */ ) {
+		var args = _normalizeArguments.apply( this, arguments ),
+			effectMethod = $.effects.effect[ args.effect ],
+			defaultMode = effectMethod.mode,
+			queue = args.queue,
+			queueName = queue || "fx",
+			complete = args.complete,
+			mode = args.mode,
+			modes = [],
+			prefilter = function( next ) {
+				var el = $( this ),
+					normalizedMode = $.effects.mode( el, mode ) || defaultMode;

-		this._updateVirtualBoundaries( event.shiftKey );
-		if ( this._aspectRatio || event.shiftKey ) {
-			data = this._updateRatio( data, event );
-		}
+				// Sentinel for duck-punching the :animated pseudo-selector
+				el.data( dataSpaceAnimated, true );

-		data = this._respectSize( data, event );
+				// Save effect mode for later use,
+				// we can't just call $.effects.mode again later,
+				// as the .show() below destroys the initial state
+				modes.push( normalizedMode );

-		this._updateCache( data );
+				// See $.uiBackCompat inside of run() for removal of defaultMode in 1.14
+				if ( defaultMode && ( normalizedMode === "show" ||
+						( normalizedMode === defaultMode && normalizedMode === "hide" ) ) ) {
+					el.show();
+				}

-		this._propagate( "resize", event );
+				if ( !defaultMode || normalizedMode !== "none" ) {
+					$.effects.saveStyle( el );
+				}

-		props = this._applyChanges();
+				if ( typeof next === "function" ) {
+					next();
+				}
+			};

-		if ( !this._helper && this._proportionallyResizeElements.length ) {
-			this._proportionallyResize();
-		}
+		if ( $.fx.off || !effectMethod ) {

-		if ( !$.isEmptyObject( props ) ) {
-			this._updatePrevProperties();
-			this._trigger( "resize", event, this.ui() );
-			this._applyChanges();
+			// Delegate to the original method (e.g., .show()) if possible
+			if ( mode ) {
+				return this[ mode ]( args.duration, complete );
+			} else {
+				return this.each( function() {
+					if ( complete ) {
+						complete.call( this );
+					}
+				} );
+			}
 		}

-		return false;
-	},
-
-	_mouseStop: function( event ) {
-
-		this.resizing = false;
-		var pr, ista, soffseth, soffsetw, s, left, top,
-			o = this.options, that = this;
+		function run( next ) {
+			var elem = $( this );

-		if ( this._helper ) {
+			function cleanup() {
+				elem.removeData( dataSpaceAnimated );

-			pr = this._proportionallyResizeElements;
-			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName );
-			soffseth = ista && this._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height;
-			soffsetw = ista ? 0 : that.sizeDiff.width;
+				$.effects.cleanUp( elem );

-			s = {
-				width: ( that.helper.width()  - soffsetw ),
-				height: ( that.helper.height() - soffseth )
-			};
-			left = ( parseFloat( that.element.css( "left" ) ) +
-				( that.position.left - that.originalPosition.left ) ) || null;
-			top = ( parseFloat( that.element.css( "top" ) ) +
-				( that.position.top - that.originalPosition.top ) ) || null;
+				if ( args.mode === "hide" ) {
+					elem.hide();
+				}

-			if ( !o.animate ) {
-				this.element.css( $.extend( s, { top: top, left: left } ) );
+				done();
 			}

-			that.helper.height( that.size.height );
-			that.helper.width( that.size.width );
+			function done() {
+				if ( typeof complete === "function" ) {
+					complete.call( elem[ 0 ] );
+				}

-			if ( this._helper && !o.animate ) {
-				this._proportionallyResize();
+				if ( typeof next === "function" ) {
+					next();
+				}
 			}
-		}

-		$( "body" ).css( "cursor", "auto" );
+			// Override mode option on a per element basis,
+			// as toggle can be either show or hide depending on element state
+			args.mode = modes.shift();

-		this._removeClass( "ui-resizable-resizing" );
+			if ( $.uiBackCompat !== false && !defaultMode ) {
+				if ( elem.is( ":hidden" ) ? mode === "hide" : mode === "show" ) {

-		this._propagate( "stop", event );
+					// Call the core method to track "olddisplay" properly
+					elem[ mode ]();
+					done();
+				} else {
+					effectMethod.call( elem[ 0 ], args, done );
+				}
+			} else {
+				if ( args.mode === "none" ) {

-		if ( this._helper ) {
-			this.helper.remove();
+					// Call the core method to track "olddisplay" properly
+					elem[ mode ]();
+					done();
+				} else {
+					effectMethod.call( elem[ 0 ], args, cleanup );
+				}
+			}
 		}

-		return false;
-
+		// Run prefilter on all elements first to ensure that
+		// any showing or hiding happens before placeholder creation,
+		// which ensures that any layout changes are correctly captured.
+		return queue === false ?
+			this.each( prefilter ).each( run ) :
+			this.queue( queueName, prefilter ).queue( queueName, run );
 	},

-	_updatePrevProperties: function() {
-		this.prevPosition = {
-			top: this.position.top,
-			left: this.position.left
-		};
-		this.prevSize = {
-			width: this.size.width,
-			height: this.size.height
+	show: ( function( orig ) {
+		return function( option ) {
+			if ( standardAnimationOption( option ) ) {
+				return orig.apply( this, arguments );
+			} else {
+				var args = _normalizeArguments.apply( this, arguments );
+				args.mode = "show";
+				return this.effect.call( this, args );
+			}
 		};
-	},
-
-	_applyChanges: function() {
-		var props = {};
-
-		if ( this.position.top !== this.prevPosition.top ) {
-			props.top = this.position.top + "px";
-		}
-		if ( this.position.left !== this.prevPosition.left ) {
-			props.left = this.position.left + "px";
-		}
-		if ( this.size.width !== this.prevSize.width ) {
-			props.width = this.size.width + "px";
-		}
-		if ( this.size.height !== this.prevSize.height ) {
-			props.height = this.size.height + "px";
-		}
-
-		this.helper.css( props );
-
-		return props;
-	},
-
-	_updateVirtualBoundaries: function( forceAspectRatio ) {
-		var pMinWidth, pMaxWidth, pMinHeight, pMaxHeight, b,
-			o = this.options;
+	} )( $.fn.show ),

-		b = {
-			minWidth: this._isNumber( o.minWidth ) ? o.minWidth : 0,
-			maxWidth: this._isNumber( o.maxWidth ) ? o.maxWidth : Infinity,
-			minHeight: this._isNumber( o.minHeight ) ? o.minHeight : 0,
-			maxHeight: this._isNumber( o.maxHeight ) ? o.maxHeight : Infinity
+	hide: ( function( orig ) {
+		return function( option ) {
+			if ( standardAnimationOption( option ) ) {
+				return orig.apply( this, arguments );
+			} else {
+				var args = _normalizeArguments.apply( this, arguments );
+				args.mode = "hide";
+				return this.effect.call( this, args );
+			}
 		};
+	} )( $.fn.hide ),

-		if ( this._aspectRatio || forceAspectRatio ) {
-			pMinWidth = b.minHeight * this.aspectRatio;
-			pMinHeight = b.minWidth / this.aspectRatio;
-			pMaxWidth = b.maxHeight * this.aspectRatio;
-			pMaxHeight = b.maxWidth / this.aspectRatio;
-
-			if ( pMinWidth > b.minWidth ) {
-				b.minWidth = pMinWidth;
-			}
-			if ( pMinHeight > b.minHeight ) {
-				b.minHeight = pMinHeight;
-			}
-			if ( pMaxWidth < b.maxWidth ) {
-				b.maxWidth = pMaxWidth;
-			}
-			if ( pMaxHeight < b.maxHeight ) {
-				b.maxHeight = pMaxHeight;
+	toggle: ( function( orig ) {
+		return function( option ) {
+			if ( standardAnimationOption( option ) || typeof option === "boolean" ) {
+				return orig.apply( this, arguments );
+			} else {
+				var args = _normalizeArguments.apply( this, arguments );
+				args.mode = "toggle";
+				return this.effect.call( this, args );
 			}
-		}
-		this._vBoundaries = b;
-	},
-
-	_updateCache: function( data ) {
-		this.offset = this.helper.offset();
-		if ( this._isNumber( data.left ) ) {
-			this.position.left = data.left;
-		}
-		if ( this._isNumber( data.top ) ) {
-			this.position.top = data.top;
-		}
-		if ( this._isNumber( data.height ) ) {
-			this.size.height = data.height;
-		}
-		if ( this._isNumber( data.width ) ) {
-			this.size.width = data.width;
-		}
-	},
-
-	_updateRatio: function( data ) {
-
-		var cpos = this.position,
-			csize = this.size,
-			a = this.axis;
-
-		if ( this._isNumber( data.height ) ) {
-			data.width = ( data.height * this.aspectRatio );
-		} else if ( this._isNumber( data.width ) ) {
-			data.height = ( data.width / this.aspectRatio );
-		}
-
-		if ( a === "sw" ) {
-			data.left = cpos.left + ( csize.width - data.width );
-			data.top = null;
-		}
-		if ( a === "nw" ) {
-			data.top = cpos.top + ( csize.height - data.height );
-			data.left = cpos.left + ( csize.width - data.width );
-		}
-
-		return data;
-	},
-
-	_respectSize: function( data ) {
-
-		var o = this._vBoundaries,
-			a = this.axis,
-			ismaxw = this._isNumber( data.width ) && o.maxWidth && ( o.maxWidth < data.width ),
-			ismaxh = this._isNumber( data.height ) && o.maxHeight && ( o.maxHeight < data.height ),
-			isminw = this._isNumber( data.width ) && o.minWidth && ( o.minWidth > data.width ),
-			isminh = this._isNumber( data.height ) && o.minHeight && ( o.minHeight > data.height ),
-			dw = this.originalPosition.left + this.originalSize.width,
-			dh = this.originalPosition.top + this.originalSize.height,
-			cw = /sw|nw|w/.test( a ), ch = /nw|ne|n/.test( a );
-		if ( isminw ) {
-			data.width = o.minWidth;
-		}
-		if ( isminh ) {
-			data.height = o.minHeight;
-		}
-		if ( ismaxw ) {
-			data.width = o.maxWidth;
-		}
-		if ( ismaxh ) {
-			data.height = o.maxHeight;
-		}
-
-		if ( isminw && cw ) {
-			data.left = dw - o.minWidth;
-		}
-		if ( ismaxw && cw ) {
-			data.left = dw - o.maxWidth;
-		}
-		if ( isminh && ch ) {
-			data.top = dh - o.minHeight;
-		}
-		if ( ismaxh && ch ) {
-			data.top = dh - o.maxHeight;
-		}
-
-		// Fixing jump error on top/left - bug #2330
-		if ( !data.width && !data.height && !data.left && data.top ) {
-			data.top = null;
-		} else if ( !data.width && !data.height && !data.top && data.left ) {
-			data.left = null;
-		}
-
-		return data;
-	},
-
-	_getPaddingPlusBorderDimensions: function( element ) {
-		var i = 0,
-			widths = [],
-			borders = [
-				element.css( "borderTopWidth" ),
-				element.css( "borderRightWidth" ),
-				element.css( "borderBottomWidth" ),
-				element.css( "borderLeftWidth" )
-			],
-			paddings = [
-				element.css( "paddingTop" ),
-				element.css( "paddingRight" ),
-				element.css( "paddingBottom" ),
-				element.css( "paddingLeft" )
-			];
-
-		for ( ; i < 4; i++ ) {
-			widths[ i ] = ( parseFloat( borders[ i ] ) || 0 );
-			widths[ i ] += ( parseFloat( paddings[ i ] ) || 0 );
-		}
-
-		return {
-			height: widths[ 0 ] + widths[ 2 ],
-			width: widths[ 1 ] + widths[ 3 ]
 		};
-	},
-
-	_proportionallyResize: function() {
-
-		if ( !this._proportionallyResizeElements.length ) {
-			return;
-		}
-
-		var prel,
-			i = 0,
-			element = this.helper || this.element;
-
-		for ( ; i < this._proportionallyResizeElements.length; i++ ) {
+	} )( $.fn.toggle ),

-			prel = this._proportionallyResizeElements[ i ];
+	cssUnit: function( key ) {
+		var style = this.css( key ),
+			val = [];

-			// TODO: Seems like a bug to cache this.outerDimensions
-			// considering that we are in a loop.
-			if ( !this.outerDimensions ) {
-				this.outerDimensions = this._getPaddingPlusBorderDimensions( prel );
+		$.each( [ "em", "px", "%", "pt" ], function( i, unit ) {
+			if ( style.indexOf( unit ) > 0 ) {
+				val = [ parseFloat( style ), unit ];
 			}
-
-			prel.css( {
-				height: ( element.height() - this.outerDimensions.height ) || 0,
-				width: ( element.width() - this.outerDimensions.width ) || 0
-			} );
-
-		}
-
-	},
-
-	_renderProxy: function() {
-
-		var el = this.element, o = this.options;
-		this.elementOffset = el.offset();
-
-		if ( this._helper ) {
-
-			this.helper = this.helper || $( "<div></div>" ).css( { overflow: "hidden" } );
-
-			this._addClass( this.helper, this._helper );
-			this.helper.css( {
-				width: this.element.outerWidth(),
-				height: this.element.outerHeight(),
-				position: "absolute",
-				left: this.elementOffset.left + "px",
-				top: this.elementOffset.top + "px",
-				zIndex: ++o.zIndex //TODO: Don't modify option
-			} );
-
-			this.helper
-				.appendTo( "body" )
-				.disableSelection();
-
-		} else {
-			this.helper = this.element;
-		}
-
-	},
-
-	_change: {
-		e: function( event, dx ) {
-			return { width: this.originalSize.width + dx };
-		},
-		w: function( event, dx ) {
-			var cs = this.originalSize, sp = this.originalPosition;
-			return { left: sp.left + dx, width: cs.width - dx };
-		},
-		n: function( event, dx, dy ) {
-			var cs = this.originalSize, sp = this.originalPosition;
-			return { top: sp.top + dy, height: cs.height - dy };
-		},
-		s: function( event, dx, dy ) {
-			return { height: this.originalSize.height + dy };
-		},
-		se: function( event, dx, dy ) {
-			return $.extend( this._change.s.apply( this, arguments ),
-				this._change.e.apply( this, [ event, dx, dy ] ) );
-		},
-		sw: function( event, dx, dy ) {
-			return $.extend( this._change.s.apply( this, arguments ),
-				this._change.w.apply( this, [ event, dx, dy ] ) );
-		},
-		ne: function( event, dx, dy ) {
-			return $.extend( this._change.n.apply( this, arguments ),
-				this._change.e.apply( this, [ event, dx, dy ] ) );
-		},
-		nw: function( event, dx, dy ) {
-			return $.extend( this._change.n.apply( this, arguments ),
-				this._change.w.apply( this, [ event, dx, dy ] ) );
-		}
+		} );
+		return val;
 	},

-	_propagate: function( n, event ) {
-		$.ui.plugin.call( this, n, [ event, this.ui() ] );
-		if ( n !== "resize" ) {
-			this._trigger( n, event, this.ui() );
+	cssClip: function( clipObj ) {
+		if ( clipObj ) {
+			return this.css( "clip", "rect(" + clipObj.top + "px " + clipObj.right + "px " +
+				clipObj.bottom + "px " + clipObj.left + "px)" );
 		}
+		return parseClip( this.css( "clip" ), this );
 	},

-	plugins: {},
-
-	ui: function() {
-		return {
-			originalElement: this.originalElement,
-			element: this.element,
-			helper: this.helper,
-			position: this.position,
-			size: this.size,
-			originalSize: this.originalSize,
-			originalPosition: this.originalPosition
-		};
-	}
-
-} );
-
-/*
- * Resizable Extensions
- */
-
-$.ui.plugin.add( "resizable", "animate", {
-
-	stop: function( event ) {
-		var that = $( this ).resizable( "instance" ),
-			o = that.options,
-			pr = that._proportionallyResizeElements,
-			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName ),
-			soffseth = ista && that._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height,
-			soffsetw = ista ? 0 : that.sizeDiff.width,
-			style = {
-				width: ( that.size.width - soffsetw ),
-				height: ( that.size.height - soffseth )
+	transfer: function( options, done ) {
+		var element = $( this ),
+			target = $( options.to ),
+			targetFixed = target.css( "position" ) === "fixed",
+			body = $( "body" ),
+			fixTop = targetFixed ? body.scrollTop() : 0,
+			fixLeft = targetFixed ? body.scrollLeft() : 0,
+			endPosition = target.offset(),
+			animation = {
+				top: endPosition.top - fixTop,
+				left: endPosition.left - fixLeft,
+				height: target.innerHeight(),
+				width: target.innerWidth()
 			},
-			left = ( parseFloat( that.element.css( "left" ) ) +
-				( that.position.left - that.originalPosition.left ) ) || null,
-			top = ( parseFloat( that.element.css( "top" ) ) +
-				( that.position.top - that.originalPosition.top ) ) || null;
-
-		that.element.animate(
-			$.extend( style, top && left ? { top: top, left: left } : {} ), {
-				duration: o.animateDuration,
-				easing: o.animateEasing,
-				step: function() {
-
-					var data = {
-						width: parseFloat( that.element.css( "width" ) ),
-						height: parseFloat( that.element.css( "height" ) ),
-						top: parseFloat( that.element.css( "top" ) ),
-						left: parseFloat( that.element.css( "left" ) )
-					};
-
-					if ( pr && pr.length ) {
-						$( pr[ 0 ] ).css( { width: data.width, height: data.height } );
-					}
-
-					// Propagating resize, and updating values for each animation step
-					that._updateCache( data );
-					that._propagate( "resize", event );
+			startPosition = element.offset(),
+			transfer = $( "<div class='ui-effects-transfer'></div>" );

+		transfer
+			.appendTo( "body" )
+			.addClass( options.className )
+			.css( {
+				top: startPosition.top - fixTop,
+				left: startPosition.left - fixLeft,
+				height: element.innerHeight(),
+				width: element.innerWidth(),
+				position: targetFixed ? "fixed" : "absolute"
+			} )
+			.animate( animation, options.duration, options.easing, function() {
+				transfer.remove();
+				if ( typeof done === "function" ) {
+					done();
 				}
-			}
-		);
+			} );
 	}
-
 } );

-$.ui.plugin.add( "resizable", "containment", {
-
-	start: function() {
-		var element, p, co, ch, cw, width, height,
-			that = $( this ).resizable( "instance" ),
-			o = that.options,
-			el = that.element,
-			oc = o.containment,
-			ce = ( oc instanceof $ ) ?
-				oc.get( 0 ) :
-				( /parent/.test( oc ) ) ? el.parent().get( 0 ) : oc;
-
-		if ( !ce ) {
-			return;
-		}
-
-		that.containerElement = $( ce );
-
-		if ( /document/.test( oc ) || oc === document ) {
-			that.containerOffset = {
-				left: 0,
-				top: 0
-			};
-			that.containerPosition = {
-				left: 0,
-				top: 0
-			};
-
-			that.parentData = {
-				element: $( document ),
-				left: 0,
-				top: 0,
-				width: $( document ).width(),
-				height: $( document ).height() || document.body.parentNode.scrollHeight
-			};
-		} else {
-			element = $( ce );
-			p = [];
-			$( [ "Top", "Right", "Left", "Bottom" ] ).each( function( i, name ) {
-				p[ i ] = that._num( element.css( "padding" + name ) );
-			} );
-
-			that.containerOffset = element.offset();
-			that.containerPosition = element.position();
-			that.containerSize = {
-				height: ( element.innerHeight() - p[ 3 ] ),
-				width: ( element.innerWidth() - p[ 1 ] )
-			};
-
-			co = that.containerOffset;
-			ch = that.containerSize.height;
-			cw = that.containerSize.width;
-			width = ( that._hasScroll( ce, "left" ) ? ce.scrollWidth : cw );
-			height = ( that._hasScroll( ce ) ? ce.scrollHeight : ch );
-
-			that.parentData = {
-				element: ce,
-				left: co.left,
-				top: co.top,
-				width: width,
-				height: height
-			};
-		}
-	},
-
-	resize: function( event ) {
-		var woset, hoset, isParent, isOffsetRelative,
-			that = $( this ).resizable( "instance" ),
-			o = that.options,
-			co = that.containerOffset,
-			cp = that.position,
-			pRatio = that._aspectRatio || event.shiftKey,
-			cop = {
-				top: 0,
-				left: 0
-			},
-			ce = that.containerElement,
-			continueResize = true;
-
-		if ( ce[ 0 ] !== document && ( /static/ ).test( ce.css( "position" ) ) ) {
-			cop = co;
-		}
-
-		if ( cp.left < ( that._helper ? co.left : 0 ) ) {
-			that.size.width = that.size.width +
-				( that._helper ?
-					( that.position.left - co.left ) :
-					( that.position.left - cop.left ) );
-
-			if ( pRatio ) {
-				that.size.height = that.size.width / that.aspectRatio;
-				continueResize = false;
-			}
-			that.position.left = o.helper ? co.left : 0;
-		}
-
-		if ( cp.top < ( that._helper ? co.top : 0 ) ) {
-			that.size.height = that.size.height +
-				( that._helper ?
-					( that.position.top - co.top ) :
-					that.position.top );
-
-			if ( pRatio ) {
-				that.size.width = that.size.height * that.aspectRatio;
-				continueResize = false;
-			}
-			that.position.top = that._helper ? co.top : 0;
-		}
+function parseClip( str, element ) {
+		var outerWidth = element.outerWidth(),
+			outerHeight = element.outerHeight(),
+			clipRegex = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,
+			values = clipRegex.exec( str ) || [ "", 0, outerWidth, outerHeight, 0 ];

-		isParent = that.containerElement.get( 0 ) === that.element.parent().get( 0 );
-		isOffsetRelative = /relative|absolute/.test( that.containerElement.css( "position" ) );
+		return {
+			top: parseFloat( values[ 1 ] ) || 0,
+			right: values[ 2 ] === "auto" ? outerWidth : parseFloat( values[ 2 ] ),
+			bottom: values[ 3 ] === "auto" ? outerHeight : parseFloat( values[ 3 ] ),
+			left: parseFloat( values[ 4 ] ) || 0
+		};
+}

-		if ( isParent && isOffsetRelative ) {
-			that.offset.left = that.parentData.left + that.position.left;
-			that.offset.top = that.parentData.top + that.position.top;
-		} else {
-			that.offset.left = that.element.offset().left;
-			that.offset.top = that.element.offset().top;
+$.fx.step.clip = function( fx ) {
+	if ( !fx.clipInit ) {
+		fx.start = $( fx.elem ).cssClip();
+		if ( typeof fx.end === "string" ) {
+			fx.end = parseClip( fx.end, fx.elem );
 		}
+		fx.clipInit = true;
+	}

-		woset = Math.abs( that.sizeDiff.width +
-			( that._helper ?
-				that.offset.left - cop.left :
-				( that.offset.left - co.left ) ) );
-
-		hoset = Math.abs( that.sizeDiff.height +
-			( that._helper ?
-				that.offset.top - cop.top :
-				( that.offset.top - co.top ) ) );
+	$( fx.elem ).cssClip( {
+		top: fx.pos * ( fx.end.top - fx.start.top ) + fx.start.top,
+		right: fx.pos * ( fx.end.right - fx.start.right ) + fx.start.right,
+		bottom: fx.pos * ( fx.end.bottom - fx.start.bottom ) + fx.start.bottom,
+		left: fx.pos * ( fx.end.left - fx.start.left ) + fx.start.left
+	} );
+};

-		if ( woset + that.size.width >= that.parentData.width ) {
-			that.size.width = that.parentData.width - woset;
-			if ( pRatio ) {
-				that.size.height = that.size.width / that.aspectRatio;
-				continueResize = false;
-			}
-		}
+} )();

-		if ( hoset + that.size.height >= that.parentData.height ) {
-			that.size.height = that.parentData.height - hoset;
-			if ( pRatio ) {
-				that.size.width = that.size.height * that.aspectRatio;
-				continueResize = false;
-			}
-		}
+/******************************************************************************/
+/*********************************** EASING ***********************************/
+/******************************************************************************/

-		if ( !continueResize ) {
-			that.position.left = that.prevPosition.left;
-			that.position.top = that.prevPosition.top;
-			that.size.width = that.prevSize.width;
-			that.size.height = that.prevSize.height;
-		}
-	},
+( function() {

-	stop: function() {
-		var that = $( this ).resizable( "instance" ),
-			o = that.options,
-			co = that.containerOffset,
-			cop = that.containerPosition,
-			ce = that.containerElement,
-			helper = $( that.helper ),
-			ho = helper.offset(),
-			w = helper.outerWidth() - that.sizeDiff.width,
-			h = helper.outerHeight() - that.sizeDiff.height;
+// Based on easing equations from Robert Penner (http://www.robertpenner.com/easing)

-		if ( that._helper && !o.animate && ( /relative/ ).test( ce.css( "position" ) ) ) {
-			$( this ).css( {
-				left: ho.left - cop.left - co.left,
-				width: w,
-				height: h
-			} );
-		}
+var baseEasings = {};

-		if ( that._helper && !o.animate && ( /static/ ).test( ce.css( "position" ) ) ) {
-			$( this ).css( {
-				left: ho.left - cop.left - co.left,
-				width: w,
-				height: h
-			} );
-		}
-	}
+$.each( [ "Quad", "Cubic", "Quart", "Quint", "Expo" ], function( i, name ) {
+	baseEasings[ name ] = function( p ) {
+		return Math.pow( p, i + 2 );
+	};
 } );

-$.ui.plugin.add( "resizable", "alsoResize", {
-
-	start: function() {
-		var that = $( this ).resizable( "instance" ),
-			o = that.options;
-
-		$( o.alsoResize ).each( function() {
-			var el = $( this );
-			el.data( "ui-resizable-alsoresize", {
-				width: parseFloat( el.width() ), height: parseFloat( el.height() ),
-				left: parseFloat( el.css( "left" ) ), top: parseFloat( el.css( "top" ) )
-			} );
-		} );
+$.extend( baseEasings, {
+	Sine: function( p ) {
+		return 1 - Math.cos( p * Math.PI / 2 );
 	},
-
-	resize: function( event, ui ) {
-		var that = $( this ).resizable( "instance" ),
-			o = that.options,
-			os = that.originalSize,
-			op = that.originalPosition,
-			delta = {
-				height: ( that.size.height - os.height ) || 0,
-				width: ( that.size.width - os.width ) || 0,
-				top: ( that.position.top - op.top ) || 0,
-				left: ( that.position.left - op.left ) || 0
-			};
-
-			$( o.alsoResize ).each( function() {
-				var el = $( this ), start = $( this ).data( "ui-resizable-alsoresize" ), style = {},
-					css = el.parents( ui.originalElement[ 0 ] ).length ?
-							[ "width", "height" ] :
-							[ "width", "height", "top", "left" ];
-
-				$.each( css, function( i, prop ) {
-					var sum = ( start[ prop ] || 0 ) + ( delta[ prop ] || 0 );
-					if ( sum && sum >= 0 ) {
-						style[ prop ] = sum || null;
-					}
-				} );
-
-				el.css( style );
-			} );
+	Circ: function( p ) {
+		return 1 - Math.sqrt( 1 - p * p );
+	},
+	Elastic: function( p ) {
+		return p === 0 || p === 1 ? p :
+			-Math.pow( 2, 8 * ( p - 1 ) ) * Math.sin( ( ( p - 1 ) * 80 - 7.5 ) * Math.PI / 15 );
 	},
+	Back: function( p ) {
+		return p * p * ( 3 * p - 2 );
+	},
+	Bounce: function( p ) {
+		var pow2,
+			bounce = 4;

-	stop: function() {
-		$( this ).removeData( "ui-resizable-alsoresize" );
+		while ( p < ( ( pow2 = Math.pow( 2, --bounce ) ) - 1 ) / 11 ) {}
+		return 1 / Math.pow( 4, 3 - bounce ) - 7.5625 * Math.pow( ( pow2 * 3 - 2 ) / 22 - p, 2 );
 	}
 } );

-$.ui.plugin.add( "resizable", "ghost", {
+$.each( baseEasings, function( name, easeIn ) {
+	$.easing[ "easeIn" + name ] = easeIn;
+	$.easing[ "easeOut" + name ] = function( p ) {
+		return 1 - easeIn( 1 - p );
+	};
+	$.easing[ "easeInOut" + name ] = function( p ) {
+		return p < 0.5 ?
+			easeIn( p * 2 ) / 2 :
+			1 - easeIn( p * -2 + 2 ) / 2;
+	};
+} );

-	start: function() {
+} )();

-		var that = $( this ).resizable( "instance" ), cs = that.size;
+var effect = $.effects;

-		that.ghost = that.originalElement.clone();
-		that.ghost.css( {
-			opacity: 0.25,
-			display: "block",
-			position: "relative",
-			height: cs.height,
-			width: cs.width,
-			margin: 0,
-			left: 0,
-			top: 0
-		} );

-		that._addClass( that.ghost, "ui-resizable-ghost" );
+/*!
+ * jQuery UI Effects Blind 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		// DEPRECATED
-		// TODO: remove after 1.12
-		if ( $.uiBackCompat !== false && typeof that.options.ghost === "string" ) {
+//>>label: Blind Effect
+//>>group: Effects
+//>>description: Blinds the element.
+//>>docs: http://api.jqueryui.com/blind-effect/
+//>>demos: http://jqueryui.com/effect/

-			// Ghost option
-			that.ghost.addClass( this.options.ghost );
-		}

-		that.ghost.appendTo( that.helper );
+var effectsEffectBlind = $.effects.define( "blind", "hide", function( options, done ) {
+	var map = {
+			up: [ "bottom", "top" ],
+			vertical: [ "bottom", "top" ],
+			down: [ "top", "bottom" ],
+			left: [ "right", "left" ],
+			horizontal: [ "right", "left" ],
+			right: [ "left", "right" ]
+		},
+		element = $( this ),
+		direction = options.direction || "up",
+		start = element.cssClip(),
+		animate = { clip: $.extend( {}, start ) },
+		placeholder = $.effects.createPlaceholder( element );

-	},
+	animate.clip[ map[ direction ][ 0 ] ] = animate.clip[ map[ direction ][ 1 ] ];

-	resize: function() {
-		var that = $( this ).resizable( "instance" );
-		if ( that.ghost ) {
-			that.ghost.css( {
-				position: "relative",
-				height: that.size.height,
-				width: that.size.width
-			} );
+	if ( options.mode === "show" ) {
+		element.cssClip( animate.clip );
+		if ( placeholder ) {
+			placeholder.css( $.effects.clipToBox( animate ) );
 		}
-	},

-	stop: function() {
-		var that = $( this ).resizable( "instance" );
-		if ( that.ghost && that.helper ) {
-			that.helper.get( 0 ).removeChild( that.ghost.get( 0 ) );
-		}
+		animate.clip = start;
 	}

-} );
-
-$.ui.plugin.add( "resizable", "grid", {
-
-	resize: function() {
-		var outerDimensions,
-			that = $( this ).resizable( "instance" ),
-			o = that.options,
-			cs = that.size,
-			os = that.originalSize,
-			op = that.originalPosition,
-			a = that.axis,
-			grid = typeof o.grid === "number" ? [ o.grid, o.grid ] : o.grid,
-			gridX = ( grid[ 0 ] || 1 ),
-			gridY = ( grid[ 1 ] || 1 ),
-			ox = Math.round( ( cs.width - os.width ) / gridX ) * gridX,
-			oy = Math.round( ( cs.height - os.height ) / gridY ) * gridY,
-			newWidth = os.width + ox,
-			newHeight = os.height + oy,
-			isMaxWidth = o.maxWidth && ( o.maxWidth < newWidth ),
-			isMaxHeight = o.maxHeight && ( o.maxHeight < newHeight ),
-			isMinWidth = o.minWidth && ( o.minWidth > newWidth ),
-			isMinHeight = o.minHeight && ( o.minHeight > newHeight );
-
-		o.grid = grid;
-
-		if ( isMinWidth ) {
-			newWidth += gridX;
-		}
-		if ( isMinHeight ) {
-			newHeight += gridY;
-		}
-		if ( isMaxWidth ) {
-			newWidth -= gridX;
-		}
-		if ( isMaxHeight ) {
-			newHeight -= gridY;
-		}
-
-		if ( /^(se|s|e)$/.test( a ) ) {
-			that.size.width = newWidth;
-			that.size.height = newHeight;
-		} else if ( /^(ne)$/.test( a ) ) {
-			that.size.width = newWidth;
-			that.size.height = newHeight;
-			that.position.top = op.top - oy;
-		} else if ( /^(sw)$/.test( a ) ) {
-			that.size.width = newWidth;
-			that.size.height = newHeight;
-			that.position.left = op.left - ox;
-		} else {
-			if ( newHeight - gridY <= 0 || newWidth - gridX <= 0 ) {
-				outerDimensions = that._getPaddingPlusBorderDimensions( this );
-			}
-
-			if ( newHeight - gridY > 0 ) {
-				that.size.height = newHeight;
-				that.position.top = op.top - oy;
-			} else {
-				newHeight = gridY - outerDimensions.height;
-				that.size.height = newHeight;
-				that.position.top = op.top + os.height - newHeight;
-			}
-			if ( newWidth - gridX > 0 ) {
-				that.size.width = newWidth;
-				that.position.left = op.left - ox;
-			} else {
-				newWidth = gridX - outerDimensions.width;
-				that.size.width = newWidth;
-				that.position.left = op.left + os.width - newWidth;
-			}
-		}
+	if ( placeholder ) {
+		placeholder.animate( $.effects.clipToBox( animate ), options.duration, options.easing );
 	}

+	element.animate( animate, {
+		queue: false,
+		duration: options.duration,
+		easing: options.easing,
+		complete: done
+	} );
 } );

-var widgetsResizable = $.ui.resizable;
-

 /*!
- * jQuery UI Selectable 1.13.1
+ * jQuery UI Effects Bounce 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -4952,297 +3062,198 @@
  * http://jquery.org/license
  */

-//>>label: Selectable
-//>>group: Interactions
-//>>description: Allows groups of elements to be selected with the mouse.
-//>>docs: http://api.jqueryui.com/selectable/
-//>>demos: http://jqueryui.com/selectable/
-//>>css.structure: ../../themes/base/selectable.css
-
-
-var widgetsSelectable = $.widget( "ui.selectable", $.ui.mouse, {
-	version: "1.13.1",
-	options: {
-		appendTo: "body",
-		autoRefresh: true,
-		distance: 0,
-		filter: "*",
-		tolerance: "touch",
-
-		// Callbacks
-		selected: null,
-		selecting: null,
-		start: null,
-		stop: null,
-		unselected: null,
-		unselecting: null
-	},
-	_create: function() {
-		var that = this;
+//>>label: Bounce Effect
+//>>group: Effects
+//>>description: Bounces an element horizontally or vertically n times.
+//>>docs: http://api.jqueryui.com/bounce-effect/
+//>>demos: http://jqueryui.com/effect/

-		this._addClass( "ui-selectable" );

-		this.dragged = false;
+var effectsEffectBounce = $.effects.define( "bounce", function( options, done ) {
+	var upAnim, downAnim, refValue,
+		element = $( this ),

-		// Cache selectee children based on filter
-		this.refresh = function() {
-			that.elementPos = $( that.element[ 0 ] ).offset();
-			that.selectees = $( that.options.filter, that.element[ 0 ] );
-			that._addClass( that.selectees, "ui-selectee" );
-			that.selectees.each( function() {
-				var $this = $( this ),
-					selecteeOffset = $this.offset(),
-					pos = {
-						left: selecteeOffset.left - that.elementPos.left,
-						top: selecteeOffset.top - that.elementPos.top
-					};
-				$.data( this, "selectable-item", {
-					element: this,
-					$element: $this,
-					left: pos.left,
-					top: pos.top,
-					right: pos.left + $this.outerWidth(),
-					bottom: pos.top + $this.outerHeight(),
-					startselected: false,
-					selected: $this.hasClass( "ui-selected" ),
-					selecting: $this.hasClass( "ui-selecting" ),
-					unselecting: $this.hasClass( "ui-unselecting" )
-				} );
-			} );
-		};
-		this.refresh();
+		// Defaults:
+		mode = options.mode,
+		hide = mode === "hide",
+		show = mode === "show",
+		direction = options.direction || "up",
+		distance = options.distance,
+		times = options.times || 5,

-		this._mouseInit();
+		// Number of internal animations
+		anims = times * 2 + ( show || hide ? 1 : 0 ),
+		speed = options.duration / anims,
+		easing = options.easing,

-		this.helper = $( "<div>" );
-		this._addClass( this.helper, "ui-selectable-helper" );
-	},
+		// Utility:
+		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
+		motion = ( direction === "up" || direction === "left" ),
+		i = 0,

-	_destroy: function() {
-		this.selectees.removeData( "selectable-item" );
-		this._mouseDestroy();
-	},
+		queuelen = element.queue().length;

-	_mouseStart: function( event ) {
-		var that = this,
-			options = this.options;
+	$.effects.createPlaceholder( element );

-		this.opos = [ event.pageX, event.pageY ];
-		this.elementPos = $( this.element[ 0 ] ).offset();
+	refValue = element.css( ref );

-		if ( this.options.disabled ) {
-			return;
-		}
+	// Default distance for the BIGGEST bounce is the outer Distance / 3
+	if ( !distance ) {
+		distance = element[ ref === "top" ? "outerHeight" : "outerWidth" ]() / 3;
+	}

-		this.selectees = $( options.filter, this.element[ 0 ] );
+	if ( show ) {
+		downAnim = { opacity: 1 };
+		downAnim[ ref ] = refValue;

-		this._trigger( "start", event );
+		// If we are showing, force opacity 0 and set the initial position
+		// then do the "first" animation
+		element
+			.css( "opacity", 0 )
+			.css( ref, motion ? -distance * 2 : distance * 2 )
+			.animate( downAnim, speed, easing );
+	}

-		$( options.appendTo ).append( this.helper );
+	// Start at the smallest distance if we are hiding
+	if ( hide ) {
+		distance = distance / Math.pow( 2, times - 1 );
+	}

-		// position helper (lasso)
-		this.helper.css( {
-			"left": event.pageX,
-			"top": event.pageY,
-			"width": 0,
-			"height": 0
-		} );
+	downAnim = {};
+	downAnim[ ref ] = refValue;

-		if ( options.autoRefresh ) {
-			this.refresh();
-		}
+	// Bounces up/down/left/right then back to 0 -- times * 2 animations happen here
+	for ( ; i < times; i++ ) {
+		upAnim = {};
+		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;

-		this.selectees.filter( ".ui-selected" ).each( function() {
-			var selectee = $.data( this, "selectable-item" );
-			selectee.startselected = true;
-			if ( !event.metaKey && !event.ctrlKey ) {
-				that._removeClass( selectee.$element, "ui-selected" );
-				selectee.selected = false;
-				that._addClass( selectee.$element, "ui-unselecting" );
-				selectee.unselecting = true;
+		element
+			.animate( upAnim, speed, easing )
+			.animate( downAnim, speed, easing );

-				// selectable UNSELECTING callback
-				that._trigger( "unselecting", event, {
-					unselecting: selectee.element
-				} );
-			}
-		} );
+		distance = hide ? distance * 2 : distance / 2;
+	}

-		$( event.target ).parents().addBack().each( function() {
-			var doSelect,
-				selectee = $.data( this, "selectable-item" );
-			if ( selectee ) {
-				doSelect = ( !event.metaKey && !event.ctrlKey ) ||
-					!selectee.$element.hasClass( "ui-selected" );
-				that._removeClass( selectee.$element, doSelect ? "ui-unselecting" : "ui-selected" )
-					._addClass( selectee.$element, doSelect ? "ui-selecting" : "ui-unselecting" );
-				selectee.unselecting = !doSelect;
-				selectee.selecting = doSelect;
-				selectee.selected = doSelect;
+	// Last Bounce when Hiding
+	if ( hide ) {
+		upAnim = { opacity: 0 };
+		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;

-				// selectable (UN)SELECTING callback
-				if ( doSelect ) {
-					that._trigger( "selecting", event, {
-						selecting: selectee.element
-					} );
-				} else {
-					that._trigger( "unselecting", event, {
-						unselecting: selectee.element
-					} );
-				}
-				return false;
-			}
-		} );
+		element.animate( upAnim, speed, easing );
+	}

-	},
+	element.queue( done );

-	_mouseDrag: function( event ) {
+	$.effects.unshift( element, queuelen, anims + 1 );
+} );

-		this.dragged = true;

-		if ( this.options.disabled ) {
-			return;
-		}
+/*!
+ * jQuery UI Effects Clip 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		var tmp,
-			that = this,
-			options = this.options,
-			x1 = this.opos[ 0 ],
-			y1 = this.opos[ 1 ],
-			x2 = event.pageX,
-			y2 = event.pageY;
+//>>label: Clip Effect
+//>>group: Effects
+//>>description: Clips the element on and off like an old TV.
+//>>docs: http://api.jqueryui.com/clip-effect/
+//>>demos: http://jqueryui.com/effect/

-		if ( x1 > x2 ) {
-			tmp = x2; x2 = x1; x1 = tmp;
-		}
-		if ( y1 > y2 ) {
-			tmp = y2; y2 = y1; y1 = tmp;
-		}
-		this.helper.css( { left: x1, top: y1, width: x2 - x1, height: y2 - y1 } );

-		this.selectees.each( function() {
-			var selectee = $.data( this, "selectable-item" ),
-				hit = false,
-				offset = {};
+var effectsEffectClip = $.effects.define( "clip", "hide", function( options, done ) {
+	var start,
+		animate = {},
+		element = $( this ),
+		direction = options.direction || "vertical",
+		both = direction === "both",
+		horizontal = both || direction === "horizontal",
+		vertical = both || direction === "vertical";

-			//prevent helper from being selected if appendTo: selectable
-			if ( !selectee || selectee.element === that.element[ 0 ] ) {
-				return;
-			}
+	start = element.cssClip();
+	animate.clip = {
+		top: vertical ? ( start.bottom - start.top ) / 2 : start.top,
+		right: horizontal ? ( start.right - start.left ) / 2 : start.right,
+		bottom: vertical ? ( start.bottom - start.top ) / 2 : start.bottom,
+		left: horizontal ? ( start.right - start.left ) / 2 : start.left
+	};

-			offset.left   = selectee.left   + that.elementPos.left;
-			offset.right  = selectee.right  + that.elementPos.left;
-			offset.top    = selectee.top    + that.elementPos.top;
-			offset.bottom = selectee.bottom + that.elementPos.top;
+	$.effects.createPlaceholder( element );

-			if ( options.tolerance === "touch" ) {
-				hit = ( !( offset.left > x2 || offset.right < x1 || offset.top > y2 ||
-                    offset.bottom < y1 ) );
-			} else if ( options.tolerance === "fit" ) {
-				hit = ( offset.left > x1 && offset.right < x2 && offset.top > y1 &&
-                    offset.bottom < y2 );
-			}
+	if ( options.mode === "show" ) {
+		element.cssClip( animate.clip );
+		animate.clip = start;
+	}

-			if ( hit ) {
+	element.animate( animate, {
+		queue: false,
+		duration: options.duration,
+		easing: options.easing,
+		complete: done
+	} );

-				// SELECT
-				if ( selectee.selected ) {
-					that._removeClass( selectee.$element, "ui-selected" );
-					selectee.selected = false;
-				}
-				if ( selectee.unselecting ) {
-					that._removeClass( selectee.$element, "ui-unselecting" );
-					selectee.unselecting = false;
-				}
-				if ( !selectee.selecting ) {
-					that._addClass( selectee.$element, "ui-selecting" );
-					selectee.selecting = true;
+} );

-					// selectable SELECTING callback
-					that._trigger( "selecting", event, {
-						selecting: selectee.element
-					} );
-				}
-			} else {

-				// UNSELECT
-				if ( selectee.selecting ) {
-					if ( ( event.metaKey || event.ctrlKey ) && selectee.startselected ) {
-						that._removeClass( selectee.$element, "ui-selecting" );
-						selectee.selecting = false;
-						that._addClass( selectee.$element, "ui-selected" );
-						selectee.selected = true;
-					} else {
-						that._removeClass( selectee.$element, "ui-selecting" );
-						selectee.selecting = false;
-						if ( selectee.startselected ) {
-							that._addClass( selectee.$element, "ui-unselecting" );
-							selectee.unselecting = true;
-						}
+/*!
+ * jQuery UI Effects Drop 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-						// selectable UNSELECTING callback
-						that._trigger( "unselecting", event, {
-							unselecting: selectee.element
-						} );
-					}
-				}
-				if ( selectee.selected ) {
-					if ( !event.metaKey && !event.ctrlKey && !selectee.startselected ) {
-						that._removeClass( selectee.$element, "ui-selected" );
-						selectee.selected = false;
+//>>label: Drop Effect
+//>>group: Effects
+//>>description: Moves an element in one direction and hides it at the same time.
+//>>docs: http://api.jqueryui.com/drop-effect/
+//>>demos: http://jqueryui.com/effect/

-						that._addClass( selectee.$element, "ui-unselecting" );
-						selectee.unselecting = true;

-						// selectable UNSELECTING callback
-						that._trigger( "unselecting", event, {
-							unselecting: selectee.element
-						} );
-					}
-				}
-			}
-		} );
+var effectsEffectDrop = $.effects.define( "drop", "hide", function( options, done ) {

-		return false;
-	},
+	var distance,
+		element = $( this ),
+		mode = options.mode,
+		show = mode === "show",
+		direction = options.direction || "left",
+		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
+		motion = ( direction === "up" || direction === "left" ) ? "-=" : "+=",
+		oppositeMotion = ( motion === "+=" ) ? "-=" : "+=",
+		animation = {
+			opacity: 0
+		};

-	_mouseStop: function( event ) {
-		var that = this;
+	$.effects.createPlaceholder( element );

-		this.dragged = false;
+	distance = options.distance ||
+		element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ) / 2;

-		$( ".ui-unselecting", this.element[ 0 ] ).each( function() {
-			var selectee = $.data( this, "selectable-item" );
-			that._removeClass( selectee.$element, "ui-unselecting" );
-			selectee.unselecting = false;
-			selectee.startselected = false;
-			that._trigger( "unselected", event, {
-				unselected: selectee.element
-			} );
-		} );
-		$( ".ui-selecting", this.element[ 0 ] ).each( function() {
-			var selectee = $.data( this, "selectable-item" );
-			that._removeClass( selectee.$element, "ui-selecting" )
-				._addClass( selectee.$element, "ui-selected" );
-			selectee.selecting = false;
-			selectee.selected = true;
-			selectee.startselected = true;
-			that._trigger( "selected", event, {
-				selected: selectee.element
-			} );
-		} );
-		this._trigger( "stop", event );
+	animation[ ref ] = motion + distance;

-		this.helper.remove();
+	if ( show ) {
+		element.css( animation );

-		return false;
+		animation[ ref ] = oppositeMotion + distance;
+		animation.opacity = 1;
 	}

+	// Animate
+	element.animate( animation, {
+		queue: false,
+		duration: options.duration,
+		easing: options.easing,
+		complete: done
+	} );
 } );


 /*!
- * jQuery UI Sortable 1.13.1
+ * jQuery UI Effects Explode 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -5250,1592 +3261,1086 @@
  * http://jquery.org/license
  */

-//>>label: Sortable
-//>>group: Interactions
-//>>description: Enables items in a list to be sorted using the mouse.
-//>>docs: http://api.jqueryui.com/sortable/
-//>>demos: http://jqueryui.com/sortable/
-//>>css.structure: ../../themes/base/sortable.css
-
-
-var widgetsSortable = $.widget( "ui.sortable", $.ui.mouse, {
-	version: "1.13.1",
-	widgetEventPrefix: "sort",
-	ready: false,
-	options: {
-		appendTo: "parent",
-		axis: false,
-		connectWith: false,
-		containment: false,
-		cursor: "auto",
-		cursorAt: false,
-		dropOnEmpty: true,
-		forcePlaceholderSize: false,
-		forceHelperSize: false,
-		grid: false,
-		handle: false,
-		helper: "original",
-		items: "> *",
-		opacity: false,
-		placeholder: false,
-		revert: false,
-		scroll: true,
-		scrollSensitivity: 20,
-		scrollSpeed: 20,
-		scope: "default",
-		tolerance: "intersect",
-		zIndex: 1000,
-
-		// Callbacks
-		activate: null,
-		beforeStop: null,
-		change: null,
-		deactivate: null,
-		out: null,
-		over: null,
-		receive: null,
-		remove: null,
-		sort: null,
-		start: null,
-		stop: null,
-		update: null
-	},
-
-	_isOverAxis: function( x, reference, size ) {
-		return ( x >= reference ) && ( x < ( reference + size ) );
-	},
-
-	_isFloating: function( item ) {
-		return ( /left|right/ ).test( item.css( "float" ) ) ||
-			( /inline|table-cell/ ).test( item.css( "display" ) );
-	},
-
-	_create: function() {
-		this.containerCache = {};
-		this._addClass( "ui-sortable" );
-
-		//Get the items
-		this.refresh();
-
-		//Let's determine the parent's offset
-		this.offset = this.element.offset();
-
-		//Initialize mouse events for interaction
-		this._mouseInit();
-
-		this._setHandleClassName();
-
-		//We're ready to go
-		this.ready = true;
+//>>label: Explode Effect
+//>>group: Effects
+/* eslint-disable max-len */
+//>>description: Explodes an element in all directions into n pieces. Implodes an element to its original wholeness.
+/* eslint-enable max-len */
+//>>docs: http://api.jqueryui.com/explode-effect/
+//>>demos: http://jqueryui.com/effect/

-	},

-	_setOption: function( key, value ) {
-		this._super( key, value );
+var effectsEffectExplode = $.effects.define( "explode", "hide", function( options, done ) {

-		if ( key === "handle" ) {
-			this._setHandleClassName();
-		}
-	},
+	var i, j, left, top, mx, my,
+		rows = options.pieces ? Math.round( Math.sqrt( options.pieces ) ) : 3,
+		cells = rows,
+		element = $( this ),
+		mode = options.mode,
+		show = mode === "show",

-	_setHandleClassName: function() {
-		var that = this;
-		this._removeClass( this.element.find( ".ui-sortable-handle" ), "ui-sortable-handle" );
-		$.each( this.items, function() {
-			that._addClass(
-				this.instance.options.handle ?
-					this.item.find( this.instance.options.handle ) :
-					this.item,
-				"ui-sortable-handle"
-			);
-		} );
-	},
+		// Show and then visibility:hidden the element before calculating offset
+		offset = element.show().css( "visibility", "hidden" ).offset(),

-	_destroy: function() {
-		this._mouseDestroy();
+		// Width and height of a piece
+		width = Math.ceil( element.outerWidth() / cells ),
+		height = Math.ceil( element.outerHeight() / rows ),
+		pieces = [];

-		for ( var i = this.items.length - 1; i >= 0; i-- ) {
-			this.items[ i ].item.removeData( this.widgetName + "-item" );
+	// Children animate complete:
+	function childComplete() {
+		pieces.push( this );
+		if ( pieces.length === rows * cells ) {
+			animComplete();
 		}
+	}

-		return this;
-	},
+	// Clone the element for each row and cell.
+	for ( i = 0; i < rows; i++ ) { // ===>
+		top = offset.top + i * height;
+		my = i - ( rows - 1 ) / 2;

-	_mouseCapture: function( event, overrideHandle ) {
-		var currentItem = null,
-			validHandle = false,
-			that = this;
+		for ( j = 0; j < cells; j++ ) { // |||
+			left = offset.left + j * width;
+			mx = j - ( cells - 1 ) / 2;

-		if ( this.reverting ) {
-			return false;
-		}
+			// Create a clone of the now hidden main element that will be absolute positioned
+			// within a wrapper div off the -left and -top equal to size of our pieces
+			element
+				.clone()
+				.appendTo( "body" )
+				.wrap( "<div></div>" )
+				.css( {
+					position: "absolute",
+					visibility: "visible",
+					left: -j * width,
+					top: -i * height
+				} )

-		if ( this.options.disabled || this.options.type === "static" ) {
-			return false;
+				// Select the wrapper - make it overflow: hidden and absolute positioned based on
+				// where the original was located +left and +top equal to the size of pieces
+				.parent()
+					.addClass( "ui-effects-explode" )
+					.css( {
+						position: "absolute",
+						overflow: "hidden",
+						width: width,
+						height: height,
+						left: left + ( show ? mx * width : 0 ),
+						top: top + ( show ? my * height : 0 ),
+						opacity: show ? 0 : 1
+					} )
+					.animate( {
+						left: left + ( show ? 0 : mx * width ),
+						top: top + ( show ? 0 : my * height ),
+						opacity: show ? 1 : 0
+					}, options.duration || 500, options.easing, childComplete );
 		}
+	}

-		//We have to refresh the items data once first
-		this._refreshItems( event );
-
-		//Find out if the clicked node (or one of its parents) is a actual item in this.items
-		$( event.target ).parents().each( function() {
-			if ( $.data( this, that.widgetName + "-item" ) === that ) {
-				currentItem = $( this );
-				return false;
-			}
+	function animComplete() {
+		element.css( {
+			visibility: "visible"
 		} );
-		if ( $.data( event.target, that.widgetName + "-item" ) === that ) {
-			currentItem = $( event.target );
-		}
-
-		if ( !currentItem ) {
-			return false;
-		}
-		if ( this.options.handle && !overrideHandle ) {
-			$( this.options.handle, currentItem ).find( "*" ).addBack().each( function() {
-				if ( this === event.target ) {
-					validHandle = true;
-				}
-			} );
-			if ( !validHandle ) {
-				return false;
-			}
-		}
-
-		this.currentItem = currentItem;
-		this._removeCurrentsFromItems();
-		return true;
-
-	},
-
-	_mouseStart: function( event, overrideHandle, noActivation ) {
-
-		var i, body,
-			o = this.options;
-
-		this.currentContainer = this;
-
-		//We only need to call refreshPositions, because the refreshItems call has been moved to
-		// mouseCapture
-		this.refreshPositions();
-
-		//Prepare the dragged items parent
-		this.appendTo = $( o.appendTo !== "parent" ?
-				o.appendTo :
-				this.currentItem.parent() );
-
-		//Create and append the visible helper
-		this.helper = this._createHelper( event );
+		$( pieces ).remove();
+		done();
+	}
+} );

-		//Cache the helper size
-		this._cacheHelperProportions();

-		/*
-		 * - Position generation -
-		 * This block generates everything position related - it's the core of draggables.
-		 */
+/*!
+ * jQuery UI Effects Fade 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		//Cache the margins of the original element
-		this._cacheMargins();
+//>>label: Fade Effect
+//>>group: Effects
+//>>description: Fades the element.
+//>>docs: http://api.jqueryui.com/fade-effect/
+//>>demos: http://jqueryui.com/effect/

-		//The element's absolute position on the page minus margins
-		this.offset = this.currentItem.offset();
-		this.offset = {
-			top: this.offset.top - this.margins.top,
-			left: this.offset.left - this.margins.left
-		};

-		$.extend( this.offset, {
-			click: { //Where the click happened, relative to the element
-				left: event.pageX - this.offset.left,
-				top: event.pageY - this.offset.top
-			},
+var effectsEffectFade = $.effects.define( "fade", "toggle", function( options, done ) {
+	var show = options.mode === "show";

-			// This is a relative to absolute position minus the actual position calculation -
-			// only used for relative positioned helper
-			relative: this._getRelativeOffset()
+	$( this )
+		.css( "opacity", show ? 0 : 1 )
+		.animate( {
+			opacity: show ? 1 : 0
+		}, {
+			queue: false,
+			duration: options.duration,
+			easing: options.easing,
+			complete: done
 		} );
+} );

-		// After we get the helper offset, but before we get the parent offset we can
-		// change the helper's position to absolute
-		// TODO: Still need to figure out a way to make relative sorting possible
-		this.helper.css( "position", "absolute" );
-		this.cssPosition = this.helper.css( "position" );
-
-		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
-		if ( o.cursorAt ) {
-			this._adjustOffsetFromHelper( o.cursorAt );
-		}
-
-		//Cache the former DOM position
-		this.domPosition = {
-			prev: this.currentItem.prev()[ 0 ],
-			parent: this.currentItem.parent()[ 0 ]
-		};

-		// If the helper is not the original, hide the original so it's not playing any role during
-		// the drag, won't cause anything bad this way
-		if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
-			this.currentItem.hide();
-		}
+/*!
+ * jQuery UI Effects Fold 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		//Create the placeholder
-		this._createPlaceholder();
+//>>label: Fold Effect
+//>>group: Effects
+//>>description: Folds an element first horizontally and then vertically.
+//>>docs: http://api.jqueryui.com/fold-effect/
+//>>demos: http://jqueryui.com/effect/

-		//Get the next scrolling parent
-		this.scrollParent = this.placeholder.scrollParent();

-		$.extend( this.offset, {
-			parent: this._getParentOffset()
-		} );
+var effectsEffectFold = $.effects.define( "fold", "hide", function( options, done ) {

-		//Set a containment if given in the options
-		if ( o.containment ) {
-			this._setContainment();
-		}
+	// Create element
+	var element = $( this ),
+		mode = options.mode,
+		show = mode === "show",
+		hide = mode === "hide",
+		size = options.size || 15,
+		percent = /([0-9]+)%/.exec( size ),
+		horizFirst = !!options.horizFirst,
+		ref = horizFirst ? [ "right", "bottom" ] : [ "bottom", "right" ],
+		duration = options.duration / 2,

-		if ( o.cursor && o.cursor !== "auto" ) { // cursor option
-			body = this.document.find( "body" );
+		placeholder = $.effects.createPlaceholder( element ),

-			// Support: IE
-			this.storedCursor = body.css( "cursor" );
-			body.css( "cursor", o.cursor );
+		start = element.cssClip(),
+		animation1 = { clip: $.extend( {}, start ) },
+		animation2 = { clip: $.extend( {}, start ) },

-			this.storedStylesheet =
-				$( "<style>*{ cursor: " + o.cursor + " !important; }</style>" ).appendTo( body );
-		}
+		distance = [ start[ ref[ 0 ] ], start[ ref[ 1 ] ] ],

-		// We need to make sure to grab the zIndex before setting the
-		// opacity, because setting the opacity to anything lower than 1
-		// causes the zIndex to change from "auto" to 0.
-		if ( o.zIndex ) { // zIndex option
-			if ( this.helper.css( "zIndex" ) ) {
-				this._storedZIndex = this.helper.css( "zIndex" );
-			}
-			this.helper.css( "zIndex", o.zIndex );
-		}
+		queuelen = element.queue().length;

-		if ( o.opacity ) { // opacity option
-			if ( this.helper.css( "opacity" ) ) {
-				this._storedOpacity = this.helper.css( "opacity" );
-			}
-			this.helper.css( "opacity", o.opacity );
-		}
+	if ( percent ) {
+		size = parseInt( percent[ 1 ], 10 ) / 100 * distance[ hide ? 0 : 1 ];
+	}
+	animation1.clip[ ref[ 0 ] ] = size;
+	animation2.clip[ ref[ 0 ] ] = size;
+	animation2.clip[ ref[ 1 ] ] = 0;

-		//Prepare scrolling
-		if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				this.scrollParent[ 0 ].tagName !== "HTML" ) {
-			this.overflowOffset = this.scrollParent.offset();
+	if ( show ) {
+		element.cssClip( animation2.clip );
+		if ( placeholder ) {
+			placeholder.css( $.effects.clipToBox( animation2 ) );
 		}

-		//Call callbacks
-		this._trigger( "start", event, this._uiHash() );
-
-		//Recache the helper size
-		if ( !this._preserveHelperProportions ) {
-			this._cacheHelperProportions();
-		}
+		animation2.clip = start;
+	}

-		//Post "activate" events to possible containers
-		if ( !noActivation ) {
-			for ( i = this.containers.length - 1; i >= 0; i-- ) {
-				this.containers[ i ]._trigger( "activate", event, this._uiHash( this ) );
+	// Animate
+	element
+		.queue( function( next ) {
+			if ( placeholder ) {
+				placeholder
+					.animate( $.effects.clipToBox( animation1 ), duration, options.easing )
+					.animate( $.effects.clipToBox( animation2 ), duration, options.easing );
 			}
-		}

-		//Prepare possible droppables
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.current = this;
-		}
-
-		if ( $.ui.ddmanager && !o.dropBehaviour ) {
-			$.ui.ddmanager.prepareOffsets( this, event );
-		}
+			next();
+		} )
+		.animate( animation1, duration, options.easing )
+		.animate( animation2, duration, options.easing )
+		.queue( done );

-		this.dragging = true;
+	$.effects.unshift( element, queuelen, 4 );
+} );

-		this._addClass( this.helper, "ui-sortable-helper" );

-		//Move the helper, if needed
-		if ( !this.helper.parent().is( this.appendTo ) ) {
-			this.helper.detach().appendTo( this.appendTo );
+/*!
+ * jQuery UI Effects Highlight 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-			//Update position
-			this.offset.parent = this._getParentOffset();
-		}
+//>>label: Highlight Effect
+//>>group: Effects
+//>>description: Highlights the background of an element in a defined color for a custom duration.
+//>>docs: http://api.jqueryui.com/highlight-effect/
+//>>demos: http://jqueryui.com/effect/

-		//Generate the original position
-		this.position = this.originalPosition = this._generatePosition( event );
-		this.originalPageX = event.pageX;
-		this.originalPageY = event.pageY;
-		this.lastPositionAbs = this.positionAbs = this._convertPositionTo( "absolute" );

-		this._mouseDrag( event );
+var effectsEffectHighlight = $.effects.define( "highlight", "show", function( options, done ) {
+	var element = $( this ),
+		animation = {
+			backgroundColor: element.css( "backgroundColor" )
+		};

-		return true;
+	if ( options.mode === "hide" ) {
+		animation.opacity = 0;
+	}

-	},
+	$.effects.saveStyle( element );

-	_scroll: function( event ) {
-		var o = this.options,
-			scrolled = false;
+	element
+		.css( {
+			backgroundImage: "none",
+			backgroundColor: options.color || "#ffff99"
+		} )
+		.animate( animation, {
+			queue: false,
+			duration: options.duration,
+			easing: options.easing,
+			complete: done
+		} );
+} );

-		if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				this.scrollParent[ 0 ].tagName !== "HTML" ) {

-			if ( ( this.overflowOffset.top + this.scrollParent[ 0 ].offsetHeight ) -
-					event.pageY < o.scrollSensitivity ) {
-				this.scrollParent[ 0 ].scrollTop =
-					scrolled = this.scrollParent[ 0 ].scrollTop + o.scrollSpeed;
-			} else if ( event.pageY - this.overflowOffset.top < o.scrollSensitivity ) {
-				this.scrollParent[ 0 ].scrollTop =
-					scrolled = this.scrollParent[ 0 ].scrollTop - o.scrollSpeed;
-			}
+/*!
+ * jQuery UI Effects Size 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-			if ( ( this.overflowOffset.left + this.scrollParent[ 0 ].offsetWidth ) -
-					event.pageX < o.scrollSensitivity ) {
-				this.scrollParent[ 0 ].scrollLeft = scrolled =
-					this.scrollParent[ 0 ].scrollLeft + o.scrollSpeed;
-			} else if ( event.pageX - this.overflowOffset.left < o.scrollSensitivity ) {
-				this.scrollParent[ 0 ].scrollLeft = scrolled =
-					this.scrollParent[ 0 ].scrollLeft - o.scrollSpeed;
-			}
+//>>label: Size Effect
+//>>group: Effects
+//>>description: Resize an element to a specified width and height.
+//>>docs: http://api.jqueryui.com/size-effect/
+//>>demos: http://jqueryui.com/effect/

-		} else {

-			if ( event.pageY - this.document.scrollTop() < o.scrollSensitivity ) {
-				scrolled = this.document.scrollTop( this.document.scrollTop() - o.scrollSpeed );
-			} else if ( this.window.height() - ( event.pageY - this.document.scrollTop() ) <
-					o.scrollSensitivity ) {
-				scrolled = this.document.scrollTop( this.document.scrollTop() + o.scrollSpeed );
-			}
+var effectsEffectSize = $.effects.define( "size", function( options, done ) {

-			if ( event.pageX - this.document.scrollLeft() < o.scrollSensitivity ) {
-				scrolled = this.document.scrollLeft(
-					this.document.scrollLeft() - o.scrollSpeed
-				);
-			} else if ( this.window.width() - ( event.pageX - this.document.scrollLeft() ) <
-					o.scrollSensitivity ) {
-				scrolled = this.document.scrollLeft(
-					this.document.scrollLeft() + o.scrollSpeed
-				);
-			}
+	// Create element
+	var baseline, factor, temp,
+		element = $( this ),

-		}
+		// Copy for children
+		cProps = [ "fontSize" ],
+		vProps = [ "borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom" ],
+		hProps = [ "borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight" ],

-		return scrolled;
-	},
+		// Set options
+		mode = options.mode,
+		restore = mode !== "effect",
+		scale = options.scale || "both",
+		origin = options.origin || [ "middle", "center" ],
+		position = element.css( "position" ),
+		pos = element.position(),
+		original = $.effects.scaledDimensions( element ),
+		from = options.from || original,
+		to = options.to || $.effects.scaledDimensions( element, 0 );

-	_mouseDrag: function( event ) {
-		var i, item, itemElement, intersection,
-			o = this.options;
+	$.effects.createPlaceholder( element );

-		//Compute the helpers position
-		this.position = this._generatePosition( event );
-		this.positionAbs = this._convertPositionTo( "absolute" );
+	if ( mode === "show" ) {
+		temp = from;
+		from = to;
+		to = temp;
+	}

-		//Set the helper position
-		if ( !this.options.axis || this.options.axis !== "y" ) {
-			this.helper[ 0 ].style.left = this.position.left + "px";
-		}
-		if ( !this.options.axis || this.options.axis !== "x" ) {
-			this.helper[ 0 ].style.top = this.position.top + "px";
+	// Set scaling factor
+	factor = {
+		from: {
+			y: from.height / original.height,
+			x: from.width / original.width
+		},
+		to: {
+			y: to.height / original.height,
+			x: to.width / original.width
 		}
+	};

-		//Do scrolling
-		if ( o.scroll ) {
-			if ( this._scroll( event ) !== false ) {
-
-				//Update item positions used in position checks
-				this._refreshItemPositions( true );
+	// Scale the css box
+	if ( scale === "box" || scale === "both" ) {

-				if ( $.ui.ddmanager && !o.dropBehaviour ) {
-					$.ui.ddmanager.prepareOffsets( this, event );
-				}
-			}
+		// Vertical props scaling
+		if ( factor.from.y !== factor.to.y ) {
+			from = $.effects.setTransition( element, vProps, factor.from.y, from );
+			to = $.effects.setTransition( element, vProps, factor.to.y, to );
 		}

-		this.dragDirection = {
-			vertical: this._getDragVerticalDirection(),
-			horizontal: this._getDragHorizontalDirection()
-		};
-
-		//Rearrange
-		for ( i = this.items.length - 1; i >= 0; i-- ) {
-
-			//Cache variables and intersection, continue if no intersection
-			item = this.items[ i ];
-			itemElement = item.item[ 0 ];
-			intersection = this._intersectsWithPointer( item );
-			if ( !intersection ) {
-				continue;
-			}
-
-			// Only put the placeholder inside the current Container, skip all
-			// items from other containers. This works because when moving
-			// an item from one container to another the
-			// currentContainer is switched before the placeholder is moved.
-			//
-			// Without this, moving items in "sub-sortables" can cause
-			// the placeholder to jitter between the outer and inner container.
-			if ( item.instance !== this.currentContainer ) {
-				continue;
-			}
-
-			// Cannot intersect with itself
-			// no useless actions that have been done before
-			// no action if the item moved is the parent of the item checked
-			if ( itemElement !== this.currentItem[ 0 ] &&
-				this.placeholder[ intersection === 1 ?
-				"next" : "prev" ]()[ 0 ] !== itemElement &&
-				!$.contains( this.placeholder[ 0 ], itemElement ) &&
-				( this.options.type === "semi-dynamic" ?
-					!$.contains( this.element[ 0 ], itemElement ) :
-					true
-				)
-			) {
-
-				this.direction = intersection === 1 ? "down" : "up";
-
-				if ( this.options.tolerance === "pointer" ||
-						this._intersectsWithSides( item ) ) {
-					this._rearrange( event, item );
-				} else {
-					break;
-				}
-
-				this._trigger( "change", event, this._uiHash() );
-				break;
-			}
+		// Horizontal props scaling
+		if ( factor.from.x !== factor.to.x ) {
+			from = $.effects.setTransition( element, hProps, factor.from.x, from );
+			to = $.effects.setTransition( element, hProps, factor.to.x, to );
 		}
+	}

-		//Post events to containers
-		this._contactContainers( event );
+	// Scale the content
+	if ( scale === "content" || scale === "both" ) {

-		//Interconnect with droppables
-		if ( $.ui.ddmanager ) {
-			$.ui.ddmanager.drag( this, event );
+		// Vertical props scaling
+		if ( factor.from.y !== factor.to.y ) {
+			from = $.effects.setTransition( element, cProps, factor.from.y, from );
+			to = $.effects.setTransition( element, cProps, factor.to.y, to );
 		}
+	}

-		//Call callbacks
-		this._trigger( "sort", event, this._uiHash() );
-
-		this.lastPositionAbs = this.positionAbs;
-		return false;
-
-	},
-
-	_mouseStop: function( event, noPropagation ) {
+	// Adjust the position properties based on the provided origin points
+	if ( origin ) {
+		baseline = $.effects.getBaseline( origin, original );
+		from.top = ( original.outerHeight - from.outerHeight ) * baseline.y + pos.top;
+		from.left = ( original.outerWidth - from.outerWidth ) * baseline.x + pos.left;
+		to.top = ( original.outerHeight - to.outerHeight ) * baseline.y + pos.top;
+		to.left = ( original.outerWidth - to.outerWidth ) * baseline.x + pos.left;
+	}
+	delete from.outerHeight;
+	delete from.outerWidth;
+	element.css( from );

-		if ( !event ) {
-			return;
-		}
+	// Animate the children if desired
+	if ( scale === "content" || scale === "both" ) {

-		//If we are using droppables, inform the manager about the drop
-		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
-			$.ui.ddmanager.drop( this, event );
-		}
+		vProps = vProps.concat( [ "marginTop", "marginBottom" ] ).concat( cProps );
+		hProps = hProps.concat( [ "marginLeft", "marginRight" ] );

-		if ( this.options.revert ) {
-			var that = this,
-				cur = this.placeholder.offset(),
-				axis = this.options.axis,
-				animation = {};
+		// Only animate children with width attributes specified
+		// TODO: is this right? should we include anything with css width specified as well
+		element.find( "*[width]" ).each( function() {
+			var child = $( this ),
+				childOriginal = $.effects.scaledDimensions( child ),
+				childFrom = {
+					height: childOriginal.height * factor.from.y,
+					width: childOriginal.width * factor.from.x,
+					outerHeight: childOriginal.outerHeight * factor.from.y,
+					outerWidth: childOriginal.outerWidth * factor.from.x
+				},
+				childTo = {
+					height: childOriginal.height * factor.to.y,
+					width: childOriginal.width * factor.to.x,
+					outerHeight: childOriginal.height * factor.to.y,
+					outerWidth: childOriginal.width * factor.to.x
+				};

-			if ( !axis || axis === "x" ) {
-				animation.left = cur.left - this.offset.parent.left - this.margins.left +
-					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
-						0 :
-						this.offsetParent[ 0 ].scrollLeft
-					);
-			}
-			if ( !axis || axis === "y" ) {
-				animation.top = cur.top - this.offset.parent.top - this.margins.top +
-					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
-						0 :
-						this.offsetParent[ 0 ].scrollTop
-					);
+			// Vertical props scaling
+			if ( factor.from.y !== factor.to.y ) {
+				childFrom = $.effects.setTransition( child, vProps, factor.from.y, childFrom );
+				childTo = $.effects.setTransition( child, vProps, factor.to.y, childTo );
 			}
-			this.reverting = true;
-			$( this.helper ).animate(
-				animation,
-				parseInt( this.options.revert, 10 ) || 500,
-				function() {
-					that._clear( event );
-				}
-			);
-		} else {
-			this._clear( event, noPropagation );
-		}
-
-		return false;
-
-	},
-
-	cancel: function() {
-
-		if ( this.dragging ) {
-
-			this._mouseUp( new $.Event( "mouseup", { target: null } ) );

-			if ( this.options.helper === "original" ) {
-				this.currentItem.css( this._storedCSS );
-				this._removeClass( this.currentItem, "ui-sortable-helper" );
-			} else {
-				this.currentItem.show();
+			// Horizontal props scaling
+			if ( factor.from.x !== factor.to.x ) {
+				childFrom = $.effects.setTransition( child, hProps, factor.from.x, childFrom );
+				childTo = $.effects.setTransition( child, hProps, factor.to.x, childTo );
 			}

-			//Post deactivating events to containers
-			for ( var i = this.containers.length - 1; i >= 0; i-- ) {
-				this.containers[ i ]._trigger( "deactivate", null, this._uiHash( this ) );
-				if ( this.containers[ i ].containerCache.over ) {
-					this.containers[ i ]._trigger( "out", null, this._uiHash( this ) );
-					this.containers[ i ].containerCache.over = 0;
-				}
+			if ( restore ) {
+				$.effects.saveStyle( child );
 			}

-		}
-
-		if ( this.placeholder ) {
-
-			//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
-			// it unbinds ALL events from the original node!
-			if ( this.placeholder[ 0 ].parentNode ) {
-				this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );
-			}
-			if ( this.options.helper !== "original" && this.helper &&
-					this.helper[ 0 ].parentNode ) {
-				this.helper.remove();
-			}
+			// Animate children
+			child.css( childFrom );
+			child.animate( childTo, options.duration, options.easing, function() {

-			$.extend( this, {
-				helper: null,
-				dragging: false,
-				reverting: false,
-				_noFinalSort: null
+				// Restore children
+				if ( restore ) {
+					$.effects.restoreStyle( child );
+				}
 			} );
-
-			if ( this.domPosition.prev ) {
-				$( this.domPosition.prev ).after( this.currentItem );
-			} else {
-				$( this.domPosition.parent ).prepend( this.currentItem );
-			}
-		}
-
-		return this;
-
-	},
-
-	serialize: function( o ) {
-
-		var items = this._getItemsAsjQuery( o && o.connected ),
-			str = [];
-		o = o || {};
-
-		$( items ).each( function() {
-			var res = ( $( o.item || this ).attr( o.attribute || "id" ) || "" )
-				.match( o.expression || ( /(.+)[\-=_](.+)/ ) );
-			if ( res ) {
-				str.push(
-					( o.key || res[ 1 ] + "[]" ) +
-					"=" + ( o.key && o.expression ? res[ 1 ] : res[ 2 ] ) );
-			}
-		} );
-
-		if ( !str.length && o.key ) {
-			str.push( o.key + "=" );
-		}
-
-		return str.join( "&" );
-
-	},
-
-	toArray: function( o ) {
-
-		var items = this._getItemsAsjQuery( o && o.connected ),
-			ret = [];
-
-		o = o || {};
-
-		items.each( function() {
-			ret.push( $( o.item || this ).attr( o.attribute || "id" ) || "" );
 		} );
-		return ret;
-
-	},
-
-	/* Be careful with the following core functions */
-	_intersectsWith: function( item ) {
-
-		var x1 = this.positionAbs.left,
-			x2 = x1 + this.helperProportions.width,
-			y1 = this.positionAbs.top,
-			y2 = y1 + this.helperProportions.height,
-			l = item.left,
-			r = l + item.width,
-			t = item.top,
-			b = t + item.height,
-			dyClick = this.offset.click.top,
-			dxClick = this.offset.click.left,
-			isOverElementHeight = ( this.options.axis === "x" ) || ( ( y1 + dyClick ) > t &&
-				( y1 + dyClick ) < b ),
-			isOverElementWidth = ( this.options.axis === "y" ) || ( ( x1 + dxClick ) > l &&
-				( x1 + dxClick ) < r ),
-			isOverElement = isOverElementHeight && isOverElementWidth;
-
-		if ( this.options.tolerance === "pointer" ||
-			this.options.forcePointerForContainers ||
-			( this.options.tolerance !== "pointer" &&
-				this.helperProportions[ this.floating ? "width" : "height" ] >
-				item[ this.floating ? "width" : "height" ] )
-		) {
-			return isOverElement;
-		} else {
-
-			return ( l < x1 + ( this.helperProportions.width / 2 ) && // Right Half
-				x2 - ( this.helperProportions.width / 2 ) < r && // Left Half
-				t < y1 + ( this.helperProportions.height / 2 ) && // Bottom Half
-				y2 - ( this.helperProportions.height / 2 ) < b ); // Top Half
-
-		}
-	},
-
-	_intersectsWithPointer: function( item ) {
-		var verticalDirection, horizontalDirection,
-			isOverElementHeight = ( this.options.axis === "x" ) ||
-				this._isOverAxis(
-					this.positionAbs.top + this.offset.click.top, item.top, item.height ),
-			isOverElementWidth = ( this.options.axis === "y" ) ||
-				this._isOverAxis(
-					this.positionAbs.left + this.offset.click.left, item.left, item.width ),
-			isOverElement = isOverElementHeight && isOverElementWidth;
-
-		if ( !isOverElement ) {
-			return false;
-		}
-
-		verticalDirection = this.dragDirection.vertical;
-		horizontalDirection = this.dragDirection.horizontal;
-
-		return this.floating ?
-			( ( horizontalDirection === "right" || verticalDirection === "down" ) ? 2 : 1 ) :
-			( verticalDirection && ( verticalDirection === "down" ? 2 : 1 ) );
-
-	},
-
-	_intersectsWithSides: function( item ) {
-
-		var isOverBottomHalf = this._isOverAxis( this.positionAbs.top +
-				this.offset.click.top, item.top + ( item.height / 2 ), item.height ),
-			isOverRightHalf = this._isOverAxis( this.positionAbs.left +
-				this.offset.click.left, item.left + ( item.width / 2 ), item.width ),
-			verticalDirection = this.dragDirection.vertical,
-			horizontalDirection = this.dragDirection.horizontal;
-
-		if ( this.floating && horizontalDirection ) {
-			return ( ( horizontalDirection === "right" && isOverRightHalf ) ||
-				( horizontalDirection === "left" && !isOverRightHalf ) );
-		} else {
-			return verticalDirection && ( ( verticalDirection === "down" && isOverBottomHalf ) ||
-				( verticalDirection === "up" && !isOverBottomHalf ) );
-		}
-
-	},
-
-	_getDragVerticalDirection: function() {
-		var delta = this.positionAbs.top - this.lastPositionAbs.top;
-		return delta !== 0 && ( delta > 0 ? "down" : "up" );
-	},
-
-	_getDragHorizontalDirection: function() {
-		var delta = this.positionAbs.left - this.lastPositionAbs.left;
-		return delta !== 0 && ( delta > 0 ? "right" : "left" );
-	},
-
-	refresh: function( event ) {
-		this._refreshItems( event );
-		this._setHandleClassName();
-		this.refreshPositions();
-		return this;
-	},
-
-	_connectWith: function() {
-		var options = this.options;
-		return options.connectWith.constructor === String ?
-			[ options.connectWith ] :
-			options.connectWith;
-	},
+	}

-	_getItemsAsjQuery: function( connected ) {
+	// Animate
+	element.animate( to, {
+		queue: false,
+		duration: options.duration,
+		easing: options.easing,
+		complete: function() {

-		var i, j, cur, inst,
-			items = [],
-			queries = [],
-			connectWith = this._connectWith();
+			var offset = element.offset();

-		if ( connectWith && connected ) {
-			for ( i = connectWith.length - 1; i >= 0; i-- ) {
-				cur = $( connectWith[ i ], this.document[ 0 ] );
-				for ( j = cur.length - 1; j >= 0; j-- ) {
-					inst = $.data( cur[ j ], this.widgetFullName );
-					if ( inst && inst !== this && !inst.options.disabled ) {
-						queries.push( [ typeof inst.options.items === "function" ?
-							inst.options.items.call( inst.element ) :
-							$( inst.options.items, inst.element )
-								.not( ".ui-sortable-helper" )
-								.not( ".ui-sortable-placeholder" ), inst ] );
-					}
-				}
+			if ( to.opacity === 0 ) {
+				element.css( "opacity", from.opacity );
 			}
-		}
-
-		queries.push( [ typeof this.options.items === "function" ?
-			this.options.items
-				.call( this.element, null, { options: this.options, item: this.currentItem } ) :
-			$( this.options.items, this.element )
-				.not( ".ui-sortable-helper" )
-				.not( ".ui-sortable-placeholder" ), this ] );
-
-		function addItems() {
-			items.push( this );
-		}
-		for ( i = queries.length - 1; i >= 0; i-- ) {
-			queries[ i ][ 0 ].each( addItems );
-		}
-
-		return $( items );

-	},
-
-	_removeCurrentsFromItems: function() {
-
-		var list = this.currentItem.find( ":data(" + this.widgetName + "-item)" );
+			if ( !restore ) {
+				element
+					.css( "position", position === "static" ? "relative" : position )
+					.offset( offset );

-		this.items = $.grep( this.items, function( item ) {
-			for ( var j = 0; j < list.length; j++ ) {
-				if ( list[ j ] === item.item[ 0 ] ) {
-					return false;
-				}
+				// Need to save style here so that automatic style restoration
+				// doesn't restore to the original styles from before the animation.
+				$.effects.saveStyle( element );
 			}
-			return true;
-		} );

-	},
-
-	_refreshItems: function( event ) {
-
-		this.items = [];
-		this.containers = [ this ];
-
-		var i, j, cur, inst, targetData, _queries, item, queriesLength,
-			items = this.items,
-			queries = [ [ typeof this.options.items === "function" ?
-				this.options.items.call( this.element[ 0 ], event, { item: this.currentItem } ) :
-				$( this.options.items, this.element ), this ] ],
-			connectWith = this._connectWith();
-
-		//Shouldn't be run the first time through due to massive slow-down
-		if ( connectWith && this.ready ) {
-			for ( i = connectWith.length - 1; i >= 0; i-- ) {
-				cur = $( connectWith[ i ], this.document[ 0 ] );
-				for ( j = cur.length - 1; j >= 0; j-- ) {
-					inst = $.data( cur[ j ], this.widgetFullName );
-					if ( inst && inst !== this && !inst.options.disabled ) {
-						queries.push( [ typeof inst.options.items === "function" ?
-							inst.options.items
-								.call( inst.element[ 0 ], event, { item: this.currentItem } ) :
-							$( inst.options.items, inst.element ), inst ] );
-						this.containers.push( inst );
-					}
-				}
-			}
+			done();
 		}
+	} );

-		for ( i = queries.length - 1; i >= 0; i-- ) {
-			targetData = queries[ i ][ 1 ];
-			_queries = queries[ i ][ 0 ];
+} );

-			for ( j = 0, queriesLength = _queries.length; j < queriesLength; j++ ) {
-				item = $( _queries[ j ] );

-				// Data for target checking (mouse manager)
-				item.data( this.widgetName + "-item", targetData );
+/*!
+ * jQuery UI Effects Scale 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-				items.push( {
-					item: item,
-					instance: targetData,
-					width: 0, height: 0,
-					left: 0, top: 0
-				} );
-			}
-		}
+//>>label: Scale Effect
+//>>group: Effects
+//>>description: Grows or shrinks an element and its content.
+//>>docs: http://api.jqueryui.com/scale-effect/
+//>>demos: http://jqueryui.com/effect/

-	},

-	_refreshItemPositions: function( fast ) {
-		var i, item, t, p;
+var effectsEffectScale = $.effects.define( "scale", function( options, done ) {

-		for ( i = this.items.length - 1; i >= 0; i-- ) {
-			item = this.items[ i ];
+	// Create element
+	var el = $( this ),
+		mode = options.mode,
+		percent = parseInt( options.percent, 10 ) ||
+			( parseInt( options.percent, 10 ) === 0 ? 0 : ( mode !== "effect" ? 0 : 100 ) ),

-			//We ignore calculating positions of all connected containers when we're not over them
-			if ( this.currentContainer && item.instance !== this.currentContainer &&
-					item.item[ 0 ] !== this.currentItem[ 0 ] ) {
-				continue;
-			}
+		newOptions = $.extend( true, {
+			from: $.effects.scaledDimensions( el ),
+			to: $.effects.scaledDimensions( el, percent, options.direction || "both" ),
+			origin: options.origin || [ "middle", "center" ]
+		}, options );

-			t = this.options.toleranceElement ?
-				$( this.options.toleranceElement, item.item ) :
-				item.item;
+	// Fade option to support puff
+	if ( options.fade ) {
+		newOptions.from.opacity = 1;
+		newOptions.to.opacity = 0;
+	}

-			if ( !fast ) {
-				item.width = t.outerWidth();
-				item.height = t.outerHeight();
-			}
+	$.effects.effect.size.call( this, newOptions, done );
+} );

-			p = t.offset();
-			item.left = p.left;
-			item.top = p.top;
-		}
-	},

-	refreshPositions: function( fast ) {
+/*!
+ * jQuery UI Effects Puff 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		// Determine whether items are being displayed horizontally
-		this.floating = this.items.length ?
-			this.options.axis === "x" || this._isFloating( this.items[ 0 ].item ) :
-			false;
+//>>label: Puff Effect
+//>>group: Effects
+//>>description: Creates a puff effect by scaling the element up and hiding it at the same time.
+//>>docs: http://api.jqueryui.com/puff-effect/
+//>>demos: http://jqueryui.com/effect/

-		// This has to be redone because due to the item being moved out/into the offsetParent,
-		// the offsetParent's position will change
-		if ( this.offsetParent && this.helper ) {
-			this.offset.parent = this._getParentOffset();
-		}

-		this._refreshItemPositions( fast );
+var effectsEffectPuff = $.effects.define( "puff", "hide", function( options, done ) {
+	var newOptions = $.extend( true, {}, options, {
+		fade: true,
+		percent: parseInt( options.percent, 10 ) || 150
+	} );

-		var i, p;
+	$.effects.effect.scale.call( this, newOptions, done );
+} );

-		if ( this.options.custom && this.options.custom.refreshContainers ) {
-			this.options.custom.refreshContainers.call( this );
-		} else {
-			for ( i = this.containers.length - 1; i >= 0; i-- ) {
-				p = this.containers[ i ].element.offset();
-				this.containers[ i ].containerCache.left = p.left;
-				this.containers[ i ].containerCache.top = p.top;
-				this.containers[ i ].containerCache.width =
-					this.containers[ i ].element.outerWidth();
-				this.containers[ i ].containerCache.height =
-					this.containers[ i ].element.outerHeight();
-			}
-		}

-		return this;
-	},
+/*!
+ * jQuery UI Effects Pulsate 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-	_createPlaceholder: function( that ) {
-		that = that || this;
-		var className, nodeName,
-			o = that.options;
+//>>label: Pulsate Effect
+//>>group: Effects
+//>>description: Pulsates an element n times by changing the opacity to zero and back.
+//>>docs: http://api.jqueryui.com/pulsate-effect/
+//>>demos: http://jqueryui.com/effect/

-		if ( !o.placeholder || o.placeholder.constructor === String ) {
-			className = o.placeholder;
-			nodeName = that.currentItem[ 0 ].nodeName.toLowerCase();
-			o.placeholder = {
-				element: function() {

-					var element = $( "<" + nodeName + ">", that.document[ 0 ] );
+var effectsEffectPulsate = $.effects.define( "pulsate", "show", function( options, done ) {
+	var element = $( this ),
+		mode = options.mode,
+		show = mode === "show",
+		hide = mode === "hide",
+		showhide = show || hide,

-					that._addClass( element, "ui-sortable-placeholder",
-							className || that.currentItem[ 0 ].className )
-						._removeClass( element, "ui-sortable-helper" );
+		// Showing or hiding leaves off the "last" animation
+		anims = ( ( options.times || 5 ) * 2 ) + ( showhide ? 1 : 0 ),
+		duration = options.duration / anims,
+		animateTo = 0,
+		i = 1,
+		queuelen = element.queue().length;

-					if ( nodeName === "tbody" ) {
-						that._createTrPlaceholder(
-							that.currentItem.find( "tr" ).eq( 0 ),
-							$( "<tr>", that.document[ 0 ] ).appendTo( element )
-						);
-					} else if ( nodeName === "tr" ) {
-						that._createTrPlaceholder( that.currentItem, element );
-					} else if ( nodeName === "img" ) {
-						element.attr( "src", that.currentItem.attr( "src" ) );
-					}
+	if ( show || !element.is( ":visible" ) ) {
+		element.css( "opacity", 0 ).show();
+		animateTo = 1;
+	}

-					if ( !className ) {
-						element.css( "visibility", "hidden" );
-					}
+	// Anims - 1 opacity "toggles"
+	for ( ; i < anims; i++ ) {
+		element.animate( { opacity: animateTo }, duration, options.easing );
+		animateTo = 1 - animateTo;
+	}

-					return element;
-				},
-				update: function( container, p ) {
+	element.animate( { opacity: animateTo }, duration, options.easing );

-					// 1. If a className is set as 'placeholder option, we don't force sizes -
-					// the class is responsible for that
-					// 2. The option 'forcePlaceholderSize can be enabled to force it even if a
-					// class name is specified
-					if ( className && !o.forcePlaceholderSize ) {
-						return;
-					}
+	element.queue( done );

-					// If the element doesn't have a actual height or width by itself (without
-					// styles coming from a stylesheet), it receives the inline height and width
-					// from the dragged item. Or, if it's a tbody or tr, it's going to have a height
-					// anyway since we're populating them with <td>s above, but they're unlikely to
-					// be the correct height on their own if the row heights are dynamic, so we'll
-					// always assign the height of the dragged item given forcePlaceholderSize
-					// is true.
-					if ( !p.height() || ( o.forcePlaceholderSize &&
-							( nodeName === "tbody" || nodeName === "tr" ) ) ) {
-						p.height(
-							that.currentItem.innerHeight() -
-							parseInt( that.currentItem.css( "paddingTop" ) || 0, 10 ) -
-							parseInt( that.currentItem.css( "paddingBottom" ) || 0, 10 ) );
-					}
-					if ( !p.width() ) {
-						p.width(
-							that.currentItem.innerWidth() -
-							parseInt( that.currentItem.css( "paddingLeft" ) || 0, 10 ) -
-							parseInt( that.currentItem.css( "paddingRight" ) || 0, 10 ) );
-					}
-				}
-			};
-		}
+	$.effects.unshift( element, queuelen, anims + 1 );
+} );

-		//Create the placeholder
-		that.placeholder = $( o.placeholder.element.call( that.element, that.currentItem ) );

-		//Append it after the actual current item
-		that.currentItem.after( that.placeholder );
+/*!
+ * jQuery UI Effects Shake 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		//Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
-		o.placeholder.update( that, that.placeholder );
+//>>label: Shake Effect
+//>>group: Effects
+//>>description: Shakes an element horizontally or vertically n times.
+//>>docs: http://api.jqueryui.com/shake-effect/
+//>>demos: http://jqueryui.com/effect/

-	},

-	_createTrPlaceholder: function( sourceTr, targetTr ) {
-		var that = this;
+var effectsEffectShake = $.effects.define( "shake", function( options, done ) {

-		sourceTr.children().each( function() {
-			$( "<td>&#160;</td>", that.document[ 0 ] )
-				.attr( "colspan", $( this ).attr( "colspan" ) || 1 )
-				.appendTo( targetTr );
-		} );
-	},
+	var i = 1,
+		element = $( this ),
+		direction = options.direction || "left",
+		distance = options.distance || 20,
+		times = options.times || 3,
+		anims = times * 2 + 1,
+		speed = Math.round( options.duration / anims ),
+		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
+		positiveMotion = ( direction === "up" || direction === "left" ),
+		animation = {},
+		animation1 = {},
+		animation2 = {},

-	_contactContainers: function( event ) {
-		var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
-			floating, axis,
-			innermostContainer = null,
-			innermostIndex = null;
+		queuelen = element.queue().length;

-		// Get innermost container that intersects with item
-		for ( i = this.containers.length - 1; i >= 0; i-- ) {
+	$.effects.createPlaceholder( element );

-			// Never consider a container that's located within the item itself
-			if ( $.contains( this.currentItem[ 0 ], this.containers[ i ].element[ 0 ] ) ) {
-				continue;
-			}
+	// Animation
+	animation[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance;
+	animation1[ ref ] = ( positiveMotion ? "+=" : "-=" ) + distance * 2;
+	animation2[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance * 2;

-			if ( this._intersectsWith( this.containers[ i ].containerCache ) ) {
+	// Animate
+	element.animate( animation, speed, options.easing );

-				// If we've already found a container and it's more "inner" than this, then continue
-				if ( innermostContainer &&
-						$.contains(
-							this.containers[ i ].element[ 0 ],
-							innermostContainer.element[ 0 ] ) ) {
-					continue;
-				}
+	// Shakes
+	for ( ; i < times; i++ ) {
+		element
+			.animate( animation1, speed, options.easing )
+			.animate( animation2, speed, options.easing );
+	}

-				innermostContainer = this.containers[ i ];
-				innermostIndex = i;
+	element
+		.animate( animation1, speed, options.easing )
+		.animate( animation, speed / 2, options.easing )
+		.queue( done );

-			} else {
+	$.effects.unshift( element, queuelen, anims + 1 );
+} );

-				// container doesn't intersect. trigger "out" event if necessary
-				if ( this.containers[ i ].containerCache.over ) {
-					this.containers[ i ]._trigger( "out", event, this._uiHash( this ) );
-					this.containers[ i ].containerCache.over = 0;
-				}
-			}

-		}
+/*!
+ * jQuery UI Effects Slide 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		// If no intersecting containers found, return
-		if ( !innermostContainer ) {
-			return;
-		}
+//>>label: Slide Effect
+//>>group: Effects
+//>>description: Slides an element in and out of the viewport.
+//>>docs: http://api.jqueryui.com/slide-effect/
+//>>demos: http://jqueryui.com/effect/

-		// Move the item into the container if it's not there already
-		if ( this.containers.length === 1 ) {
-			if ( !this.containers[ innermostIndex ].containerCache.over ) {
-				this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
-				this.containers[ innermostIndex ].containerCache.over = 1;
-			}
-		} else {

-			// When entering a new container, we will find the item with the least distance and
-			// append our item near it
-			dist = 10000;
-			itemWithLeastDistance = null;
-			floating = innermostContainer.floating || this._isFloating( this.currentItem );
-			posProperty = floating ? "left" : "top";
-			sizeProperty = floating ? "width" : "height";
-			axis = floating ? "pageX" : "pageY";
+var effectsEffectSlide = $.effects.define( "slide", "show", function( options, done ) {
+	var startClip, startRef,
+		element = $( this ),
+		map = {
+			up: [ "bottom", "top" ],
+			down: [ "top", "bottom" ],
+			left: [ "right", "left" ],
+			right: [ "left", "right" ]
+		},
+		mode = options.mode,
+		direction = options.direction || "left",
+		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
+		positiveMotion = ( direction === "up" || direction === "left" ),
+		distance = options.distance ||
+			element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ),
+		animation = {};

-			for ( j = this.items.length - 1; j >= 0; j-- ) {
-				if ( !$.contains(
-						this.containers[ innermostIndex ].element[ 0 ], this.items[ j ].item[ 0 ] )
-				) {
-					continue;
-				}
-				if ( this.items[ j ].item[ 0 ] === this.currentItem[ 0 ] ) {
-					continue;
-				}
+	$.effects.createPlaceholder( element );

-				cur = this.items[ j ].item.offset()[ posProperty ];
-				nearBottom = false;
-				if ( event[ axis ] - cur > this.items[ j ][ sizeProperty ] / 2 ) {
-					nearBottom = true;
-				}
+	startClip = element.cssClip();
+	startRef = element.position()[ ref ];

-				if ( Math.abs( event[ axis ] - cur ) < dist ) {
-					dist = Math.abs( event[ axis ] - cur );
-					itemWithLeastDistance = this.items[ j ];
-					this.direction = nearBottom ? "up" : "down";
-				}
-			}
+	// Define hide animation
+	animation[ ref ] = ( positiveMotion ? -1 : 1 ) * distance + startRef;
+	animation.clip = element.cssClip();
+	animation.clip[ map[ direction ][ 1 ] ] = animation.clip[ map[ direction ][ 0 ] ];

-			//Check if dropOnEmpty is enabled
-			if ( !itemWithLeastDistance && !this.options.dropOnEmpty ) {
-				return;
-			}
+	// Reverse the animation if we're showing
+	if ( mode === "show" ) {
+		element.cssClip( animation.clip );
+		element.css( ref, animation[ ref ] );
+		animation.clip = startClip;
+		animation[ ref ] = startRef;
+	}

-			if ( this.currentContainer === this.containers[ innermostIndex ] ) {
-				if ( !this.currentContainer.containerCache.over ) {
-					this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash() );
-					this.currentContainer.containerCache.over = 1;
-				}
-				return;
-			}
+	// Actually animate
+	element.animate( animation, {
+		queue: false,
+		duration: options.duration,
+		easing: options.easing,
+		complete: done
+	} );
+} );

-			if ( itemWithLeastDistance ) {
-				this._rearrange( event, itemWithLeastDistance, null, true );
-			} else {
-				this._rearrange( event, null, this.containers[ innermostIndex ].element, true );
-			}
-			this._trigger( "change", event, this._uiHash() );
-			this.containers[ innermostIndex ]._trigger( "change", event, this._uiHash( this ) );
-			this.currentContainer = this.containers[ innermostIndex ];

-			//Update the placeholder
-			this.options.placeholder.update( this.currentContainer, this.placeholder );
+/*!
+ * jQuery UI Effects Transfer 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-			//Update scrollParent
-			this.scrollParent = this.placeholder.scrollParent();
+//>>label: Transfer Effect
+//>>group: Effects
+//>>description: Displays a transfer effect from one element to another.
+//>>docs: http://api.jqueryui.com/transfer-effect/
+//>>demos: http://jqueryui.com/effect/

-			//Update overflowOffset
-			if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-					this.scrollParent[ 0 ].tagName !== "HTML" ) {
-				this.overflowOffset = this.scrollParent.offset();
-			}

-			this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
-			this.containers[ innermostIndex ].containerCache.over = 1;
-		}
+var effect;
+if ( $.uiBackCompat !== false ) {
+	effect = $.effects.define( "transfer", function( options, done ) {
+		$( this ).transfer( options, done );
+	} );
+}
+var effectsEffectTransfer = effect;

-	},

-	_createHelper: function( event ) {
+/*!
+ * jQuery UI Focusable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		var o = this.options,
-			helper = typeof o.helper === "function" ?
-				$( o.helper.apply( this.element[ 0 ], [ event, this.currentItem ] ) ) :
-				( o.helper === "clone" ? this.currentItem.clone() : this.currentItem );
+//>>label: :focusable Selector
+//>>group: Core
+//>>description: Selects elements which can be focused.
+//>>docs: http://api.jqueryui.com/focusable-selector/

-		//Add the helper to the DOM if that didn't happen already
-		if ( !helper.parents( "body" ).length ) {
-			this.appendTo[ 0 ].appendChild( helper[ 0 ] );
-		}

-		if ( helper[ 0 ] === this.currentItem[ 0 ] ) {
-			this._storedCSS = {
-				width: this.currentItem[ 0 ].style.width,
-				height: this.currentItem[ 0 ].style.height,
-				position: this.currentItem.css( "position" ),
-				top: this.currentItem.css( "top" ),
-				left: this.currentItem.css( "left" )
-			};
-		}
+// Selectors
+$.ui.focusable = function( element, hasTabindex ) {
+	var map, mapName, img, focusableIfVisible, fieldset,
+		nodeName = element.nodeName.toLowerCase();

-		if ( !helper[ 0 ].style.width || o.forceHelperSize ) {
-			helper.width( this.currentItem.width() );
-		}
-		if ( !helper[ 0 ].style.height || o.forceHelperSize ) {
-			helper.height( this.currentItem.height() );
+	if ( "area" === nodeName ) {
+		map = element.parentNode;
+		mapName = map.name;
+		if ( !element.href || !mapName || map.nodeName.toLowerCase() !== "map" ) {
+			return false;
 		}
+		img = $( "img[usemap='#" + mapName + "']" );
+		return img.length > 0 && img.is( ":visible" );
+	}

-		return helper;
+	if ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {
+		focusableIfVisible = !element.disabled;

-	},
+		if ( focusableIfVisible ) {

-	_adjustOffsetFromHelper: function( obj ) {
-		if ( typeof obj === "string" ) {
-			obj = obj.split( " " );
-		}
-		if ( Array.isArray( obj ) ) {
-			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
-		}
-		if ( "left" in obj ) {
-			this.offset.click.left = obj.left + this.margins.left;
-		}
-		if ( "right" in obj ) {
-			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
-		}
-		if ( "top" in obj ) {
-			this.offset.click.top = obj.top + this.margins.top;
-		}
-		if ( "bottom" in obj ) {
-			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
+			// Form controls within a disabled fieldset are disabled.
+			// However, controls within the fieldset's legend do not get disabled.
+			// Since controls generally aren't placed inside legends, we skip
+			// this portion of the check.
+			fieldset = $( element ).closest( "fieldset" )[ 0 ];
+			if ( fieldset ) {
+				focusableIfVisible = !fieldset.disabled;
+			}
 		}
-	},
+	} else if ( "a" === nodeName ) {
+		focusableIfVisible = element.href || hasTabindex;
+	} else {
+		focusableIfVisible = hasTabindex;
+	}

-	_getParentOffset: function() {
+	return focusableIfVisible && $( element ).is( ":visible" ) && visible( $( element ) );
+};

-		//Get the offsetParent and cache its position
-		this.offsetParent = this.helper.offsetParent();
-		var po = this.offsetParent.offset();
+// Support: IE 8 only
+// IE 8 doesn't resolve inherit to visible/hidden for computed values
+function visible( element ) {
+	var visibility = element.css( "visibility" );
+	while ( visibility === "inherit" ) {
+		element = element.parent();
+		visibility = element.css( "visibility" );
+	}
+	return visibility === "visible";
+}

-		// This is a special case where we need to modify a offset calculated on start, since the
-		// following happened:
-		// 1. The position of the helper is absolute, so it's position is calculated based on the
-		// next positioned parent
-		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
-		// the document, which means that the scroll is included in the initial calculation of the
-		// offset of the parent, and never recalculated upon drag
-		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
-			po.left += this.scrollParent.scrollLeft();
-			po.top += this.scrollParent.scrollTop();
-		}
+$.extend( $.expr.pseudos, {
+	focusable: function( element ) {
+		return $.ui.focusable( element, $.attr( element, "tabindex" ) != null );
+	}
+} );

-		// This needs to be actually done for all browsers, since pageX/pageY includes this
-		// information with an ugly IE fix
-		if ( this.offsetParent[ 0 ] === this.document[ 0 ].body ||
-				( this.offsetParent[ 0 ].tagName &&
-				this.offsetParent[ 0 ].tagName.toLowerCase() === "html" && $.ui.ie ) ) {
-			po = { top: 0, left: 0 };
-		}
+var focusable = $.ui.focusable;

-		return {
-			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
-			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
-		};

-	},

-	_getRelativeOffset: function() {
+// Support: IE8 Only
+// IE8 does not support the form attribute and when it is supplied. It overwrites the form prop
+// with a string, so we need to find the proper form.
+var form = $.fn._form = function() {
+	return typeof this[ 0 ].form === "string" ? this.closest( "form" ) : $( this[ 0 ].form );
+};

-		if ( this.cssPosition === "relative" ) {
-			var p = this.currentItem.position();
-			return {
-				top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
-					this.scrollParent.scrollTop(),
-				left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
-					this.scrollParent.scrollLeft()
-			};
-		} else {
-			return { top: 0, left: 0 };
-		}

-	},
+/*!
+ * jQuery UI Form Reset Mixin 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-	_cacheMargins: function() {
-		this.margins = {
-			left: ( parseInt( this.currentItem.css( "marginLeft" ), 10 ) || 0 ),
-			top: ( parseInt( this.currentItem.css( "marginTop" ), 10 ) || 0 )
-		};
-	},
+//>>label: Form Reset Mixin
+//>>group: Core
+//>>description: Refresh input widgets when their form is reset
+//>>docs: http://api.jqueryui.com/form-reset-mixin/

-	_cacheHelperProportions: function() {
-		this.helperProportions = {
-			width: this.helper.outerWidth(),
-			height: this.helper.outerHeight()
-		};
-	},

-	_setContainment: function() {
+var formResetMixin = $.ui.formResetMixin = {
+	_formResetHandler: function() {
+		var form = $( this );

-		var ce, co, over,
-			o = this.options;
-		if ( o.containment === "parent" ) {
-			o.containment = this.helper[ 0 ].parentNode;
-		}
-		if ( o.containment === "document" || o.containment === "window" ) {
-			this.containment = [
-				0 - this.offset.relative.left - this.offset.parent.left,
-				0 - this.offset.relative.top - this.offset.parent.top,
-				o.containment === "document" ?
-					this.document.width() :
-					this.window.width() - this.helperProportions.width - this.margins.left,
-				( o.containment === "document" ?
-					( this.document.height() || document.body.parentNode.scrollHeight ) :
-					this.window.height() || this.document[ 0 ].body.parentNode.scrollHeight
-				) - this.helperProportions.height - this.margins.top
-			];
+		// Wait for the form reset to actually happen before refreshing
+		setTimeout( function() {
+			var instances = form.data( "ui-form-reset-instances" );
+			$.each( instances, function() {
+				this.refresh();
+			} );
+		} );
+	},
+
+	_bindFormResetHandler: function() {
+		this.form = this.element._form();
+		if ( !this.form.length ) {
+			return;
 		}

-		if ( !( /^(document|window|parent)$/ ).test( o.containment ) ) {
-			ce = $( o.containment )[ 0 ];
-			co = $( o.containment ).offset();
-			over = ( $( ce ).css( "overflow" ) !== "hidden" );
+		var instances = this.form.data( "ui-form-reset-instances" ) || [];
+		if ( !instances.length ) {

-			this.containment = [
-				co.left + ( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) +
-					( parseInt( $( ce ).css( "paddingLeft" ), 10 ) || 0 ) - this.margins.left,
-				co.top + ( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) +
-					( parseInt( $( ce ).css( "paddingTop" ), 10 ) || 0 ) - this.margins.top,
-				co.left + ( over ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
-					( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) -
-					( parseInt( $( ce ).css( "paddingRight" ), 10 ) || 0 ) -
-					this.helperProportions.width - this.margins.left,
-				co.top + ( over ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
-					( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) -
-					( parseInt( $( ce ).css( "paddingBottom" ), 10 ) || 0 ) -
-					this.helperProportions.height - this.margins.top
-			];
+			// We don't use _on() here because we use a single event handler per form
+			this.form.on( "reset.ui-form-reset", this._formResetHandler );
 		}
-
+		instances.push( this );
+		this.form.data( "ui-form-reset-instances", instances );
 	},

-	_convertPositionTo: function( d, pos ) {
+	_unbindFormResetHandler: function() {
+		if ( !this.form.length ) {
+			return;
+		}

-		if ( !pos ) {
-			pos = this.position;
+		var instances = this.form.data( "ui-form-reset-instances" );
+		instances.splice( $.inArray( this, instances ), 1 );
+		if ( instances.length ) {
+			this.form.data( "ui-form-reset-instances", instances );
+		} else {
+			this.form
+				.removeData( "ui-form-reset-instances" )
+				.off( "reset.ui-form-reset" );
 		}
-		var mod = d === "absolute" ? 1 : -1,
-			scroll = this.cssPosition === "absolute" &&
-				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
-					this.offsetParent :
-					this.scrollParent,
-			scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );
+	}
+};

-		return {
-			top: (

-				// The absolute mouse position
-				pos.top	+
+/*!
+ * jQuery UI Support for jQuery core 1.8.x and newer 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ *
+ */

-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.top * mod +
+//>>label: jQuery 1.8+ Support
+//>>group: Core
+//>>description: Support version 1.8.x and newer of jQuery core

-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.top * mod -
-				( ( this.cssPosition === "fixed" ?
-					-this.scrollParent.scrollTop() :
-					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) * mod )
-			),
-			left: (

-				// The absolute mouse position
-				pos.left +
+// Support: jQuery 1.9.x or older
+// $.expr[ ":" ] is deprecated.
+if ( !$.expr.pseudos ) {
+	$.expr.pseudos = $.expr[ ":" ];
+}

-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.left * mod +
+// Support: jQuery 1.11.x or older
+// $.unique has been renamed to $.uniqueSort
+if ( !$.uniqueSort ) {
+	$.uniqueSort = $.unique;
+}

-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.left * mod	-
-				( ( this.cssPosition === "fixed" ?
-					-this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
-					scroll.scrollLeft() ) * mod )
-			)
-		};
+// Support: jQuery 2.2.x or older.
+// This method has been defined in jQuery 3.0.0.
+// Code from https://github.com/jquery/jquery/blob/e539bac79e666bba95bba86d690b4e609dca2286/src/selector/escapeSelector.js
+if ( !$.escapeSelector ) {

-	},
+	// CSS string/identifier serialization
+	// https://drafts.csswg.org/cssom/#common-serializing-idioms
+	var rcssescape = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;

-	_generatePosition: function( event ) {
+	var fcssescape = function( ch, asCodePoint ) {
+		if ( asCodePoint ) {

-		var top, left,
-			o = this.options,
-			pageX = event.pageX,
-			pageY = event.pageY,
-			scroll = this.cssPosition === "absolute" &&
-				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
-					this.offsetParent :
-					this.scrollParent,
-				scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );
+			// U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER
+			if ( ch === "\0" ) {
+				return "\uFFFD";
+			}

-		// This is another very weird special case that only happens for relative elements:
-		// 1. If the css position is relative
-		// 2. and the scroll parent is the document or similar to the offset parent
-		// we have to refresh the relative offset during the scroll so there are no jumps
-		if ( this.cssPosition === "relative" && !( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
-				this.scrollParent[ 0 ] !== this.offsetParent[ 0 ] ) ) {
-			this.offset.relative = this._getRelativeOffset();
+			// Control characters and (dependent upon position) numbers get escaped as code points
+			return ch.slice( 0, -1 ) + "\\" + ch.charCodeAt( ch.length - 1 ).toString( 16 ) + " ";
 		}

-		/*
-		 * - Position constraining -
-		 * Constrain the position to a mix of grid, containment.
-		 */
-
-		if ( this.originalPosition ) { //If we are not dragging yet, we won't check for options
-
-			if ( this.containment ) {
-				if ( event.pageX - this.offset.click.left < this.containment[ 0 ] ) {
-					pageX = this.containment[ 0 ] + this.offset.click.left;
-				}
-				if ( event.pageY - this.offset.click.top < this.containment[ 1 ] ) {
-					pageY = this.containment[ 1 ] + this.offset.click.top;
-				}
-				if ( event.pageX - this.offset.click.left > this.containment[ 2 ] ) {
-					pageX = this.containment[ 2 ] + this.offset.click.left;
-				}
-				if ( event.pageY - this.offset.click.top > this.containment[ 3 ] ) {
-					pageY = this.containment[ 3 ] + this.offset.click.top;
-				}
-			}
-
-			if ( o.grid ) {
-				top = this.originalPageY + Math.round( ( pageY - this.originalPageY ) /
-					o.grid[ 1 ] ) * o.grid[ 1 ];
-				pageY = this.containment ?
-					( ( top - this.offset.click.top >= this.containment[ 1 ] &&
-						top - this.offset.click.top <= this.containment[ 3 ] ) ?
-							top :
-							( ( top - this.offset.click.top >= this.containment[ 1 ] ) ?
-								top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) :
-								top;
+		// Other potentially-special ASCII characters get backslash-escaped
+		return "\\" + ch;
+	};

-				left = this.originalPageX + Math.round( ( pageX - this.originalPageX ) /
-					o.grid[ 0 ] ) * o.grid[ 0 ];
-				pageX = this.containment ?
-					( ( left - this.offset.click.left >= this.containment[ 0 ] &&
-						left - this.offset.click.left <= this.containment[ 2 ] ) ?
-							left :
-							( ( left - this.offset.click.left >= this.containment[ 0 ] ) ?
-								left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) :
-								left;
-			}
+	$.escapeSelector = function( sel ) {
+		return ( sel + "" ).replace( rcssescape, fcssescape );
+	};
+}

+// Support: jQuery 3.4.x or older
+// These methods have been defined in jQuery 3.5.0.
+if ( !$.fn.even || !$.fn.odd ) {
+	$.fn.extend( {
+		even: function() {
+			return this.filter( function( i ) {
+				return i % 2 === 0;
+			} );
+		},
+		odd: function() {
+			return this.filter( function( i ) {
+				return i % 2 === 1;
+			} );
 		}
+	} );
+}

-		return {
-			top: (
+;
+/*!
+ * jQuery UI Keycode 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-				// The absolute mouse position
-				pageY -
+//>>label: Keycode
+//>>group: Core
+//>>description: Provide keycodes as keynames
+//>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/

-				// Click offset (relative to the element)
-				this.offset.click.top -

-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.top -
+var keycode = $.ui.keyCode = {
+	BACKSPACE: 8,
+	COMMA: 188,
+	DELETE: 46,
+	DOWN: 40,
+	END: 35,
+	ENTER: 13,
+	ESCAPE: 27,
+	HOME: 36,
+	LEFT: 37,
+	PAGE_DOWN: 34,
+	PAGE_UP: 33,
+	PERIOD: 190,
+	RIGHT: 39,
+	SPACE: 32,
+	TAB: 9,
+	UP: 38
+};

-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.top +
-				( ( this.cssPosition === "fixed" ?
-					-this.scrollParent.scrollTop() :
-					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) )
-			),
-			left: (

-				// The absolute mouse position
-				pageX -
+/*!
+ * jQuery UI Labels 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-				// Click offset (relative to the element)
-				this.offset.click.left -
+//>>label: labels
+//>>group: Core
+//>>description: Find all the labels associated with a given input
+//>>docs: http://api.jqueryui.com/labels/

-				// Only for relative positioned nodes: Relative offset from element to offset parent
-				this.offset.relative.left -

-				// The offsetParent's offset without borders (offset + border)
-				this.offset.parent.left +
-				( ( this.cssPosition === "fixed" ?
-					-this.scrollParent.scrollLeft() :
-					scrollIsRootNode ? 0 : scroll.scrollLeft() ) )
-			)
-		};
+var labels = $.fn.labels = function() {
+	var ancestor, selector, id, labels, ancestors;

-	},
+	if ( !this.length ) {
+		return this.pushStack( [] );
+	}

-	_rearrange: function( event, i, a, hardRefresh ) {
+	// Check control.labels first
+	if ( this[ 0 ].labels && this[ 0 ].labels.length ) {
+		return this.pushStack( this[ 0 ].labels );
+	}

-		if ( a ) {
-			a[ 0 ].appendChild( this.placeholder[ 0 ] );
-		} else {
-			i.item[ 0 ].parentNode.insertBefore( this.placeholder[ 0 ],
-				( this.direction === "down" ? i.item[ 0 ] : i.item[ 0 ].nextSibling ) );
-		}
+	// Support: IE <= 11, FF <= 37, Android <= 2.3 only
+	// Above browsers do not support control.labels. Everything below is to support them
+	// as well as document fragments. control.labels does not work on document fragments
+	labels = this.eq( 0 ).parents( "label" );

-		//Various things done here to improve the performance:
-		// 1. we create a setTimeout, that calls refreshPositions
-		// 2. on the instance, we have a counter variable, that get's higher after every append
-		// 3. on the local scope, we copy the counter variable, and check in the timeout,
-		// if it's still the same
-		// 4. this lets only the last addition to the timeout stack through
-		this.counter = this.counter ? ++this.counter : 1;
-		var counter = this.counter;
+	// Look for the label based on the id
+	id = this.attr( "id" );
+	if ( id ) {

-		this._delay( function() {
-			if ( counter === this.counter ) {
+		// We don't search against the document in case the element
+		// is disconnected from the DOM
+		ancestor = this.eq( 0 ).parents().last();

-				//Precompute after each DOM insertion, NOT on mousemove
-				this.refreshPositions( !hardRefresh );
-			}
-		} );
+		// Get a full set of top level ancestors
+		ancestors = ancestor.add( ancestor.length ? ancestor.siblings() : this.siblings() );

-	},
+		// Create a selector for the label based on the id
+		selector = "label[for='" + $.escapeSelector( id ) + "']";

-	_clear: function( event, noPropagation ) {
+		labels = labels.add( ancestors.find( selector ).addBack( selector ) );

-		this.reverting = false;
+	}

-		// We delay all events that have to be triggered to after the point where the placeholder
-		// has been removed and everything else normalized again
-		var i,
-			delayedTriggers = [];
+	// Return whatever we have found for labels
+	return this.pushStack( labels );
+};

-		// We first have to update the dom position of the actual currentItem
-		// Note: don't do it if the current item is already removed (by a user), or it gets
-		// reappended (see #4088)
-		if ( !this._noFinalSort && this.currentItem.parent().length ) {
-			this.placeholder.before( this.currentItem );
-		}
-		this._noFinalSort = null;

-		if ( this.helper[ 0 ] === this.currentItem[ 0 ] ) {
-			for ( i in this._storedCSS ) {
-				if ( this._storedCSS[ i ] === "auto" || this._storedCSS[ i ] === "static" ) {
-					this._storedCSS[ i ] = "";
-				}
-			}
-			this.currentItem.css( this._storedCSS );
-			this._removeClass( this.currentItem, "ui-sortable-helper" );
-		} else {
-			this.currentItem.show();
-		}
+/*!
+ * jQuery UI Scroll Parent 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		if ( this.fromOutside && !noPropagation ) {
-			delayedTriggers.push( function( event ) {
-				this._trigger( "receive", event, this._uiHash( this.fromOutside ) );
-			} );
-		}
-		if ( ( this.fromOutside ||
-				this.domPosition.prev !==
-				this.currentItem.prev().not( ".ui-sortable-helper" )[ 0 ] ||
-				this.domPosition.parent !== this.currentItem.parent()[ 0 ] ) && !noPropagation ) {
+//>>label: scrollParent
+//>>group: Core
+//>>description: Get the closest ancestor element that is scrollable.
+//>>docs: http://api.jqueryui.com/scrollParent/

-			// Trigger update callback if the DOM position has changed
-			delayedTriggers.push( function( event ) {
-				this._trigger( "update", event, this._uiHash() );
-			} );
-		}

-		// Check if the items Container has Changed and trigger appropriate
-		// events.
-		if ( this !== this.currentContainer ) {
-			if ( !noPropagation ) {
-				delayedTriggers.push( function( event ) {
-					this._trigger( "remove", event, this._uiHash() );
-				} );
-				delayedTriggers.push( ( function( c ) {
-					return function( event ) {
-						c._trigger( "receive", event, this._uiHash( this ) );
-					};
-				} ).call( this, this.currentContainer ) );
-				delayedTriggers.push( ( function( c ) {
-					return function( event ) {
-						c._trigger( "update", event, this._uiHash( this ) );
-					};
-				} ).call( this, this.currentContainer ) );
+var scrollParent = $.fn.scrollParent = function( includeHidden ) {
+	var position = this.css( "position" ),
+		excludeStaticParent = position === "absolute",
+		overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
+		scrollParent = this.parents().filter( function() {
+			var parent = $( this );
+			if ( excludeStaticParent && parent.css( "position" ) === "static" ) {
+				return false;
 			}
-		}
+			return overflowRegex.test( parent.css( "overflow" ) + parent.css( "overflow-y" ) +
+				parent.css( "overflow-x" ) );
+		} ).eq( 0 );

-		//Post events to containers
-		function delayEvent( type, instance, container ) {
-			return function( event ) {
-				container._trigger( type, event, instance._uiHash( instance ) );
-			};
-		}
-		for ( i = this.containers.length - 1; i >= 0; i-- ) {
-			if ( !noPropagation ) {
-				delayedTriggers.push( delayEvent( "deactivate", this, this.containers[ i ] ) );
-			}
-			if ( this.containers[ i ].containerCache.over ) {
-				delayedTriggers.push( delayEvent( "out", this, this.containers[ i ] ) );
-				this.containers[ i ].containerCache.over = 0;
-			}
-		}
+	return position === "fixed" || !scrollParent.length ?
+		$( this[ 0 ].ownerDocument || document ) :
+		scrollParent;
+};

-		//Do what was originally in plugins
-		if ( this.storedCursor ) {
-			this.document.find( "body" ).css( "cursor", this.storedCursor );
-			this.storedStylesheet.remove();
-		}
-		if ( this._storedOpacity ) {
-			this.helper.css( "opacity", this._storedOpacity );
-		}
-		if ( this._storedZIndex ) {
-			this.helper.css( "zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex );
-		}

-		this.dragging = false;
+/*!
+ * jQuery UI Tabbable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		if ( !noPropagation ) {
-			this._trigger( "beforeStop", event, this._uiHash() );
-		}
+//>>label: :tabbable Selector
+//>>group: Core
+//>>description: Selects elements which can be tabbed to.
+//>>docs: http://api.jqueryui.com/tabbable-selector/

-		//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
-		// it unbinds ALL events from the original node!
-		this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );

-		if ( !this.cancelHelperRemoval ) {
-			if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
-				this.helper.remove();
-			}
-			this.helper = null;
-		}
+var tabbable = $.extend( $.expr.pseudos, {
+	tabbable: function( element ) {
+		var tabIndex = $.attr( element, "tabindex" ),
+			hasTabindex = tabIndex != null;
+		return ( !hasTabindex || tabIndex >= 0 ) && $.ui.focusable( element, hasTabindex );
+	}
+} );

-		if ( !noPropagation ) {
-			for ( i = 0; i < delayedTriggers.length; i++ ) {

-				// Trigger all delayed events
-				delayedTriggers[ i ].call( this, event );
-			}
-			this._trigger( "stop", event, this._uiHash() );
-		}
+/*!
+ * jQuery UI Unique ID 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */

-		this.fromOutside = false;
-		return !this.cancelHelperRemoval;
+//>>label: uniqueId
+//>>group: Core
+//>>description: Functions to generate and remove uniqueId's
+//>>docs: http://api.jqueryui.com/uniqueId/

-	},

-	_trigger: function() {
-		if ( $.Widget.prototype._trigger.apply( this, arguments ) === false ) {
-			this.cancel();
-		}
-	},
+var uniqueId = $.fn.extend( {
+	uniqueId: ( function() {
+		var uuid = 0;

-	_uiHash: function( _inst ) {
-		var inst = _inst || this;
-		return {
-			helper: inst.helper,
-			placeholder: inst.placeholder || $( [] ),
-			position: inst.position,
-			originalPosition: inst.originalPosition,
-			offset: inst.positionAbs,
-			item: inst.currentItem,
-			sender: _inst ? _inst.element : null
+		return function() {
+			return this.each( function() {
+				if ( !this.id ) {
+					this.id = "ui-id-" + ( ++uuid );
+				}
+			} );
 		};
-	}
+	} )(),

+	removeUniqueId: function() {
+		return this.each( function() {
+			if ( /^ui-id-\d+$/.test( this.id ) ) {
+				$( this ).removeAttr( "id" );
+			}
+		} );
+	}
 } );


 /*!
- * jQuery UI Accordion 1.13.1
+ * jQuery UI Accordion 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -6856,7 +4361,7 @@


 var widgetsAccordion = $.widget( "ui.accordion", {
-	version: "1.13.1",
+	version: "1.13.2",
 	options: {
 		active: 0,
 		animate: {},
@@ -7436,8 +4941,38 @@
 } );


+
+var safeActiveElement = $.ui.safeActiveElement = function( document ) {
+	var activeElement;
+
+	// Support: IE 9 only
+	// IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
+	try {
+		activeElement = document.activeElement;
+	} catch ( error ) {
+		activeElement = document.body;
+	}
+
+	// Support: IE 9 - 11 only
+	// IE may return null instead of an element
+	// Interestingly, this only seems to occur when NOT in an iframe
+	if ( !activeElement ) {
+		activeElement = document.body;
+	}
+
+	// Support: IE 11 only
+	// IE11 returns a seemingly empty object in some cases when accessing
+	// document.activeElement from an <iframe>
+	if ( !activeElement.nodeName ) {
+		activeElement = document.body;
+	}
+
+	return activeElement;
+};
+
+
 /*!
- * jQuery UI Menu 1.13.1
+ * jQuery UI Menu 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -7456,7 +4991,7 @@


 var widgetsMenu = $.widget( "ui.menu", {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<ul>",
 	delay: 300,
 	options: {
@@ -8128,7 +5663,7 @@


 /*!
- * jQuery UI Autocomplete 1.13.1
+ * jQuery UI Autocomplete 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -8147,7 +5682,7 @@


 $.widget( "ui.autocomplete", {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<input>",
 	options: {
 		appendTo: null,
@@ -8784,7 +6319,7 @@


 /*!
- * jQuery UI Controlgroup 1.13.1
+ * jQuery UI Controlgroup 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -8805,7 +6340,7 @@
 var controlgroupCornerRegex = /ui-corner-([a-z]){2,6}/g;

 var widgetsControlgroup = $.widget( "ui.controlgroup", {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<div>",
 	options: {
 		direction: "horizontal",
@@ -9069,7 +6604,7 @@
 } );

 /*!
- * jQuery UI Checkboxradio 1.13.1
+ * jQuery UI Checkboxradio 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -9089,7 +6624,7 @@


 $.widget( "ui.checkboxradio", [ $.ui.formResetMixin, {
-	version: "1.13.1",
+	version: "1.13.2",
 	options: {
 		disabled: null,
 		label: null,
@@ -9101,8 +6636,7 @@
 	},

 	_getCreateOptions: function() {
-		var disabled, labels;
-		var that = this;
+		var disabled, labels, labelContents;
 		var options = this._super() || {};

 		// We read the type here, because it makes more sense to throw a element type error first,
@@ -9122,12 +6656,18 @@

 		// We need to get the label text but this may also need to make sure it does not contain the
 		// input itself.
-		this.label.contents().not( this.element[ 0 ] ).each( function() {
+		// The label contents could be text, html, or a mix. We wrap all elements
+		// and read the wrapper's `innerHTML` to get a string representation of
+		// the label, without the input as part of it.
+		labelContents = this.label.contents().not( this.element[ 0 ] );

-			// The label contents could be text, html, or a mix. We concat each element to get a
-			// string representation of the label, without the input as part of it.
-			that.originalLabel += this.nodeType === 3 ? $( this ).text() : this.outerHTML;
-		} );
+		if ( labelContents.length ) {
+			this.originalLabel += labelContents
+				.clone()
+				.wrapAll( "<div></div>" )
+				.parent()
+				.html();
+		}

 		// Set the label option if we found label text
 		if ( this.originalLabel ) {
@@ -9335,7 +6875,7 @@


 /*!
- * jQuery UI Button 1.13.1
+ * jQuery UI Button 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -9354,7 +6894,7 @@


 $.widget( "ui.button", {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<button>",
 	options: {
 		classes: {
@@ -9761,7 +7301,7 @@

 /* eslint-disable max-len, camelcase */
 /*!
- * jQuery UI Datepicker 1.13.1
+ * jQuery UI Datepicker 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -9779,7 +7319,7 @@
 //>>css.theme: ../../themes/base/theme.css


-$.extend( $.ui, { datepicker: { version: "1.13.1" } } );
+$.extend( $.ui, { datepicker: { version: "1.13.2" } } );

 var datepicker_instActive;

@@ -10622,1367 +8162,4066 @@
 			datepicker_handleMouseover.apply( activeCell.get( 0 ) );
 		}

-		inst.dpDiv.removeClass( "ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4" ).width( "" );
-		if ( cols > 1 ) {
-			inst.dpDiv.addClass( "ui-datepicker-multi-" + cols ).css( "width", ( width * cols ) + "em" );
-		}
-		inst.dpDiv[ ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ? "add" : "remove" ) +
-			"Class" ]( "ui-datepicker-multi" );
-		inst.dpDiv[ ( this._get( inst, "isRTL" ) ? "add" : "remove" ) +
-			"Class" ]( "ui-datepicker-rtl" );
+		inst.dpDiv.removeClass( "ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4" ).width( "" );
+		if ( cols > 1 ) {
+			inst.dpDiv.addClass( "ui-datepicker-multi-" + cols ).css( "width", ( width * cols ) + "em" );
+		}
+		inst.dpDiv[ ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ? "add" : "remove" ) +
+			"Class" ]( "ui-datepicker-multi" );
+		inst.dpDiv[ ( this._get( inst, "isRTL" ) ? "add" : "remove" ) +
+			"Class" ]( "ui-datepicker-rtl" );
+
+		if ( inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput( inst ) ) {
+			inst.input.trigger( "focus" );
+		}
+
+		// Deffered render of the years select (to avoid flashes on Firefox)
+		if ( inst.yearshtml ) {
+			origyearshtml = inst.yearshtml;
+			setTimeout( function() {
+
+				//assure that inst.yearshtml didn't change.
+				if ( origyearshtml === inst.yearshtml && inst.yearshtml ) {
+					inst.dpDiv.find( "select.ui-datepicker-year" ).first().replaceWith( inst.yearshtml );
+				}
+				origyearshtml = inst.yearshtml = null;
+			}, 0 );
+		}
+
+		if ( onUpdateDatepicker ) {
+			onUpdateDatepicker.apply( ( inst.input ? inst.input[ 0 ] : null ), [ inst ] );
+		}
+	},
+
+	// #6694 - don't focus the input if it's already focused
+	// this breaks the change event in IE
+	// Support: IE and jQuery <1.9
+	_shouldFocusInput: function( inst ) {
+		return inst.input && inst.input.is( ":visible" ) && !inst.input.is( ":disabled" ) && !inst.input.is( ":focus" );
+	},
+
+	/* Check positioning to remain on screen. */
+	_checkOffset: function( inst, offset, isFixed ) {
+		var dpWidth = inst.dpDiv.outerWidth(),
+			dpHeight = inst.dpDiv.outerHeight(),
+			inputWidth = inst.input ? inst.input.outerWidth() : 0,
+			inputHeight = inst.input ? inst.input.outerHeight() : 0,
+			viewWidth = document.documentElement.clientWidth + ( isFixed ? 0 : $( document ).scrollLeft() ),
+			viewHeight = document.documentElement.clientHeight + ( isFixed ? 0 : $( document ).scrollTop() );
+
+		offset.left -= ( this._get( inst, "isRTL" ) ? ( dpWidth - inputWidth ) : 0 );
+		offset.left -= ( isFixed && offset.left === inst.input.offset().left ) ? $( document ).scrollLeft() : 0;
+		offset.top -= ( isFixed && offset.top === ( inst.input.offset().top + inputHeight ) ) ? $( document ).scrollTop() : 0;
+
+		// Now check if datepicker is showing outside window viewport - move to a better place if so.
+		offset.left -= Math.min( offset.left, ( offset.left + dpWidth > viewWidth && viewWidth > dpWidth ) ?
+			Math.abs( offset.left + dpWidth - viewWidth ) : 0 );
+		offset.top -= Math.min( offset.top, ( offset.top + dpHeight > viewHeight && viewHeight > dpHeight ) ?
+			Math.abs( dpHeight + inputHeight ) : 0 );
+
+		return offset;
+	},
+
+	/* Find an object's position on the screen. */
+	_findPos: function( obj ) {
+		var position,
+			inst = this._getInst( obj ),
+			isRTL = this._get( inst, "isRTL" );
+
+		while ( obj && ( obj.type === "hidden" || obj.nodeType !== 1 || $.expr.pseudos.hidden( obj ) ) ) {
+			obj = obj[ isRTL ? "previousSibling" : "nextSibling" ];
+		}
+
+		position = $( obj ).offset();
+		return [ position.left, position.top ];
+	},
+
+	/* Hide the date picker from view.
+	 * @param  input  element - the input field attached to the date picker
+	 */
+	_hideDatepicker: function( input ) {
+		var showAnim, duration, postProcess, onClose,
+			inst = this._curInst;
+
+		if ( !inst || ( input && inst !== $.data( input, "datepicker" ) ) ) {
+			return;
+		}
+
+		if ( this._datepickerShowing ) {
+			showAnim = this._get( inst, "showAnim" );
+			duration = this._get( inst, "duration" );
+			postProcess = function() {
+				$.datepicker._tidyDialog( inst );
+			};
+
+			// DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
+			if ( $.effects && ( $.effects.effect[ showAnim ] || $.effects[ showAnim ] ) ) {
+				inst.dpDiv.hide( showAnim, $.datepicker._get( inst, "showOptions" ), duration, postProcess );
+			} else {
+				inst.dpDiv[ ( showAnim === "slideDown" ? "slideUp" :
+					( showAnim === "fadeIn" ? "fadeOut" : "hide" ) ) ]( ( showAnim ? duration : null ), postProcess );
+			}
+
+			if ( !showAnim ) {
+				postProcess();
+			}
+			this._datepickerShowing = false;
+
+			onClose = this._get( inst, "onClose" );
+			if ( onClose ) {
+				onClose.apply( ( inst.input ? inst.input[ 0 ] : null ), [ ( inst.input ? inst.input.val() : "" ), inst ] );
+			}
+
+			this._lastInput = null;
+			if ( this._inDialog ) {
+				this._dialogInput.css( { position: "absolute", left: "0", top: "-100px" } );
+				if ( $.blockUI ) {
+					$.unblockUI();
+					$( "body" ).append( this.dpDiv );
+				}
+			}
+			this._inDialog = false;
+		}
+	},
+
+	/* Tidy up after a dialog display. */
+	_tidyDialog: function( inst ) {
+		inst.dpDiv.removeClass( this._dialogClass ).off( ".ui-datepicker-calendar" );
+	},
+
+	/* Close date picker if clicked elsewhere. */
+	_checkExternalClick: function( event ) {
+		if ( !$.datepicker._curInst ) {
+			return;
+		}
+
+		var $target = $( event.target ),
+			inst = $.datepicker._getInst( $target[ 0 ] );
+
+		if ( ( ( $target[ 0 ].id !== $.datepicker._mainDivId &&
+				$target.parents( "#" + $.datepicker._mainDivId ).length === 0 &&
+				!$target.hasClass( $.datepicker.markerClassName ) &&
+				!$target.closest( "." + $.datepicker._triggerClass ).length &&
+				$.datepicker._datepickerShowing && !( $.datepicker._inDialog && $.blockUI ) ) ) ||
+			( $target.hasClass( $.datepicker.markerClassName ) && $.datepicker._curInst !== inst ) ) {
+				$.datepicker._hideDatepicker();
+		}
+	},
+
+	/* Adjust one of the date sub-fields. */
+	_adjustDate: function( id, offset, period ) {
+		var target = $( id ),
+			inst = this._getInst( target[ 0 ] );
+
+		if ( this._isDisabledDatepicker( target[ 0 ] ) ) {
+			return;
+		}
+		this._adjustInstDate( inst, offset, period );
+		this._updateDatepicker( inst );
+	},
+
+	/* Action for current link. */
+	_gotoToday: function( id ) {
+		var date,
+			target = $( id ),
+			inst = this._getInst( target[ 0 ] );
+
+		if ( this._get( inst, "gotoCurrent" ) && inst.currentDay ) {
+			inst.selectedDay = inst.currentDay;
+			inst.drawMonth = inst.selectedMonth = inst.currentMonth;
+			inst.drawYear = inst.selectedYear = inst.currentYear;
+		} else {
+			date = new Date();
+			inst.selectedDay = date.getDate();
+			inst.drawMonth = inst.selectedMonth = date.getMonth();
+			inst.drawYear = inst.selectedYear = date.getFullYear();
+		}
+		this._notifyChange( inst );
+		this._adjustDate( target );
+	},
+
+	/* Action for selecting a new month/year. */
+	_selectMonthYear: function( id, select, period ) {
+		var target = $( id ),
+			inst = this._getInst( target[ 0 ] );
+
+		inst[ "selected" + ( period === "M" ? "Month" : "Year" ) ] =
+		inst[ "draw" + ( period === "M" ? "Month" : "Year" ) ] =
+			parseInt( select.options[ select.selectedIndex ].value, 10 );
+
+		this._notifyChange( inst );
+		this._adjustDate( target );
+	},
+
+	/* Action for selecting a day. */
+	_selectDay: function( id, month, year, td ) {
+		var inst,
+			target = $( id );
+
+		if ( $( td ).hasClass( this._unselectableClass ) || this._isDisabledDatepicker( target[ 0 ] ) ) {
+			return;
+		}
+
+		inst = this._getInst( target[ 0 ] );
+		inst.selectedDay = inst.currentDay = parseInt( $( "a", td ).attr( "data-date" ) );
+		inst.selectedMonth = inst.currentMonth = month;
+		inst.selectedYear = inst.currentYear = year;
+		this._selectDate( id, this._formatDate( inst,
+			inst.currentDay, inst.currentMonth, inst.currentYear ) );
+	},
+
+	/* Erase the input field and hide the date picker. */
+	_clearDate: function( id ) {
+		var target = $( id );
+		this._selectDate( target, "" );
+	},
+
+	/* Update the input field with the selected date. */
+	_selectDate: function( id, dateStr ) {
+		var onSelect,
+			target = $( id ),
+			inst = this._getInst( target[ 0 ] );
+
+		dateStr = ( dateStr != null ? dateStr : this._formatDate( inst ) );
+		if ( inst.input ) {
+			inst.input.val( dateStr );
+		}
+		this._updateAlternate( inst );
+
+		onSelect = this._get( inst, "onSelect" );
+		if ( onSelect ) {
+			onSelect.apply( ( inst.input ? inst.input[ 0 ] : null ), [ dateStr, inst ] );  // trigger custom callback
+		} else if ( inst.input ) {
+			inst.input.trigger( "change" ); // fire the change event
+		}
+
+		if ( inst.inline ) {
+			this._updateDatepicker( inst );
+		} else {
+			this._hideDatepicker();
+			this._lastInput = inst.input[ 0 ];
+			if ( typeof( inst.input[ 0 ] ) !== "object" ) {
+				inst.input.trigger( "focus" ); // restore focus
+			}
+			this._lastInput = null;
+		}
+	},
+
+	/* Update any alternate field to synchronise with the main field. */
+	_updateAlternate: function( inst ) {
+		var altFormat, date, dateStr,
+			altField = this._get( inst, "altField" );
+
+		if ( altField ) { // update alternate field too
+			altFormat = this._get( inst, "altFormat" ) || this._get( inst, "dateFormat" );
+			date = this._getDate( inst );
+			dateStr = this.formatDate( altFormat, date, this._getFormatConfig( inst ) );
+			$( document ).find( altField ).val( dateStr );
+		}
+	},
+
+	/* Set as beforeShowDay function to prevent selection of weekends.
+	 * @param  date  Date - the date to customise
+	 * @return [boolean, string] - is this date selectable?, what is its CSS class?
+	 */
+	noWeekends: function( date ) {
+		var day = date.getDay();
+		return [ ( day > 0 && day < 6 ), "" ];
+	},
+
+	/* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
+	 * @param  date  Date - the date to get the week for
+	 * @return  number - the number of the week within the year that contains this date
+	 */
+	iso8601Week: function( date ) {
+		var time,
+			checkDate = new Date( date.getTime() );
+
+		// Find Thursday of this week starting on Monday
+		checkDate.setDate( checkDate.getDate() + 4 - ( checkDate.getDay() || 7 ) );
+
+		time = checkDate.getTime();
+		checkDate.setMonth( 0 ); // Compare with Jan 1
+		checkDate.setDate( 1 );
+		return Math.floor( Math.round( ( time - checkDate ) / 86400000 ) / 7 ) + 1;
+	},
+
+	/* Parse a string value into a date object.
+	 * See formatDate below for the possible formats.
+	 *
+	 * @param  format string - the expected format of the date
+	 * @param  value string - the date in the above format
+	 * @param  settings Object - attributes include:
+	 *					shortYearCutoff  number - the cutoff year for determining the century (optional)
+	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
+	 *					dayNames		string[7] - names of the days from Sunday (optional)
+	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
+	 *					monthNames		string[12] - names of the months (optional)
+	 * @return  Date - the extracted date value or null if value is blank
+	 */
+	parseDate: function( format, value, settings ) {
+		if ( format == null || value == null ) {
+			throw "Invalid arguments";
+		}
+
+		value = ( typeof value === "object" ? value.toString() : value + "" );
+		if ( value === "" ) {
+			return null;
+		}
+
+		var iFormat, dim, extra,
+			iValue = 0,
+			shortYearCutoffTemp = ( settings ? settings.shortYearCutoff : null ) || this._defaults.shortYearCutoff,
+			shortYearCutoff = ( typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
+				new Date().getFullYear() % 100 + parseInt( shortYearCutoffTemp, 10 ) ),
+			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
+			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
+			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
+			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,
+			year = -1,
+			month = -1,
+			day = -1,
+			doy = -1,
+			literal = false,
+			date,
+
+			// Check whether a format character is doubled
+			lookAhead = function( match ) {
+				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
+				if ( matches ) {
+					iFormat++;
+				}
+				return matches;
+			},
+
+			// Extract a number from the string value
+			getNumber = function( match ) {
+				var isDoubled = lookAhead( match ),
+					size = ( match === "@" ? 14 : ( match === "!" ? 20 :
+					( match === "y" && isDoubled ? 4 : ( match === "o" ? 3 : 2 ) ) ) ),
+					minSize = ( match === "y" ? size : 1 ),
+					digits = new RegExp( "^\\d{" + minSize + "," + size + "}" ),
+					num = value.substring( iValue ).match( digits );
+				if ( !num ) {
+					throw "Missing number at position " + iValue;
+				}
+				iValue += num[ 0 ].length;
+				return parseInt( num[ 0 ], 10 );
+			},
+
+			// Extract a name from the string value and convert to an index
+			getName = function( match, shortNames, longNames ) {
+				var index = -1,
+					names = $.map( lookAhead( match ) ? longNames : shortNames, function( v, k ) {
+						return [ [ k, v ] ];
+					} ).sort( function( a, b ) {
+						return -( a[ 1 ].length - b[ 1 ].length );
+					} );
+
+				$.each( names, function( i, pair ) {
+					var name = pair[ 1 ];
+					if ( value.substr( iValue, name.length ).toLowerCase() === name.toLowerCase() ) {
+						index = pair[ 0 ];
+						iValue += name.length;
+						return false;
+					}
+				} );
+				if ( index !== -1 ) {
+					return index + 1;
+				} else {
+					throw "Unknown name at position " + iValue;
+				}
+			},
+
+			// Confirm that a literal character matches the string value
+			checkLiteral = function() {
+				if ( value.charAt( iValue ) !== format.charAt( iFormat ) ) {
+					throw "Unexpected literal at position " + iValue;
+				}
+				iValue++;
+			};
+
+		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
+			if ( literal ) {
+				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
+					literal = false;
+				} else {
+					checkLiteral();
+				}
+			} else {
+				switch ( format.charAt( iFormat ) ) {
+					case "d":
+						day = getNumber( "d" );
+						break;
+					case "D":
+						getName( "D", dayNamesShort, dayNames );
+						break;
+					case "o":
+						doy = getNumber( "o" );
+						break;
+					case "m":
+						month = getNumber( "m" );
+						break;
+					case "M":
+						month = getName( "M", monthNamesShort, monthNames );
+						break;
+					case "y":
+						year = getNumber( "y" );
+						break;
+					case "@":
+						date = new Date( getNumber( "@" ) );
+						year = date.getFullYear();
+						month = date.getMonth() + 1;
+						day = date.getDate();
+						break;
+					case "!":
+						date = new Date( ( getNumber( "!" ) - this._ticksTo1970 ) / 10000 );
+						year = date.getFullYear();
+						month = date.getMonth() + 1;
+						day = date.getDate();
+						break;
+					case "'":
+						if ( lookAhead( "'" ) ) {
+							checkLiteral();
+						} else {
+							literal = true;
+						}
+						break;
+					default:
+						checkLiteral();
+				}
+			}
+		}
+
+		if ( iValue < value.length ) {
+			extra = value.substr( iValue );
+			if ( !/^\s+/.test( extra ) ) {
+				throw "Extra/unparsed characters found in date: " + extra;
+			}
+		}
+
+		if ( year === -1 ) {
+			year = new Date().getFullYear();
+		} else if ( year < 100 ) {
+			year += new Date().getFullYear() - new Date().getFullYear() % 100 +
+				( year <= shortYearCutoff ? 0 : -100 );
+		}
+
+		if ( doy > -1 ) {
+			month = 1;
+			day = doy;
+			do {
+				dim = this._getDaysInMonth( year, month - 1 );
+				if ( day <= dim ) {
+					break;
+				}
+				month++;
+				day -= dim;
+			} while ( true );
+		}
+
+		date = this._daylightSavingAdjust( new Date( year, month - 1, day ) );
+		if ( date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day ) {
+			throw "Invalid date"; // E.g. 31/02/00
+		}
+		return date;
+	},
+
+	/* Standard date formats. */
+	ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
+	COOKIE: "D, dd M yy",
+	ISO_8601: "yy-mm-dd",
+	RFC_822: "D, d M y",
+	RFC_850: "DD, dd-M-y",
+	RFC_1036: "D, d M y",
+	RFC_1123: "D, d M yy",
+	RFC_2822: "D, d M yy",
+	RSS: "D, d M y", // RFC 822
+	TICKS: "!",
+	TIMESTAMP: "@",
+	W3C: "yy-mm-dd", // ISO 8601
+
+	_ticksTo1970: ( ( ( 1970 - 1 ) * 365 + Math.floor( 1970 / 4 ) - Math.floor( 1970 / 100 ) +
+		Math.floor( 1970 / 400 ) ) * 24 * 60 * 60 * 10000000 ),
+
+	/* Format a date object into a string value.
+	 * The format can be combinations of the following:
+	 * d  - day of month (no leading zero)
+	 * dd - day of month (two digit)
+	 * o  - day of year (no leading zeros)
+	 * oo - day of year (three digit)
+	 * D  - day name short
+	 * DD - day name long
+	 * m  - month of year (no leading zero)
+	 * mm - month of year (two digit)
+	 * M  - month name short
+	 * MM - month name long
+	 * y  - year (two digit)
+	 * yy - year (four digit)
+	 * @ - Unix timestamp (ms since 01/01/1970)
+	 * ! - Windows ticks (100ns since 01/01/0001)
+	 * "..." - literal text
+	 * '' - single quote
+	 *
+	 * @param  format string - the desired format of the date
+	 * @param  date Date - the date value to format
+	 * @param  settings Object - attributes include:
+	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
+	 *					dayNames		string[7] - names of the days from Sunday (optional)
+	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
+	 *					monthNames		string[12] - names of the months (optional)
+	 * @return  string - the date in the above format
+	 */
+	formatDate: function( format, date, settings ) {
+		if ( !date ) {
+			return "";
+		}
+
+		var iFormat,
+			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
+			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
+			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
+			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,
+
+			// Check whether a format character is doubled
+			lookAhead = function( match ) {
+				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
+				if ( matches ) {
+					iFormat++;
+				}
+				return matches;
+			},
+
+			// Format a number, with leading zero if necessary
+			formatNumber = function( match, value, len ) {
+				var num = "" + value;
+				if ( lookAhead( match ) ) {
+					while ( num.length < len ) {
+						num = "0" + num;
+					}
+				}
+				return num;
+			},
+
+			// Format a name, short or long as requested
+			formatName = function( match, value, shortNames, longNames ) {
+				return ( lookAhead( match ) ? longNames[ value ] : shortNames[ value ] );
+			},
+			output = "",
+			literal = false;
+
+		if ( date ) {
+			for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
+				if ( literal ) {
+					if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
+						literal = false;
+					} else {
+						output += format.charAt( iFormat );
+					}
+				} else {
+					switch ( format.charAt( iFormat ) ) {
+						case "d":
+							output += formatNumber( "d", date.getDate(), 2 );
+							break;
+						case "D":
+							output += formatName( "D", date.getDay(), dayNamesShort, dayNames );
+							break;
+						case "o":
+							output += formatNumber( "o",
+								Math.round( ( new Date( date.getFullYear(), date.getMonth(), date.getDate() ).getTime() - new Date( date.getFullYear(), 0, 0 ).getTime() ) / 86400000 ), 3 );
+							break;
+						case "m":
+							output += formatNumber( "m", date.getMonth() + 1, 2 );
+							break;
+						case "M":
+							output += formatName( "M", date.getMonth(), monthNamesShort, monthNames );
+							break;
+						case "y":
+							output += ( lookAhead( "y" ) ? date.getFullYear() :
+								( date.getFullYear() % 100 < 10 ? "0" : "" ) + date.getFullYear() % 100 );
+							break;
+						case "@":
+							output += date.getTime();
+							break;
+						case "!":
+							output += date.getTime() * 10000 + this._ticksTo1970;
+							break;
+						case "'":
+							if ( lookAhead( "'" ) ) {
+								output += "'";
+							} else {
+								literal = true;
+							}
+							break;
+						default:
+							output += format.charAt( iFormat );
+					}
+				}
+			}
+		}
+		return output;
+	},
+
+	/* Extract all possible characters from the date format. */
+	_possibleChars: function( format ) {
+		var iFormat,
+			chars = "",
+			literal = false,
+
+			// Check whether a format character is doubled
+			lookAhead = function( match ) {
+				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
+				if ( matches ) {
+					iFormat++;
+				}
+				return matches;
+			};
+
+		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
+			if ( literal ) {
+				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
+					literal = false;
+				} else {
+					chars += format.charAt( iFormat );
+				}
+			} else {
+				switch ( format.charAt( iFormat ) ) {
+					case "d": case "m": case "y": case "@":
+						chars += "0123456789";
+						break;
+					case "D": case "M":
+						return null; // Accept anything
+					case "'":
+						if ( lookAhead( "'" ) ) {
+							chars += "'";
+						} else {
+							literal = true;
+						}
+						break;
+					default:
+						chars += format.charAt( iFormat );
+				}
+			}
+		}
+		return chars;
+	},
+
+	/* Get a setting value, defaulting if necessary. */
+	_get: function( inst, name ) {
+		return inst.settings[ name ] !== undefined ?
+			inst.settings[ name ] : this._defaults[ name ];
+	},
+
+	/* Parse existing date and initialise date picker. */
+	_setDateFromField: function( inst, noDefault ) {
+		if ( inst.input.val() === inst.lastVal ) {
+			return;
+		}
+
+		var dateFormat = this._get( inst, "dateFormat" ),
+			dates = inst.lastVal = inst.input ? inst.input.val() : null,
+			defaultDate = this._getDefaultDate( inst ),
+			date = defaultDate,
+			settings = this._getFormatConfig( inst );
+
+		try {
+			date = this.parseDate( dateFormat, dates, settings ) || defaultDate;
+		} catch ( event ) {
+			dates = ( noDefault ? "" : dates );
+		}
+		inst.selectedDay = date.getDate();
+		inst.drawMonth = inst.selectedMonth = date.getMonth();
+		inst.drawYear = inst.selectedYear = date.getFullYear();
+		inst.currentDay = ( dates ? date.getDate() : 0 );
+		inst.currentMonth = ( dates ? date.getMonth() : 0 );
+		inst.currentYear = ( dates ? date.getFullYear() : 0 );
+		this._adjustInstDate( inst );
+	},
+
+	/* Retrieve the default date shown on opening. */
+	_getDefaultDate: function( inst ) {
+		return this._restrictMinMax( inst,
+			this._determineDate( inst, this._get( inst, "defaultDate" ), new Date() ) );
+	},
+
+	/* A date may be specified as an exact value or a relative one. */
+	_determineDate: function( inst, date, defaultDate ) {
+		var offsetNumeric = function( offset ) {
+				var date = new Date();
+				date.setDate( date.getDate() + offset );
+				return date;
+			},
+			offsetString = function( offset ) {
+				try {
+					return $.datepicker.parseDate( $.datepicker._get( inst, "dateFormat" ),
+						offset, $.datepicker._getFormatConfig( inst ) );
+				} catch ( e ) {
+
+					// Ignore
+				}
+
+				var date = ( offset.toLowerCase().match( /^c/ ) ?
+					$.datepicker._getDate( inst ) : null ) || new Date(),
+					year = date.getFullYear(),
+					month = date.getMonth(),
+					day = date.getDate(),
+					pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
+					matches = pattern.exec( offset );
+
+				while ( matches ) {
+					switch ( matches[ 2 ] || "d" ) {
+						case "d" : case "D" :
+							day += parseInt( matches[ 1 ], 10 ); break;
+						case "w" : case "W" :
+							day += parseInt( matches[ 1 ], 10 ) * 7; break;
+						case "m" : case "M" :
+							month += parseInt( matches[ 1 ], 10 );
+							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
+							break;
+						case "y": case "Y" :
+							year += parseInt( matches[ 1 ], 10 );
+							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
+							break;
+					}
+					matches = pattern.exec( offset );
+				}
+				return new Date( year, month, day );
+			},
+			newDate = ( date == null || date === "" ? defaultDate : ( typeof date === "string" ? offsetString( date ) :
+				( typeof date === "number" ? ( isNaN( date ) ? defaultDate : offsetNumeric( date ) ) : new Date( date.getTime() ) ) ) );
+
+		newDate = ( newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate );
+		if ( newDate ) {
+			newDate.setHours( 0 );
+			newDate.setMinutes( 0 );
+			newDate.setSeconds( 0 );
+			newDate.setMilliseconds( 0 );
+		}
+		return this._daylightSavingAdjust( newDate );
+	},
+
+	/* Handle switch to/from daylight saving.
+	 * Hours may be non-zero on daylight saving cut-over:
+	 * > 12 when midnight changeover, but then cannot generate
+	 * midnight datetime, so jump to 1AM, otherwise reset.
+	 * @param  date  (Date) the date to check
+	 * @return  (Date) the corrected date
+	 */
+	_daylightSavingAdjust: function( date ) {
+		if ( !date ) {
+			return null;
+		}
+		date.setHours( date.getHours() > 12 ? date.getHours() + 2 : 0 );
+		return date;
+	},
+
+	/* Set the date(s) directly. */
+	_setDate: function( inst, date, noChange ) {
+		var clear = !date,
+			origMonth = inst.selectedMonth,
+			origYear = inst.selectedYear,
+			newDate = this._restrictMinMax( inst, this._determineDate( inst, date, new Date() ) );
+
+		inst.selectedDay = inst.currentDay = newDate.getDate();
+		inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
+		inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
+		if ( ( origMonth !== inst.selectedMonth || origYear !== inst.selectedYear ) && !noChange ) {
+			this._notifyChange( inst );
+		}
+		this._adjustInstDate( inst );
+		if ( inst.input ) {
+			inst.input.val( clear ? "" : this._formatDate( inst ) );
+		}
+	},
+
+	/* Retrieve the date(s) directly. */
+	_getDate: function( inst ) {
+		var startDate = ( !inst.currentYear || ( inst.input && inst.input.val() === "" ) ? null :
+			this._daylightSavingAdjust( new Date(
+			inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
+			return startDate;
+	},
+
+	/* Attach the onxxx handlers.  These are declared statically so
+	 * they work with static code transformers like Caja.
+	 */
+	_attachHandlers: function( inst ) {
+		var stepMonths = this._get( inst, "stepMonths" ),
+			id = "#" + inst.id.replace( /\\\\/g, "\\" );
+		inst.dpDiv.find( "[data-handler]" ).map( function() {
+			var handler = {
+				prev: function() {
+					$.datepicker._adjustDate( id, -stepMonths, "M" );
+				},
+				next: function() {
+					$.datepicker._adjustDate( id, +stepMonths, "M" );
+				},
+				hide: function() {
+					$.datepicker._hideDatepicker();
+				},
+				today: function() {
+					$.datepicker._gotoToday( id );
+				},
+				selectDay: function() {
+					$.datepicker._selectDay( id, +this.getAttribute( "data-month" ), +this.getAttribute( "data-year" ), this );
+					return false;
+				},
+				selectMonth: function() {
+					$.datepicker._selectMonthYear( id, this, "M" );
+					return false;
+				},
+				selectYear: function() {
+					$.datepicker._selectMonthYear( id, this, "Y" );
+					return false;
+				}
+			};
+			$( this ).on( this.getAttribute( "data-event" ), handler[ this.getAttribute( "data-handler" ) ] );
+		} );
+	},
+
+	/* Generate the HTML for the current state of the date picker. */
+	_generateHTML: function( inst ) {
+		var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
+			controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
+			monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
+			selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
+			cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
+			printDate, dRow, tbody, daySettings, otherMonth, unselectable,
+			tempDate = new Date(),
+			today = this._daylightSavingAdjust(
+				new Date( tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate() ) ), // clear time
+			isRTL = this._get( inst, "isRTL" ),
+			showButtonPanel = this._get( inst, "showButtonPanel" ),
+			hideIfNoPrevNext = this._get( inst, "hideIfNoPrevNext" ),
+			navigationAsDateFormat = this._get( inst, "navigationAsDateFormat" ),
+			numMonths = this._getNumberOfMonths( inst ),
+			showCurrentAtPos = this._get( inst, "showCurrentAtPos" ),
+			stepMonths = this._get( inst, "stepMonths" ),
+			isMultiMonth = ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ),
+			currentDate = this._daylightSavingAdjust( ( !inst.currentDay ? new Date( 9999, 9, 9 ) :
+				new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) ),
+			minDate = this._getMinMaxDate( inst, "min" ),
+			maxDate = this._getMinMaxDate( inst, "max" ),
+			drawMonth = inst.drawMonth - showCurrentAtPos,
+			drawYear = inst.drawYear;
+
+		if ( drawMonth < 0 ) {
+			drawMonth += 12;
+			drawYear--;
+		}
+		if ( maxDate ) {
+			maxDraw = this._daylightSavingAdjust( new Date( maxDate.getFullYear(),
+				maxDate.getMonth() - ( numMonths[ 0 ] * numMonths[ 1 ] ) + 1, maxDate.getDate() ) );
+			maxDraw = ( minDate && maxDraw < minDate ? minDate : maxDraw );
+			while ( this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 ) ) > maxDraw ) {
+				drawMonth--;
+				if ( drawMonth < 0 ) {
+					drawMonth = 11;
+					drawYear--;
+				}
+			}
+		}
+		inst.drawMonth = drawMonth;
+		inst.drawYear = drawYear;
+
+		prevText = this._get( inst, "prevText" );
+		prevText = ( !navigationAsDateFormat ? prevText : this.formatDate( prevText,
+			this._daylightSavingAdjust( new Date( drawYear, drawMonth - stepMonths, 1 ) ),
+			this._getFormatConfig( inst ) ) );
+
+		if ( this._canAdjustMonth( inst, -1, drawYear, drawMonth ) ) {
+			prev = $( "<a>" )
+				.attr( {
+					"class": "ui-datepicker-prev ui-corner-all",
+					"data-handler": "prev",
+					"data-event": "click",
+					title: prevText
+				} )
+				.append(
+					$( "<span>" )
+						.addClass( "ui-icon ui-icon-circle-triangle-" +
+							( isRTL ? "e" : "w" ) )
+						.text( prevText )
+				)[ 0 ].outerHTML;
+		} else if ( hideIfNoPrevNext ) {
+			prev = "";
+		} else {
+			prev = $( "<a>" )
+				.attr( {
+					"class": "ui-datepicker-prev ui-corner-all ui-state-disabled",
+					title: prevText
+				} )
+				.append(
+					$( "<span>" )
+						.addClass( "ui-icon ui-icon-circle-triangle-" +
+							( isRTL ? "e" : "w" ) )
+						.text( prevText )
+				)[ 0 ].outerHTML;
+		}
+
+		nextText = this._get( inst, "nextText" );
+		nextText = ( !navigationAsDateFormat ? nextText : this.formatDate( nextText,
+			this._daylightSavingAdjust( new Date( drawYear, drawMonth + stepMonths, 1 ) ),
+			this._getFormatConfig( inst ) ) );
+
+		if ( this._canAdjustMonth( inst, +1, drawYear, drawMonth ) ) {
+			next = $( "<a>" )
+				.attr( {
+					"class": "ui-datepicker-next ui-corner-all",
+					"data-handler": "next",
+					"data-event": "click",
+					title: nextText
+				} )
+				.append(
+					$( "<span>" )
+						.addClass( "ui-icon ui-icon-circle-triangle-" +
+							( isRTL ? "w" : "e" ) )
+						.text( nextText )
+				)[ 0 ].outerHTML;
+		} else if ( hideIfNoPrevNext ) {
+			next = "";
+		} else {
+			next = $( "<a>" )
+				.attr( {
+					"class": "ui-datepicker-next ui-corner-all ui-state-disabled",
+					title: nextText
+				} )
+				.append(
+					$( "<span>" )
+						.attr( "class", "ui-icon ui-icon-circle-triangle-" +
+							( isRTL ? "w" : "e" ) )
+						.text( nextText )
+				)[ 0 ].outerHTML;
+		}
+
+		currentText = this._get( inst, "currentText" );
+		gotoDate = ( this._get( inst, "gotoCurrent" ) && inst.currentDay ? currentDate : today );
+		currentText = ( !navigationAsDateFormat ? currentText :
+			this.formatDate( currentText, gotoDate, this._getFormatConfig( inst ) ) );
+
+		controls = "";
+		if ( !inst.inline ) {
+			controls = $( "<button>" )
+				.attr( {
+					type: "button",
+					"class": "ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all",
+					"data-handler": "hide",
+					"data-event": "click"
+				} )
+				.text( this._get( inst, "closeText" ) )[ 0 ].outerHTML;
+		}
+
+		buttonPanel = "";
+		if ( showButtonPanel ) {
+			buttonPanel = $( "<div class='ui-datepicker-buttonpane ui-widget-content'>" )
+				.append( isRTL ? controls : "" )
+				.append( this._isInRange( inst, gotoDate ) ?
+					$( "<button>" )
+						.attr( {
+							type: "button",
+							"class": "ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all",
+							"data-handler": "today",
+							"data-event": "click"
+						} )
+						.text( currentText ) :
+					"" )
+				.append( isRTL ? "" : controls )[ 0 ].outerHTML;
+		}
+
+		firstDay = parseInt( this._get( inst, "firstDay" ), 10 );
+		firstDay = ( isNaN( firstDay ) ? 0 : firstDay );
+
+		showWeek = this._get( inst, "showWeek" );
+		dayNames = this._get( inst, "dayNames" );
+		dayNamesMin = this._get( inst, "dayNamesMin" );
+		monthNames = this._get( inst, "monthNames" );
+		monthNamesShort = this._get( inst, "monthNamesShort" );
+		beforeShowDay = this._get( inst, "beforeShowDay" );
+		showOtherMonths = this._get( inst, "showOtherMonths" );
+		selectOtherMonths = this._get( inst, "selectOtherMonths" );
+		defaultDate = this._getDefaultDate( inst );
+		html = "";
+
+		for ( row = 0; row < numMonths[ 0 ]; row++ ) {
+			group = "";
+			this.maxRows = 4;
+			for ( col = 0; col < numMonths[ 1 ]; col++ ) {
+				selectedDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, inst.selectedDay ) );
+				cornerClass = " ui-corner-all";
+				calender = "";
+				if ( isMultiMonth ) {
+					calender += "<div class='ui-datepicker-group";
+					if ( numMonths[ 1 ] > 1 ) {
+						switch ( col ) {
+							case 0: calender += " ui-datepicker-group-first";
+								cornerClass = " ui-corner-" + ( isRTL ? "right" : "left" ); break;
+							case numMonths[ 1 ] - 1: calender += " ui-datepicker-group-last";
+								cornerClass = " ui-corner-" + ( isRTL ? "left" : "right" ); break;
+							default: calender += " ui-datepicker-group-middle"; cornerClass = ""; break;
+						}
+					}
+					calender += "'>";
+				}
+				calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
+					( /all|left/.test( cornerClass ) && row === 0 ? ( isRTL ? next : prev ) : "" ) +
+					( /all|right/.test( cornerClass ) && row === 0 ? ( isRTL ? prev : next ) : "" ) +
+					this._generateMonthYearHeader( inst, drawMonth, drawYear, minDate, maxDate,
+					row > 0 || col > 0, monthNames, monthNamesShort ) + // draw month headers
+					"</div><table class='ui-datepicker-calendar'><thead>" +
+					"<tr>";
+				thead = ( showWeek ? "<th class='ui-datepicker-week-col'>" + this._get( inst, "weekHeader" ) + "</th>" : "" );
+				for ( dow = 0; dow < 7; dow++ ) { // days of the week
+					day = ( dow + firstDay ) % 7;
+					thead += "<th scope='col'" + ( ( dow + firstDay + 6 ) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "" ) + ">" +
+						"<span title='" + dayNames[ day ] + "'>" + dayNamesMin[ day ] + "</span></th>";
+				}
+				calender += thead + "</tr></thead><tbody>";
+				daysInMonth = this._getDaysInMonth( drawYear, drawMonth );
+				if ( drawYear === inst.selectedYear && drawMonth === inst.selectedMonth ) {
+					inst.selectedDay = Math.min( inst.selectedDay, daysInMonth );
+				}
+				leadDays = ( this._getFirstDayOfMonth( drawYear, drawMonth ) - firstDay + 7 ) % 7;
+				curRows = Math.ceil( ( leadDays + daysInMonth ) / 7 ); // calculate the number of rows to generate
+				numRows = ( isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows ); //If multiple months, use the higher number of rows (see #7043)
+				this.maxRows = numRows;
+				printDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 - leadDays ) );
+				for ( dRow = 0; dRow < numRows; dRow++ ) { // create date picker rows
+					calender += "<tr>";
+					tbody = ( !showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
+						this._get( inst, "calculateWeek" )( printDate ) + "</td>" );
+					for ( dow = 0; dow < 7; dow++ ) { // create date picker days
+						daySettings = ( beforeShowDay ?
+							beforeShowDay.apply( ( inst.input ? inst.input[ 0 ] : null ), [ printDate ] ) : [ true, "" ] );
+						otherMonth = ( printDate.getMonth() !== drawMonth );
+						unselectable = ( otherMonth && !selectOtherMonths ) || !daySettings[ 0 ] ||
+							( minDate && printDate < minDate ) || ( maxDate && printDate > maxDate );
+						tbody += "<td class='" +
+							( ( dow + firstDay + 6 ) % 7 >= 5 ? " ui-datepicker-week-end" : "" ) + // highlight weekends
+							( otherMonth ? " ui-datepicker-other-month" : "" ) + // highlight days from other months
+							( ( printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent ) || // user pressed key
+							( defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime() ) ?
+
+							// or defaultDate is current printedDate and defaultDate is selectedDate
+							" " + this._dayOverClass : "" ) + // highlight selected day
+							( unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "" ) +  // highlight unselectable days
+							( otherMonth && !showOtherMonths ? "" : " " + daySettings[ 1 ] + // highlight custom dates
+							( printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "" ) + // highlight selected day
+							( printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "" ) ) + "'" + // highlight today (if different)
+							( ( !otherMonth || showOtherMonths ) && daySettings[ 2 ] ? " title='" + daySettings[ 2 ].replace( /'/g, "&#39;" ) + "'" : "" ) + // cell title
+							( unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'" ) + ">" + // actions
+							( otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
+							( unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
+							( printDate.getTime() === today.getTime() ? " ui-state-highlight" : "" ) +
+							( printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "" ) + // highlight selected day
+							( otherMonth ? " ui-priority-secondary" : "" ) + // distinguish dates from other months
+							"' href='#' aria-current='" + ( printDate.getTime() === currentDate.getTime() ? "true" : "false" ) + // mark date as selected for screen reader
+							"' data-date='" + printDate.getDate() + // store date as data
+							"'>" + printDate.getDate() + "</a>" ) ) + "</td>"; // display selectable date
+						printDate.setDate( printDate.getDate() + 1 );
+						printDate = this._daylightSavingAdjust( printDate );
+					}
+					calender += tbody + "</tr>";
+				}
+				drawMonth++;
+				if ( drawMonth > 11 ) {
+					drawMonth = 0;
+					drawYear++;
+				}
+				calender += "</tbody></table>" + ( isMultiMonth ? "</div>" +
+							( ( numMonths[ 0 ] > 0 && col === numMonths[ 1 ] - 1 ) ? "<div class='ui-datepicker-row-break'></div>" : "" ) : "" );
+				group += calender;
+			}
+			html += group;
+		}
+		html += buttonPanel;
+		inst._keyEvent = false;
+		return html;
+	},
+
+	/* Generate the month and year header. */
+	_generateMonthYearHeader: function( inst, drawMonth, drawYear, minDate, maxDate,
+			secondary, monthNames, monthNamesShort ) {
+
+		var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
+			changeMonth = this._get( inst, "changeMonth" ),
+			changeYear = this._get( inst, "changeYear" ),
+			showMonthAfterYear = this._get( inst, "showMonthAfterYear" ),
+			selectMonthLabel = this._get( inst, "selectMonthLabel" ),
+			selectYearLabel = this._get( inst, "selectYearLabel" ),
+			html = "<div class='ui-datepicker-title'>",
+			monthHtml = "";
+
+		// Month selection
+		if ( secondary || !changeMonth ) {
+			monthHtml += "<span class='ui-datepicker-month'>" + monthNames[ drawMonth ] + "</span>";
+		} else {
+			inMinYear = ( minDate && minDate.getFullYear() === drawYear );
+			inMaxYear = ( maxDate && maxDate.getFullYear() === drawYear );
+			monthHtml += "<select class='ui-datepicker-month' aria-label='" + selectMonthLabel + "' data-handler='selectMonth' data-event='change'>";
+			for ( month = 0; month < 12; month++ ) {
+				if ( ( !inMinYear || month >= minDate.getMonth() ) && ( !inMaxYear || month <= maxDate.getMonth() ) ) {
+					monthHtml += "<option value='" + month + "'" +
+						( month === drawMonth ? " selected='selected'" : "" ) +
+						">" + monthNamesShort[ month ] + "</option>";
+				}
+			}
+			monthHtml += "</select>";
+		}
+
+		if ( !showMonthAfterYear ) {
+			html += monthHtml + ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" );
+		}
+
+		// Year selection
+		if ( !inst.yearshtml ) {
+			inst.yearshtml = "";
+			if ( secondary || !changeYear ) {
+				html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
+			} else {
+
+				// determine range of years to display
+				years = this._get( inst, "yearRange" ).split( ":" );
+				thisYear = new Date().getFullYear();
+				determineYear = function( value ) {
+					var year = ( value.match( /c[+\-].*/ ) ? drawYear + parseInt( value.substring( 1 ), 10 ) :
+						( value.match( /[+\-].*/ ) ? thisYear + parseInt( value, 10 ) :
+						parseInt( value, 10 ) ) );
+					return ( isNaN( year ) ? thisYear : year );
+				};
+				year = determineYear( years[ 0 ] );
+				endYear = Math.max( year, determineYear( years[ 1 ] || "" ) );
+				year = ( minDate ? Math.max( year, minDate.getFullYear() ) : year );
+				endYear = ( maxDate ? Math.min( endYear, maxDate.getFullYear() ) : endYear );
+				inst.yearshtml += "<select class='ui-datepicker-year' aria-label='" + selectYearLabel + "' data-handler='selectYear' data-event='change'>";
+				for ( ; year <= endYear; year++ ) {
+					inst.yearshtml += "<option value='" + year + "'" +
+						( year === drawYear ? " selected='selected'" : "" ) +
+						">" + year + "</option>";
+				}
+				inst.yearshtml += "</select>";
+
+				html += inst.yearshtml;
+				inst.yearshtml = null;
+			}
+		}
+
+		html += this._get( inst, "yearSuffix" );
+		if ( showMonthAfterYear ) {
+			html += ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" ) + monthHtml;
+		}
+		html += "</div>"; // Close datepicker_header
+		return html;
+	},
+
+	/* Adjust one of the date sub-fields. */
+	_adjustInstDate: function( inst, offset, period ) {
+		var year = inst.selectedYear + ( period === "Y" ? offset : 0 ),
+			month = inst.selectedMonth + ( period === "M" ? offset : 0 ),
+			day = Math.min( inst.selectedDay, this._getDaysInMonth( year, month ) ) + ( period === "D" ? offset : 0 ),
+			date = this._restrictMinMax( inst, this._daylightSavingAdjust( new Date( year, month, day ) ) );
+
+		inst.selectedDay = date.getDate();
+		inst.drawMonth = inst.selectedMonth = date.getMonth();
+		inst.drawYear = inst.selectedYear = date.getFullYear();
+		if ( period === "M" || period === "Y" ) {
+			this._notifyChange( inst );
+		}
+	},
+
+	/* Ensure a date is within any min/max bounds. */
+	_restrictMinMax: function( inst, date ) {
+		var minDate = this._getMinMaxDate( inst, "min" ),
+			maxDate = this._getMinMaxDate( inst, "max" ),
+			newDate = ( minDate && date < minDate ? minDate : date );
+		return ( maxDate && newDate > maxDate ? maxDate : newDate );
+	},
+
+	/* Notify change of month/year. */
+	_notifyChange: function( inst ) {
+		var onChange = this._get( inst, "onChangeMonthYear" );
+		if ( onChange ) {
+			onChange.apply( ( inst.input ? inst.input[ 0 ] : null ),
+				[ inst.selectedYear, inst.selectedMonth + 1, inst ] );
+		}
+	},
+
+	/* Determine the number of months to show. */
+	_getNumberOfMonths: function( inst ) {
+		var numMonths = this._get( inst, "numberOfMonths" );
+		return ( numMonths == null ? [ 1, 1 ] : ( typeof numMonths === "number" ? [ 1, numMonths ] : numMonths ) );
+	},
+
+	/* Determine the current maximum date - ensure no time components are set. */
+	_getMinMaxDate: function( inst, minMax ) {
+		return this._determineDate( inst, this._get( inst, minMax + "Date" ), null );
+	},
+
+	/* Find the number of days in a given month. */
+	_getDaysInMonth: function( year, month ) {
+		return 32 - this._daylightSavingAdjust( new Date( year, month, 32 ) ).getDate();
+	},
+
+	/* Find the day of the week of the first of a month. */
+	_getFirstDayOfMonth: function( year, month ) {
+		return new Date( year, month, 1 ).getDay();
+	},
+
+	/* Determines if we should allow a "next/prev" month display change. */
+	_canAdjustMonth: function( inst, offset, curYear, curMonth ) {
+		var numMonths = this._getNumberOfMonths( inst ),
+			date = this._daylightSavingAdjust( new Date( curYear,
+			curMonth + ( offset < 0 ? offset : numMonths[ 0 ] * numMonths[ 1 ] ), 1 ) );
+
+		if ( offset < 0 ) {
+			date.setDate( this._getDaysInMonth( date.getFullYear(), date.getMonth() ) );
+		}
+		return this._isInRange( inst, date );
+	},
+
+	/* Is the given date in the accepted range? */
+	_isInRange: function( inst, date ) {
+		var yearSplit, currentYear,
+			minDate = this._getMinMaxDate( inst, "min" ),
+			maxDate = this._getMinMaxDate( inst, "max" ),
+			minYear = null,
+			maxYear = null,
+			years = this._get( inst, "yearRange" );
+			if ( years ) {
+				yearSplit = years.split( ":" );
+				currentYear = new Date().getFullYear();
+				minYear = parseInt( yearSplit[ 0 ], 10 );
+				maxYear = parseInt( yearSplit[ 1 ], 10 );
+				if ( yearSplit[ 0 ].match( /[+\-].*/ ) ) {
+					minYear += currentYear;
+				}
+				if ( yearSplit[ 1 ].match( /[+\-].*/ ) ) {
+					maxYear += currentYear;
+				}
+			}
+
+		return ( ( !minDate || date.getTime() >= minDate.getTime() ) &&
+			( !maxDate || date.getTime() <= maxDate.getTime() ) &&
+			( !minYear || date.getFullYear() >= minYear ) &&
+			( !maxYear || date.getFullYear() <= maxYear ) );
+	},
+
+	/* Provide the configuration settings for formatting/parsing. */
+	_getFormatConfig: function( inst ) {
+		var shortYearCutoff = this._get( inst, "shortYearCutoff" );
+		shortYearCutoff = ( typeof shortYearCutoff !== "string" ? shortYearCutoff :
+			new Date().getFullYear() % 100 + parseInt( shortYearCutoff, 10 ) );
+		return { shortYearCutoff: shortYearCutoff,
+			dayNamesShort: this._get( inst, "dayNamesShort" ), dayNames: this._get( inst, "dayNames" ),
+			monthNamesShort: this._get( inst, "monthNamesShort" ), monthNames: this._get( inst, "monthNames" ) };
+	},
+
+	/* Format the given date for display. */
+	_formatDate: function( inst, day, month, year ) {
+		if ( !day ) {
+			inst.currentDay = inst.selectedDay;
+			inst.currentMonth = inst.selectedMonth;
+			inst.currentYear = inst.selectedYear;
+		}
+		var date = ( day ? ( typeof day === "object" ? day :
+			this._daylightSavingAdjust( new Date( year, month, day ) ) ) :
+			this._daylightSavingAdjust( new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
+		return this.formatDate( this._get( inst, "dateFormat" ), date, this._getFormatConfig( inst ) );
+	}
+} );
+
+/*
+ * Bind hover events for datepicker elements.
+ * Done via delegate so the binding only occurs once in the lifetime of the parent div.
+ * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
+ */
+function datepicker_bindHover( dpDiv ) {
+	var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
+	return dpDiv.on( "mouseout", selector, function() {
+			$( this ).removeClass( "ui-state-hover" );
+			if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
+				$( this ).removeClass( "ui-datepicker-prev-hover" );
+			}
+			if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
+				$( this ).removeClass( "ui-datepicker-next-hover" );
+			}
+		} )
+		.on( "mouseover", selector, datepicker_handleMouseover );
+}
+
+function datepicker_handleMouseover() {
+	if ( !$.datepicker._isDisabledDatepicker( datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[ 0 ] : datepicker_instActive.input[ 0 ] ) ) {
+		$( this ).parents( ".ui-datepicker-calendar" ).find( "a" ).removeClass( "ui-state-hover" );
+		$( this ).addClass( "ui-state-hover" );
+		if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
+			$( this ).addClass( "ui-datepicker-prev-hover" );
+		}
+		if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
+			$( this ).addClass( "ui-datepicker-next-hover" );
+		}
+	}
+}
+
+/* jQuery extend now ignores nulls! */
+function datepicker_extendRemove( target, props ) {
+	$.extend( target, props );
+	for ( var name in props ) {
+		if ( props[ name ] == null ) {
+			target[ name ] = props[ name ];
+		}
+	}
+	return target;
+}
+
+/* Invoke the datepicker functionality.
+   @param  options  string - a command, optionally followed by additional parameters or
+					Object - settings for attaching new datepicker functionality
+   @return  jQuery object */
+$.fn.datepicker = function( options ) {
+
+	/* Verify an empty collection wasn't passed - Fixes #6976 */
+	if ( !this.length ) {
+		return this;
+	}
+
+	/* Initialise the date picker. */
+	if ( !$.datepicker.initialized ) {
+		$( document ).on( "mousedown", $.datepicker._checkExternalClick );
+		$.datepicker.initialized = true;
+	}
+
+	/* Append datepicker main container to body if not exist. */
+	if ( $( "#" + $.datepicker._mainDivId ).length === 0 ) {
+		$( "body" ).append( $.datepicker.dpDiv );
+	}
+
+	var otherArgs = Array.prototype.slice.call( arguments, 1 );
+	if ( typeof options === "string" && ( options === "isDisabled" || options === "getDate" || options === "widget" ) ) {
+		return $.datepicker[ "_" + options + "Datepicker" ].
+			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
+	}
+	if ( options === "option" && arguments.length === 2 && typeof arguments[ 1 ] === "string" ) {
+		return $.datepicker[ "_" + options + "Datepicker" ].
+			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
+	}
+	return this.each( function() {
+		if ( typeof options === "string" ) {
+			$.datepicker[ "_" + options + "Datepicker" ]
+				.apply( $.datepicker, [ this ].concat( otherArgs ) );
+		} else {
+			$.datepicker._attachDatepicker( this, options );
+		}
+	} );
+};
+
+$.datepicker = new Datepicker(); // singleton instance
+$.datepicker.initialized = false;
+$.datepicker.uuid = new Date().getTime();
+$.datepicker.version = "1.13.2";
+
+var widgetsDatepicker = $.datepicker;
+
+
+
+// This file is deprecated
+var ie = $.ui.ie = !!/msie [\w.]+/.exec( navigator.userAgent.toLowerCase() );
+
+/*!
+ * jQuery UI Mouse 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Mouse
+//>>group: Widgets
+//>>description: Abstracts mouse-based interactions to assist in creating certain widgets.
+//>>docs: http://api.jqueryui.com/mouse/
+
+
+var mouseHandled = false;
+$( document ).on( "mouseup", function() {
+	mouseHandled = false;
+} );
+
+var widgetsMouse = $.widget( "ui.mouse", {
+	version: "1.13.2",
+	options: {
+		cancel: "input, textarea, button, select, option",
+		distance: 1,
+		delay: 0
+	},
+	_mouseInit: function() {
+		var that = this;
+
+		this.element
+			.on( "mousedown." + this.widgetName, function( event ) {
+				return that._mouseDown( event );
+			} )
+			.on( "click." + this.widgetName, function( event ) {
+				if ( true === $.data( event.target, that.widgetName + ".preventClickEvent" ) ) {
+					$.removeData( event.target, that.widgetName + ".preventClickEvent" );
+					event.stopImmediatePropagation();
+					return false;
+				}
+			} );
+
+		this.started = false;
+	},
+
+	// TODO: make sure destroying one instance of mouse doesn't mess with
+	// other instances of mouse
+	_mouseDestroy: function() {
+		this.element.off( "." + this.widgetName );
+		if ( this._mouseMoveDelegate ) {
+			this.document
+				.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
+				.off( "mouseup." + this.widgetName, this._mouseUpDelegate );
+		}
+	},
+
+	_mouseDown: function( event ) {
+
+		// don't let more than one widget handle mouseStart
+		if ( mouseHandled ) {
+			return;
+		}
+
+		this._mouseMoved = false;
+
+		// We may have missed mouseup (out of window)
+		if ( this._mouseStarted ) {
+			this._mouseUp( event );
+		}
+
+		this._mouseDownEvent = event;
+
+		var that = this,
+			btnIsLeft = ( event.which === 1 ),
+
+			// event.target.nodeName works around a bug in IE 8 with
+			// disabled inputs (#7620)
+			elIsCancel = ( typeof this.options.cancel === "string" && event.target.nodeName ?
+				$( event.target ).closest( this.options.cancel ).length : false );
+		if ( !btnIsLeft || elIsCancel || !this._mouseCapture( event ) ) {
+			return true;
+		}
+
+		this.mouseDelayMet = !this.options.delay;
+		if ( !this.mouseDelayMet ) {
+			this._mouseDelayTimer = setTimeout( function() {
+				that.mouseDelayMet = true;
+			}, this.options.delay );
+		}
+
+		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
+			this._mouseStarted = ( this._mouseStart( event ) !== false );
+			if ( !this._mouseStarted ) {
+				event.preventDefault();
+				return true;
+			}
+		}
+
+		// Click event may never have fired (Gecko & Opera)
+		if ( true === $.data( event.target, this.widgetName + ".preventClickEvent" ) ) {
+			$.removeData( event.target, this.widgetName + ".preventClickEvent" );
+		}
+
+		// These delegates are required to keep context
+		this._mouseMoveDelegate = function( event ) {
+			return that._mouseMove( event );
+		};
+		this._mouseUpDelegate = function( event ) {
+			return that._mouseUp( event );
+		};
+
+		this.document
+			.on( "mousemove." + this.widgetName, this._mouseMoveDelegate )
+			.on( "mouseup." + this.widgetName, this._mouseUpDelegate );
+
+		event.preventDefault();
+
+		mouseHandled = true;
+		return true;
+	},
+
+	_mouseMove: function( event ) {
+
+		// Only check for mouseups outside the document if you've moved inside the document
+		// at least once. This prevents the firing of mouseup in the case of IE<9, which will
+		// fire a mousemove event if content is placed under the cursor. See #7778
+		// Support: IE <9
+		if ( this._mouseMoved ) {
+
+			// IE mouseup check - mouseup happened when mouse was out of window
+			if ( $.ui.ie && ( !document.documentMode || document.documentMode < 9 ) &&
+					!event.button ) {
+				return this._mouseUp( event );
+
+			// Iframe mouseup check - mouseup occurred in another document
+			} else if ( !event.which ) {
+
+				// Support: Safari <=8 - 9
+				// Safari sets which to 0 if you press any of the following keys
+				// during a drag (#14461)
+				if ( event.originalEvent.altKey || event.originalEvent.ctrlKey ||
+						event.originalEvent.metaKey || event.originalEvent.shiftKey ) {
+					this.ignoreMissingWhich = true;
+				} else if ( !this.ignoreMissingWhich ) {
+					return this._mouseUp( event );
+				}
+			}
+		}
+
+		if ( event.which || event.button ) {
+			this._mouseMoved = true;
+		}
+
+		if ( this._mouseStarted ) {
+			this._mouseDrag( event );
+			return event.preventDefault();
+		}
+
+		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
+			this._mouseStarted =
+				( this._mouseStart( this._mouseDownEvent, event ) !== false );
+			if ( this._mouseStarted ) {
+				this._mouseDrag( event );
+			} else {
+				this._mouseUp( event );
+			}
+		}
+
+		return !this._mouseStarted;
+	},
+
+	_mouseUp: function( event ) {
+		this.document
+			.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
+			.off( "mouseup." + this.widgetName, this._mouseUpDelegate );
+
+		if ( this._mouseStarted ) {
+			this._mouseStarted = false;
+
+			if ( event.target === this._mouseDownEvent.target ) {
+				$.data( event.target, this.widgetName + ".preventClickEvent", true );
+			}
+
+			this._mouseStop( event );
+		}
+
+		if ( this._mouseDelayTimer ) {
+			clearTimeout( this._mouseDelayTimer );
+			delete this._mouseDelayTimer;
+		}
+
+		this.ignoreMissingWhich = false;
+		mouseHandled = false;
+		event.preventDefault();
+	},
+
+	_mouseDistanceMet: function( event ) {
+		return ( Math.max(
+				Math.abs( this._mouseDownEvent.pageX - event.pageX ),
+				Math.abs( this._mouseDownEvent.pageY - event.pageY )
+			) >= this.options.distance
+		);
+	},
+
+	_mouseDelayMet: function( /* event */ ) {
+		return this.mouseDelayMet;
+	},
+
+	// These are placeholder methods, to be overriden by extending plugin
+	_mouseStart: function( /* event */ ) {},
+	_mouseDrag: function( /* event */ ) {},
+	_mouseStop: function( /* event */ ) {},
+	_mouseCapture: function( /* event */ ) {
+		return true;
+	}
+} );
+
+
+
+// $.ui.plugin is deprecated. Use $.widget() extensions instead.
+var plugin = $.ui.plugin = {
+	add: function( module, option, set ) {
+		var i,
+			proto = $.ui[ module ].prototype;
+		for ( i in set ) {
+			proto.plugins[ i ] = proto.plugins[ i ] || [];
+			proto.plugins[ i ].push( [ option, set[ i ] ] );
+		}
+	},
+	call: function( instance, name, args, allowDisconnected ) {
+		var i,
+			set = instance.plugins[ name ];
+
+		if ( !set ) {
+			return;
+		}
+
+		if ( !allowDisconnected && ( !instance.element[ 0 ].parentNode ||
+				instance.element[ 0 ].parentNode.nodeType === 11 ) ) {
+			return;
+		}
+
+		for ( i = 0; i < set.length; i++ ) {
+			if ( instance.options[ set[ i ][ 0 ] ] ) {
+				set[ i ][ 1 ].apply( instance.element, args );
+			}
+		}
+	}
+};
+
+
+
+var safeBlur = $.ui.safeBlur = function( element ) {
+
+	// Support: IE9 - 10 only
+	// If the <body> is blurred, IE will switch windows, see #9420
+	if ( element && element.nodeName.toLowerCase() !== "body" ) {
+		$( element ).trigger( "blur" );
+	}
+};
+
+
+/*!
+ * jQuery UI Draggable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Draggable
+//>>group: Interactions
+//>>description: Enables dragging functionality for any element.
+//>>docs: http://api.jqueryui.com/draggable/
+//>>demos: http://jqueryui.com/draggable/
+//>>css.structure: ../../themes/base/draggable.css
+
+
+$.widget( "ui.draggable", $.ui.mouse, {
+	version: "1.13.2",
+	widgetEventPrefix: "drag",
+	options: {
+		addClasses: true,
+		appendTo: "parent",
+		axis: false,
+		connectToSortable: false,
+		containment: false,
+		cursor: "auto",
+		cursorAt: false,
+		grid: false,
+		handle: false,
+		helper: "original",
+		iframeFix: false,
+		opacity: false,
+		refreshPositions: false,
+		revert: false,
+		revertDuration: 500,
+		scope: "default",
+		scroll: true,
+		scrollSensitivity: 20,
+		scrollSpeed: 20,
+		snap: false,
+		snapMode: "both",
+		snapTolerance: 20,
+		stack: false,
+		zIndex: false,
+
+		// Callbacks
+		drag: null,
+		start: null,
+		stop: null
+	},
+	_create: function() {
+
+		if ( this.options.helper === "original" ) {
+			this._setPositionRelative();
+		}
+		if ( this.options.addClasses ) {
+			this._addClass( "ui-draggable" );
+		}
+		this._setHandleClassName();
+
+		this._mouseInit();
+	},
+
+	_setOption: function( key, value ) {
+		this._super( key, value );
+		if ( key === "handle" ) {
+			this._removeHandleClassName();
+			this._setHandleClassName();
+		}
+	},
+
+	_destroy: function() {
+		if ( ( this.helper || this.element ).is( ".ui-draggable-dragging" ) ) {
+			this.destroyOnClear = true;
+			return;
+		}
+		this._removeHandleClassName();
+		this._mouseDestroy();
+	},
+
+	_mouseCapture: function( event ) {
+		var o = this.options;
+
+		// Among others, prevent a drag on a resizable-handle
+		if ( this.helper || o.disabled ||
+				$( event.target ).closest( ".ui-resizable-handle" ).length > 0 ) {
+			return false;
+		}
+
+		//Quit if we're not on a valid handle
+		this.handle = this._getHandle( event );
+		if ( !this.handle ) {
+			return false;
+		}
+
+		this._blurActiveElement( event );
+
+		this._blockFrames( o.iframeFix === true ? "iframe" : o.iframeFix );
+
+		return true;
+
+	},
+
+	_blockFrames: function( selector ) {
+		this.iframeBlocks = this.document.find( selector ).map( function() {
+			var iframe = $( this );
+
+			return $( "<div>" )
+				.css( "position", "absolute" )
+				.appendTo( iframe.parent() )
+				.outerWidth( iframe.outerWidth() )
+				.outerHeight( iframe.outerHeight() )
+				.offset( iframe.offset() )[ 0 ];
+		} );
+	},
+
+	_unblockFrames: function() {
+		if ( this.iframeBlocks ) {
+			this.iframeBlocks.remove();
+			delete this.iframeBlocks;
+		}
+	},
+
+	_blurActiveElement: function( event ) {
+		var activeElement = $.ui.safeActiveElement( this.document[ 0 ] ),
+			target = $( event.target );
+
+		// Don't blur if the event occurred on an element that is within
+		// the currently focused element
+		// See #10527, #12472
+		if ( target.closest( activeElement ).length ) {
+			return;
+		}
+
+		// Blur any element that currently has focus, see #4261
+		$.ui.safeBlur( activeElement );
+	},
+
+	_mouseStart: function( event ) {
+
+		var o = this.options;
+
+		//Create and append the visible helper
+		this.helper = this._createHelper( event );
+
+		this._addClass( this.helper, "ui-draggable-dragging" );
+
+		//Cache the helper size
+		this._cacheHelperProportions();
+
+		//If ddmanager is used for droppables, set the global draggable
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.current = this;
+		}
+
+		/*
+		 * - Position generation -
+		 * This block generates everything position related - it's the core of draggables.
+		 */
+
+		//Cache the margins of the original element
+		this._cacheMargins();
+
+		//Store the helper's css position
+		this.cssPosition = this.helper.css( "position" );
+		this.scrollParent = this.helper.scrollParent( true );
+		this.offsetParent = this.helper.offsetParent();
+		this.hasFixedAncestor = this.helper.parents().filter( function() {
+				return $( this ).css( "position" ) === "fixed";
+			} ).length > 0;
+
+		//The element's absolute position on the page minus margins
+		this.positionAbs = this.element.offset();
+		this._refreshOffsets( event );
+
+		//Generate the original position
+		this.originalPosition = this.position = this._generatePosition( event, false );
+		this.originalPageX = event.pageX;
+		this.originalPageY = event.pageY;
+
+		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
+		if ( o.cursorAt ) {
+			this._adjustOffsetFromHelper( o.cursorAt );
+		}
+
+		//Set a containment if given in the options
+		this._setContainment();
+
+		//Trigger event + callbacks
+		if ( this._trigger( "start", event ) === false ) {
+			this._clear();
+			return false;
+		}
+
+		//Recache the helper size
+		this._cacheHelperProportions();
+
+		//Prepare the droppable offsets
+		if ( $.ui.ddmanager && !o.dropBehaviour ) {
+			$.ui.ddmanager.prepareOffsets( this, event );
+		}
+
+		// Execute the drag once - this causes the helper not to be visible before getting its
+		// correct position
+		this._mouseDrag( event, true );
+
+		// If the ddmanager is used for droppables, inform the manager that dragging has started
+		// (see #5003)
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.dragStart( this, event );
+		}
+
+		return true;
+	},
+
+	_refreshOffsets: function( event ) {
+		this.offset = {
+			top: this.positionAbs.top - this.margins.top,
+			left: this.positionAbs.left - this.margins.left,
+			scroll: false,
+			parent: this._getParentOffset(),
+			relative: this._getRelativeOffset()
+		};
+
+		this.offset.click = {
+			left: event.pageX - this.offset.left,
+			top: event.pageY - this.offset.top
+		};
+	},
+
+	_mouseDrag: function( event, noPropagation ) {
+
+		// reset any necessary cached properties (see #5009)
+		if ( this.hasFixedAncestor ) {
+			this.offset.parent = this._getParentOffset();
+		}
+
+		//Compute the helpers position
+		this.position = this._generatePosition( event, true );
+		this.positionAbs = this._convertPositionTo( "absolute" );
+
+		//Call plugins and callbacks and use the resulting position if something is returned
+		if ( !noPropagation ) {
+			var ui = this._uiHash();
+			if ( this._trigger( "drag", event, ui ) === false ) {
+				this._mouseUp( new $.Event( "mouseup", event ) );
+				return false;
+			}
+			this.position = ui.position;
+		}
+
+		this.helper[ 0 ].style.left = this.position.left + "px";
+		this.helper[ 0 ].style.top = this.position.top + "px";
+
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.drag( this, event );
+		}
+
+		return false;
+	},
+
+	_mouseStop: function( event ) {
+
+		//If we are using droppables, inform the manager about the drop
+		var that = this,
+			dropped = false;
+		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
+			dropped = $.ui.ddmanager.drop( this, event );
+		}
+
+		//if a drop comes from outside (a sortable)
+		if ( this.dropped ) {
+			dropped = this.dropped;
+			this.dropped = false;
+		}
+
+		if ( ( this.options.revert === "invalid" && !dropped ) ||
+				( this.options.revert === "valid" && dropped ) ||
+				this.options.revert === true || ( typeof this.options.revert === "function" &&
+				this.options.revert.call( this.element, dropped ) )
+		) {
+			$( this.helper ).animate(
+				this.originalPosition,
+				parseInt( this.options.revertDuration, 10 ),
+				function() {
+					if ( that._trigger( "stop", event ) !== false ) {
+						that._clear();
+					}
+				}
+			);
+		} else {
+			if ( this._trigger( "stop", event ) !== false ) {
+				this._clear();
+			}
+		}
+
+		return false;
+	},
+
+	_mouseUp: function( event ) {
+		this._unblockFrames();
+
+		// If the ddmanager is used for droppables, inform the manager that dragging has stopped
+		// (see #5003)
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.dragStop( this, event );
+		}
+
+		// Only need to focus if the event occurred on the draggable itself, see #10527
+		if ( this.handleElement.is( event.target ) ) {
+
+			// The interaction is over; whether or not the click resulted in a drag,
+			// focus the element
+			this.element.trigger( "focus" );
+		}
+
+		return $.ui.mouse.prototype._mouseUp.call( this, event );
+	},
+
+	cancel: function() {
+
+		if ( this.helper.is( ".ui-draggable-dragging" ) ) {
+			this._mouseUp( new $.Event( "mouseup", { target: this.element[ 0 ] } ) );
+		} else {
+			this._clear();
+		}
+
+		return this;
+
+	},
+
+	_getHandle: function( event ) {
+		return this.options.handle ?
+			!!$( event.target ).closest( this.element.find( this.options.handle ) ).length :
+			true;
+	},
+
+	_setHandleClassName: function() {
+		this.handleElement = this.options.handle ?
+			this.element.find( this.options.handle ) : this.element;
+		this._addClass( this.handleElement, "ui-draggable-handle" );
+	},
+
+	_removeHandleClassName: function() {
+		this._removeClass( this.handleElement, "ui-draggable-handle" );
+	},
+
+	_createHelper: function( event ) {
+
+		var o = this.options,
+			helperIsFunction = typeof o.helper === "function",
+			helper = helperIsFunction ?
+				$( o.helper.apply( this.element[ 0 ], [ event ] ) ) :
+				( o.helper === "clone" ?
+					this.element.clone().removeAttr( "id" ) :
+					this.element );
+
+		if ( !helper.parents( "body" ).length ) {
+			helper.appendTo( ( o.appendTo === "parent" ?
+				this.element[ 0 ].parentNode :
+				o.appendTo ) );
+		}
+
+		// Http://bugs.jqueryui.com/ticket/9446
+		// a helper function can return the original element
+		// which wouldn't have been set to relative in _create
+		if ( helperIsFunction && helper[ 0 ] === this.element[ 0 ] ) {
+			this._setPositionRelative();
+		}
+
+		if ( helper[ 0 ] !== this.element[ 0 ] &&
+				!( /(fixed|absolute)/ ).test( helper.css( "position" ) ) ) {
+			helper.css( "position", "absolute" );
+		}
+
+		return helper;
+
+	},
+
+	_setPositionRelative: function() {
+		if ( !( /^(?:r|a|f)/ ).test( this.element.css( "position" ) ) ) {
+			this.element[ 0 ].style.position = "relative";
+		}
+	},
+
+	_adjustOffsetFromHelper: function( obj ) {
+		if ( typeof obj === "string" ) {
+			obj = obj.split( " " );
+		}
+		if ( Array.isArray( obj ) ) {
+			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
+		}
+		if ( "left" in obj ) {
+			this.offset.click.left = obj.left + this.margins.left;
+		}
+		if ( "right" in obj ) {
+			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
+		}
+		if ( "top" in obj ) {
+			this.offset.click.top = obj.top + this.margins.top;
+		}
+		if ( "bottom" in obj ) {
+			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
+		}
+	},
+
+	_isRootNode: function( element ) {
+		return ( /(html|body)/i ).test( element.tagName ) || element === this.document[ 0 ];
+	},
+
+	_getParentOffset: function() {
+
+		//Get the offsetParent and cache its position
+		var po = this.offsetParent.offset(),
+			document = this.document[ 0 ];
+
+		// This is a special case where we need to modify a offset calculated on start, since the
+		// following happened:
+		// 1. The position of the helper is absolute, so it's position is calculated based on the
+		// next positioned parent
+		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
+		// the document, which means that the scroll is included in the initial calculation of the
+		// offset of the parent, and never recalculated upon drag
+		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== document &&
+				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
+			po.left += this.scrollParent.scrollLeft();
+			po.top += this.scrollParent.scrollTop();
+		}
+
+		if ( this._isRootNode( this.offsetParent[ 0 ] ) ) {
+			po = { top: 0, left: 0 };
+		}
+
+		return {
+			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
+			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
+		};
+
+	},
+
+	_getRelativeOffset: function() {
+		if ( this.cssPosition !== "relative" ) {
+			return { top: 0, left: 0 };
+		}
+
+		var p = this.element.position(),
+			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );
+
+		return {
+			top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
+				( !scrollIsRootNode ? this.scrollParent.scrollTop() : 0 ),
+			left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
+				( !scrollIsRootNode ? this.scrollParent.scrollLeft() : 0 )
+		};
+
+	},
+
+	_cacheMargins: function() {
+		this.margins = {
+			left: ( parseInt( this.element.css( "marginLeft" ), 10 ) || 0 ),
+			top: ( parseInt( this.element.css( "marginTop" ), 10 ) || 0 ),
+			right: ( parseInt( this.element.css( "marginRight" ), 10 ) || 0 ),
+			bottom: ( parseInt( this.element.css( "marginBottom" ), 10 ) || 0 )
+		};
+	},
+
+	_cacheHelperProportions: function() {
+		this.helperProportions = {
+			width: this.helper.outerWidth(),
+			height: this.helper.outerHeight()
+		};
+	},
+
+	_setContainment: function() {
+
+		var isUserScrollable, c, ce,
+			o = this.options,
+			document = this.document[ 0 ];
+
+		this.relativeContainer = null;
+
+		if ( !o.containment ) {
+			this.containment = null;
+			return;
+		}
+
+		if ( o.containment === "window" ) {
+			this.containment = [
+				$( window ).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
+				$( window ).scrollTop() - this.offset.relative.top - this.offset.parent.top,
+				$( window ).scrollLeft() + $( window ).width() -
+					this.helperProportions.width - this.margins.left,
+				$( window ).scrollTop() +
+					( $( window ).height() || document.body.parentNode.scrollHeight ) -
+					this.helperProportions.height - this.margins.top
+			];
+			return;
+		}
+
+		if ( o.containment === "document" ) {
+			this.containment = [
+				0,
+				0,
+				$( document ).width() - this.helperProportions.width - this.margins.left,
+				( $( document ).height() || document.body.parentNode.scrollHeight ) -
+					this.helperProportions.height - this.margins.top
+			];
+			return;
+		}
+
+		if ( o.containment.constructor === Array ) {
+			this.containment = o.containment;
+			return;
+		}
+
+		if ( o.containment === "parent" ) {
+			o.containment = this.helper[ 0 ].parentNode;
+		}
+
+		c = $( o.containment );
+		ce = c[ 0 ];
+
+		if ( !ce ) {
+			return;
+		}
+
+		isUserScrollable = /(scroll|auto)/.test( c.css( "overflow" ) );
+
+		this.containment = [
+			( parseInt( c.css( "borderLeftWidth" ), 10 ) || 0 ) +
+				( parseInt( c.css( "paddingLeft" ), 10 ) || 0 ),
+			( parseInt( c.css( "borderTopWidth" ), 10 ) || 0 ) +
+				( parseInt( c.css( "paddingTop" ), 10 ) || 0 ),
+			( isUserScrollable ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
+				( parseInt( c.css( "borderRightWidth" ), 10 ) || 0 ) -
+				( parseInt( c.css( "paddingRight" ), 10 ) || 0 ) -
+				this.helperProportions.width -
+				this.margins.left -
+				this.margins.right,
+			( isUserScrollable ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
+				( parseInt( c.css( "borderBottomWidth" ), 10 ) || 0 ) -
+				( parseInt( c.css( "paddingBottom" ), 10 ) || 0 ) -
+				this.helperProportions.height -
+				this.margins.top -
+				this.margins.bottom
+		];
+		this.relativeContainer = c;
+	},
+
+	_convertPositionTo: function( d, pos ) {
+
+		if ( !pos ) {
+			pos = this.position;
+		}
+
+		var mod = d === "absolute" ? 1 : -1,
+			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );
+
+		return {
+			top: (
+
+				// The absolute mouse position
+				pos.top	+
+
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.top * mod +
+
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.top * mod -
+				( ( this.cssPosition === "fixed" ?
+					-this.offset.scroll.top :
+					( scrollIsRootNode ? 0 : this.offset.scroll.top ) ) * mod )
+			),
+			left: (
+
+				// The absolute mouse position
+				pos.left +
+
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.left * mod +
+
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.left * mod	-
+				( ( this.cssPosition === "fixed" ?
+					-this.offset.scroll.left :
+					( scrollIsRootNode ? 0 : this.offset.scroll.left ) ) * mod )
+			)
+		};
+
+	},
+
+	_generatePosition: function( event, constrainPosition ) {
+
+		var containment, co, top, left,
+			o = this.options,
+			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] ),
+			pageX = event.pageX,
+			pageY = event.pageY;
+
+		// Cache the scroll
+		if ( !scrollIsRootNode || !this.offset.scroll ) {
+			this.offset.scroll = {
+				top: this.scrollParent.scrollTop(),
+				left: this.scrollParent.scrollLeft()
+			};
+		}
+
+		/*
+		 * - Position constraining -
+		 * Constrain the position to a mix of grid, containment.
+		 */
+
+		// If we are not dragging yet, we won't check for options
+		if ( constrainPosition ) {
+			if ( this.containment ) {
+				if ( this.relativeContainer ) {
+					co = this.relativeContainer.offset();
+					containment = [
+						this.containment[ 0 ] + co.left,
+						this.containment[ 1 ] + co.top,
+						this.containment[ 2 ] + co.left,
+						this.containment[ 3 ] + co.top
+					];
+				} else {
+					containment = this.containment;
+				}
+
+				if ( event.pageX - this.offset.click.left < containment[ 0 ] ) {
+					pageX = containment[ 0 ] + this.offset.click.left;
+				}
+				if ( event.pageY - this.offset.click.top < containment[ 1 ] ) {
+					pageY = containment[ 1 ] + this.offset.click.top;
+				}
+				if ( event.pageX - this.offset.click.left > containment[ 2 ] ) {
+					pageX = containment[ 2 ] + this.offset.click.left;
+				}
+				if ( event.pageY - this.offset.click.top > containment[ 3 ] ) {
+					pageY = containment[ 3 ] + this.offset.click.top;
+				}
+			}
+
+			if ( o.grid ) {
+
+				//Check for grid elements set to 0 to prevent divide by 0 error causing invalid
+				// argument errors in IE (see ticket #6950)
+				top = o.grid[ 1 ] ? this.originalPageY + Math.round( ( pageY -
+					this.originalPageY ) / o.grid[ 1 ] ) * o.grid[ 1 ] : this.originalPageY;
+				pageY = containment ? ( ( top - this.offset.click.top >= containment[ 1 ] ||
+					top - this.offset.click.top > containment[ 3 ] ) ?
+						top :
+						( ( top - this.offset.click.top >= containment[ 1 ] ) ?
+							top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) : top;
+
+				left = o.grid[ 0 ] ? this.originalPageX +
+					Math.round( ( pageX - this.originalPageX ) / o.grid[ 0 ] ) * o.grid[ 0 ] :
+					this.originalPageX;
+				pageX = containment ? ( ( left - this.offset.click.left >= containment[ 0 ] ||
+					left - this.offset.click.left > containment[ 2 ] ) ?
+						left :
+						( ( left - this.offset.click.left >= containment[ 0 ] ) ?
+							left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) : left;
+			}
+
+			if ( o.axis === "y" ) {
+				pageX = this.originalPageX;
+			}
+
+			if ( o.axis === "x" ) {
+				pageY = this.originalPageY;
+			}
+		}
+
+		return {
+			top: (
+
+				// The absolute mouse position
+				pageY -
+
+				// Click offset (relative to the element)
+				this.offset.click.top -
+
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.top -
+
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.top +
+				( this.cssPosition === "fixed" ?
+					-this.offset.scroll.top :
+					( scrollIsRootNode ? 0 : this.offset.scroll.top ) )
+			),
+			left: (
+
+				// The absolute mouse position
+				pageX -
+
+				// Click offset (relative to the element)
+				this.offset.click.left -
+
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.left -
+
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.left +
+				( this.cssPosition === "fixed" ?
+					-this.offset.scroll.left :
+					( scrollIsRootNode ? 0 : this.offset.scroll.left ) )
+			)
+		};
+
+	},
+
+	_clear: function() {
+		this._removeClass( this.helper, "ui-draggable-dragging" );
+		if ( this.helper[ 0 ] !== this.element[ 0 ] && !this.cancelHelperRemoval ) {
+			this.helper.remove();
+		}
+		this.helper = null;
+		this.cancelHelperRemoval = false;
+		if ( this.destroyOnClear ) {
+			this.destroy();
+		}
+	},
+
+	// From now on bulk stuff - mainly helpers
+
+	_trigger: function( type, event, ui ) {
+		ui = ui || this._uiHash();
+		$.ui.plugin.call( this, type, [ event, ui, this ], true );
+
+		// Absolute position and offset (see #6884 ) have to be recalculated after plugins
+		if ( /^(drag|start|stop)/.test( type ) ) {
+			this.positionAbs = this._convertPositionTo( "absolute" );
+			ui.offset = this.positionAbs;
+		}
+		return $.Widget.prototype._trigger.call( this, type, event, ui );
+	},
+
+	plugins: {},
+
+	_uiHash: function() {
+		return {
+			helper: this.helper,
+			position: this.position,
+			originalPosition: this.originalPosition,
+			offset: this.positionAbs
+		};
+	}
+
+} );
+
+$.ui.plugin.add( "draggable", "connectToSortable", {
+	start: function( event, ui, draggable ) {
+		var uiSortable = $.extend( {}, ui, {
+			item: draggable.element
+		} );
+
+		draggable.sortables = [];
+		$( draggable.options.connectToSortable ).each( function() {
+			var sortable = $( this ).sortable( "instance" );
+
+			if ( sortable && !sortable.options.disabled ) {
+				draggable.sortables.push( sortable );
+
+				// RefreshPositions is called at drag start to refresh the containerCache
+				// which is used in drag. This ensures it's initialized and synchronized
+				// with any changes that might have happened on the page since initialization.
+				sortable.refreshPositions();
+				sortable._trigger( "activate", event, uiSortable );
+			}
+		} );
+	},
+	stop: function( event, ui, draggable ) {
+		var uiSortable = $.extend( {}, ui, {
+			item: draggable.element
+		} );
+
+		draggable.cancelHelperRemoval = false;
+
+		$.each( draggable.sortables, function() {
+			var sortable = this;
+
+			if ( sortable.isOver ) {
+				sortable.isOver = 0;
+
+				// Allow this sortable to handle removing the helper
+				draggable.cancelHelperRemoval = true;
+				sortable.cancelHelperRemoval = false;
+
+				// Use _storedCSS To restore properties in the sortable,
+				// as this also handles revert (#9675) since the draggable
+				// may have modified them in unexpected ways (#8809)
+				sortable._storedCSS = {
+					position: sortable.placeholder.css( "position" ),
+					top: sortable.placeholder.css( "top" ),
+					left: sortable.placeholder.css( "left" )
+				};
+
+				sortable._mouseStop( event );
+
+				// Once drag has ended, the sortable should return to using
+				// its original helper, not the shared helper from draggable
+				sortable.options.helper = sortable.options._helper;
+			} else {
+
+				// Prevent this Sortable from removing the helper.
+				// However, don't set the draggable to remove the helper
+				// either as another connected Sortable may yet handle the removal.
+				sortable.cancelHelperRemoval = true;
+
+				sortable._trigger( "deactivate", event, uiSortable );
+			}
+		} );
+	},
+	drag: function( event, ui, draggable ) {
+		$.each( draggable.sortables, function() {
+			var innermostIntersecting = false,
+				sortable = this;
+
+			// Copy over variables that sortable's _intersectsWith uses
+			sortable.positionAbs = draggable.positionAbs;
+			sortable.helperProportions = draggable.helperProportions;
+			sortable.offset.click = draggable.offset.click;
+
+			if ( sortable._intersectsWith( sortable.containerCache ) ) {
+				innermostIntersecting = true;
+
+				$.each( draggable.sortables, function() {
+
+					// Copy over variables that sortable's _intersectsWith uses
+					this.positionAbs = draggable.positionAbs;
+					this.helperProportions = draggable.helperProportions;
+					this.offset.click = draggable.offset.click;
+
+					if ( this !== sortable &&
+							this._intersectsWith( this.containerCache ) &&
+							$.contains( sortable.element[ 0 ], this.element[ 0 ] ) ) {
+						innermostIntersecting = false;
+					}
+
+					return innermostIntersecting;
+				} );
+			}
+
+			if ( innermostIntersecting ) {
+
+				// If it intersects, we use a little isOver variable and set it once,
+				// so that the move-in stuff gets fired only once.
+				if ( !sortable.isOver ) {
+					sortable.isOver = 1;
+
+					// Store draggable's parent in case we need to reappend to it later.
+					draggable._parent = ui.helper.parent();
+
+					sortable.currentItem = ui.helper
+						.appendTo( sortable.element )
+						.data( "ui-sortable-item", true );
+
+					// Store helper option to later restore it
+					sortable.options._helper = sortable.options.helper;
+
+					sortable.options.helper = function() {
+						return ui.helper[ 0 ];
+					};
+
+					// Fire the start events of the sortable with our passed browser event,
+					// and our own helper (so it doesn't create a new one)
+					event.target = sortable.currentItem[ 0 ];
+					sortable._mouseCapture( event, true );
+					sortable._mouseStart( event, true, true );
+
+					// Because the browser event is way off the new appended portlet,
+					// modify necessary variables to reflect the changes
+					sortable.offset.click.top = draggable.offset.click.top;
+					sortable.offset.click.left = draggable.offset.click.left;
+					sortable.offset.parent.left -= draggable.offset.parent.left -
+						sortable.offset.parent.left;
+					sortable.offset.parent.top -= draggable.offset.parent.top -
+						sortable.offset.parent.top;
+
+					draggable._trigger( "toSortable", event );
+
+					// Inform draggable that the helper is in a valid drop zone,
+					// used solely in the revert option to handle "valid/invalid".
+					draggable.dropped = sortable.element;
+
+					// Need to refreshPositions of all sortables in the case that
+					// adding to one sortable changes the location of the other sortables (#9675)
+					$.each( draggable.sortables, function() {
+						this.refreshPositions();
+					} );
+
+					// Hack so receive/update callbacks work (mostly)
+					draggable.currentItem = draggable.element;
+					sortable.fromOutside = draggable;
+				}
+
+				if ( sortable.currentItem ) {
+					sortable._mouseDrag( event );
+
+					// Copy the sortable's position because the draggable's can potentially reflect
+					// a relative position, while sortable is always absolute, which the dragged
+					// element has now become. (#8809)
+					ui.position = sortable.position;
+				}
+			} else {
+
+				// If it doesn't intersect with the sortable, and it intersected before,
+				// we fake the drag stop of the sortable, but make sure it doesn't remove
+				// the helper by using cancelHelperRemoval.
+				if ( sortable.isOver ) {
+
+					sortable.isOver = 0;
+					sortable.cancelHelperRemoval = true;
+
+					// Calling sortable's mouseStop would trigger a revert,
+					// so revert must be temporarily false until after mouseStop is called.
+					sortable.options._revert = sortable.options.revert;
+					sortable.options.revert = false;
+
+					sortable._trigger( "out", event, sortable._uiHash( sortable ) );
+					sortable._mouseStop( event, true );
+
+					// Restore sortable behaviors that were modfied
+					// when the draggable entered the sortable area (#9481)
+					sortable.options.revert = sortable.options._revert;
+					sortable.options.helper = sortable.options._helper;
+
+					if ( sortable.placeholder ) {
+						sortable.placeholder.remove();
+					}
+
+					// Restore and recalculate the draggable's offset considering the sortable
+					// may have modified them in unexpected ways. (#8809, #10669)
+					ui.helper.appendTo( draggable._parent );
+					draggable._refreshOffsets( event );
+					ui.position = draggable._generatePosition( event, true );
+
+					draggable._trigger( "fromSortable", event );
+
+					// Inform draggable that the helper is no longer in a valid drop zone
+					draggable.dropped = false;
+
+					// Need to refreshPositions of all sortables just in case removing
+					// from one sortable changes the location of other sortables (#9675)
+					$.each( draggable.sortables, function() {
+						this.refreshPositions();
+					} );
+				}
+			}
+		} );
+	}
+} );
+
+$.ui.plugin.add( "draggable", "cursor", {
+	start: function( event, ui, instance ) {
+		var t = $( "body" ),
+			o = instance.options;
+
+		if ( t.css( "cursor" ) ) {
+			o._cursor = t.css( "cursor" );
+		}
+		t.css( "cursor", o.cursor );
+	},
+	stop: function( event, ui, instance ) {
+		var o = instance.options;
+		if ( o._cursor ) {
+			$( "body" ).css( "cursor", o._cursor );
+		}
+	}
+} );
+
+$.ui.plugin.add( "draggable", "opacity", {
+	start: function( event, ui, instance ) {
+		var t = $( ui.helper ),
+			o = instance.options;
+		if ( t.css( "opacity" ) ) {
+			o._opacity = t.css( "opacity" );
+		}
+		t.css( "opacity", o.opacity );
+	},
+	stop: function( event, ui, instance ) {
+		var o = instance.options;
+		if ( o._opacity ) {
+			$( ui.helper ).css( "opacity", o._opacity );
+		}
+	}
+} );
+
+$.ui.plugin.add( "draggable", "scroll", {
+	start: function( event, ui, i ) {
+		if ( !i.scrollParentNotHidden ) {
+			i.scrollParentNotHidden = i.helper.scrollParent( false );
+		}
+
+		if ( i.scrollParentNotHidden[ 0 ] !== i.document[ 0 ] &&
+				i.scrollParentNotHidden[ 0 ].tagName !== "HTML" ) {
+			i.overflowOffset = i.scrollParentNotHidden.offset();
+		}
+	},
+	drag: function( event, ui, i  ) {
+
+		var o = i.options,
+			scrolled = false,
+			scrollParent = i.scrollParentNotHidden[ 0 ],
+			document = i.document[ 0 ];
+
+		if ( scrollParent !== document && scrollParent.tagName !== "HTML" ) {
+			if ( !o.axis || o.axis !== "x" ) {
+				if ( ( i.overflowOffset.top + scrollParent.offsetHeight ) - event.pageY <
+						o.scrollSensitivity ) {
+					scrollParent.scrollTop = scrolled = scrollParent.scrollTop + o.scrollSpeed;
+				} else if ( event.pageY - i.overflowOffset.top < o.scrollSensitivity ) {
+					scrollParent.scrollTop = scrolled = scrollParent.scrollTop - o.scrollSpeed;
+				}
+			}
+
+			if ( !o.axis || o.axis !== "y" ) {
+				if ( ( i.overflowOffset.left + scrollParent.offsetWidth ) - event.pageX <
+						o.scrollSensitivity ) {
+					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + o.scrollSpeed;
+				} else if ( event.pageX - i.overflowOffset.left < o.scrollSensitivity ) {
+					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - o.scrollSpeed;
+				}
+			}
+
+		} else {
+
+			if ( !o.axis || o.axis !== "x" ) {
+				if ( event.pageY - $( document ).scrollTop() < o.scrollSensitivity ) {
+					scrolled = $( document ).scrollTop( $( document ).scrollTop() - o.scrollSpeed );
+				} else if ( $( window ).height() - ( event.pageY - $( document ).scrollTop() ) <
+						o.scrollSensitivity ) {
+					scrolled = $( document ).scrollTop( $( document ).scrollTop() + o.scrollSpeed );
+				}
+			}
+
+			if ( !o.axis || o.axis !== "y" ) {
+				if ( event.pageX - $( document ).scrollLeft() < o.scrollSensitivity ) {
+					scrolled = $( document ).scrollLeft(
+						$( document ).scrollLeft() - o.scrollSpeed
+					);
+				} else if ( $( window ).width() - ( event.pageX - $( document ).scrollLeft() ) <
+						o.scrollSensitivity ) {
+					scrolled = $( document ).scrollLeft(
+						$( document ).scrollLeft() + o.scrollSpeed
+					);
+				}
+			}
+
+		}
+
+		if ( scrolled !== false && $.ui.ddmanager && !o.dropBehaviour ) {
+			$.ui.ddmanager.prepareOffsets( i, event );
+		}
+
+	}
+} );
+
+$.ui.plugin.add( "draggable", "snap", {
+	start: function( event, ui, i ) {
+
+		var o = i.options;
+
+		i.snapElements = [];
+
+		$( o.snap.constructor !== String ? ( o.snap.items || ":data(ui-draggable)" ) : o.snap )
+			.each( function() {
+				var $t = $( this ),
+					$o = $t.offset();
+				if ( this !== i.element[ 0 ] ) {
+					i.snapElements.push( {
+						item: this,
+						width: $t.outerWidth(), height: $t.outerHeight(),
+						top: $o.top, left: $o.left
+					} );
+				}
+			} );
+
+	},
+	drag: function( event, ui, inst ) {
+
+		var ts, bs, ls, rs, l, r, t, b, i, first,
+			o = inst.options,
+			d = o.snapTolerance,
+			x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width,
+			y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;
+
+		for ( i = inst.snapElements.length - 1; i >= 0; i-- ) {
+
+			l = inst.snapElements[ i ].left - inst.margins.left;
+			r = l + inst.snapElements[ i ].width;
+			t = inst.snapElements[ i ].top - inst.margins.top;
+			b = t + inst.snapElements[ i ].height;
+
+			if ( x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d ||
+					!$.contains( inst.snapElements[ i ].item.ownerDocument,
+					inst.snapElements[ i ].item ) ) {
+				if ( inst.snapElements[ i ].snapping ) {
+					if ( inst.options.snap.release ) {
+						inst.options.snap.release.call(
+							inst.element,
+							event,
+							$.extend( inst._uiHash(), { snapItem: inst.snapElements[ i ].item } )
+						);
+					}
+				}
+				inst.snapElements[ i ].snapping = false;
+				continue;
+			}
+
+			if ( o.snapMode !== "inner" ) {
+				ts = Math.abs( t - y2 ) <= d;
+				bs = Math.abs( b - y1 ) <= d;
+				ls = Math.abs( l - x2 ) <= d;
+				rs = Math.abs( r - x1 ) <= d;
+				if ( ts ) {
+					ui.position.top = inst._convertPositionTo( "relative", {
+						top: t - inst.helperProportions.height,
+						left: 0
+					} ).top;
+				}
+				if ( bs ) {
+					ui.position.top = inst._convertPositionTo( "relative", {
+						top: b,
+						left: 0
+					} ).top;
+				}
+				if ( ls ) {
+					ui.position.left = inst._convertPositionTo( "relative", {
+						top: 0,
+						left: l - inst.helperProportions.width
+					} ).left;
+				}
+				if ( rs ) {
+					ui.position.left = inst._convertPositionTo( "relative", {
+						top: 0,
+						left: r
+					} ).left;
+				}
+			}
+
+			first = ( ts || bs || ls || rs );
+
+			if ( o.snapMode !== "outer" ) {
+				ts = Math.abs( t - y1 ) <= d;
+				bs = Math.abs( b - y2 ) <= d;
+				ls = Math.abs( l - x1 ) <= d;
+				rs = Math.abs( r - x2 ) <= d;
+				if ( ts ) {
+					ui.position.top = inst._convertPositionTo( "relative", {
+						top: t,
+						left: 0
+					} ).top;
+				}
+				if ( bs ) {
+					ui.position.top = inst._convertPositionTo( "relative", {
+						top: b - inst.helperProportions.height,
+						left: 0
+					} ).top;
+				}
+				if ( ls ) {
+					ui.position.left = inst._convertPositionTo( "relative", {
+						top: 0,
+						left: l
+					} ).left;
+				}
+				if ( rs ) {
+					ui.position.left = inst._convertPositionTo( "relative", {
+						top: 0,
+						left: r - inst.helperProportions.width
+					} ).left;
+				}
+			}
+
+			if ( !inst.snapElements[ i ].snapping && ( ts || bs || ls || rs || first ) ) {
+				if ( inst.options.snap.snap ) {
+					inst.options.snap.snap.call(
+						inst.element,
+						event,
+						$.extend( inst._uiHash(), {
+							snapItem: inst.snapElements[ i ].item
+						} ) );
+				}
+			}
+			inst.snapElements[ i ].snapping = ( ts || bs || ls || rs || first );
+
+		}
+
+	}
+} );
+
+$.ui.plugin.add( "draggable", "stack", {
+	start: function( event, ui, instance ) {
+		var min,
+			o = instance.options,
+			group = $.makeArray( $( o.stack ) ).sort( function( a, b ) {
+				return ( parseInt( $( a ).css( "zIndex" ), 10 ) || 0 ) -
+					( parseInt( $( b ).css( "zIndex" ), 10 ) || 0 );
+			} );
+
+		if ( !group.length ) {
+			return;
+		}
+
+		min = parseInt( $( group[ 0 ] ).css( "zIndex" ), 10 ) || 0;
+		$( group ).each( function( i ) {
+			$( this ).css( "zIndex", min + i );
+		} );
+		this.css( "zIndex", ( min + group.length ) );
+	}
+} );
+
+$.ui.plugin.add( "draggable", "zIndex", {
+	start: function( event, ui, instance ) {
+		var t = $( ui.helper ),
+			o = instance.options;
+
+		if ( t.css( "zIndex" ) ) {
+			o._zIndex = t.css( "zIndex" );
+		}
+		t.css( "zIndex", o.zIndex );
+	},
+	stop: function( event, ui, instance ) {
+		var o = instance.options;
+
+		if ( o._zIndex ) {
+			$( ui.helper ).css( "zIndex", o._zIndex );
+		}
+	}
+} );
+
+var widgetsDraggable = $.ui.draggable;
+
+
+/*!
+ * jQuery UI Resizable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Resizable
+//>>group: Interactions
+//>>description: Enables resize functionality for any element.
+//>>docs: http://api.jqueryui.com/resizable/
+//>>demos: http://jqueryui.com/resizable/
+//>>css.structure: ../../themes/base/core.css
+//>>css.structure: ../../themes/base/resizable.css
+//>>css.theme: ../../themes/base/theme.css
+
+
+$.widget( "ui.resizable", $.ui.mouse, {
+	version: "1.13.2",
+	widgetEventPrefix: "resize",
+	options: {
+		alsoResize: false,
+		animate: false,
+		animateDuration: "slow",
+		animateEasing: "swing",
+		aspectRatio: false,
+		autoHide: false,
+		classes: {
+			"ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
+		},
+		containment: false,
+		ghost: false,
+		grid: false,
+		handles: "e,s,se",
+		helper: false,
+		maxHeight: null,
+		maxWidth: null,
+		minHeight: 10,
+		minWidth: 10,
+
+		// See #7960
+		zIndex: 90,
+
+		// Callbacks
+		resize: null,
+		start: null,
+		stop: null
+	},
+
+	_num: function( value ) {
+		return parseFloat( value ) || 0;
+	},
+
+	_isNumber: function( value ) {
+		return !isNaN( parseFloat( value ) );
+	},
+
+	_hasScroll: function( el, a ) {
+
+		if ( $( el ).css( "overflow" ) === "hidden" ) {
+			return false;
+		}
+
+		var scroll = ( a && a === "left" ) ? "scrollLeft" : "scrollTop",
+			has = false;
+
+		if ( el[ scroll ] > 0 ) {
+			return true;
+		}
+
+		// TODO: determine which cases actually cause this to happen
+		// if the element doesn't have the scroll set, see if it's possible to
+		// set the scroll
+		try {
+			el[ scroll ] = 1;
+			has = ( el[ scroll ] > 0 );
+			el[ scroll ] = 0;
+		} catch ( e ) {
+
+			// `el` might be a string, then setting `scroll` will throw
+			// an error in strict mode; ignore it.
+		}
+		return has;
+	},
+
+	_create: function() {
+
+		var margins,
+			o = this.options,
+			that = this;
+		this._addClass( "ui-resizable" );
+
+		$.extend( this, {
+			_aspectRatio: !!( o.aspectRatio ),
+			aspectRatio: o.aspectRatio,
+			originalElement: this.element,
+			_proportionallyResizeElements: [],
+			_helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
+		} );
+
+		// Wrap the element if it cannot hold child nodes
+		if ( this.element[ 0 ].nodeName.match( /^(canvas|textarea|input|select|button|img)$/i ) ) {
+
+			this.element.wrap(
+				$( "<div class='ui-wrapper'></div>" ).css( {
+					overflow: "hidden",
+					position: this.element.css( "position" ),
+					width: this.element.outerWidth(),
+					height: this.element.outerHeight(),
+					top: this.element.css( "top" ),
+					left: this.element.css( "left" )
+				} )
+			);
+
+			this.element = this.element.parent().data(
+				"ui-resizable", this.element.resizable( "instance" )
+			);
+
+			this.elementIsWrapper = true;
+
+			margins = {
+				marginTop: this.originalElement.css( "marginTop" ),
+				marginRight: this.originalElement.css( "marginRight" ),
+				marginBottom: this.originalElement.css( "marginBottom" ),
+				marginLeft: this.originalElement.css( "marginLeft" )
+			};
+
+			this.element.css( margins );
+			this.originalElement.css( "margin", 0 );
+
+			// support: Safari
+			// Prevent Safari textarea resize
+			this.originalResizeStyle = this.originalElement.css( "resize" );
+			this.originalElement.css( "resize", "none" );
+
+			this._proportionallyResizeElements.push( this.originalElement.css( {
+				position: "static",
+				zoom: 1,
+				display: "block"
+			} ) );
+
+			// Support: IE9
+			// avoid IE jump (hard set the margin)
+			this.originalElement.css( margins );
+
+			this._proportionallyResize();
+		}
+
+		this._setupHandles();
+
+		if ( o.autoHide ) {
+			$( this.element )
+				.on( "mouseenter", function() {
+					if ( o.disabled ) {
+						return;
+					}
+					that._removeClass( "ui-resizable-autohide" );
+					that._handles.show();
+				} )
+				.on( "mouseleave", function() {
+					if ( o.disabled ) {
+						return;
+					}
+					if ( !that.resizing ) {
+						that._addClass( "ui-resizable-autohide" );
+						that._handles.hide();
+					}
+				} );
+		}
+
+		this._mouseInit();
+	},
+
+	_destroy: function() {
+
+		this._mouseDestroy();
+		this._addedHandles.remove();
+
+		var wrapper,
+			_destroy = function( exp ) {
+				$( exp )
+					.removeData( "resizable" )
+					.removeData( "ui-resizable" )
+					.off( ".resizable" );
+			};
+
+		// TODO: Unwrap at same DOM position
+		if ( this.elementIsWrapper ) {
+			_destroy( this.element );
+			wrapper = this.element;
+			this.originalElement.css( {
+				position: wrapper.css( "position" ),
+				width: wrapper.outerWidth(),
+				height: wrapper.outerHeight(),
+				top: wrapper.css( "top" ),
+				left: wrapper.css( "left" )
+			} ).insertAfter( wrapper );
+			wrapper.remove();
+		}
+
+		this.originalElement.css( "resize", this.originalResizeStyle );
+		_destroy( this.originalElement );
+
+		return this;
+	},
+
+	_setOption: function( key, value ) {
+		this._super( key, value );
+
+		switch ( key ) {
+		case "handles":
+			this._removeHandles();
+			this._setupHandles();
+			break;
+		case "aspectRatio":
+			this._aspectRatio = !!value;
+			break;
+		default:
+			break;
+		}
+	},
+
+	_setupHandles: function() {
+		var o = this.options, handle, i, n, hname, axis, that = this;
+		this.handles = o.handles ||
+			( !$( ".ui-resizable-handle", this.element ).length ?
+				"e,s,se" : {
+					n: ".ui-resizable-n",
+					e: ".ui-resizable-e",
+					s: ".ui-resizable-s",
+					w: ".ui-resizable-w",
+					se: ".ui-resizable-se",
+					sw: ".ui-resizable-sw",
+					ne: ".ui-resizable-ne",
+					nw: ".ui-resizable-nw"
+				} );
+
+		this._handles = $();
+		this._addedHandles = $();
+		if ( this.handles.constructor === String ) {
+
+			if ( this.handles === "all" ) {
+				this.handles = "n,e,s,w,se,sw,ne,nw";
+			}
+
+			n = this.handles.split( "," );
+			this.handles = {};
+
+			for ( i = 0; i < n.length; i++ ) {
+
+				handle = String.prototype.trim.call( n[ i ] );
+				hname = "ui-resizable-" + handle;
+				axis = $( "<div>" );
+				this._addClass( axis, "ui-resizable-handle " + hname );
+
+				axis.css( { zIndex: o.zIndex } );
+
+				this.handles[ handle ] = ".ui-resizable-" + handle;
+				if ( !this.element.children( this.handles[ handle ] ).length ) {
+					this.element.append( axis );
+					this._addedHandles = this._addedHandles.add( axis );
+				}
+			}
+
+		}
+
+		this._renderAxis = function( target ) {
+
+			var i, axis, padPos, padWrapper;
+
+			target = target || this.element;
+
+			for ( i in this.handles ) {
+
+				if ( this.handles[ i ].constructor === String ) {
+					this.handles[ i ] = this.element.children( this.handles[ i ] ).first().show();
+				} else if ( this.handles[ i ].jquery || this.handles[ i ].nodeType ) {
+					this.handles[ i ] = $( this.handles[ i ] );
+					this._on( this.handles[ i ], { "mousedown": that._mouseDown } );
+				}
+
+				if ( this.elementIsWrapper &&
+						this.originalElement[ 0 ]
+							.nodeName
+							.match( /^(textarea|input|select|button)$/i ) ) {
+					axis = $( this.handles[ i ], this.element );
+
+					padWrapper = /sw|ne|nw|se|n|s/.test( i ) ?
+						axis.outerHeight() :
+						axis.outerWidth();
+
+					padPos = [ "padding",
+						/ne|nw|n/.test( i ) ? "Top" :
+						/se|sw|s/.test( i ) ? "Bottom" :
+						/^e$/.test( i ) ? "Right" : "Left" ].join( "" );
+
+					target.css( padPos, padWrapper );
+
+					this._proportionallyResize();
+				}
+
+				this._handles = this._handles.add( this.handles[ i ] );
+			}
+		};
+
+		// TODO: make renderAxis a prototype function
+		this._renderAxis( this.element );
+
+		this._handles = this._handles.add( this.element.find( ".ui-resizable-handle" ) );
+		this._handles.disableSelection();
+
+		this._handles.on( "mouseover", function() {
+			if ( !that.resizing ) {
+				if ( this.className ) {
+					axis = this.className.match( /ui-resizable-(se|sw|ne|nw|n|e|s|w)/i );
+				}
+				that.axis = axis && axis[ 1 ] ? axis[ 1 ] : "se";
+			}
+		} );
+
+		if ( o.autoHide ) {
+			this._handles.hide();
+			this._addClass( "ui-resizable-autohide" );
+		}
+	},
+
+	_removeHandles: function() {
+		this._addedHandles.remove();
+	},
+
+	_mouseCapture: function( event ) {
+		var i, handle,
+			capture = false;
+
+		for ( i in this.handles ) {
+			handle = $( this.handles[ i ] )[ 0 ];
+			if ( handle === event.target || $.contains( handle, event.target ) ) {
+				capture = true;
+			}
+		}
+
+		return !this.options.disabled && capture;
+	},
+
+	_mouseStart: function( event ) {
+
+		var curleft, curtop, cursor,
+			o = this.options,
+			el = this.element;
+
+		this.resizing = true;
+
+		this._renderProxy();
+
+		curleft = this._num( this.helper.css( "left" ) );
+		curtop = this._num( this.helper.css( "top" ) );
+
+		if ( o.containment ) {
+			curleft += $( o.containment ).scrollLeft() || 0;
+			curtop += $( o.containment ).scrollTop() || 0;
+		}
+
+		this.offset = this.helper.offset();
+		this.position = { left: curleft, top: curtop };
+
+		this.size = this._helper ? {
+				width: this.helper.width(),
+				height: this.helper.height()
+			} : {
+				width: el.width(),
+				height: el.height()
+			};
+
+		this.originalSize = this._helper ? {
+				width: el.outerWidth(),
+				height: el.outerHeight()
+			} : {
+				width: el.width(),
+				height: el.height()
+			};
+
+		this.sizeDiff = {
+			width: el.outerWidth() - el.width(),
+			height: el.outerHeight() - el.height()
+		};
+
+		this.originalPosition = { left: curleft, top: curtop };
+		this.originalMousePosition = { left: event.pageX, top: event.pageY };
+
+		this.aspectRatio = ( typeof o.aspectRatio === "number" ) ?
+			o.aspectRatio :
+			( ( this.originalSize.width / this.originalSize.height ) || 1 );
+
+		cursor = $( ".ui-resizable-" + this.axis ).css( "cursor" );
+		$( "body" ).css( "cursor", cursor === "auto" ? this.axis + "-resize" : cursor );
+
+		this._addClass( "ui-resizable-resizing" );
+		this._propagate( "start", event );
+		return true;
+	},
+
+	_mouseDrag: function( event ) {

-		if ( inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput( inst ) ) {
-			inst.input.trigger( "focus" );
-		}
+		var data, props,
+			smp = this.originalMousePosition,
+			a = this.axis,
+			dx = ( event.pageX - smp.left ) || 0,
+			dy = ( event.pageY - smp.top ) || 0,
+			trigger = this._change[ a ];

-		// Deffered render of the years select (to avoid flashes on Firefox)
-		if ( inst.yearshtml ) {
-			origyearshtml = inst.yearshtml;
-			setTimeout( function() {
+		this._updatePrevProperties();

-				//assure that inst.yearshtml didn't change.
-				if ( origyearshtml === inst.yearshtml && inst.yearshtml ) {
-					inst.dpDiv.find( "select.ui-datepicker-year" ).first().replaceWith( inst.yearshtml );
-				}
-				origyearshtml = inst.yearshtml = null;
-			}, 0 );
+		if ( !trigger ) {
+			return false;
 		}

-		if ( onUpdateDatepicker ) {
-			onUpdateDatepicker.apply( ( inst.input ? inst.input[ 0 ] : null ), [ inst ] );
-		}
-	},
+		data = trigger.apply( this, [ event, dx, dy ] );

-	// #6694 - don't focus the input if it's already focused
-	// this breaks the change event in IE
-	// Support: IE and jQuery <1.9
-	_shouldFocusInput: function( inst ) {
-		return inst.input && inst.input.is( ":visible" ) && !inst.input.is( ":disabled" ) && !inst.input.is( ":focus" );
-	},
+		this._updateVirtualBoundaries( event.shiftKey );
+		if ( this._aspectRatio || event.shiftKey ) {
+			data = this._updateRatio( data, event );
+		}

-	/* Check positioning to remain on screen. */
-	_checkOffset: function( inst, offset, isFixed ) {
-		var dpWidth = inst.dpDiv.outerWidth(),
-			dpHeight = inst.dpDiv.outerHeight(),
-			inputWidth = inst.input ? inst.input.outerWidth() : 0,
-			inputHeight = inst.input ? inst.input.outerHeight() : 0,
-			viewWidth = document.documentElement.clientWidth + ( isFixed ? 0 : $( document ).scrollLeft() ),
-			viewHeight = document.documentElement.clientHeight + ( isFixed ? 0 : $( document ).scrollTop() );
+		data = this._respectSize( data, event );

-		offset.left -= ( this._get( inst, "isRTL" ) ? ( dpWidth - inputWidth ) : 0 );
-		offset.left -= ( isFixed && offset.left === inst.input.offset().left ) ? $( document ).scrollLeft() : 0;
-		offset.top -= ( isFixed && offset.top === ( inst.input.offset().top + inputHeight ) ) ? $( document ).scrollTop() : 0;
+		this._updateCache( data );

-		// Now check if datepicker is showing outside window viewport - move to a better place if so.
-		offset.left -= Math.min( offset.left, ( offset.left + dpWidth > viewWidth && viewWidth > dpWidth ) ?
-			Math.abs( offset.left + dpWidth - viewWidth ) : 0 );
-		offset.top -= Math.min( offset.top, ( offset.top + dpHeight > viewHeight && viewHeight > dpHeight ) ?
-			Math.abs( dpHeight + inputHeight ) : 0 );
+		this._propagate( "resize", event );

-		return offset;
-	},
+		props = this._applyChanges();

-	/* Find an object's position on the screen. */
-	_findPos: function( obj ) {
-		var position,
-			inst = this._getInst( obj ),
-			isRTL = this._get( inst, "isRTL" );
+		if ( !this._helper && this._proportionallyResizeElements.length ) {
+			this._proportionallyResize();
+		}

-		while ( obj && ( obj.type === "hidden" || obj.nodeType !== 1 || $.expr.pseudos.hidden( obj ) ) ) {
-			obj = obj[ isRTL ? "previousSibling" : "nextSibling" ];
+		if ( !$.isEmptyObject( props ) ) {
+			this._updatePrevProperties();
+			this._trigger( "resize", event, this.ui() );
+			this._applyChanges();
 		}

-		position = $( obj ).offset();
-		return [ position.left, position.top ];
+		return false;
 	},

-	/* Hide the date picker from view.
-	 * @param  input  element - the input field attached to the date picker
-	 */
-	_hideDatepicker: function( input ) {
-		var showAnim, duration, postProcess, onClose,
-			inst = this._curInst;
+	_mouseStop: function( event ) {

-		if ( !inst || ( input && inst !== $.data( input, "datepicker" ) ) ) {
-			return;
-		}
+		this.resizing = false;
+		var pr, ista, soffseth, soffsetw, s, left, top,
+			o = this.options, that = this;

-		if ( this._datepickerShowing ) {
-			showAnim = this._get( inst, "showAnim" );
-			duration = this._get( inst, "duration" );
-			postProcess = function() {
-				$.datepicker._tidyDialog( inst );
+		if ( this._helper ) {
+
+			pr = this._proportionallyResizeElements;
+			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName );
+			soffseth = ista && this._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height;
+			soffsetw = ista ? 0 : that.sizeDiff.width;
+
+			s = {
+				width: ( that.helper.width()  - soffsetw ),
+				height: ( that.helper.height() - soffseth )
 			};
+			left = ( parseFloat( that.element.css( "left" ) ) +
+				( that.position.left - that.originalPosition.left ) ) || null;
+			top = ( parseFloat( that.element.css( "top" ) ) +
+				( that.position.top - that.originalPosition.top ) ) || null;

-			// DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
-			if ( $.effects && ( $.effects.effect[ showAnim ] || $.effects[ showAnim ] ) ) {
-				inst.dpDiv.hide( showAnim, $.datepicker._get( inst, "showOptions" ), duration, postProcess );
-			} else {
-				inst.dpDiv[ ( showAnim === "slideDown" ? "slideUp" :
-					( showAnim === "fadeIn" ? "fadeOut" : "hide" ) ) ]( ( showAnim ? duration : null ), postProcess );
+			if ( !o.animate ) {
+				this.element.css( $.extend( s, { top: top, left: left } ) );
 			}

-			if ( !showAnim ) {
-				postProcess();
-			}
-			this._datepickerShowing = false;
+			that.helper.height( that.size.height );
+			that.helper.width( that.size.width );

-			onClose = this._get( inst, "onClose" );
-			if ( onClose ) {
-				onClose.apply( ( inst.input ? inst.input[ 0 ] : null ), [ ( inst.input ? inst.input.val() : "" ), inst ] );
+			if ( this._helper && !o.animate ) {
+				this._proportionallyResize();
 			}
+		}

-			this._lastInput = null;
-			if ( this._inDialog ) {
-				this._dialogInput.css( { position: "absolute", left: "0", top: "-100px" } );
-				if ( $.blockUI ) {
-					$.unblockUI();
-					$( "body" ).append( this.dpDiv );
-				}
-			}
-			this._inDialog = false;
+		$( "body" ).css( "cursor", "auto" );
+
+		this._removeClass( "ui-resizable-resizing" );
+
+		this._propagate( "stop", event );
+
+		if ( this._helper ) {
+			this.helper.remove();
 		}
+
+		return false;
+
 	},

-	/* Tidy up after a dialog display. */
-	_tidyDialog: function( inst ) {
-		inst.dpDiv.removeClass( this._dialogClass ).off( ".ui-datepicker-calendar" );
+	_updatePrevProperties: function() {
+		this.prevPosition = {
+			top: this.position.top,
+			left: this.position.left
+		};
+		this.prevSize = {
+			width: this.size.width,
+			height: this.size.height
+		};
 	},

-	/* Close date picker if clicked elsewhere. */
-	_checkExternalClick: function( event ) {
-		if ( !$.datepicker._curInst ) {
-			return;
+	_applyChanges: function() {
+		var props = {};
+
+		if ( this.position.top !== this.prevPosition.top ) {
+			props.top = this.position.top + "px";
+		}
+		if ( this.position.left !== this.prevPosition.left ) {
+			props.left = this.position.left + "px";
+		}
+		if ( this.size.width !== this.prevSize.width ) {
+			props.width = this.size.width + "px";
+		}
+		if ( this.size.height !== this.prevSize.height ) {
+			props.height = this.size.height + "px";
 		}

-		var $target = $( event.target ),
-			inst = $.datepicker._getInst( $target[ 0 ] );
+		this.helper.css( props );

-		if ( ( ( $target[ 0 ].id !== $.datepicker._mainDivId &&
-				$target.parents( "#" + $.datepicker._mainDivId ).length === 0 &&
-				!$target.hasClass( $.datepicker.markerClassName ) &&
-				!$target.closest( "." + $.datepicker._triggerClass ).length &&
-				$.datepicker._datepickerShowing && !( $.datepicker._inDialog && $.blockUI ) ) ) ||
-			( $target.hasClass( $.datepicker.markerClassName ) && $.datepicker._curInst !== inst ) ) {
-				$.datepicker._hideDatepicker();
-		}
+		return props;
 	},

-	/* Adjust one of the date sub-fields. */
-	_adjustDate: function( id, offset, period ) {
-		var target = $( id ),
-			inst = this._getInst( target[ 0 ] );
+	_updateVirtualBoundaries: function( forceAspectRatio ) {
+		var pMinWidth, pMaxWidth, pMinHeight, pMaxHeight, b,
+			o = this.options;

-		if ( this._isDisabledDatepicker( target[ 0 ] ) ) {
-			return;
-		}
-		this._adjustInstDate( inst, offset, period );
-		this._updateDatepicker( inst );
-	},
+		b = {
+			minWidth: this._isNumber( o.minWidth ) ? o.minWidth : 0,
+			maxWidth: this._isNumber( o.maxWidth ) ? o.maxWidth : Infinity,
+			minHeight: this._isNumber( o.minHeight ) ? o.minHeight : 0,
+			maxHeight: this._isNumber( o.maxHeight ) ? o.maxHeight : Infinity
+		};

-	/* Action for current link. */
-	_gotoToday: function( id ) {
-		var date,
-			target = $( id ),
-			inst = this._getInst( target[ 0 ] );
+		if ( this._aspectRatio || forceAspectRatio ) {
+			pMinWidth = b.minHeight * this.aspectRatio;
+			pMinHeight = b.minWidth / this.aspectRatio;
+			pMaxWidth = b.maxHeight * this.aspectRatio;
+			pMaxHeight = b.maxWidth / this.aspectRatio;

-		if ( this._get( inst, "gotoCurrent" ) && inst.currentDay ) {
-			inst.selectedDay = inst.currentDay;
-			inst.drawMonth = inst.selectedMonth = inst.currentMonth;
-			inst.drawYear = inst.selectedYear = inst.currentYear;
-		} else {
-			date = new Date();
-			inst.selectedDay = date.getDate();
-			inst.drawMonth = inst.selectedMonth = date.getMonth();
-			inst.drawYear = inst.selectedYear = date.getFullYear();
+			if ( pMinWidth > b.minWidth ) {
+				b.minWidth = pMinWidth;
+			}
+			if ( pMinHeight > b.minHeight ) {
+				b.minHeight = pMinHeight;
+			}
+			if ( pMaxWidth < b.maxWidth ) {
+				b.maxWidth = pMaxWidth;
+			}
+			if ( pMaxHeight < b.maxHeight ) {
+				b.maxHeight = pMaxHeight;
+			}
 		}
-		this._notifyChange( inst );
-		this._adjustDate( target );
+		this._vBoundaries = b;
 	},

-	/* Action for selecting a new month/year. */
-	_selectMonthYear: function( id, select, period ) {
-		var target = $( id ),
-			inst = this._getInst( target[ 0 ] );
-
-		inst[ "selected" + ( period === "M" ? "Month" : "Year" ) ] =
-		inst[ "draw" + ( period === "M" ? "Month" : "Year" ) ] =
-			parseInt( select.options[ select.selectedIndex ].value, 10 );
-
-		this._notifyChange( inst );
-		this._adjustDate( target );
+	_updateCache: function( data ) {
+		this.offset = this.helper.offset();
+		if ( this._isNumber( data.left ) ) {
+			this.position.left = data.left;
+		}
+		if ( this._isNumber( data.top ) ) {
+			this.position.top = data.top;
+		}
+		if ( this._isNumber( data.height ) ) {
+			this.size.height = data.height;
+		}
+		if ( this._isNumber( data.width ) ) {
+			this.size.width = data.width;
+		}
 	},

-	/* Action for selecting a day. */
-	_selectDay: function( id, month, year, td ) {
-		var inst,
-			target = $( id );
+	_updateRatio: function( data ) {

-		if ( $( td ).hasClass( this._unselectableClass ) || this._isDisabledDatepicker( target[ 0 ] ) ) {
-			return;
+		var cpos = this.position,
+			csize = this.size,
+			a = this.axis;
+
+		if ( this._isNumber( data.height ) ) {
+			data.width = ( data.height * this.aspectRatio );
+		} else if ( this._isNumber( data.width ) ) {
+			data.height = ( data.width / this.aspectRatio );
 		}

-		inst = this._getInst( target[ 0 ] );
-		inst.selectedDay = inst.currentDay = parseInt( $( "a", td ).attr( "data-date" ) );
-		inst.selectedMonth = inst.currentMonth = month;
-		inst.selectedYear = inst.currentYear = year;
-		this._selectDate( id, this._formatDate( inst,
-			inst.currentDay, inst.currentMonth, inst.currentYear ) );
-	},
+		if ( a === "sw" ) {
+			data.left = cpos.left + ( csize.width - data.width );
+			data.top = null;
+		}
+		if ( a === "nw" ) {
+			data.top = cpos.top + ( csize.height - data.height );
+			data.left = cpos.left + ( csize.width - data.width );
+		}

-	/* Erase the input field and hide the date picker. */
-	_clearDate: function( id ) {
-		var target = $( id );
-		this._selectDate( target, "" );
+		return data;
 	},

-	/* Update the input field with the selected date. */
-	_selectDate: function( id, dateStr ) {
-		var onSelect,
-			target = $( id ),
-			inst = this._getInst( target[ 0 ] );
+	_respectSize: function( data ) {

-		dateStr = ( dateStr != null ? dateStr : this._formatDate( inst ) );
-		if ( inst.input ) {
-			inst.input.val( dateStr );
+		var o = this._vBoundaries,
+			a = this.axis,
+			ismaxw = this._isNumber( data.width ) && o.maxWidth && ( o.maxWidth < data.width ),
+			ismaxh = this._isNumber( data.height ) && o.maxHeight && ( o.maxHeight < data.height ),
+			isminw = this._isNumber( data.width ) && o.minWidth && ( o.minWidth > data.width ),
+			isminh = this._isNumber( data.height ) && o.minHeight && ( o.minHeight > data.height ),
+			dw = this.originalPosition.left + this.originalSize.width,
+			dh = this.originalPosition.top + this.originalSize.height,
+			cw = /sw|nw|w/.test( a ), ch = /nw|ne|n/.test( a );
+		if ( isminw ) {
+			data.width = o.minWidth;
+		}
+		if ( isminh ) {
+			data.height = o.minHeight;
+		}
+		if ( ismaxw ) {
+			data.width = o.maxWidth;
+		}
+		if ( ismaxh ) {
+			data.height = o.maxHeight;
 		}
-		this._updateAlternate( inst );

-		onSelect = this._get( inst, "onSelect" );
-		if ( onSelect ) {
-			onSelect.apply( ( inst.input ? inst.input[ 0 ] : null ), [ dateStr, inst ] );  // trigger custom callback
-		} else if ( inst.input ) {
-			inst.input.trigger( "change" ); // fire the change event
+		if ( isminw && cw ) {
+			data.left = dw - o.minWidth;
+		}
+		if ( ismaxw && cw ) {
+			data.left = dw - o.maxWidth;
+		}
+		if ( isminh && ch ) {
+			data.top = dh - o.minHeight;
+		}
+		if ( ismaxh && ch ) {
+			data.top = dh - o.maxHeight;
 		}

-		if ( inst.inline ) {
-			this._updateDatepicker( inst );
-		} else {
-			this._hideDatepicker();
-			this._lastInput = inst.input[ 0 ];
-			if ( typeof( inst.input[ 0 ] ) !== "object" ) {
-				inst.input.trigger( "focus" ); // restore focus
-			}
-			this._lastInput = null;
+		// Fixing jump error on top/left - bug #2330
+		if ( !data.width && !data.height && !data.left && data.top ) {
+			data.top = null;
+		} else if ( !data.width && !data.height && !data.top && data.left ) {
+			data.left = null;
 		}
+
+		return data;
 	},

-	/* Update any alternate field to synchronise with the main field. */
-	_updateAlternate: function( inst ) {
-		var altFormat, date, dateStr,
-			altField = this._get( inst, "altField" );
+	_getPaddingPlusBorderDimensions: function( element ) {
+		var i = 0,
+			widths = [],
+			borders = [
+				element.css( "borderTopWidth" ),
+				element.css( "borderRightWidth" ),
+				element.css( "borderBottomWidth" ),
+				element.css( "borderLeftWidth" )
+			],
+			paddings = [
+				element.css( "paddingTop" ),
+				element.css( "paddingRight" ),
+				element.css( "paddingBottom" ),
+				element.css( "paddingLeft" )
+			];

-		if ( altField ) { // update alternate field too
-			altFormat = this._get( inst, "altFormat" ) || this._get( inst, "dateFormat" );
-			date = this._getDate( inst );
-			dateStr = this.formatDate( altFormat, date, this._getFormatConfig( inst ) );
-			$( document ).find( altField ).val( dateStr );
+		for ( ; i < 4; i++ ) {
+			widths[ i ] = ( parseFloat( borders[ i ] ) || 0 );
+			widths[ i ] += ( parseFloat( paddings[ i ] ) || 0 );
 		}
-	},

-	/* Set as beforeShowDay function to prevent selection of weekends.
-	 * @param  date  Date - the date to customise
-	 * @return [boolean, string] - is this date selectable?, what is its CSS class?
-	 */
-	noWeekends: function( date ) {
-		var day = date.getDay();
-		return [ ( day > 0 && day < 6 ), "" ];
+		return {
+			height: widths[ 0 ] + widths[ 2 ],
+			width: widths[ 1 ] + widths[ 3 ]
+		};
 	},

-	/* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
-	 * @param  date  Date - the date to get the week for
-	 * @return  number - the number of the week within the year that contains this date
-	 */
-	iso8601Week: function( date ) {
-		var time,
-			checkDate = new Date( date.getTime() );
+	_proportionallyResize: function() {

-		// Find Thursday of this week starting on Monday
-		checkDate.setDate( checkDate.getDate() + 4 - ( checkDate.getDay() || 7 ) );
+		if ( !this._proportionallyResizeElements.length ) {
+			return;
+		}

-		time = checkDate.getTime();
-		checkDate.setMonth( 0 ); // Compare with Jan 1
-		checkDate.setDate( 1 );
-		return Math.floor( Math.round( ( time - checkDate ) / 86400000 ) / 7 ) + 1;
-	},
+		var prel,
+			i = 0,
+			element = this.helper || this.element;

-	/* Parse a string value into a date object.
-	 * See formatDate below for the possible formats.
-	 *
-	 * @param  format string - the expected format of the date
-	 * @param  value string - the date in the above format
-	 * @param  settings Object - attributes include:
-	 *					shortYearCutoff  number - the cutoff year for determining the century (optional)
-	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
-	 *					dayNames		string[7] - names of the days from Sunday (optional)
-	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
-	 *					monthNames		string[12] - names of the months (optional)
-	 * @return  Date - the extracted date value or null if value is blank
-	 */
-	parseDate: function( format, value, settings ) {
-		if ( format == null || value == null ) {
-			throw "Invalid arguments";
-		}
+		for ( ; i < this._proportionallyResizeElements.length; i++ ) {
+
+			prel = this._proportionallyResizeElements[ i ];
+
+			// TODO: Seems like a bug to cache this.outerDimensions
+			// considering that we are in a loop.
+			if ( !this.outerDimensions ) {
+				this.outerDimensions = this._getPaddingPlusBorderDimensions( prel );
+			}
+
+			prel.css( {
+				height: ( element.height() - this.outerDimensions.height ) || 0,
+				width: ( element.width() - this.outerDimensions.width ) || 0
+			} );

-		value = ( typeof value === "object" ? value.toString() : value + "" );
-		if ( value === "" ) {
-			return null;
 		}

-		var iFormat, dim, extra,
-			iValue = 0,
-			shortYearCutoffTemp = ( settings ? settings.shortYearCutoff : null ) || this._defaults.shortYearCutoff,
-			shortYearCutoff = ( typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
-				new Date().getFullYear() % 100 + parseInt( shortYearCutoffTemp, 10 ) ),
-			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
-			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
-			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
-			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,
-			year = -1,
-			month = -1,
-			day = -1,
-			doy = -1,
-			literal = false,
-			date,
+	},

-			// Check whether a format character is doubled
-			lookAhead = function( match ) {
-				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
-				if ( matches ) {
-					iFormat++;
-				}
-				return matches;
-			},
+	_renderProxy: function() {

-			// Extract a number from the string value
-			getNumber = function( match ) {
-				var isDoubled = lookAhead( match ),
-					size = ( match === "@" ? 14 : ( match === "!" ? 20 :
-					( match === "y" && isDoubled ? 4 : ( match === "o" ? 3 : 2 ) ) ) ),
-					minSize = ( match === "y" ? size : 1 ),
-					digits = new RegExp( "^\\d{" + minSize + "," + size + "}" ),
-					num = value.substring( iValue ).match( digits );
-				if ( !num ) {
-					throw "Missing number at position " + iValue;
-				}
-				iValue += num[ 0 ].length;
-				return parseInt( num[ 0 ], 10 );
-			},
+		var el = this.element, o = this.options;
+		this.elementOffset = el.offset();

-			// Extract a name from the string value and convert to an index
-			getName = function( match, shortNames, longNames ) {
-				var index = -1,
-					names = $.map( lookAhead( match ) ? longNames : shortNames, function( v, k ) {
-						return [ [ k, v ] ];
-					} ).sort( function( a, b ) {
-						return -( a[ 1 ].length - b[ 1 ].length );
-					} );
+		if ( this._helper ) {

-				$.each( names, function( i, pair ) {
-					var name = pair[ 1 ];
-					if ( value.substr( iValue, name.length ).toLowerCase() === name.toLowerCase() ) {
-						index = pair[ 0 ];
-						iValue += name.length;
-						return false;
-					}
-				} );
-				if ( index !== -1 ) {
-					return index + 1;
-				} else {
-					throw "Unknown name at position " + iValue;
-				}
-			},
+			this.helper = this.helper || $( "<div></div>" ).css( { overflow: "hidden" } );

-			// Confirm that a literal character matches the string value
-			checkLiteral = function() {
-				if ( value.charAt( iValue ) !== format.charAt( iFormat ) ) {
-					throw "Unexpected literal at position " + iValue;
-				}
-				iValue++;
-			};
+			this._addClass( this.helper, this._helper );
+			this.helper.css( {
+				width: this.element.outerWidth(),
+				height: this.element.outerHeight(),
+				position: "absolute",
+				left: this.elementOffset.left + "px",
+				top: this.elementOffset.top + "px",
+				zIndex: ++o.zIndex //TODO: Don't modify option
+			} );

-		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
-			if ( literal ) {
-				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
-					literal = false;
-				} else {
-					checkLiteral();
-				}
-			} else {
-				switch ( format.charAt( iFormat ) ) {
-					case "d":
-						day = getNumber( "d" );
-						break;
-					case "D":
-						getName( "D", dayNamesShort, dayNames );
-						break;
-					case "o":
-						doy = getNumber( "o" );
-						break;
-					case "m":
-						month = getNumber( "m" );
-						break;
-					case "M":
-						month = getName( "M", monthNamesShort, monthNames );
-						break;
-					case "y":
-						year = getNumber( "y" );
-						break;
-					case "@":
-						date = new Date( getNumber( "@" ) );
-						year = date.getFullYear();
-						month = date.getMonth() + 1;
-						day = date.getDate();
-						break;
-					case "!":
-						date = new Date( ( getNumber( "!" ) - this._ticksTo1970 ) / 10000 );
-						year = date.getFullYear();
-						month = date.getMonth() + 1;
-						day = date.getDate();
-						break;
-					case "'":
-						if ( lookAhead( "'" ) ) {
-							checkLiteral();
-						} else {
-							literal = true;
-						}
-						break;
-					default:
-						checkLiteral();
-				}
-			}
-		}
+			this.helper
+				.appendTo( "body" )
+				.disableSelection();

-		if ( iValue < value.length ) {
-			extra = value.substr( iValue );
-			if ( !/^\s+/.test( extra ) ) {
-				throw "Extra/unparsed characters found in date: " + extra;
-			}
+		} else {
+			this.helper = this.element;
 		}

-		if ( year === -1 ) {
-			year = new Date().getFullYear();
-		} else if ( year < 100 ) {
-			year += new Date().getFullYear() - new Date().getFullYear() % 100 +
-				( year <= shortYearCutoff ? 0 : -100 );
-		}
+	},

-		if ( doy > -1 ) {
-			month = 1;
-			day = doy;
-			do {
-				dim = this._getDaysInMonth( year, month - 1 );
-				if ( day <= dim ) {
-					break;
-				}
-				month++;
-				day -= dim;
-			} while ( true );
+	_change: {
+		e: function( event, dx ) {
+			return { width: this.originalSize.width + dx };
+		},
+		w: function( event, dx ) {
+			var cs = this.originalSize, sp = this.originalPosition;
+			return { left: sp.left + dx, width: cs.width - dx };
+		},
+		n: function( event, dx, dy ) {
+			var cs = this.originalSize, sp = this.originalPosition;
+			return { top: sp.top + dy, height: cs.height - dy };
+		},
+		s: function( event, dx, dy ) {
+			return { height: this.originalSize.height + dy };
+		},
+		se: function( event, dx, dy ) {
+			return $.extend( this._change.s.apply( this, arguments ),
+				this._change.e.apply( this, [ event, dx, dy ] ) );
+		},
+		sw: function( event, dx, dy ) {
+			return $.extend( this._change.s.apply( this, arguments ),
+				this._change.w.apply( this, [ event, dx, dy ] ) );
+		},
+		ne: function( event, dx, dy ) {
+			return $.extend( this._change.n.apply( this, arguments ),
+				this._change.e.apply( this, [ event, dx, dy ] ) );
+		},
+		nw: function( event, dx, dy ) {
+			return $.extend( this._change.n.apply( this, arguments ),
+				this._change.w.apply( this, [ event, dx, dy ] ) );
 		}
+	},

-		date = this._daylightSavingAdjust( new Date( year, month - 1, day ) );
-		if ( date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day ) {
-			throw "Invalid date"; // E.g. 31/02/00
+	_propagate: function( n, event ) {
+		$.ui.plugin.call( this, n, [ event, this.ui() ] );
+		if ( n !== "resize" ) {
+			this._trigger( n, event, this.ui() );
 		}
-		return date;
 	},

-	/* Standard date formats. */
-	ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
-	COOKIE: "D, dd M yy",
-	ISO_8601: "yy-mm-dd",
-	RFC_822: "D, d M y",
-	RFC_850: "DD, dd-M-y",
-	RFC_1036: "D, d M y",
-	RFC_1123: "D, d M yy",
-	RFC_2822: "D, d M yy",
-	RSS: "D, d M y", // RFC 822
-	TICKS: "!",
-	TIMESTAMP: "@",
-	W3C: "yy-mm-dd", // ISO 8601
+	plugins: {},

-	_ticksTo1970: ( ( ( 1970 - 1 ) * 365 + Math.floor( 1970 / 4 ) - Math.floor( 1970 / 100 ) +
-		Math.floor( 1970 / 400 ) ) * 24 * 60 * 60 * 10000000 ),
+	ui: function() {
+		return {
+			originalElement: this.originalElement,
+			element: this.element,
+			helper: this.helper,
+			position: this.position,
+			size: this.size,
+			originalSize: this.originalSize,
+			originalPosition: this.originalPosition
+		};
+	}

-	/* Format a date object into a string value.
-	 * The format can be combinations of the following:
-	 * d  - day of month (no leading zero)
-	 * dd - day of month (two digit)
-	 * o  - day of year (no leading zeros)
-	 * oo - day of year (three digit)
-	 * D  - day name short
-	 * DD - day name long
-	 * m  - month of year (no leading zero)
-	 * mm - month of year (two digit)
-	 * M  - month name short
-	 * MM - month name long
-	 * y  - year (two digit)
-	 * yy - year (four digit)
-	 * @ - Unix timestamp (ms since 01/01/1970)
-	 * ! - Windows ticks (100ns since 01/01/0001)
-	 * "..." - literal text
-	 * '' - single quote
-	 *
-	 * @param  format string - the desired format of the date
-	 * @param  date Date - the date value to format
-	 * @param  settings Object - attributes include:
-	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
-	 *					dayNames		string[7] - names of the days from Sunday (optional)
-	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
-	 *					monthNames		string[12] - names of the months (optional)
-	 * @return  string - the date in the above format
-	 */
-	formatDate: function( format, date, settings ) {
-		if ( !date ) {
-			return "";
-		}
+} );

-		var iFormat,
-			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
-			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
-			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
-			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,
+/*
+ * Resizable Extensions
+ */

-			// Check whether a format character is doubled
-			lookAhead = function( match ) {
-				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
-				if ( matches ) {
-					iFormat++;
-				}
-				return matches;
-			},
+$.ui.plugin.add( "resizable", "animate", {

-			// Format a number, with leading zero if necessary
-			formatNumber = function( match, value, len ) {
-				var num = "" + value;
-				if ( lookAhead( match ) ) {
-					while ( num.length < len ) {
-						num = "0" + num;
-					}
-				}
-				return num;
+	stop: function( event ) {
+		var that = $( this ).resizable( "instance" ),
+			o = that.options,
+			pr = that._proportionallyResizeElements,
+			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName ),
+			soffseth = ista && that._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height,
+			soffsetw = ista ? 0 : that.sizeDiff.width,
+			style = {
+				width: ( that.size.width - soffsetw ),
+				height: ( that.size.height - soffseth )
 			},
+			left = ( parseFloat( that.element.css( "left" ) ) +
+				( that.position.left - that.originalPosition.left ) ) || null,
+			top = ( parseFloat( that.element.css( "top" ) ) +
+				( that.position.top - that.originalPosition.top ) ) || null;

-			// Format a name, short or long as requested
-			formatName = function( match, value, shortNames, longNames ) {
-				return ( lookAhead( match ) ? longNames[ value ] : shortNames[ value ] );
-			},
-			output = "",
-			literal = false;
+		that.element.animate(
+			$.extend( style, top && left ? { top: top, left: left } : {} ), {
+				duration: o.animateDuration,
+				easing: o.animateEasing,
+				step: function() {

-		if ( date ) {
-			for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
-				if ( literal ) {
-					if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
-						literal = false;
-					} else {
-						output += format.charAt( iFormat );
-					}
-				} else {
-					switch ( format.charAt( iFormat ) ) {
-						case "d":
-							output += formatNumber( "d", date.getDate(), 2 );
-							break;
-						case "D":
-							output += formatName( "D", date.getDay(), dayNamesShort, dayNames );
-							break;
-						case "o":
-							output += formatNumber( "o",
-								Math.round( ( new Date( date.getFullYear(), date.getMonth(), date.getDate() ).getTime() - new Date( date.getFullYear(), 0, 0 ).getTime() ) / 86400000 ), 3 );
-							break;
-						case "m":
-							output += formatNumber( "m", date.getMonth() + 1, 2 );
-							break;
-						case "M":
-							output += formatName( "M", date.getMonth(), monthNamesShort, monthNames );
-							break;
-						case "y":
-							output += ( lookAhead( "y" ) ? date.getFullYear() :
-								( date.getFullYear() % 100 < 10 ? "0" : "" ) + date.getFullYear() % 100 );
-							break;
-						case "@":
-							output += date.getTime();
-							break;
-						case "!":
-							output += date.getTime() * 10000 + this._ticksTo1970;
-							break;
-						case "'":
-							if ( lookAhead( "'" ) ) {
-								output += "'";
-							} else {
-								literal = true;
-							}
-							break;
-						default:
-							output += format.charAt( iFormat );
-					}
-				}
-			}
-		}
-		return output;
-	},
+					var data = {
+						width: parseFloat( that.element.css( "width" ) ),
+						height: parseFloat( that.element.css( "height" ) ),
+						top: parseFloat( that.element.css( "top" ) ),
+						left: parseFloat( that.element.css( "left" ) )
+					};

-	/* Extract all possible characters from the date format. */
-	_possibleChars: function( format ) {
-		var iFormat,
-			chars = "",
-			literal = false,
+					if ( pr && pr.length ) {
+						$( pr[ 0 ] ).css( { width: data.width, height: data.height } );
+					}

-			// Check whether a format character is doubled
-			lookAhead = function( match ) {
-				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
-				if ( matches ) {
-					iFormat++;
-				}
-				return matches;
-			};
+					// Propagating resize, and updating values for each animation step
+					that._updateCache( data );
+					that._propagate( "resize", event );

-		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
-			if ( literal ) {
-				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
-					literal = false;
-				} else {
-					chars += format.charAt( iFormat );
-				}
-			} else {
-				switch ( format.charAt( iFormat ) ) {
-					case "d": case "m": case "y": case "@":
-						chars += "0123456789";
-						break;
-					case "D": case "M":
-						return null; // Accept anything
-					case "'":
-						if ( lookAhead( "'" ) ) {
-							chars += "'";
-						} else {
-							literal = true;
-						}
-						break;
-					default:
-						chars += format.charAt( iFormat );
 				}
 			}
-		}
-		return chars;
-	},
+		);
+	}

-	/* Get a setting value, defaulting if necessary. */
-	_get: function( inst, name ) {
-		return inst.settings[ name ] !== undefined ?
-			inst.settings[ name ] : this._defaults[ name ];
-	},
+} );

-	/* Parse existing date and initialise date picker. */
-	_setDateFromField: function( inst, noDefault ) {
-		if ( inst.input.val() === inst.lastVal ) {
-			return;
-		}
+$.ui.plugin.add( "resizable", "containment", {

-		var dateFormat = this._get( inst, "dateFormat" ),
-			dates = inst.lastVal = inst.input ? inst.input.val() : null,
-			defaultDate = this._getDefaultDate( inst ),
-			date = defaultDate,
-			settings = this._getFormatConfig( inst );
+	start: function() {
+		var element, p, co, ch, cw, width, height,
+			that = $( this ).resizable( "instance" ),
+			o = that.options,
+			el = that.element,
+			oc = o.containment,
+			ce = ( oc instanceof $ ) ?
+				oc.get( 0 ) :
+				( /parent/.test( oc ) ) ? el.parent().get( 0 ) : oc;

-		try {
-			date = this.parseDate( dateFormat, dates, settings ) || defaultDate;
-		} catch ( event ) {
-			dates = ( noDefault ? "" : dates );
+		if ( !ce ) {
+			return;
 		}
-		inst.selectedDay = date.getDate();
-		inst.drawMonth = inst.selectedMonth = date.getMonth();
-		inst.drawYear = inst.selectedYear = date.getFullYear();
-		inst.currentDay = ( dates ? date.getDate() : 0 );
-		inst.currentMonth = ( dates ? date.getMonth() : 0 );
-		inst.currentYear = ( dates ? date.getFullYear() : 0 );
-		this._adjustInstDate( inst );
-	},
-
-	/* Retrieve the default date shown on opening. */
-	_getDefaultDate: function( inst ) {
-		return this._restrictMinMax( inst,
-			this._determineDate( inst, this._get( inst, "defaultDate" ), new Date() ) );
-	},

-	/* A date may be specified as an exact value or a relative one. */
-	_determineDate: function( inst, date, defaultDate ) {
-		var offsetNumeric = function( offset ) {
-				var date = new Date();
-				date.setDate( date.getDate() + offset );
-				return date;
-			},
-			offsetString = function( offset ) {
-				try {
-					return $.datepicker.parseDate( $.datepicker._get( inst, "dateFormat" ),
-						offset, $.datepicker._getFormatConfig( inst ) );
-				} catch ( e ) {
+		that.containerElement = $( ce );

-					// Ignore
-				}
+		if ( /document/.test( oc ) || oc === document ) {
+			that.containerOffset = {
+				left: 0,
+				top: 0
+			};
+			that.containerPosition = {
+				left: 0,
+				top: 0
+			};

-				var date = ( offset.toLowerCase().match( /^c/ ) ?
-					$.datepicker._getDate( inst ) : null ) || new Date(),
-					year = date.getFullYear(),
-					month = date.getMonth(),
-					day = date.getDate(),
-					pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
-					matches = pattern.exec( offset );
+			that.parentData = {
+				element: $( document ),
+				left: 0,
+				top: 0,
+				width: $( document ).width(),
+				height: $( document ).height() || document.body.parentNode.scrollHeight
+			};
+		} else {
+			element = $( ce );
+			p = [];
+			$( [ "Top", "Right", "Left", "Bottom" ] ).each( function( i, name ) {
+				p[ i ] = that._num( element.css( "padding" + name ) );
+			} );

-				while ( matches ) {
-					switch ( matches[ 2 ] || "d" ) {
-						case "d" : case "D" :
-							day += parseInt( matches[ 1 ], 10 ); break;
-						case "w" : case "W" :
-							day += parseInt( matches[ 1 ], 10 ) * 7; break;
-						case "m" : case "M" :
-							month += parseInt( matches[ 1 ], 10 );
-							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
-							break;
-						case "y": case "Y" :
-							year += parseInt( matches[ 1 ], 10 );
-							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
-							break;
-					}
-					matches = pattern.exec( offset );
-				}
-				return new Date( year, month, day );
-			},
-			newDate = ( date == null || date === "" ? defaultDate : ( typeof date === "string" ? offsetString( date ) :
-				( typeof date === "number" ? ( isNaN( date ) ? defaultDate : offsetNumeric( date ) ) : new Date( date.getTime() ) ) ) );
+			that.containerOffset = element.offset();
+			that.containerPosition = element.position();
+			that.containerSize = {
+				height: ( element.innerHeight() - p[ 3 ] ),
+				width: ( element.innerWidth() - p[ 1 ] )
+			};

-		newDate = ( newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate );
-		if ( newDate ) {
-			newDate.setHours( 0 );
-			newDate.setMinutes( 0 );
-			newDate.setSeconds( 0 );
-			newDate.setMilliseconds( 0 );
-		}
-		return this._daylightSavingAdjust( newDate );
-	},
+			co = that.containerOffset;
+			ch = that.containerSize.height;
+			cw = that.containerSize.width;
+			width = ( that._hasScroll( ce, "left" ) ? ce.scrollWidth : cw );
+			height = ( that._hasScroll( ce ) ? ce.scrollHeight : ch );

-	/* Handle switch to/from daylight saving.
-	 * Hours may be non-zero on daylight saving cut-over:
-	 * > 12 when midnight changeover, but then cannot generate
-	 * midnight datetime, so jump to 1AM, otherwise reset.
-	 * @param  date  (Date) the date to check
-	 * @return  (Date) the corrected date
-	 */
-	_daylightSavingAdjust: function( date ) {
-		if ( !date ) {
-			return null;
+			that.parentData = {
+				element: ce,
+				left: co.left,
+				top: co.top,
+				width: width,
+				height: height
+			};
 		}
-		date.setHours( date.getHours() > 12 ? date.getHours() + 2 : 0 );
-		return date;
 	},

-	/* Set the date(s) directly. */
-	_setDate: function( inst, date, noChange ) {
-		var clear = !date,
-			origMonth = inst.selectedMonth,
-			origYear = inst.selectedYear,
-			newDate = this._restrictMinMax( inst, this._determineDate( inst, date, new Date() ) );
+	resize: function( event ) {
+		var woset, hoset, isParent, isOffsetRelative,
+			that = $( this ).resizable( "instance" ),
+			o = that.options,
+			co = that.containerOffset,
+			cp = that.position,
+			pRatio = that._aspectRatio || event.shiftKey,
+			cop = {
+				top: 0,
+				left: 0
+			},
+			ce = that.containerElement,
+			continueResize = true;

-		inst.selectedDay = inst.currentDay = newDate.getDate();
-		inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
-		inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
-		if ( ( origMonth !== inst.selectedMonth || origYear !== inst.selectedYear ) && !noChange ) {
-			this._notifyChange( inst );
-		}
-		this._adjustInstDate( inst );
-		if ( inst.input ) {
-			inst.input.val( clear ? "" : this._formatDate( inst ) );
+		if ( ce[ 0 ] !== document && ( /static/ ).test( ce.css( "position" ) ) ) {
+			cop = co;
 		}
-	},
-
-	/* Retrieve the date(s) directly. */
-	_getDate: function( inst ) {
-		var startDate = ( !inst.currentYear || ( inst.input && inst.input.val() === "" ) ? null :
-			this._daylightSavingAdjust( new Date(
-			inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
-			return startDate;
-	},
-
-	/* Attach the onxxx handlers.  These are declared statically so
-	 * they work with static code transformers like Caja.
-	 */
-	_attachHandlers: function( inst ) {
-		var stepMonths = this._get( inst, "stepMonths" ),
-			id = "#" + inst.id.replace( /\\\\/g, "\\" );
-		inst.dpDiv.find( "[data-handler]" ).map( function() {
-			var handler = {
-				prev: function() {
-					$.datepicker._adjustDate( id, -stepMonths, "M" );
-				},
-				next: function() {
-					$.datepicker._adjustDate( id, +stepMonths, "M" );
-				},
-				hide: function() {
-					$.datepicker._hideDatepicker();
-				},
-				today: function() {
-					$.datepicker._gotoToday( id );
-				},
-				selectDay: function() {
-					$.datepicker._selectDay( id, +this.getAttribute( "data-month" ), +this.getAttribute( "data-year" ), this );
-					return false;
-				},
-				selectMonth: function() {
-					$.datepicker._selectMonthYear( id, this, "M" );
-					return false;
-				},
-				selectYear: function() {
-					$.datepicker._selectMonthYear( id, this, "Y" );
-					return false;
-				}
-			};
-			$( this ).on( this.getAttribute( "data-event" ), handler[ this.getAttribute( "data-handler" ) ] );
-		} );
-	},

-	/* Generate the HTML for the current state of the date picker. */
-	_generateHTML: function( inst ) {
-		var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
-			controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
-			monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
-			selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
-			cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
-			printDate, dRow, tbody, daySettings, otherMonth, unselectable,
-			tempDate = new Date(),
-			today = this._daylightSavingAdjust(
-				new Date( tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate() ) ), // clear time
-			isRTL = this._get( inst, "isRTL" ),
-			showButtonPanel = this._get( inst, "showButtonPanel" ),
-			hideIfNoPrevNext = this._get( inst, "hideIfNoPrevNext" ),
-			navigationAsDateFormat = this._get( inst, "navigationAsDateFormat" ),
-			numMonths = this._getNumberOfMonths( inst ),
-			showCurrentAtPos = this._get( inst, "showCurrentAtPos" ),
-			stepMonths = this._get( inst, "stepMonths" ),
-			isMultiMonth = ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ),
-			currentDate = this._daylightSavingAdjust( ( !inst.currentDay ? new Date( 9999, 9, 9 ) :
-				new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) ),
-			minDate = this._getMinMaxDate( inst, "min" ),
-			maxDate = this._getMinMaxDate( inst, "max" ),
-			drawMonth = inst.drawMonth - showCurrentAtPos,
-			drawYear = inst.drawYear;
+		if ( cp.left < ( that._helper ? co.left : 0 ) ) {
+			that.size.width = that.size.width +
+				( that._helper ?
+					( that.position.left - co.left ) :
+					( that.position.left - cop.left ) );

-		if ( drawMonth < 0 ) {
-			drawMonth += 12;
-			drawYear--;
-		}
-		if ( maxDate ) {
-			maxDraw = this._daylightSavingAdjust( new Date( maxDate.getFullYear(),
-				maxDate.getMonth() - ( numMonths[ 0 ] * numMonths[ 1 ] ) + 1, maxDate.getDate() ) );
-			maxDraw = ( minDate && maxDraw < minDate ? minDate : maxDraw );
-			while ( this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 ) ) > maxDraw ) {
-				drawMonth--;
-				if ( drawMonth < 0 ) {
-					drawMonth = 11;
-					drawYear--;
-				}
+			if ( pRatio ) {
+				that.size.height = that.size.width / that.aspectRatio;
+				continueResize = false;
 			}
+			that.position.left = o.helper ? co.left : 0;
 		}
-		inst.drawMonth = drawMonth;
-		inst.drawYear = drawYear;

-		prevText = this._get( inst, "prevText" );
-		prevText = ( !navigationAsDateFormat ? prevText : this.formatDate( prevText,
-			this._daylightSavingAdjust( new Date( drawYear, drawMonth - stepMonths, 1 ) ),
-			this._getFormatConfig( inst ) ) );
+		if ( cp.top < ( that._helper ? co.top : 0 ) ) {
+			that.size.height = that.size.height +
+				( that._helper ?
+					( that.position.top - co.top ) :
+					that.position.top );

-		if ( this._canAdjustMonth( inst, -1, drawYear, drawMonth ) ) {
-			prev = $( "<a>" )
-				.attr( {
-					"class": "ui-datepicker-prev ui-corner-all",
-					"data-handler": "prev",
-					"data-event": "click",
-					title: prevText
-				} )
-				.append(
-					$( "<span>" )
-						.addClass( "ui-icon ui-icon-circle-triangle-" +
-							( isRTL ? "e" : "w" ) )
-						.text( prevText )
-				)[ 0 ].outerHTML;
-		} else if ( hideIfNoPrevNext ) {
-			prev = "";
-		} else {
-			prev = $( "<a>" )
-				.attr( {
-					"class": "ui-datepicker-prev ui-corner-all ui-state-disabled",
-					title: prevText
-				} )
-				.append(
-					$( "<span>" )
-						.addClass( "ui-icon ui-icon-circle-triangle-" +
-							( isRTL ? "e" : "w" ) )
-						.text( prevText )
-				)[ 0 ].outerHTML;
+			if ( pRatio ) {
+				that.size.width = that.size.height * that.aspectRatio;
+				continueResize = false;
+			}
+			that.position.top = that._helper ? co.top : 0;
 		}

-		nextText = this._get( inst, "nextText" );
-		nextText = ( !navigationAsDateFormat ? nextText : this.formatDate( nextText,
-			this._daylightSavingAdjust( new Date( drawYear, drawMonth + stepMonths, 1 ) ),
-			this._getFormatConfig( inst ) ) );
+		isParent = that.containerElement.get( 0 ) === that.element.parent().get( 0 );
+		isOffsetRelative = /relative|absolute/.test( that.containerElement.css( "position" ) );

-		if ( this._canAdjustMonth( inst, +1, drawYear, drawMonth ) ) {
-			next = $( "<a>" )
-				.attr( {
-					"class": "ui-datepicker-next ui-corner-all",
-					"data-handler": "next",
-					"data-event": "click",
-					title: nextText
-				} )
-				.append(
-					$( "<span>" )
-						.addClass( "ui-icon ui-icon-circle-triangle-" +
-							( isRTL ? "w" : "e" ) )
-						.text( nextText )
-				)[ 0 ].outerHTML;
-		} else if ( hideIfNoPrevNext ) {
-			next = "";
+		if ( isParent && isOffsetRelative ) {
+			that.offset.left = that.parentData.left + that.position.left;
+			that.offset.top = that.parentData.top + that.position.top;
 		} else {
-			next = $( "<a>" )
-				.attr( {
-					"class": "ui-datepicker-next ui-corner-all ui-state-disabled",
-					title: nextText
-				} )
-				.append(
-					$( "<span>" )
-						.attr( "class", "ui-icon ui-icon-circle-triangle-" +
-							( isRTL ? "w" : "e" ) )
-						.text( nextText )
-				)[ 0 ].outerHTML;
+			that.offset.left = that.element.offset().left;
+			that.offset.top = that.element.offset().top;
 		}

-		currentText = this._get( inst, "currentText" );
-		gotoDate = ( this._get( inst, "gotoCurrent" ) && inst.currentDay ? currentDate : today );
-		currentText = ( !navigationAsDateFormat ? currentText :
-			this.formatDate( currentText, gotoDate, this._getFormatConfig( inst ) ) );
+		woset = Math.abs( that.sizeDiff.width +
+			( that._helper ?
+				that.offset.left - cop.left :
+				( that.offset.left - co.left ) ) );

-		controls = "";
-		if ( !inst.inline ) {
-			controls = $( "<button>" )
-				.attr( {
-					type: "button",
-					"class": "ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all",
-					"data-handler": "hide",
-					"data-event": "click"
-				} )
-				.text( this._get( inst, "closeText" ) )[ 0 ].outerHTML;
-		}
+		hoset = Math.abs( that.sizeDiff.height +
+			( that._helper ?
+				that.offset.top - cop.top :
+				( that.offset.top - co.top ) ) );

-		buttonPanel = "";
-		if ( showButtonPanel ) {
-			buttonPanel = $( "<div class='ui-datepicker-buttonpane ui-widget-content'>" )
-				.append( isRTL ? controls : "" )
-				.append( this._isInRange( inst, gotoDate ) ?
-					$( "<button>" )
-						.attr( {
-							type: "button",
-							"class": "ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all",
-							"data-handler": "today",
-							"data-event": "click"
-						} )
-						.text( currentText ) :
-					"" )
-				.append( isRTL ? "" : controls )[ 0 ].outerHTML;
+		if ( woset + that.size.width >= that.parentData.width ) {
+			that.size.width = that.parentData.width - woset;
+			if ( pRatio ) {
+				that.size.height = that.size.width / that.aspectRatio;
+				continueResize = false;
+			}
 		}

-		firstDay = parseInt( this._get( inst, "firstDay" ), 10 );
-		firstDay = ( isNaN( firstDay ) ? 0 : firstDay );
-
-		showWeek = this._get( inst, "showWeek" );
-		dayNames = this._get( inst, "dayNames" );
-		dayNamesMin = this._get( inst, "dayNamesMin" );
-		monthNames = this._get( inst, "monthNames" );
-		monthNamesShort = this._get( inst, "monthNamesShort" );
-		beforeShowDay = this._get( inst, "beforeShowDay" );
-		showOtherMonths = this._get( inst, "showOtherMonths" );
-		selectOtherMonths = this._get( inst, "selectOtherMonths" );
-		defaultDate = this._getDefaultDate( inst );
-		html = "";
-
-		for ( row = 0; row < numMonths[ 0 ]; row++ ) {
-			group = "";
-			this.maxRows = 4;
-			for ( col = 0; col < numMonths[ 1 ]; col++ ) {
-				selectedDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, inst.selectedDay ) );
-				cornerClass = " ui-corner-all";
-				calender = "";
-				if ( isMultiMonth ) {
-					calender += "<div class='ui-datepicker-group";
-					if ( numMonths[ 1 ] > 1 ) {
-						switch ( col ) {
-							case 0: calender += " ui-datepicker-group-first";
-								cornerClass = " ui-corner-" + ( isRTL ? "right" : "left" ); break;
-							case numMonths[ 1 ] - 1: calender += " ui-datepicker-group-last";
-								cornerClass = " ui-corner-" + ( isRTL ? "left" : "right" ); break;
-							default: calender += " ui-datepicker-group-middle"; cornerClass = ""; break;
-						}
-					}
-					calender += "'>";
-				}
-				calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
-					( /all|left/.test( cornerClass ) && row === 0 ? ( isRTL ? next : prev ) : "" ) +
-					( /all|right/.test( cornerClass ) && row === 0 ? ( isRTL ? prev : next ) : "" ) +
-					this._generateMonthYearHeader( inst, drawMonth, drawYear, minDate, maxDate,
-					row > 0 || col > 0, monthNames, monthNamesShort ) + // draw month headers
-					"</div><table class='ui-datepicker-calendar'><thead>" +
-					"<tr>";
-				thead = ( showWeek ? "<th class='ui-datepicker-week-col'>" + this._get( inst, "weekHeader" ) + "</th>" : "" );
-				for ( dow = 0; dow < 7; dow++ ) { // days of the week
-					day = ( dow + firstDay ) % 7;
-					thead += "<th scope='col'" + ( ( dow + firstDay + 6 ) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "" ) + ">" +
-						"<span title='" + dayNames[ day ] + "'>" + dayNamesMin[ day ] + "</span></th>";
-				}
-				calender += thead + "</tr></thead><tbody>";
-				daysInMonth = this._getDaysInMonth( drawYear, drawMonth );
-				if ( drawYear === inst.selectedYear && drawMonth === inst.selectedMonth ) {
-					inst.selectedDay = Math.min( inst.selectedDay, daysInMonth );
-				}
-				leadDays = ( this._getFirstDayOfMonth( drawYear, drawMonth ) - firstDay + 7 ) % 7;
-				curRows = Math.ceil( ( leadDays + daysInMonth ) / 7 ); // calculate the number of rows to generate
-				numRows = ( isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows ); //If multiple months, use the higher number of rows (see #7043)
-				this.maxRows = numRows;
-				printDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 - leadDays ) );
-				for ( dRow = 0; dRow < numRows; dRow++ ) { // create date picker rows
-					calender += "<tr>";
-					tbody = ( !showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
-						this._get( inst, "calculateWeek" )( printDate ) + "</td>" );
-					for ( dow = 0; dow < 7; dow++ ) { // create date picker days
-						daySettings = ( beforeShowDay ?
-							beforeShowDay.apply( ( inst.input ? inst.input[ 0 ] : null ), [ printDate ] ) : [ true, "" ] );
-						otherMonth = ( printDate.getMonth() !== drawMonth );
-						unselectable = ( otherMonth && !selectOtherMonths ) || !daySettings[ 0 ] ||
-							( minDate && printDate < minDate ) || ( maxDate && printDate > maxDate );
-						tbody += "<td class='" +
-							( ( dow + firstDay + 6 ) % 7 >= 5 ? " ui-datepicker-week-end" : "" ) + // highlight weekends
-							( otherMonth ? " ui-datepicker-other-month" : "" ) + // highlight days from other months
-							( ( printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent ) || // user pressed key
-							( defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime() ) ?
-
-							// or defaultDate is current printedDate and defaultDate is selectedDate
-							" " + this._dayOverClass : "" ) + // highlight selected day
-							( unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "" ) +  // highlight unselectable days
-							( otherMonth && !showOtherMonths ? "" : " " + daySettings[ 1 ] + // highlight custom dates
-							( printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "" ) + // highlight selected day
-							( printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "" ) ) + "'" + // highlight today (if different)
-							( ( !otherMonth || showOtherMonths ) && daySettings[ 2 ] ? " title='" + daySettings[ 2 ].replace( /'/g, "&#39;" ) + "'" : "" ) + // cell title
-							( unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'" ) + ">" + // actions
-							( otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
-							( unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
-							( printDate.getTime() === today.getTime() ? " ui-state-highlight" : "" ) +
-							( printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "" ) + // highlight selected day
-							( otherMonth ? " ui-priority-secondary" : "" ) + // distinguish dates from other months
-							"' href='#' aria-current='" + ( printDate.getTime() === currentDate.getTime() ? "true" : "false" ) + // mark date as selected for screen reader
-							"' data-date='" + printDate.getDate() + // store date as data
-							"'>" + printDate.getDate() + "</a>" ) ) + "</td>"; // display selectable date
-						printDate.setDate( printDate.getDate() + 1 );
-						printDate = this._daylightSavingAdjust( printDate );
-					}
-					calender += tbody + "</tr>";
-				}
-				drawMonth++;
-				if ( drawMonth > 11 ) {
-					drawMonth = 0;
-					drawYear++;
-				}
-				calender += "</tbody></table>" + ( isMultiMonth ? "</div>" +
-							( ( numMonths[ 0 ] > 0 && col === numMonths[ 1 ] - 1 ) ? "<div class='ui-datepicker-row-break'></div>" : "" ) : "" );
-				group += calender;
+		if ( hoset + that.size.height >= that.parentData.height ) {
+			that.size.height = that.parentData.height - hoset;
+			if ( pRatio ) {
+				that.size.width = that.size.height * that.aspectRatio;
+				continueResize = false;
 			}
-			html += group;
 		}
-		html += buttonPanel;
-		inst._keyEvent = false;
-		return html;
-	},

-	/* Generate the month and year header. */
-	_generateMonthYearHeader: function( inst, drawMonth, drawYear, minDate, maxDate,
-			secondary, monthNames, monthNamesShort ) {
+		if ( !continueResize ) {
+			that.position.left = that.prevPosition.left;
+			that.position.top = that.prevPosition.top;
+			that.size.width = that.prevSize.width;
+			that.size.height = that.prevSize.height;
+		}
+	},

-		var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
-			changeMonth = this._get( inst, "changeMonth" ),
-			changeYear = this._get( inst, "changeYear" ),
-			showMonthAfterYear = this._get( inst, "showMonthAfterYear" ),
-			selectMonthLabel = this._get( inst, "selectMonthLabel" ),
-			selectYearLabel = this._get( inst, "selectYearLabel" ),
-			html = "<div class='ui-datepicker-title'>",
-			monthHtml = "";
+	stop: function() {
+		var that = $( this ).resizable( "instance" ),
+			o = that.options,
+			co = that.containerOffset,
+			cop = that.containerPosition,
+			ce = that.containerElement,
+			helper = $( that.helper ),
+			ho = helper.offset(),
+			w = helper.outerWidth() - that.sizeDiff.width,
+			h = helper.outerHeight() - that.sizeDiff.height;

-		// Month selection
-		if ( secondary || !changeMonth ) {
-			monthHtml += "<span class='ui-datepicker-month'>" + monthNames[ drawMonth ] + "</span>";
-		} else {
-			inMinYear = ( minDate && minDate.getFullYear() === drawYear );
-			inMaxYear = ( maxDate && maxDate.getFullYear() === drawYear );
-			monthHtml += "<select class='ui-datepicker-month' aria-label='" + selectMonthLabel + "' data-handler='selectMonth' data-event='change'>";
-			for ( month = 0; month < 12; month++ ) {
-				if ( ( !inMinYear || month >= minDate.getMonth() ) && ( !inMaxYear || month <= maxDate.getMonth() ) ) {
-					monthHtml += "<option value='" + month + "'" +
-						( month === drawMonth ? " selected='selected'" : "" ) +
-						">" + monthNamesShort[ month ] + "</option>";
-				}
-			}
-			monthHtml += "</select>";
+		if ( that._helper && !o.animate && ( /relative/ ).test( ce.css( "position" ) ) ) {
+			$( this ).css( {
+				left: ho.left - cop.left - co.left,
+				width: w,
+				height: h
+			} );
 		}

-		if ( !showMonthAfterYear ) {
-			html += monthHtml + ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" );
+		if ( that._helper && !o.animate && ( /static/ ).test( ce.css( "position" ) ) ) {
+			$( this ).css( {
+				left: ho.left - cop.left - co.left,
+				width: w,
+				height: h
+			} );
 		}
+	}
+} );

-		// Year selection
-		if ( !inst.yearshtml ) {
-			inst.yearshtml = "";
-			if ( secondary || !changeYear ) {
-				html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
-			} else {
-
-				// determine range of years to display
-				years = this._get( inst, "yearRange" ).split( ":" );
-				thisYear = new Date().getFullYear();
-				determineYear = function( value ) {
-					var year = ( value.match( /c[+\-].*/ ) ? drawYear + parseInt( value.substring( 1 ), 10 ) :
-						( value.match( /[+\-].*/ ) ? thisYear + parseInt( value, 10 ) :
-						parseInt( value, 10 ) ) );
-					return ( isNaN( year ) ? thisYear : year );
-				};
-				year = determineYear( years[ 0 ] );
-				endYear = Math.max( year, determineYear( years[ 1 ] || "" ) );
-				year = ( minDate ? Math.max( year, minDate.getFullYear() ) : year );
-				endYear = ( maxDate ? Math.min( endYear, maxDate.getFullYear() ) : endYear );
-				inst.yearshtml += "<select class='ui-datepicker-year' aria-label='" + selectYearLabel + "' data-handler='selectYear' data-event='change'>";
-				for ( ; year <= endYear; year++ ) {
-					inst.yearshtml += "<option value='" + year + "'" +
-						( year === drawYear ? " selected='selected'" : "" ) +
-						">" + year + "</option>";
-				}
-				inst.yearshtml += "</select>";
+$.ui.plugin.add( "resizable", "alsoResize", {

-				html += inst.yearshtml;
-				inst.yearshtml = null;
-			}
-		}
+	start: function() {
+		var that = $( this ).resizable( "instance" ),
+			o = that.options;

-		html += this._get( inst, "yearSuffix" );
-		if ( showMonthAfterYear ) {
-			html += ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" ) + monthHtml;
-		}
-		html += "</div>"; // Close datepicker_header
-		return html;
+		$( o.alsoResize ).each( function() {
+			var el = $( this );
+			el.data( "ui-resizable-alsoresize", {
+				width: parseFloat( el.width() ), height: parseFloat( el.height() ),
+				left: parseFloat( el.css( "left" ) ), top: parseFloat( el.css( "top" ) )
+			} );
+		} );
 	},

-	/* Adjust one of the date sub-fields. */
-	_adjustInstDate: function( inst, offset, period ) {
-		var year = inst.selectedYear + ( period === "Y" ? offset : 0 ),
-			month = inst.selectedMonth + ( period === "M" ? offset : 0 ),
-			day = Math.min( inst.selectedDay, this._getDaysInMonth( year, month ) ) + ( period === "D" ? offset : 0 ),
-			date = this._restrictMinMax( inst, this._daylightSavingAdjust( new Date( year, month, day ) ) );
+	resize: function( event, ui ) {
+		var that = $( this ).resizable( "instance" ),
+			o = that.options,
+			os = that.originalSize,
+			op = that.originalPosition,
+			delta = {
+				height: ( that.size.height - os.height ) || 0,
+				width: ( that.size.width - os.width ) || 0,
+				top: ( that.position.top - op.top ) || 0,
+				left: ( that.position.left - op.left ) || 0
+			};

-		inst.selectedDay = date.getDate();
-		inst.drawMonth = inst.selectedMonth = date.getMonth();
-		inst.drawYear = inst.selectedYear = date.getFullYear();
-		if ( period === "M" || period === "Y" ) {
-			this._notifyChange( inst );
-		}
-	},
+			$( o.alsoResize ).each( function() {
+				var el = $( this ), start = $( this ).data( "ui-resizable-alsoresize" ), style = {},
+					css = el.parents( ui.originalElement[ 0 ] ).length ?
+							[ "width", "height" ] :
+							[ "width", "height", "top", "left" ];

-	/* Ensure a date is within any min/max bounds. */
-	_restrictMinMax: function( inst, date ) {
-		var minDate = this._getMinMaxDate( inst, "min" ),
-			maxDate = this._getMinMaxDate( inst, "max" ),
-			newDate = ( minDate && date < minDate ? minDate : date );
-		return ( maxDate && newDate > maxDate ? maxDate : newDate );
-	},
+				$.each( css, function( i, prop ) {
+					var sum = ( start[ prop ] || 0 ) + ( delta[ prop ] || 0 );
+					if ( sum && sum >= 0 ) {
+						style[ prop ] = sum || null;
+					}
+				} );

-	/* Notify change of month/year. */
-	_notifyChange: function( inst ) {
-		var onChange = this._get( inst, "onChangeMonthYear" );
-		if ( onChange ) {
-			onChange.apply( ( inst.input ? inst.input[ 0 ] : null ),
-				[ inst.selectedYear, inst.selectedMonth + 1, inst ] );
-		}
+				el.css( style );
+			} );
 	},

-	/* Determine the number of months to show. */
-	_getNumberOfMonths: function( inst ) {
-		var numMonths = this._get( inst, "numberOfMonths" );
-		return ( numMonths == null ? [ 1, 1 ] : ( typeof numMonths === "number" ? [ 1, numMonths ] : numMonths ) );
-	},
+	stop: function() {
+		$( this ).removeData( "ui-resizable-alsoresize" );
+	}
+} );

-	/* Determine the current maximum date - ensure no time components are set. */
-	_getMinMaxDate: function( inst, minMax ) {
-		return this._determineDate( inst, this._get( inst, minMax + "Date" ), null );
-	},
+$.ui.plugin.add( "resizable", "ghost", {

-	/* Find the number of days in a given month. */
-	_getDaysInMonth: function( year, month ) {
-		return 32 - this._daylightSavingAdjust( new Date( year, month, 32 ) ).getDate();
-	},
+	start: function() {

-	/* Find the day of the week of the first of a month. */
-	_getFirstDayOfMonth: function( year, month ) {
-		return new Date( year, month, 1 ).getDay();
-	},
+		var that = $( this ).resizable( "instance" ), cs = that.size;

-	/* Determines if we should allow a "next/prev" month display change. */
-	_canAdjustMonth: function( inst, offset, curYear, curMonth ) {
-		var numMonths = this._getNumberOfMonths( inst ),
-			date = this._daylightSavingAdjust( new Date( curYear,
-			curMonth + ( offset < 0 ? offset : numMonths[ 0 ] * numMonths[ 1 ] ), 1 ) );
+		that.ghost = that.originalElement.clone();
+		that.ghost.css( {
+			opacity: 0.25,
+			display: "block",
+			position: "relative",
+			height: cs.height,
+			width: cs.width,
+			margin: 0,
+			left: 0,
+			top: 0
+		} );

-		if ( offset < 0 ) {
-			date.setDate( this._getDaysInMonth( date.getFullYear(), date.getMonth() ) );
+		that._addClass( that.ghost, "ui-resizable-ghost" );
+
+		// DEPRECATED
+		// TODO: remove after 1.12
+		if ( $.uiBackCompat !== false && typeof that.options.ghost === "string" ) {
+
+			// Ghost option
+			that.ghost.addClass( this.options.ghost );
 		}
-		return this._isInRange( inst, date );
-	},

-	/* Is the given date in the accepted range? */
-	_isInRange: function( inst, date ) {
-		var yearSplit, currentYear,
-			minDate = this._getMinMaxDate( inst, "min" ),
-			maxDate = this._getMinMaxDate( inst, "max" ),
-			minYear = null,
-			maxYear = null,
-			years = this._get( inst, "yearRange" );
-			if ( years ) {
-				yearSplit = years.split( ":" );
-				currentYear = new Date().getFullYear();
-				minYear = parseInt( yearSplit[ 0 ], 10 );
-				maxYear = parseInt( yearSplit[ 1 ], 10 );
-				if ( yearSplit[ 0 ].match( /[+\-].*/ ) ) {
-					minYear += currentYear;
-				}
-				if ( yearSplit[ 1 ].match( /[+\-].*/ ) ) {
-					maxYear += currentYear;
-				}
-			}
+		that.ghost.appendTo( that.helper );

-		return ( ( !minDate || date.getTime() >= minDate.getTime() ) &&
-			( !maxDate || date.getTime() <= maxDate.getTime() ) &&
-			( !minYear || date.getFullYear() >= minYear ) &&
-			( !maxYear || date.getFullYear() <= maxYear ) );
 	},

-	/* Provide the configuration settings for formatting/parsing. */
-	_getFormatConfig: function( inst ) {
-		var shortYearCutoff = this._get( inst, "shortYearCutoff" );
-		shortYearCutoff = ( typeof shortYearCutoff !== "string" ? shortYearCutoff :
-			new Date().getFullYear() % 100 + parseInt( shortYearCutoff, 10 ) );
-		return { shortYearCutoff: shortYearCutoff,
-			dayNamesShort: this._get( inst, "dayNamesShort" ), dayNames: this._get( inst, "dayNames" ),
-			monthNamesShort: this._get( inst, "monthNamesShort" ), monthNames: this._get( inst, "monthNames" ) };
+	resize: function() {
+		var that = $( this ).resizable( "instance" );
+		if ( that.ghost ) {
+			that.ghost.css( {
+				position: "relative",
+				height: that.size.height,
+				width: that.size.width
+			} );
+		}
 	},

-	/* Format the given date for display. */
-	_formatDate: function( inst, day, month, year ) {
-		if ( !day ) {
-			inst.currentDay = inst.selectedDay;
-			inst.currentMonth = inst.selectedMonth;
-			inst.currentYear = inst.selectedYear;
+	stop: function() {
+		var that = $( this ).resizable( "instance" );
+		if ( that.ghost && that.helper ) {
+			that.helper.get( 0 ).removeChild( that.ghost.get( 0 ) );
 		}
-		var date = ( day ? ( typeof day === "object" ? day :
-			this._daylightSavingAdjust( new Date( year, month, day ) ) ) :
-			this._daylightSavingAdjust( new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
-		return this.formatDate( this._get( inst, "dateFormat" ), date, this._getFormatConfig( inst ) );
 	}
+
 } );

-/*
- * Bind hover events for datepicker elements.
- * Done via delegate so the binding only occurs once in the lifetime of the parent div.
- * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
- */
-function datepicker_bindHover( dpDiv ) {
-	var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
-	return dpDiv.on( "mouseout", selector, function() {
-			$( this ).removeClass( "ui-state-hover" );
-			if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
-				$( this ).removeClass( "ui-datepicker-prev-hover" );
-			}
-			if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
-				$( this ).removeClass( "ui-datepicker-next-hover" );
-			}
-		} )
-		.on( "mouseover", selector, datepicker_handleMouseover );
-}
+$.ui.plugin.add( "resizable", "grid", {

-function datepicker_handleMouseover() {
-	if ( !$.datepicker._isDisabledDatepicker( datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[ 0 ] : datepicker_instActive.input[ 0 ] ) ) {
-		$( this ).parents( ".ui-datepicker-calendar" ).find( "a" ).removeClass( "ui-state-hover" );
-		$( this ).addClass( "ui-state-hover" );
-		if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
-			$( this ).addClass( "ui-datepicker-prev-hover" );
+	resize: function() {
+		var outerDimensions,
+			that = $( this ).resizable( "instance" ),
+			o = that.options,
+			cs = that.size,
+			os = that.originalSize,
+			op = that.originalPosition,
+			a = that.axis,
+			grid = typeof o.grid === "number" ? [ o.grid, o.grid ] : o.grid,
+			gridX = ( grid[ 0 ] || 1 ),
+			gridY = ( grid[ 1 ] || 1 ),
+			ox = Math.round( ( cs.width - os.width ) / gridX ) * gridX,
+			oy = Math.round( ( cs.height - os.height ) / gridY ) * gridY,
+			newWidth = os.width + ox,
+			newHeight = os.height + oy,
+			isMaxWidth = o.maxWidth && ( o.maxWidth < newWidth ),
+			isMaxHeight = o.maxHeight && ( o.maxHeight < newHeight ),
+			isMinWidth = o.minWidth && ( o.minWidth > newWidth ),
+			isMinHeight = o.minHeight && ( o.minHeight > newHeight );
+
+		o.grid = grid;
+
+		if ( isMinWidth ) {
+			newWidth += gridX;
 		}
-		if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
-			$( this ).addClass( "ui-datepicker-next-hover" );
+		if ( isMinHeight ) {
+			newHeight += gridY;
 		}
-	}
-}
-
-/* jQuery extend now ignores nulls! */
-function datepicker_extendRemove( target, props ) {
-	$.extend( target, props );
-	for ( var name in props ) {
-		if ( props[ name ] == null ) {
-			target[ name ] = props[ name ];
+		if ( isMaxWidth ) {
+			newWidth -= gridX;
+		}
+		if ( isMaxHeight ) {
+			newHeight -= gridY;
 		}
-	}
-	return target;
-}
-
-/* Invoke the datepicker functionality.
-   @param  options  string - a command, optionally followed by additional parameters or
-					Object - settings for attaching new datepicker functionality
-   @return  jQuery object */
-$.fn.datepicker = function( options ) {
-
-	/* Verify an empty collection wasn't passed - Fixes #6976 */
-	if ( !this.length ) {
-		return this;
-	}
-
-	/* Initialise the date picker. */
-	if ( !$.datepicker.initialized ) {
-		$( document ).on( "mousedown", $.datepicker._checkExternalClick );
-		$.datepicker.initialized = true;
-	}
-
-	/* Append datepicker main container to body if not exist. */
-	if ( $( "#" + $.datepicker._mainDivId ).length === 0 ) {
-		$( "body" ).append( $.datepicker.dpDiv );
-	}

-	var otherArgs = Array.prototype.slice.call( arguments, 1 );
-	if ( typeof options === "string" && ( options === "isDisabled" || options === "getDate" || options === "widget" ) ) {
-		return $.datepicker[ "_" + options + "Datepicker" ].
-			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
-	}
-	if ( options === "option" && arguments.length === 2 && typeof arguments[ 1 ] === "string" ) {
-		return $.datepicker[ "_" + options + "Datepicker" ].
-			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
-	}
-	return this.each( function() {
-		if ( typeof options === "string" ) {
-			$.datepicker[ "_" + options + "Datepicker" ]
-				.apply( $.datepicker, [ this ].concat( otherArgs ) );
+		if ( /^(se|s|e)$/.test( a ) ) {
+			that.size.width = newWidth;
+			that.size.height = newHeight;
+		} else if ( /^(ne)$/.test( a ) ) {
+			that.size.width = newWidth;
+			that.size.height = newHeight;
+			that.position.top = op.top - oy;
+		} else if ( /^(sw)$/.test( a ) ) {
+			that.size.width = newWidth;
+			that.size.height = newHeight;
+			that.position.left = op.left - ox;
 		} else {
-			$.datepicker._attachDatepicker( this, options );
+			if ( newHeight - gridY <= 0 || newWidth - gridX <= 0 ) {
+				outerDimensions = that._getPaddingPlusBorderDimensions( this );
+			}
+
+			if ( newHeight - gridY > 0 ) {
+				that.size.height = newHeight;
+				that.position.top = op.top - oy;
+			} else {
+				newHeight = gridY - outerDimensions.height;
+				that.size.height = newHeight;
+				that.position.top = op.top + os.height - newHeight;
+			}
+			if ( newWidth - gridX > 0 ) {
+				that.size.width = newWidth;
+				that.position.left = op.left - ox;
+			} else {
+				newWidth = gridX - outerDimensions.width;
+				that.size.width = newWidth;
+				that.position.left = op.left + os.width - newWidth;
+			}
 		}
-	} );
-};
+	}

-$.datepicker = new Datepicker(); // singleton instance
-$.datepicker.initialized = false;
-$.datepicker.uuid = new Date().getTime();
-$.datepicker.version = "1.13.1";
+} );

-var widgetsDatepicker = $.datepicker;
+var widgetsResizable = $.ui.resizable;


 /*!
- * jQuery UI Dialog 1.13.1
+ * jQuery UI Dialog 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -12001,7 +12240,7 @@


 $.widget( "ui.dialog", {
-	version: "1.13.1",
+	version: "1.13.2",
 	options: {
 		appendTo: "body",
 		autoOpen: true,
@@ -12907,7 +13146,490 @@


 /*!
- * jQuery UI Progressbar 1.13.1
+ * jQuery UI Droppable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Droppable
+//>>group: Interactions
+//>>description: Enables drop targets for draggable elements.
+//>>docs: http://api.jqueryui.com/droppable/
+//>>demos: http://jqueryui.com/droppable/
+
+
+$.widget( "ui.droppable", {
+	version: "1.13.2",
+	widgetEventPrefix: "drop",
+	options: {
+		accept: "*",
+		addClasses: true,
+		greedy: false,
+		scope: "default",
+		tolerance: "intersect",
+
+		// Callbacks
+		activate: null,
+		deactivate: null,
+		drop: null,
+		out: null,
+		over: null
+	},
+	_create: function() {
+
+		var proportions,
+			o = this.options,
+			accept = o.accept;
+
+		this.isover = false;
+		this.isout = true;
+
+		this.accept = typeof accept === "function" ? accept : function( d ) {
+			return d.is( accept );
+		};
+
+		this.proportions = function( /* valueToWrite */ ) {
+			if ( arguments.length ) {
+
+				// Store the droppable's proportions
+				proportions = arguments[ 0 ];
+			} else {
+
+				// Retrieve or derive the droppable's proportions
+				return proportions ?
+					proportions :
+					proportions = {
+						width: this.element[ 0 ].offsetWidth,
+						height: this.element[ 0 ].offsetHeight
+					};
+			}
+		};
+
+		this._addToManager( o.scope );
+
+		if ( o.addClasses ) {
+			this._addClass( "ui-droppable" );
+		}
+
+	},
+
+	_addToManager: function( scope ) {
+
+		// Add the reference and positions to the manager
+		$.ui.ddmanager.droppables[ scope ] = $.ui.ddmanager.droppables[ scope ] || [];
+		$.ui.ddmanager.droppables[ scope ].push( this );
+	},
+
+	_splice: function( drop ) {
+		var i = 0;
+		for ( ; i < drop.length; i++ ) {
+			if ( drop[ i ] === this ) {
+				drop.splice( i, 1 );
+			}
+		}
+	},
+
+	_destroy: function() {
+		var drop = $.ui.ddmanager.droppables[ this.options.scope ];
+
+		this._splice( drop );
+	},
+
+	_setOption: function( key, value ) {
+
+		if ( key === "accept" ) {
+			this.accept = typeof value === "function" ? value : function( d ) {
+				return d.is( value );
+			};
+		} else if ( key === "scope" ) {
+			var drop = $.ui.ddmanager.droppables[ this.options.scope ];
+
+			this._splice( drop );
+			this._addToManager( value );
+		}
+
+		this._super( key, value );
+	},
+
+	_activate: function( event ) {
+		var draggable = $.ui.ddmanager.current;
+
+		this._addActiveClass();
+		if ( draggable ) {
+			this._trigger( "activate", event, this.ui( draggable ) );
+		}
+	},
+
+	_deactivate: function( event ) {
+		var draggable = $.ui.ddmanager.current;
+
+		this._removeActiveClass();
+		if ( draggable ) {
+			this._trigger( "deactivate", event, this.ui( draggable ) );
+		}
+	},
+
+	_over: function( event ) {
+
+		var draggable = $.ui.ddmanager.current;
+
+		// Bail if draggable and droppable are same element
+		if ( !draggable || ( draggable.currentItem ||
+				draggable.element )[ 0 ] === this.element[ 0 ] ) {
+			return;
+		}
+
+		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
+				draggable.element ) ) ) {
+			this._addHoverClass();
+			this._trigger( "over", event, this.ui( draggable ) );
+		}
+
+	},
+
+	_out: function( event ) {
+
+		var draggable = $.ui.ddmanager.current;
+
+		// Bail if draggable and droppable are same element
+		if ( !draggable || ( draggable.currentItem ||
+				draggable.element )[ 0 ] === this.element[ 0 ] ) {
+			return;
+		}
+
+		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
+				draggable.element ) ) ) {
+			this._removeHoverClass();
+			this._trigger( "out", event, this.ui( draggable ) );
+		}
+
+	},
+
+	_drop: function( event, custom ) {
+
+		var draggable = custom || $.ui.ddmanager.current,
+			childrenIntersection = false;
+
+		// Bail if draggable and droppable are same element
+		if ( !draggable || ( draggable.currentItem ||
+				draggable.element )[ 0 ] === this.element[ 0 ] ) {
+			return false;
+		}
+
+		this.element
+			.find( ":data(ui-droppable)" )
+			.not( ".ui-draggable-dragging" )
+			.each( function() {
+				var inst = $( this ).droppable( "instance" );
+				if (
+					inst.options.greedy &&
+					!inst.options.disabled &&
+					inst.options.scope === draggable.options.scope &&
+					inst.accept.call(
+						inst.element[ 0 ], ( draggable.currentItem || draggable.element )
+					) &&
+					$.ui.intersect(
+						draggable,
+						$.extend( inst, { offset: inst.element.offset() } ),
+						inst.options.tolerance, event
+					)
+				) {
+					childrenIntersection = true;
+					return false;
+				}
+			} );
+		if ( childrenIntersection ) {
+			return false;
+		}
+
+		if ( this.accept.call( this.element[ 0 ],
+				( draggable.currentItem || draggable.element ) ) ) {
+			this._removeActiveClass();
+			this._removeHoverClass();
+
+			this._trigger( "drop", event, this.ui( draggable ) );
+			return this.element;
+		}
+
+		return false;
+
+	},
+
+	ui: function( c ) {
+		return {
+			draggable: ( c.currentItem || c.element ),
+			helper: c.helper,
+			position: c.position,
+			offset: c.positionAbs
+		};
+	},
+
+	// Extension points just to make backcompat sane and avoid duplicating logic
+	// TODO: Remove in 1.14 along with call to it below
+	_addHoverClass: function() {
+		this._addClass( "ui-droppable-hover" );
+	},
+
+	_removeHoverClass: function() {
+		this._removeClass( "ui-droppable-hover" );
+	},
+
+	_addActiveClass: function() {
+		this._addClass( "ui-droppable-active" );
+	},
+
+	_removeActiveClass: function() {
+		this._removeClass( "ui-droppable-active" );
+	}
+} );
+
+$.ui.intersect = ( function() {
+	function isOverAxis( x, reference, size ) {
+		return ( x >= reference ) && ( x < ( reference + size ) );
+	}
+
+	return function( draggable, droppable, toleranceMode, event ) {
+
+		if ( !droppable.offset ) {
+			return false;
+		}
+
+		var x1 = ( draggable.positionAbs ||
+				draggable.position.absolute ).left + draggable.margins.left,
+			y1 = ( draggable.positionAbs ||
+				draggable.position.absolute ).top + draggable.margins.top,
+			x2 = x1 + draggable.helperProportions.width,
+			y2 = y1 + draggable.helperProportions.height,
+			l = droppable.offset.left,
+			t = droppable.offset.top,
+			r = l + droppable.proportions().width,
+			b = t + droppable.proportions().height;
+
+		switch ( toleranceMode ) {
+		case "fit":
+			return ( l <= x1 && x2 <= r && t <= y1 && y2 <= b );
+		case "intersect":
+			return ( l < x1 + ( draggable.helperProportions.width / 2 ) && // Right Half
+				x2 - ( draggable.helperProportions.width / 2 ) < r && // Left Half
+				t < y1 + ( draggable.helperProportions.height / 2 ) && // Bottom Half
+				y2 - ( draggable.helperProportions.height / 2 ) < b ); // Top Half
+		case "pointer":
+			return isOverAxis( event.pageY, t, droppable.proportions().height ) &&
+				isOverAxis( event.pageX, l, droppable.proportions().width );
+		case "touch":
+			return (
+				( y1 >= t && y1 <= b ) || // Top edge touching
+				( y2 >= t && y2 <= b ) || // Bottom edge touching
+				( y1 < t && y2 > b ) // Surrounded vertically
+			) && (
+				( x1 >= l && x1 <= r ) || // Left edge touching
+				( x2 >= l && x2 <= r ) || // Right edge touching
+				( x1 < l && x2 > r ) // Surrounded horizontally
+			);
+		default:
+			return false;
+		}
+	};
+} )();
+
+/*
+	This manager tracks offsets of draggables and droppables
+*/
+$.ui.ddmanager = {
+	current: null,
+	droppables: { "default": [] },
+	prepareOffsets: function( t, event ) {
+
+		var i, j,
+			m = $.ui.ddmanager.droppables[ t.options.scope ] || [],
+			type = event ? event.type : null, // workaround for #2317
+			list = ( t.currentItem || t.element ).find( ":data(ui-droppable)" ).addBack();
+
+		droppablesLoop: for ( i = 0; i < m.length; i++ ) {
+
+			// No disabled and non-accepted
+			if ( m[ i ].options.disabled || ( t && !m[ i ].accept.call( m[ i ].element[ 0 ],
+					( t.currentItem || t.element ) ) ) ) {
+				continue;
+			}
+
+			// Filter out elements in the current dragged item
+			for ( j = 0; j < list.length; j++ ) {
+				if ( list[ j ] === m[ i ].element[ 0 ] ) {
+					m[ i ].proportions().height = 0;
+					continue droppablesLoop;
+				}
+			}
+
+			m[ i ].visible = m[ i ].element.css( "display" ) !== "none";
+			if ( !m[ i ].visible ) {
+				continue;
+			}
+
+			// Activate the droppable if used directly from draggables
+			if ( type === "mousedown" ) {
+				m[ i ]._activate.call( m[ i ], event );
+			}
+
+			m[ i ].offset = m[ i ].element.offset();
+			m[ i ].proportions( {
+				width: m[ i ].element[ 0 ].offsetWidth,
+				height: m[ i ].element[ 0 ].offsetHeight
+			} );
+
+		}
+
+	},
+	drop: function( draggable, event ) {
+
+		var dropped = false;
+
+		// Create a copy of the droppables in case the list changes during the drop (#9116)
+		$.each( ( $.ui.ddmanager.droppables[ draggable.options.scope ] || [] ).slice(), function() {
+
+			if ( !this.options ) {
+				return;
+			}
+			if ( !this.options.disabled && this.visible &&
+					$.ui.intersect( draggable, this, this.options.tolerance, event ) ) {
+				dropped = this._drop.call( this, event ) || dropped;
+			}
+
+			if ( !this.options.disabled && this.visible && this.accept.call( this.element[ 0 ],
+					( draggable.currentItem || draggable.element ) ) ) {
+				this.isout = true;
+				this.isover = false;
+				this._deactivate.call( this, event );
+			}
+
+		} );
+		return dropped;
+
+	},
+	dragStart: function( draggable, event ) {
+
+		// Listen for scrolling so that if the dragging causes scrolling the position of the
+		// droppables can be recalculated (see #5003)
+		draggable.element.parentsUntil( "body" ).on( "scroll.droppable", function() {
+			if ( !draggable.options.refreshPositions ) {
+				$.ui.ddmanager.prepareOffsets( draggable, event );
+			}
+		} );
+	},
+	drag: function( draggable, event ) {
+
+		// If you have a highly dynamic page, you might try this option. It renders positions
+		// every time you move the mouse.
+		if ( draggable.options.refreshPositions ) {
+			$.ui.ddmanager.prepareOffsets( draggable, event );
+		}
+
+		// Run through all droppables and check their positions based on specific tolerance options
+		$.each( $.ui.ddmanager.droppables[ draggable.options.scope ] || [], function() {
+
+			if ( this.options.disabled || this.greedyChild || !this.visible ) {
+				return;
+			}
+
+			var parentInstance, scope, parent,
+				intersects = $.ui.intersect( draggable, this, this.options.tolerance, event ),
+				c = !intersects && this.isover ?
+					"isout" :
+					( intersects && !this.isover ? "isover" : null );
+			if ( !c ) {
+				return;
+			}
+
+			if ( this.options.greedy ) {
+
+				// find droppable parents with same scope
+				scope = this.options.scope;
+				parent = this.element.parents( ":data(ui-droppable)" ).filter( function() {
+					return $( this ).droppable( "instance" ).options.scope === scope;
+				} );
+
+				if ( parent.length ) {
+					parentInstance = $( parent[ 0 ] ).droppable( "instance" );
+					parentInstance.greedyChild = ( c === "isover" );
+				}
+			}
+
+			// We just moved into a greedy child
+			if ( parentInstance && c === "isover" ) {
+				parentInstance.isover = false;
+				parentInstance.isout = true;
+				parentInstance._out.call( parentInstance, event );
+			}
+
+			this[ c ] = true;
+			this[ c === "isout" ? "isover" : "isout" ] = false;
+			this[ c === "isover" ? "_over" : "_out" ].call( this, event );
+
+			// We just moved out of a greedy child
+			if ( parentInstance && c === "isout" ) {
+				parentInstance.isout = false;
+				parentInstance.isover = true;
+				parentInstance._over.call( parentInstance, event );
+			}
+		} );
+
+	},
+	dragStop: function( draggable, event ) {
+		draggable.element.parentsUntil( "body" ).off( "scroll.droppable" );
+
+		// Call prepareOffsets one final time since IE does not fire return scroll events when
+		// overflow was caused by drag (see #5003)
+		if ( !draggable.options.refreshPositions ) {
+			$.ui.ddmanager.prepareOffsets( draggable, event );
+		}
+	}
+};
+
+// DEPRECATED
+// TODO: switch return back to widget declaration at top of file when this is removed
+if ( $.uiBackCompat !== false ) {
+
+	// Backcompat for activeClass and hoverClass options
+	$.widget( "ui.droppable", $.ui.droppable, {
+		options: {
+			hoverClass: false,
+			activeClass: false
+		},
+		_addActiveClass: function() {
+			this._super();
+			if ( this.options.activeClass ) {
+				this.element.addClass( this.options.activeClass );
+			}
+		},
+		_removeActiveClass: function() {
+			this._super();
+			if ( this.options.activeClass ) {
+				this.element.removeClass( this.options.activeClass );
+			}
+		},
+		_addHoverClass: function() {
+			this._super();
+			if ( this.options.hoverClass ) {
+				this.element.addClass( this.options.hoverClass );
+			}
+		},
+		_removeHoverClass: function() {
+			this._super();
+			if ( this.options.hoverClass ) {
+				this.element.removeClass( this.options.hoverClass );
+			}
+		}
+	} );
+}
+
+var widgetsDroppable = $.ui.droppable;
+
+
+/*!
+ * jQuery UI Progressbar 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -12928,7 +13650,7 @@


 var widgetsProgressbar = $.widget( "ui.progressbar", {
-	version: "1.13.1",
+	version: "1.13.2",
 	options: {
 		classes: {
 			"ui-progressbar": "ui-corner-all",
@@ -13070,7 +13792,305 @@


 /*!
- * jQuery UI Selectmenu 1.13.1
+ * jQuery UI Selectable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Selectable
+//>>group: Interactions
+//>>description: Allows groups of elements to be selected with the mouse.
+//>>docs: http://api.jqueryui.com/selectable/
+//>>demos: http://jqueryui.com/selectable/
+//>>css.structure: ../../themes/base/selectable.css
+
+
+var widgetsSelectable = $.widget( "ui.selectable", $.ui.mouse, {
+	version: "1.13.2",
+	options: {
+		appendTo: "body",
+		autoRefresh: true,
+		distance: 0,
+		filter: "*",
+		tolerance: "touch",
+
+		// Callbacks
+		selected: null,
+		selecting: null,
+		start: null,
+		stop: null,
+		unselected: null,
+		unselecting: null
+	},
+	_create: function() {
+		var that = this;
+
+		this._addClass( "ui-selectable" );
+
+		this.dragged = false;
+
+		// Cache selectee children based on filter
+		this.refresh = function() {
+			that.elementPos = $( that.element[ 0 ] ).offset();
+			that.selectees = $( that.options.filter, that.element[ 0 ] );
+			that._addClass( that.selectees, "ui-selectee" );
+			that.selectees.each( function() {
+				var $this = $( this ),
+					selecteeOffset = $this.offset(),
+					pos = {
+						left: selecteeOffset.left - that.elementPos.left,
+						top: selecteeOffset.top - that.elementPos.top
+					};
+				$.data( this, "selectable-item", {
+					element: this,
+					$element: $this,
+					left: pos.left,
+					top: pos.top,
+					right: pos.left + $this.outerWidth(),
+					bottom: pos.top + $this.outerHeight(),
+					startselected: false,
+					selected: $this.hasClass( "ui-selected" ),
+					selecting: $this.hasClass( "ui-selecting" ),
+					unselecting: $this.hasClass( "ui-unselecting" )
+				} );
+			} );
+		};
+		this.refresh();
+
+		this._mouseInit();
+
+		this.helper = $( "<div>" );
+		this._addClass( this.helper, "ui-selectable-helper" );
+	},
+
+	_destroy: function() {
+		this.selectees.removeData( "selectable-item" );
+		this._mouseDestroy();
+	},
+
+	_mouseStart: function( event ) {
+		var that = this,
+			options = this.options;
+
+		this.opos = [ event.pageX, event.pageY ];
+		this.elementPos = $( this.element[ 0 ] ).offset();
+
+		if ( this.options.disabled ) {
+			return;
+		}
+
+		this.selectees = $( options.filter, this.element[ 0 ] );
+
+		this._trigger( "start", event );
+
+		$( options.appendTo ).append( this.helper );
+
+		// position helper (lasso)
+		this.helper.css( {
+			"left": event.pageX,
+			"top": event.pageY,
+			"width": 0,
+			"height": 0
+		} );
+
+		if ( options.autoRefresh ) {
+			this.refresh();
+		}
+
+		this.selectees.filter( ".ui-selected" ).each( function() {
+			var selectee = $.data( this, "selectable-item" );
+			selectee.startselected = true;
+			if ( !event.metaKey && !event.ctrlKey ) {
+				that._removeClass( selectee.$element, "ui-selected" );
+				selectee.selected = false;
+				that._addClass( selectee.$element, "ui-unselecting" );
+				selectee.unselecting = true;
+
+				// selectable UNSELECTING callback
+				that._trigger( "unselecting", event, {
+					unselecting: selectee.element
+				} );
+			}
+		} );
+
+		$( event.target ).parents().addBack().each( function() {
+			var doSelect,
+				selectee = $.data( this, "selectable-item" );
+			if ( selectee ) {
+				doSelect = ( !event.metaKey && !event.ctrlKey ) ||
+					!selectee.$element.hasClass( "ui-selected" );
+				that._removeClass( selectee.$element, doSelect ? "ui-unselecting" : "ui-selected" )
+					._addClass( selectee.$element, doSelect ? "ui-selecting" : "ui-unselecting" );
+				selectee.unselecting = !doSelect;
+				selectee.selecting = doSelect;
+				selectee.selected = doSelect;
+
+				// selectable (UN)SELECTING callback
+				if ( doSelect ) {
+					that._trigger( "selecting", event, {
+						selecting: selectee.element
+					} );
+				} else {
+					that._trigger( "unselecting", event, {
+						unselecting: selectee.element
+					} );
+				}
+				return false;
+			}
+		} );
+
+	},
+
+	_mouseDrag: function( event ) {
+
+		this.dragged = true;
+
+		if ( this.options.disabled ) {
+			return;
+		}
+
+		var tmp,
+			that = this,
+			options = this.options,
+			x1 = this.opos[ 0 ],
+			y1 = this.opos[ 1 ],
+			x2 = event.pageX,
+			y2 = event.pageY;
+
+		if ( x1 > x2 ) {
+			tmp = x2; x2 = x1; x1 = tmp;
+		}
+		if ( y1 > y2 ) {
+			tmp = y2; y2 = y1; y1 = tmp;
+		}
+		this.helper.css( { left: x1, top: y1, width: x2 - x1, height: y2 - y1 } );
+
+		this.selectees.each( function() {
+			var selectee = $.data( this, "selectable-item" ),
+				hit = false,
+				offset = {};
+
+			//prevent helper from being selected if appendTo: selectable
+			if ( !selectee || selectee.element === that.element[ 0 ] ) {
+				return;
+			}
+
+			offset.left   = selectee.left   + that.elementPos.left;
+			offset.right  = selectee.right  + that.elementPos.left;
+			offset.top    = selectee.top    + that.elementPos.top;
+			offset.bottom = selectee.bottom + that.elementPos.top;
+
+			if ( options.tolerance === "touch" ) {
+				hit = ( !( offset.left > x2 || offset.right < x1 || offset.top > y2 ||
+                    offset.bottom < y1 ) );
+			} else if ( options.tolerance === "fit" ) {
+				hit = ( offset.left > x1 && offset.right < x2 && offset.top > y1 &&
+                    offset.bottom < y2 );
+			}
+
+			if ( hit ) {
+
+				// SELECT
+				if ( selectee.selected ) {
+					that._removeClass( selectee.$element, "ui-selected" );
+					selectee.selected = false;
+				}
+				if ( selectee.unselecting ) {
+					that._removeClass( selectee.$element, "ui-unselecting" );
+					selectee.unselecting = false;
+				}
+				if ( !selectee.selecting ) {
+					that._addClass( selectee.$element, "ui-selecting" );
+					selectee.selecting = true;
+
+					// selectable SELECTING callback
+					that._trigger( "selecting", event, {
+						selecting: selectee.element
+					} );
+				}
+			} else {
+
+				// UNSELECT
+				if ( selectee.selecting ) {
+					if ( ( event.metaKey || event.ctrlKey ) && selectee.startselected ) {
+						that._removeClass( selectee.$element, "ui-selecting" );
+						selectee.selecting = false;
+						that._addClass( selectee.$element, "ui-selected" );
+						selectee.selected = true;
+					} else {
+						that._removeClass( selectee.$element, "ui-selecting" );
+						selectee.selecting = false;
+						if ( selectee.startselected ) {
+							that._addClass( selectee.$element, "ui-unselecting" );
+							selectee.unselecting = true;
+						}
+
+						// selectable UNSELECTING callback
+						that._trigger( "unselecting", event, {
+							unselecting: selectee.element
+						} );
+					}
+				}
+				if ( selectee.selected ) {
+					if ( !event.metaKey && !event.ctrlKey && !selectee.startselected ) {
+						that._removeClass( selectee.$element, "ui-selected" );
+						selectee.selected = false;
+
+						that._addClass( selectee.$element, "ui-unselecting" );
+						selectee.unselecting = true;
+
+						// selectable UNSELECTING callback
+						that._trigger( "unselecting", event, {
+							unselecting: selectee.element
+						} );
+					}
+				}
+			}
+		} );
+
+		return false;
+	},
+
+	_mouseStop: function( event ) {
+		var that = this;
+
+		this.dragged = false;
+
+		$( ".ui-unselecting", this.element[ 0 ] ).each( function() {
+			var selectee = $.data( this, "selectable-item" );
+			that._removeClass( selectee.$element, "ui-unselecting" );
+			selectee.unselecting = false;
+			selectee.startselected = false;
+			that._trigger( "unselected", event, {
+				unselected: selectee.element
+			} );
+		} );
+		$( ".ui-selecting", this.element[ 0 ] ).each( function() {
+			var selectee = $.data( this, "selectable-item" );
+			that._removeClass( selectee.$element, "ui-selecting" )
+				._addClass( selectee.$element, "ui-selected" );
+			selectee.selecting = false;
+			selectee.selected = true;
+			selectee.startselected = true;
+			that._trigger( "selected", event, {
+				selected: selectee.element
+			} );
+		} );
+		this._trigger( "stop", event );
+
+		this.helper.remove();
+
+		return false;
+	}
+
+} );
+
+
+/*!
+ * jQuery UI Selectmenu 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -13091,7 +14111,7 @@


 var widgetsSelectmenu = $.widget( "ui.selectmenu", [ $.ui.formResetMixin, {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<select>",
 	options: {
 		appendTo: null,
@@ -13464,7 +14484,7 @@
 		// Support: IE
 		// Setting the text selection kills the button focus in IE, but
 		// restoring the focus doesn't kill the selection.
-		this.button.focus();
+		this.button.trigger( "focus" );
 	},

 	_documentClick: {
@@ -13556,925 +14576,2518 @@
 				preventDefault = false;
 			}

-			if ( preventDefault ) {
-				event.preventDefault();
-			}
+			if ( preventDefault ) {
+				event.preventDefault();
+			}
+		}
+	},
+
+	_selectFocusedItem: function( event ) {
+		var item = this.menuItems.eq( this.focusIndex ).parent( "li" );
+		if ( !item.hasClass( "ui-state-disabled" ) ) {
+			this._select( item.data( "ui-selectmenu-item" ), event );
+		}
+	},
+
+	_select: function( item, event ) {
+		var oldIndex = this.element[ 0 ].selectedIndex;
+
+		// Change native select element
+		this.element[ 0 ].selectedIndex = item.index;
+		this.buttonItem.replaceWith( this.buttonItem = this._renderButtonItem( item ) );
+		this._setAria( item );
+		this._trigger( "select", event, { item: item } );
+
+		if ( item.index !== oldIndex ) {
+			this._trigger( "change", event, { item: item } );
+		}
+
+		this.close( event );
+	},
+
+	_setAria: function( item ) {
+		var id = this.menuItems.eq( item.index ).attr( "id" );
+
+		this.button.attr( {
+			"aria-labelledby": id,
+			"aria-activedescendant": id
+		} );
+		this.menu.attr( "aria-activedescendant", id );
+	},
+
+	_setOption: function( key, value ) {
+		if ( key === "icons" ) {
+			var icon = this.button.find( "span.ui-icon" );
+			this._removeClass( icon, null, this.options.icons.button )
+				._addClass( icon, null, value.button );
+		}
+
+		this._super( key, value );
+
+		if ( key === "appendTo" ) {
+			this.menuWrap.appendTo( this._appendTo() );
+		}
+
+		if ( key === "width" ) {
+			this._resizeButton();
+		}
+	},
+
+	_setOptionDisabled: function( value ) {
+		this._super( value );
+
+		this.menuInstance.option( "disabled", value );
+		this.button.attr( "aria-disabled", value );
+		this._toggleClass( this.button, null, "ui-state-disabled", value );
+
+		this.element.prop( "disabled", value );
+		if ( value ) {
+			this.button.attr( "tabindex", -1 );
+			this.close();
+		} else {
+			this.button.attr( "tabindex", 0 );
+		}
+	},
+
+	_appendTo: function() {
+		var element = this.options.appendTo;
+
+		if ( element ) {
+			element = element.jquery || element.nodeType ?
+				$( element ) :
+				this.document.find( element ).eq( 0 );
+		}
+
+		if ( !element || !element[ 0 ] ) {
+			element = this.element.closest( ".ui-front, dialog" );
+		}
+
+		if ( !element.length ) {
+			element = this.document[ 0 ].body;
+		}
+
+		return element;
+	},
+
+	_toggleAttr: function() {
+		this.button.attr( "aria-expanded", this.isOpen );
+
+		// We can't use two _toggleClass() calls here, because we need to make sure
+		// we always remove classes first and add them second, otherwise if both classes have the
+		// same theme class, it will be removed after we add it.
+		this._removeClass( this.button, "ui-selectmenu-button-" +
+			( this.isOpen ? "closed" : "open" ) )
+			._addClass( this.button, "ui-selectmenu-button-" +
+				( this.isOpen ? "open" : "closed" ) )
+			._toggleClass( this.menuWrap, "ui-selectmenu-open", null, this.isOpen );
+
+		this.menu.attr( "aria-hidden", !this.isOpen );
+	},
+
+	_resizeButton: function() {
+		var width = this.options.width;
+
+		// For `width: false`, just remove inline style and stop
+		if ( width === false ) {
+			this.button.css( "width", "" );
+			return;
+		}
+
+		// For `width: null`, match the width of the original element
+		if ( width === null ) {
+			width = this.element.show().outerWidth();
+			this.element.hide();
+		}
+
+		this.button.outerWidth( width );
+	},
+
+	_resizeMenu: function() {
+		this.menu.outerWidth( Math.max(
+			this.button.outerWidth(),
+
+			// Support: IE10
+			// IE10 wraps long text (possibly a rounding bug)
+			// so we add 1px to avoid the wrapping
+			this.menu.width( "" ).outerWidth() + 1
+		) );
+	},
+
+	_getCreateOptions: function() {
+		var options = this._super();
+
+		options.disabled = this.element.prop( "disabled" );
+
+		return options;
+	},
+
+	_parseOptions: function( options ) {
+		var that = this,
+			data = [];
+		options.each( function( index, item ) {
+			if ( item.hidden ) {
+				return;
+			}
+
+			data.push( that._parseOption( $( item ), index ) );
+		} );
+		this.items = data;
+	},
+
+	_parseOption: function( option, index ) {
+		var optgroup = option.parent( "optgroup" );
+
+		return {
+			element: option,
+			index: index,
+			value: option.val(),
+			label: option.text(),
+			optgroup: optgroup.attr( "label" ) || "",
+			disabled: optgroup.prop( "disabled" ) || option.prop( "disabled" )
+		};
+	},
+
+	_destroy: function() {
+		this._unbindFormResetHandler();
+		this.menuWrap.remove();
+		this.button.remove();
+		this.element.show();
+		this.element.removeUniqueId();
+		this.labels.attr( "for", this.ids.element );
+	}
+} ] );
+
+
+/*!
+ * jQuery UI Slider 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Slider
+//>>group: Widgets
+//>>description: Displays a flexible slider with ranges and accessibility via keyboard.
+//>>docs: http://api.jqueryui.com/slider/
+//>>demos: http://jqueryui.com/slider/
+//>>css.structure: ../../themes/base/core.css
+//>>css.structure: ../../themes/base/slider.css
+//>>css.theme: ../../themes/base/theme.css
+
+
+var widgetsSlider = $.widget( "ui.slider", $.ui.mouse, {
+	version: "1.13.2",
+	widgetEventPrefix: "slide",
+
+	options: {
+		animate: false,
+		classes: {
+			"ui-slider": "ui-corner-all",
+			"ui-slider-handle": "ui-corner-all",
+
+			// Note: ui-widget-header isn't the most fittingly semantic framework class for this
+			// element, but worked best visually with a variety of themes
+			"ui-slider-range": "ui-corner-all ui-widget-header"
+		},
+		distance: 0,
+		max: 100,
+		min: 0,
+		orientation: "horizontal",
+		range: false,
+		step: 1,
+		value: 0,
+		values: null,
+
+		// Callbacks
+		change: null,
+		slide: null,
+		start: null,
+		stop: null
+	},
+
+	// Number of pages in a slider
+	// (how many times can you page up/down to go through the whole range)
+	numPages: 5,
+
+	_create: function() {
+		this._keySliding = false;
+		this._mouseSliding = false;
+		this._animateOff = true;
+		this._handleIndex = null;
+		this._detectOrientation();
+		this._mouseInit();
+		this._calculateNewMax();
+
+		this._addClass( "ui-slider ui-slider-" + this.orientation,
+			"ui-widget ui-widget-content" );
+
+		this._refresh();
+
+		this._animateOff = false;
+	},
+
+	_refresh: function() {
+		this._createRange();
+		this._createHandles();
+		this._setupEvents();
+		this._refreshValue();
+	},
+
+	_createHandles: function() {
+		var i, handleCount,
+			options = this.options,
+			existingHandles = this.element.find( ".ui-slider-handle" ),
+			handle = "<span tabindex='0'></span>",
+			handles = [];
+
+		handleCount = ( options.values && options.values.length ) || 1;
+
+		if ( existingHandles.length > handleCount ) {
+			existingHandles.slice( handleCount ).remove();
+			existingHandles = existingHandles.slice( 0, handleCount );
+		}
+
+		for ( i = existingHandles.length; i < handleCount; i++ ) {
+			handles.push( handle );
+		}
+
+		this.handles = existingHandles.add( $( handles.join( "" ) ).appendTo( this.element ) );
+
+		this._addClass( this.handles, "ui-slider-handle", "ui-state-default" );
+
+		this.handle = this.handles.eq( 0 );
+
+		this.handles.each( function( i ) {
+			$( this )
+				.data( "ui-slider-handle-index", i )
+				.attr( "tabIndex", 0 );
+		} );
+	},
+
+	_createRange: function() {
+		var options = this.options;
+
+		if ( options.range ) {
+			if ( options.range === true ) {
+				if ( !options.values ) {
+					options.values = [ this._valueMin(), this._valueMin() ];
+				} else if ( options.values.length && options.values.length !== 2 ) {
+					options.values = [ options.values[ 0 ], options.values[ 0 ] ];
+				} else if ( Array.isArray( options.values ) ) {
+					options.values = options.values.slice( 0 );
+				}
+			}
+
+			if ( !this.range || !this.range.length ) {
+				this.range = $( "<div>" )
+					.appendTo( this.element );
+
+				this._addClass( this.range, "ui-slider-range" );
+			} else {
+				this._removeClass( this.range, "ui-slider-range-min ui-slider-range-max" );
+
+				// Handle range switching from true to min/max
+				this.range.css( {
+					"left": "",
+					"bottom": ""
+				} );
+			}
+			if ( options.range === "min" || options.range === "max" ) {
+				this._addClass( this.range, "ui-slider-range-" + options.range );
+			}
+		} else {
+			if ( this.range ) {
+				this.range.remove();
+			}
+			this.range = null;
+		}
+	},
+
+	_setupEvents: function() {
+		this._off( this.handles );
+		this._on( this.handles, this._handleEvents );
+		this._hoverable( this.handles );
+		this._focusable( this.handles );
+	},
+
+	_destroy: function() {
+		this.handles.remove();
+		if ( this.range ) {
+			this.range.remove();
+		}
+
+		this._mouseDestroy();
+	},
+
+	_mouseCapture: function( event ) {
+		var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
+			that = this,
+			o = this.options;
+
+		if ( o.disabled ) {
+			return false;
+		}
+
+		this.elementSize = {
+			width: this.element.outerWidth(),
+			height: this.element.outerHeight()
+		};
+		this.elementOffset = this.element.offset();
+
+		position = { x: event.pageX, y: event.pageY };
+		normValue = this._normValueFromMouse( position );
+		distance = this._valueMax() - this._valueMin() + 1;
+		this.handles.each( function( i ) {
+			var thisDistance = Math.abs( normValue - that.values( i ) );
+			if ( ( distance > thisDistance ) ||
+				( distance === thisDistance &&
+					( i === that._lastChangedValue || that.values( i ) === o.min ) ) ) {
+				distance = thisDistance;
+				closestHandle = $( this );
+				index = i;
+			}
+		} );
+
+		allowed = this._start( event, index );
+		if ( allowed === false ) {
+			return false;
+		}
+		this._mouseSliding = true;
+
+		this._handleIndex = index;
+
+		this._addClass( closestHandle, null, "ui-state-active" );
+		closestHandle.trigger( "focus" );
+
+		offset = closestHandle.offset();
+		mouseOverHandle = !$( event.target ).parents().addBack().is( ".ui-slider-handle" );
+		this._clickOffset = mouseOverHandle ? { left: 0, top: 0 } : {
+			left: event.pageX - offset.left - ( closestHandle.width() / 2 ),
+			top: event.pageY - offset.top -
+				( closestHandle.height() / 2 ) -
+				( parseInt( closestHandle.css( "borderTopWidth" ), 10 ) || 0 ) -
+				( parseInt( closestHandle.css( "borderBottomWidth" ), 10 ) || 0 ) +
+				( parseInt( closestHandle.css( "marginTop" ), 10 ) || 0 )
+		};
+
+		if ( !this.handles.hasClass( "ui-state-hover" ) ) {
+			this._slide( event, index, normValue );
+		}
+		this._animateOff = true;
+		return true;
+	},
+
+	_mouseStart: function() {
+		return true;
+	},
+
+	_mouseDrag: function( event ) {
+		var position = { x: event.pageX, y: event.pageY },
+			normValue = this._normValueFromMouse( position );
+
+		this._slide( event, this._handleIndex, normValue );
+
+		return false;
+	},
+
+	_mouseStop: function( event ) {
+		this._removeClass( this.handles, null, "ui-state-active" );
+		this._mouseSliding = false;
+
+		this._stop( event, this._handleIndex );
+		this._change( event, this._handleIndex );
+
+		this._handleIndex = null;
+		this._clickOffset = null;
+		this._animateOff = false;
+
+		return false;
+	},
+
+	_detectOrientation: function() {
+		this.orientation = ( this.options.orientation === "vertical" ) ? "vertical" : "horizontal";
+	},
+
+	_normValueFromMouse: function( position ) {
+		var pixelTotal,
+			pixelMouse,
+			percentMouse,
+			valueTotal,
+			valueMouse;
+
+		if ( this.orientation === "horizontal" ) {
+			pixelTotal = this.elementSize.width;
+			pixelMouse = position.x - this.elementOffset.left -
+				( this._clickOffset ? this._clickOffset.left : 0 );
+		} else {
+			pixelTotal = this.elementSize.height;
+			pixelMouse = position.y - this.elementOffset.top -
+				( this._clickOffset ? this._clickOffset.top : 0 );
+		}
+
+		percentMouse = ( pixelMouse / pixelTotal );
+		if ( percentMouse > 1 ) {
+			percentMouse = 1;
+		}
+		if ( percentMouse < 0 ) {
+			percentMouse = 0;
+		}
+		if ( this.orientation === "vertical" ) {
+			percentMouse = 1 - percentMouse;
+		}
+
+		valueTotal = this._valueMax() - this._valueMin();
+		valueMouse = this._valueMin() + percentMouse * valueTotal;
+
+		return this._trimAlignValue( valueMouse );
+	},
+
+	_uiHash: function( index, value, values ) {
+		var uiHash = {
+			handle: this.handles[ index ],
+			handleIndex: index,
+			value: value !== undefined ? value : this.value()
+		};
+
+		if ( this._hasMultipleValues() ) {
+			uiHash.value = value !== undefined ? value : this.values( index );
+			uiHash.values = values || this.values();
+		}
+
+		return uiHash;
+	},
+
+	_hasMultipleValues: function() {
+		return this.options.values && this.options.values.length;
+	},
+
+	_start: function( event, index ) {
+		return this._trigger( "start", event, this._uiHash( index ) );
+	},
+
+	_slide: function( event, index, newVal ) {
+		var allowed, otherVal,
+			currentValue = this.value(),
+			newValues = this.values();
+
+		if ( this._hasMultipleValues() ) {
+			otherVal = this.values( index ? 0 : 1 );
+			currentValue = this.values( index );
+
+			if ( this.options.values.length === 2 && this.options.range === true ) {
+				newVal =  index === 0 ? Math.min( otherVal, newVal ) : Math.max( otherVal, newVal );
+			}
+
+			newValues[ index ] = newVal;
+		}
+
+		if ( newVal === currentValue ) {
+			return;
+		}
+
+		allowed = this._trigger( "slide", event, this._uiHash( index, newVal, newValues ) );
+
+		// A slide can be canceled by returning false from the slide callback
+		if ( allowed === false ) {
+			return;
+		}
+
+		if ( this._hasMultipleValues() ) {
+			this.values( index, newVal );
+		} else {
+			this.value( newVal );
+		}
+	},
+
+	_stop: function( event, index ) {
+		this._trigger( "stop", event, this._uiHash( index ) );
+	},
+
+	_change: function( event, index ) {
+		if ( !this._keySliding && !this._mouseSliding ) {
+
+			//store the last changed value index for reference when handles overlap
+			this._lastChangedValue = index;
+			this._trigger( "change", event, this._uiHash( index ) );
+		}
+	},
+
+	value: function( newValue ) {
+		if ( arguments.length ) {
+			this.options.value = this._trimAlignValue( newValue );
+			this._refreshValue();
+			this._change( null, 0 );
+			return;
+		}
+
+		return this._value();
+	},
+
+	values: function( index, newValue ) {
+		var vals,
+			newValues,
+			i;
+
+		if ( arguments.length > 1 ) {
+			this.options.values[ index ] = this._trimAlignValue( newValue );
+			this._refreshValue();
+			this._change( null, index );
+			return;
+		}
+
+		if ( arguments.length ) {
+			if ( Array.isArray( arguments[ 0 ] ) ) {
+				vals = this.options.values;
+				newValues = arguments[ 0 ];
+				for ( i = 0; i < vals.length; i += 1 ) {
+					vals[ i ] = this._trimAlignValue( newValues[ i ] );
+					this._change( null, i );
+				}
+				this._refreshValue();
+			} else {
+				if ( this._hasMultipleValues() ) {
+					return this._values( index );
+				} else {
+					return this.value();
+				}
+			}
+		} else {
+			return this._values();
+		}
+	},
+
+	_setOption: function( key, value ) {
+		var i,
+			valsLength = 0;
+
+		if ( key === "range" && this.options.range === true ) {
+			if ( value === "min" ) {
+				this.options.value = this._values( 0 );
+				this.options.values = null;
+			} else if ( value === "max" ) {
+				this.options.value = this._values( this.options.values.length - 1 );
+				this.options.values = null;
+			}
+		}
+
+		if ( Array.isArray( this.options.values ) ) {
+			valsLength = this.options.values.length;
+		}
+
+		this._super( key, value );
+
+		switch ( key ) {
+			case "orientation":
+				this._detectOrientation();
+				this._removeClass( "ui-slider-horizontal ui-slider-vertical" )
+					._addClass( "ui-slider-" + this.orientation );
+				this._refreshValue();
+				if ( this.options.range ) {
+					this._refreshRange( value );
+				}
+
+				// Reset positioning from previous orientation
+				this.handles.css( value === "horizontal" ? "bottom" : "left", "" );
+				break;
+			case "value":
+				this._animateOff = true;
+				this._refreshValue();
+				this._change( null, 0 );
+				this._animateOff = false;
+				break;
+			case "values":
+				this._animateOff = true;
+				this._refreshValue();
+
+				// Start from the last handle to prevent unreachable handles (#9046)
+				for ( i = valsLength - 1; i >= 0; i-- ) {
+					this._change( null, i );
+				}
+				this._animateOff = false;
+				break;
+			case "step":
+			case "min":
+			case "max":
+				this._animateOff = true;
+				this._calculateNewMax();
+				this._refreshValue();
+				this._animateOff = false;
+				break;
+			case "range":
+				this._animateOff = true;
+				this._refresh();
+				this._animateOff = false;
+				break;
+		}
+	},
+
+	_setOptionDisabled: function( value ) {
+		this._super( value );
+
+		this._toggleClass( null, "ui-state-disabled", !!value );
+	},
+
+	//internal value getter
+	// _value() returns value trimmed by min and max, aligned by step
+	_value: function() {
+		var val = this.options.value;
+		val = this._trimAlignValue( val );
+
+		return val;
+	},
+
+	//internal values getter
+	// _values() returns array of values trimmed by min and max, aligned by step
+	// _values( index ) returns single value trimmed by min and max, aligned by step
+	_values: function( index ) {
+		var val,
+			vals,
+			i;
+
+		if ( arguments.length ) {
+			val = this.options.values[ index ];
+			val = this._trimAlignValue( val );
+
+			return val;
+		} else if ( this._hasMultipleValues() ) {
+
+			// .slice() creates a copy of the array
+			// this copy gets trimmed by min and max and then returned
+			vals = this.options.values.slice();
+			for ( i = 0; i < vals.length; i += 1 ) {
+				vals[ i ] = this._trimAlignValue( vals[ i ] );
+			}
+
+			return vals;
+		} else {
+			return [];
+		}
+	},
+
+	// Returns the step-aligned value that val is closest to, between (inclusive) min and max
+	_trimAlignValue: function( val ) {
+		if ( val <= this._valueMin() ) {
+			return this._valueMin();
+		}
+		if ( val >= this._valueMax() ) {
+			return this._valueMax();
+		}
+		var step = ( this.options.step > 0 ) ? this.options.step : 1,
+			valModStep = ( val - this._valueMin() ) % step,
+			alignValue = val - valModStep;
+
+		if ( Math.abs( valModStep ) * 2 >= step ) {
+			alignValue += ( valModStep > 0 ) ? step : ( -step );
+		}
+
+		// Since JavaScript has problems with large floats, round
+		// the final value to 5 digits after the decimal point (see #4124)
+		return parseFloat( alignValue.toFixed( 5 ) );
+	},
+
+	_calculateNewMax: function() {
+		var max = this.options.max,
+			min = this._valueMin(),
+			step = this.options.step,
+			aboveMin = Math.round( ( max - min ) / step ) * step;
+		max = aboveMin + min;
+		if ( max > this.options.max ) {
+
+			//If max is not divisible by step, rounding off may increase its value
+			max -= step;
+		}
+		this.max = parseFloat( max.toFixed( this._precision() ) );
+	},
+
+	_precision: function() {
+		var precision = this._precisionOf( this.options.step );
+		if ( this.options.min !== null ) {
+			precision = Math.max( precision, this._precisionOf( this.options.min ) );
+		}
+		return precision;
+	},
+
+	_precisionOf: function( num ) {
+		var str = num.toString(),
+			decimal = str.indexOf( "." );
+		return decimal === -1 ? 0 : str.length - decimal - 1;
+	},
+
+	_valueMin: function() {
+		return this.options.min;
+	},
+
+	_valueMax: function() {
+		return this.max;
+	},
+
+	_refreshRange: function( orientation ) {
+		if ( orientation === "vertical" ) {
+			this.range.css( { "width": "", "left": "" } );
+		}
+		if ( orientation === "horizontal" ) {
+			this.range.css( { "height": "", "bottom": "" } );
+		}
+	},
+
+	_refreshValue: function() {
+		var lastValPercent, valPercent, value, valueMin, valueMax,
+			oRange = this.options.range,
+			o = this.options,
+			that = this,
+			animate = ( !this._animateOff ) ? o.animate : false,
+			_set = {};
+
+		if ( this._hasMultipleValues() ) {
+			this.handles.each( function( i ) {
+				valPercent = ( that.values( i ) - that._valueMin() ) / ( that._valueMax() -
+					that._valueMin() ) * 100;
+				_set[ that.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
+				$( this ).stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
+				if ( that.options.range === true ) {
+					if ( that.orientation === "horizontal" ) {
+						if ( i === 0 ) {
+							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+								left: valPercent + "%"
+							}, o.animate );
+						}
+						if ( i === 1 ) {
+							that.range[ animate ? "animate" : "css" ]( {
+								width: ( valPercent - lastValPercent ) + "%"
+							}, {
+								queue: false,
+								duration: o.animate
+							} );
+						}
+					} else {
+						if ( i === 0 ) {
+							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+								bottom: ( valPercent ) + "%"
+							}, o.animate );
+						}
+						if ( i === 1 ) {
+							that.range[ animate ? "animate" : "css" ]( {
+								height: ( valPercent - lastValPercent ) + "%"
+							}, {
+								queue: false,
+								duration: o.animate
+							} );
+						}
+					}
+				}
+				lastValPercent = valPercent;
+			} );
+		} else {
+			value = this.value();
+			valueMin = this._valueMin();
+			valueMax = this._valueMax();
+			valPercent = ( valueMax !== valueMin ) ?
+					( value - valueMin ) / ( valueMax - valueMin ) * 100 :
+					0;
+			_set[ this.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
+			this.handle.stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
+
+			if ( oRange === "min" && this.orientation === "horizontal" ) {
+				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+					width: valPercent + "%"
+				}, o.animate );
+			}
+			if ( oRange === "max" && this.orientation === "horizontal" ) {
+				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+					width: ( 100 - valPercent ) + "%"
+				}, o.animate );
+			}
+			if ( oRange === "min" && this.orientation === "vertical" ) {
+				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+					height: valPercent + "%"
+				}, o.animate );
+			}
+			if ( oRange === "max" && this.orientation === "vertical" ) {
+				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
+					height: ( 100 - valPercent ) + "%"
+				}, o.animate );
+			}
+		}
+	},
+
+	_handleEvents: {
+		keydown: function( event ) {
+			var allowed, curVal, newVal, step,
+				index = $( event.target ).data( "ui-slider-handle-index" );
+
+			switch ( event.keyCode ) {
+				case $.ui.keyCode.HOME:
+				case $.ui.keyCode.END:
+				case $.ui.keyCode.PAGE_UP:
+				case $.ui.keyCode.PAGE_DOWN:
+				case $.ui.keyCode.UP:
+				case $.ui.keyCode.RIGHT:
+				case $.ui.keyCode.DOWN:
+				case $.ui.keyCode.LEFT:
+					event.preventDefault();
+					if ( !this._keySliding ) {
+						this._keySliding = true;
+						this._addClass( $( event.target ), null, "ui-state-active" );
+						allowed = this._start( event, index );
+						if ( allowed === false ) {
+							return;
+						}
+					}
+					break;
+			}
+
+			step = this.options.step;
+			if ( this._hasMultipleValues() ) {
+				curVal = newVal = this.values( index );
+			} else {
+				curVal = newVal = this.value();
+			}
+
+			switch ( event.keyCode ) {
+				case $.ui.keyCode.HOME:
+					newVal = this._valueMin();
+					break;
+				case $.ui.keyCode.END:
+					newVal = this._valueMax();
+					break;
+				case $.ui.keyCode.PAGE_UP:
+					newVal = this._trimAlignValue(
+						curVal + ( ( this._valueMax() - this._valueMin() ) / this.numPages )
+					);
+					break;
+				case $.ui.keyCode.PAGE_DOWN:
+					newVal = this._trimAlignValue(
+						curVal - ( ( this._valueMax() - this._valueMin() ) / this.numPages ) );
+					break;
+				case $.ui.keyCode.UP:
+				case $.ui.keyCode.RIGHT:
+					if ( curVal === this._valueMax() ) {
+						return;
+					}
+					newVal = this._trimAlignValue( curVal + step );
+					break;
+				case $.ui.keyCode.DOWN:
+				case $.ui.keyCode.LEFT:
+					if ( curVal === this._valueMin() ) {
+						return;
+					}
+					newVal = this._trimAlignValue( curVal - step );
+					break;
+			}
+
+			this._slide( event, index, newVal );
+		},
+		keyup: function( event ) {
+			var index = $( event.target ).data( "ui-slider-handle-index" );
+
+			if ( this._keySliding ) {
+				this._keySliding = false;
+				this._stop( event, index );
+				this._change( event, index );
+				this._removeClass( $( event.target ), null, "ui-state-active" );
+			}
+		}
+	}
+} );
+
+
+/*!
+ * jQuery UI Sortable 1.13.2
+ * http://jqueryui.com
+ *
+ * Copyright jQuery Foundation and other contributors
+ * Released under the MIT license.
+ * http://jquery.org/license
+ */
+
+//>>label: Sortable
+//>>group: Interactions
+//>>description: Enables items in a list to be sorted using the mouse.
+//>>docs: http://api.jqueryui.com/sortable/
+//>>demos: http://jqueryui.com/sortable/
+//>>css.structure: ../../themes/base/sortable.css
+
+
+var widgetsSortable = $.widget( "ui.sortable", $.ui.mouse, {
+	version: "1.13.2",
+	widgetEventPrefix: "sort",
+	ready: false,
+	options: {
+		appendTo: "parent",
+		axis: false,
+		connectWith: false,
+		containment: false,
+		cursor: "auto",
+		cursorAt: false,
+		dropOnEmpty: true,
+		forcePlaceholderSize: false,
+		forceHelperSize: false,
+		grid: false,
+		handle: false,
+		helper: "original",
+		items: "> *",
+		opacity: false,
+		placeholder: false,
+		revert: false,
+		scroll: true,
+		scrollSensitivity: 20,
+		scrollSpeed: 20,
+		scope: "default",
+		tolerance: "intersect",
+		zIndex: 1000,
+
+		// Callbacks
+		activate: null,
+		beforeStop: null,
+		change: null,
+		deactivate: null,
+		out: null,
+		over: null,
+		receive: null,
+		remove: null,
+		sort: null,
+		start: null,
+		stop: null,
+		update: null
+	},
+
+	_isOverAxis: function( x, reference, size ) {
+		return ( x >= reference ) && ( x < ( reference + size ) );
+	},
+
+	_isFloating: function( item ) {
+		return ( /left|right/ ).test( item.css( "float" ) ) ||
+			( /inline|table-cell/ ).test( item.css( "display" ) );
+	},
+
+	_create: function() {
+		this.containerCache = {};
+		this._addClass( "ui-sortable" );
+
+		//Get the items
+		this.refresh();
+
+		//Let's determine the parent's offset
+		this.offset = this.element.offset();
+
+		//Initialize mouse events for interaction
+		this._mouseInit();
+
+		this._setHandleClassName();
+
+		//We're ready to go
+		this.ready = true;
+
+	},
+
+	_setOption: function( key, value ) {
+		this._super( key, value );
+
+		if ( key === "handle" ) {
+			this._setHandleClassName();
+		}
+	},
+
+	_setHandleClassName: function() {
+		var that = this;
+		this._removeClass( this.element.find( ".ui-sortable-handle" ), "ui-sortable-handle" );
+		$.each( this.items, function() {
+			that._addClass(
+				this.instance.options.handle ?
+					this.item.find( this.instance.options.handle ) :
+					this.item,
+				"ui-sortable-handle"
+			);
+		} );
+	},
+
+	_destroy: function() {
+		this._mouseDestroy();
+
+		for ( var i = this.items.length - 1; i >= 0; i-- ) {
+			this.items[ i ].item.removeData( this.widgetName + "-item" );
+		}
+
+		return this;
+	},
+
+	_mouseCapture: function( event, overrideHandle ) {
+		var currentItem = null,
+			validHandle = false,
+			that = this;
+
+		if ( this.reverting ) {
+			return false;
+		}
+
+		if ( this.options.disabled || this.options.type === "static" ) {
+			return false;
+		}
+
+		//We have to refresh the items data once first
+		this._refreshItems( event );
+
+		//Find out if the clicked node (or one of its parents) is a actual item in this.items
+		$( event.target ).parents().each( function() {
+			if ( $.data( this, that.widgetName + "-item" ) === that ) {
+				currentItem = $( this );
+				return false;
+			}
+		} );
+		if ( $.data( event.target, that.widgetName + "-item" ) === that ) {
+			currentItem = $( event.target );
+		}
+
+		if ( !currentItem ) {
+			return false;
+		}
+		if ( this.options.handle && !overrideHandle ) {
+			$( this.options.handle, currentItem ).find( "*" ).addBack().each( function() {
+				if ( this === event.target ) {
+					validHandle = true;
+				}
+			} );
+			if ( !validHandle ) {
+				return false;
+			}
+		}
+
+		this.currentItem = currentItem;
+		this._removeCurrentsFromItems();
+		return true;
+
+	},
+
+	_mouseStart: function( event, overrideHandle, noActivation ) {
+
+		var i, body,
+			o = this.options;
+
+		this.currentContainer = this;
+
+		//We only need to call refreshPositions, because the refreshItems call has been moved to
+		// mouseCapture
+		this.refreshPositions();
+
+		//Prepare the dragged items parent
+		this.appendTo = $( o.appendTo !== "parent" ?
+				o.appendTo :
+				this.currentItem.parent() );
+
+		//Create and append the visible helper
+		this.helper = this._createHelper( event );
+
+		//Cache the helper size
+		this._cacheHelperProportions();
+
+		/*
+		 * - Position generation -
+		 * This block generates everything position related - it's the core of draggables.
+		 */
+
+		//Cache the margins of the original element
+		this._cacheMargins();
+
+		//The element's absolute position on the page minus margins
+		this.offset = this.currentItem.offset();
+		this.offset = {
+			top: this.offset.top - this.margins.top,
+			left: this.offset.left - this.margins.left
+		};
+
+		$.extend( this.offset, {
+			click: { //Where the click happened, relative to the element
+				left: event.pageX - this.offset.left,
+				top: event.pageY - this.offset.top
+			},
+
+			// This is a relative to absolute position minus the actual position calculation -
+			// only used for relative positioned helper
+			relative: this._getRelativeOffset()
+		} );
+
+		// After we get the helper offset, but before we get the parent offset we can
+		// change the helper's position to absolute
+		// TODO: Still need to figure out a way to make relative sorting possible
+		this.helper.css( "position", "absolute" );
+		this.cssPosition = this.helper.css( "position" );
+
+		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
+		if ( o.cursorAt ) {
+			this._adjustOffsetFromHelper( o.cursorAt );
+		}
+
+		//Cache the former DOM position
+		this.domPosition = {
+			prev: this.currentItem.prev()[ 0 ],
+			parent: this.currentItem.parent()[ 0 ]
+		};
+
+		// If the helper is not the original, hide the original so it's not playing any role during
+		// the drag, won't cause anything bad this way
+		if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
+			this.currentItem.hide();
+		}
+
+		//Create the placeholder
+		this._createPlaceholder();
+
+		//Get the next scrolling parent
+		this.scrollParent = this.placeholder.scrollParent();
+
+		$.extend( this.offset, {
+			parent: this._getParentOffset()
+		} );
+
+		//Set a containment if given in the options
+		if ( o.containment ) {
+			this._setContainment();
+		}
+
+		if ( o.cursor && o.cursor !== "auto" ) { // cursor option
+			body = this.document.find( "body" );
+
+			// Support: IE
+			this.storedCursor = body.css( "cursor" );
+			body.css( "cursor", o.cursor );
+
+			this.storedStylesheet =
+				$( "<style>*{ cursor: " + o.cursor + " !important; }</style>" ).appendTo( body );
+		}
+
+		// We need to make sure to grab the zIndex before setting the
+		// opacity, because setting the opacity to anything lower than 1
+		// causes the zIndex to change from "auto" to 0.
+		if ( o.zIndex ) { // zIndex option
+			if ( this.helper.css( "zIndex" ) ) {
+				this._storedZIndex = this.helper.css( "zIndex" );
+			}
+			this.helper.css( "zIndex", o.zIndex );
+		}
+
+		if ( o.opacity ) { // opacity option
+			if ( this.helper.css( "opacity" ) ) {
+				this._storedOpacity = this.helper.css( "opacity" );
+			}
+			this.helper.css( "opacity", o.opacity );
+		}
+
+		//Prepare scrolling
+		if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				this.scrollParent[ 0 ].tagName !== "HTML" ) {
+			this.overflowOffset = this.scrollParent.offset();
+		}
+
+		//Call callbacks
+		this._trigger( "start", event, this._uiHash() );
+
+		//Recache the helper size
+		if ( !this._preserveHelperProportions ) {
+			this._cacheHelperProportions();
+		}
+
+		//Post "activate" events to possible containers
+		if ( !noActivation ) {
+			for ( i = this.containers.length - 1; i >= 0; i-- ) {
+				this.containers[ i ]._trigger( "activate", event, this._uiHash( this ) );
+			}
+		}
+
+		//Prepare possible droppables
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.current = this;
+		}
+
+		if ( $.ui.ddmanager && !o.dropBehaviour ) {
+			$.ui.ddmanager.prepareOffsets( this, event );
+		}
+
+		this.dragging = true;
+
+		this._addClass( this.helper, "ui-sortable-helper" );
+
+		//Move the helper, if needed
+		if ( !this.helper.parent().is( this.appendTo ) ) {
+			this.helper.detach().appendTo( this.appendTo );
+
+			//Update position
+			this.offset.parent = this._getParentOffset();
+		}
+
+		//Generate the original position
+		this.position = this.originalPosition = this._generatePosition( event );
+		this.originalPageX = event.pageX;
+		this.originalPageY = event.pageY;
+		this.lastPositionAbs = this.positionAbs = this._convertPositionTo( "absolute" );
+
+		this._mouseDrag( event );
+
+		return true;
+
+	},
+
+	_scroll: function( event ) {
+		var o = this.options,
+			scrolled = false;
+
+		if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				this.scrollParent[ 0 ].tagName !== "HTML" ) {
+
+			if ( ( this.overflowOffset.top + this.scrollParent[ 0 ].offsetHeight ) -
+					event.pageY < o.scrollSensitivity ) {
+				this.scrollParent[ 0 ].scrollTop =
+					scrolled = this.scrollParent[ 0 ].scrollTop + o.scrollSpeed;
+			} else if ( event.pageY - this.overflowOffset.top < o.scrollSensitivity ) {
+				this.scrollParent[ 0 ].scrollTop =
+					scrolled = this.scrollParent[ 0 ].scrollTop - o.scrollSpeed;
+			}
+
+			if ( ( this.overflowOffset.left + this.scrollParent[ 0 ].offsetWidth ) -
+					event.pageX < o.scrollSensitivity ) {
+				this.scrollParent[ 0 ].scrollLeft = scrolled =
+					this.scrollParent[ 0 ].scrollLeft + o.scrollSpeed;
+			} else if ( event.pageX - this.overflowOffset.left < o.scrollSensitivity ) {
+				this.scrollParent[ 0 ].scrollLeft = scrolled =
+					this.scrollParent[ 0 ].scrollLeft - o.scrollSpeed;
+			}
+
+		} else {
+
+			if ( event.pageY - this.document.scrollTop() < o.scrollSensitivity ) {
+				scrolled = this.document.scrollTop( this.document.scrollTop() - o.scrollSpeed );
+			} else if ( this.window.height() - ( event.pageY - this.document.scrollTop() ) <
+					o.scrollSensitivity ) {
+				scrolled = this.document.scrollTop( this.document.scrollTop() + o.scrollSpeed );
+			}
+
+			if ( event.pageX - this.document.scrollLeft() < o.scrollSensitivity ) {
+				scrolled = this.document.scrollLeft(
+					this.document.scrollLeft() - o.scrollSpeed
+				);
+			} else if ( this.window.width() - ( event.pageX - this.document.scrollLeft() ) <
+					o.scrollSensitivity ) {
+				scrolled = this.document.scrollLeft(
+					this.document.scrollLeft() + o.scrollSpeed
+				);
+			}
+
+		}
+
+		return scrolled;
+	},
+
+	_mouseDrag: function( event ) {
+		var i, item, itemElement, intersection,
+			o = this.options;
+
+		//Compute the helpers position
+		this.position = this._generatePosition( event );
+		this.positionAbs = this._convertPositionTo( "absolute" );
+
+		//Set the helper position
+		if ( !this.options.axis || this.options.axis !== "y" ) {
+			this.helper[ 0 ].style.left = this.position.left + "px";
+		}
+		if ( !this.options.axis || this.options.axis !== "x" ) {
+			this.helper[ 0 ].style.top = this.position.top + "px";
+		}
+
+		//Do scrolling
+		if ( o.scroll ) {
+			if ( this._scroll( event ) !== false ) {
+
+				//Update item positions used in position checks
+				this._refreshItemPositions( true );
+
+				if ( $.ui.ddmanager && !o.dropBehaviour ) {
+					$.ui.ddmanager.prepareOffsets( this, event );
+				}
+			}
+		}
+
+		this.dragDirection = {
+			vertical: this._getDragVerticalDirection(),
+			horizontal: this._getDragHorizontalDirection()
+		};
+
+		//Rearrange
+		for ( i = this.items.length - 1; i >= 0; i-- ) {
+
+			//Cache variables and intersection, continue if no intersection
+			item = this.items[ i ];
+			itemElement = item.item[ 0 ];
+			intersection = this._intersectsWithPointer( item );
+			if ( !intersection ) {
+				continue;
+			}
+
+			// Only put the placeholder inside the current Container, skip all
+			// items from other containers. This works because when moving
+			// an item from one container to another the
+			// currentContainer is switched before the placeholder is moved.
+			//
+			// Without this, moving items in "sub-sortables" can cause
+			// the placeholder to jitter between the outer and inner container.
+			if ( item.instance !== this.currentContainer ) {
+				continue;
+			}
+
+			// Cannot intersect with itself
+			// no useless actions that have been done before
+			// no action if the item moved is the parent of the item checked
+			if ( itemElement !== this.currentItem[ 0 ] &&
+				this.placeholder[ intersection === 1 ?
+				"next" : "prev" ]()[ 0 ] !== itemElement &&
+				!$.contains( this.placeholder[ 0 ], itemElement ) &&
+				( this.options.type === "semi-dynamic" ?
+					!$.contains( this.element[ 0 ], itemElement ) :
+					true
+				)
+			) {
+
+				this.direction = intersection === 1 ? "down" : "up";
+
+				if ( this.options.tolerance === "pointer" ||
+						this._intersectsWithSides( item ) ) {
+					this._rearrange( event, item );
+				} else {
+					break;
+				}
+
+				this._trigger( "change", event, this._uiHash() );
+				break;
+			}
+		}
+
+		//Post events to containers
+		this._contactContainers( event );
+
+		//Interconnect with droppables
+		if ( $.ui.ddmanager ) {
+			$.ui.ddmanager.drag( this, event );
+		}
+
+		//Call callbacks
+		this._trigger( "sort", event, this._uiHash() );
+
+		this.lastPositionAbs = this.positionAbs;
+		return false;
+
+	},
+
+	_mouseStop: function( event, noPropagation ) {
+
+		if ( !event ) {
+			return;
+		}
+
+		//If we are using droppables, inform the manager about the drop
+		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
+			$.ui.ddmanager.drop( this, event );
+		}
+
+		if ( this.options.revert ) {
+			var that = this,
+				cur = this.placeholder.offset(),
+				axis = this.options.axis,
+				animation = {};
+
+			if ( !axis || axis === "x" ) {
+				animation.left = cur.left - this.offset.parent.left - this.margins.left +
+					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
+						0 :
+						this.offsetParent[ 0 ].scrollLeft
+					);
+			}
+			if ( !axis || axis === "y" ) {
+				animation.top = cur.top - this.offset.parent.top - this.margins.top +
+					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
+						0 :
+						this.offsetParent[ 0 ].scrollTop
+					);
+			}
+			this.reverting = true;
+			$( this.helper ).animate(
+				animation,
+				parseInt( this.options.revert, 10 ) || 500,
+				function() {
+					that._clear( event );
+				}
+			);
+		} else {
+			this._clear( event, noPropagation );
+		}
+
+		return false;
+
+	},
+
+	cancel: function() {
+
+		if ( this.dragging ) {
+
+			this._mouseUp( new $.Event( "mouseup", { target: null } ) );
+
+			if ( this.options.helper === "original" ) {
+				this.currentItem.css( this._storedCSS );
+				this._removeClass( this.currentItem, "ui-sortable-helper" );
+			} else {
+				this.currentItem.show();
+			}
+
+			//Post deactivating events to containers
+			for ( var i = this.containers.length - 1; i >= 0; i-- ) {
+				this.containers[ i ]._trigger( "deactivate", null, this._uiHash( this ) );
+				if ( this.containers[ i ].containerCache.over ) {
+					this.containers[ i ]._trigger( "out", null, this._uiHash( this ) );
+					this.containers[ i ].containerCache.over = 0;
+				}
+			}
+
+		}
+
+		if ( this.placeholder ) {
+
+			//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
+			// it unbinds ALL events from the original node!
+			if ( this.placeholder[ 0 ].parentNode ) {
+				this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );
+			}
+			if ( this.options.helper !== "original" && this.helper &&
+					this.helper[ 0 ].parentNode ) {
+				this.helper.remove();
+			}
+
+			$.extend( this, {
+				helper: null,
+				dragging: false,
+				reverting: false,
+				_noFinalSort: null
+			} );
+
+			if ( this.domPosition.prev ) {
+				$( this.domPosition.prev ).after( this.currentItem );
+			} else {
+				$( this.domPosition.parent ).prepend( this.currentItem );
+			}
+		}
+
+		return this;
+
+	},
+
+	serialize: function( o ) {
+
+		var items = this._getItemsAsjQuery( o && o.connected ),
+			str = [];
+		o = o || {};
+
+		$( items ).each( function() {
+			var res = ( $( o.item || this ).attr( o.attribute || "id" ) || "" )
+				.match( o.expression || ( /(.+)[\-=_](.+)/ ) );
+			if ( res ) {
+				str.push(
+					( o.key || res[ 1 ] + "[]" ) +
+					"=" + ( o.key && o.expression ? res[ 1 ] : res[ 2 ] ) );
+			}
+		} );
+
+		if ( !str.length && o.key ) {
+			str.push( o.key + "=" );
 		}
-	},

-	_selectFocusedItem: function( event ) {
-		var item = this.menuItems.eq( this.focusIndex ).parent( "li" );
-		if ( !item.hasClass( "ui-state-disabled" ) ) {
-			this._select( item.data( "ui-selectmenu-item" ), event );
-		}
+		return str.join( "&" );
+
 	},

-	_select: function( item, event ) {
-		var oldIndex = this.element[ 0 ].selectedIndex;
+	toArray: function( o ) {

-		// Change native select element
-		this.element[ 0 ].selectedIndex = item.index;
-		this.buttonItem.replaceWith( this.buttonItem = this._renderButtonItem( item ) );
-		this._setAria( item );
-		this._trigger( "select", event, { item: item } );
+		var items = this._getItemsAsjQuery( o && o.connected ),
+			ret = [];

-		if ( item.index !== oldIndex ) {
-			this._trigger( "change", event, { item: item } );
-		}
+		o = o || {};
+
+		items.each( function() {
+			ret.push( $( o.item || this ).attr( o.attribute || "id" ) || "" );
+		} );
+		return ret;

-		this.close( event );
 	},

-	_setAria: function( item ) {
-		var id = this.menuItems.eq( item.index ).attr( "id" );
+	/* Be careful with the following core functions */
+	_intersectsWith: function( item ) {

-		this.button.attr( {
-			"aria-labelledby": id,
-			"aria-activedescendant": id
-		} );
-		this.menu.attr( "aria-activedescendant", id );
-	},
+		var x1 = this.positionAbs.left,
+			x2 = x1 + this.helperProportions.width,
+			y1 = this.positionAbs.top,
+			y2 = y1 + this.helperProportions.height,
+			l = item.left,
+			r = l + item.width,
+			t = item.top,
+			b = t + item.height,
+			dyClick = this.offset.click.top,
+			dxClick = this.offset.click.left,
+			isOverElementHeight = ( this.options.axis === "x" ) || ( ( y1 + dyClick ) > t &&
+				( y1 + dyClick ) < b ),
+			isOverElementWidth = ( this.options.axis === "y" ) || ( ( x1 + dxClick ) > l &&
+				( x1 + dxClick ) < r ),
+			isOverElement = isOverElementHeight && isOverElementWidth;

-	_setOption: function( key, value ) {
-		if ( key === "icons" ) {
-			var icon = this.button.find( "span.ui-icon" );
-			this._removeClass( icon, null, this.options.icons.button )
-				._addClass( icon, null, value.button );
-		}
+		if ( this.options.tolerance === "pointer" ||
+			this.options.forcePointerForContainers ||
+			( this.options.tolerance !== "pointer" &&
+				this.helperProportions[ this.floating ? "width" : "height" ] >
+				item[ this.floating ? "width" : "height" ] )
+		) {
+			return isOverElement;
+		} else {

-		this._super( key, value );
+			return ( l < x1 + ( this.helperProportions.width / 2 ) && // Right Half
+				x2 - ( this.helperProportions.width / 2 ) < r && // Left Half
+				t < y1 + ( this.helperProportions.height / 2 ) && // Bottom Half
+				y2 - ( this.helperProportions.height / 2 ) < b ); // Top Half

-		if ( key === "appendTo" ) {
-			this.menuWrap.appendTo( this._appendTo() );
 		}
+	},

-		if ( key === "width" ) {
-			this._resizeButton();
+	_intersectsWithPointer: function( item ) {
+		var verticalDirection, horizontalDirection,
+			isOverElementHeight = ( this.options.axis === "x" ) ||
+				this._isOverAxis(
+					this.positionAbs.top + this.offset.click.top, item.top, item.height ),
+			isOverElementWidth = ( this.options.axis === "y" ) ||
+				this._isOverAxis(
+					this.positionAbs.left + this.offset.click.left, item.left, item.width ),
+			isOverElement = isOverElementHeight && isOverElementWidth;
+
+		if ( !isOverElement ) {
+			return false;
 		}
-	},

-	_setOptionDisabled: function( value ) {
-		this._super( value );
+		verticalDirection = this.dragDirection.vertical;
+		horizontalDirection = this.dragDirection.horizontal;

-		this.menuInstance.option( "disabled", value );
-		this.button.attr( "aria-disabled", value );
-		this._toggleClass( this.button, null, "ui-state-disabled", value );
+		return this.floating ?
+			( ( horizontalDirection === "right" || verticalDirection === "down" ) ? 2 : 1 ) :
+			( verticalDirection && ( verticalDirection === "down" ? 2 : 1 ) );

-		this.element.prop( "disabled", value );
-		if ( value ) {
-			this.button.attr( "tabindex", -1 );
-			this.close();
-		} else {
-			this.button.attr( "tabindex", 0 );
-		}
 	},

-	_appendTo: function() {
-		var element = this.options.appendTo;
+	_intersectsWithSides: function( item ) {

-		if ( element ) {
-			element = element.jquery || element.nodeType ?
-				$( element ) :
-				this.document.find( element ).eq( 0 );
-		}
+		var isOverBottomHalf = this._isOverAxis( this.positionAbs.top +
+				this.offset.click.top, item.top + ( item.height / 2 ), item.height ),
+			isOverRightHalf = this._isOverAxis( this.positionAbs.left +
+				this.offset.click.left, item.left + ( item.width / 2 ), item.width ),
+			verticalDirection = this.dragDirection.vertical,
+			horizontalDirection = this.dragDirection.horizontal;

-		if ( !element || !element[ 0 ] ) {
-			element = this.element.closest( ".ui-front, dialog" );
+		if ( this.floating && horizontalDirection ) {
+			return ( ( horizontalDirection === "right" && isOverRightHalf ) ||
+				( horizontalDirection === "left" && !isOverRightHalf ) );
+		} else {
+			return verticalDirection && ( ( verticalDirection === "down" && isOverBottomHalf ) ||
+				( verticalDirection === "up" && !isOverBottomHalf ) );
 		}

-		if ( !element.length ) {
-			element = this.document[ 0 ].body;
-		}
+	},

-		return element;
+	_getDragVerticalDirection: function() {
+		var delta = this.positionAbs.top - this.lastPositionAbs.top;
+		return delta !== 0 && ( delta > 0 ? "down" : "up" );
 	},

-	_toggleAttr: function() {
-		this.button.attr( "aria-expanded", this.isOpen );
+	_getDragHorizontalDirection: function() {
+		var delta = this.positionAbs.left - this.lastPositionAbs.left;
+		return delta !== 0 && ( delta > 0 ? "right" : "left" );
+	},

-		// We can't use two _toggleClass() calls here, because we need to make sure
-		// we always remove classes first and add them second, otherwise if both classes have the
-		// same theme class, it will be removed after we add it.
-		this._removeClass( this.button, "ui-selectmenu-button-" +
-			( this.isOpen ? "closed" : "open" ) )
-			._addClass( this.button, "ui-selectmenu-button-" +
-				( this.isOpen ? "open" : "closed" ) )
-			._toggleClass( this.menuWrap, "ui-selectmenu-open", null, this.isOpen );
+	refresh: function( event ) {
+		this._refreshItems( event );
+		this._setHandleClassName();
+		this.refreshPositions();
+		return this;
+	},

-		this.menu.attr( "aria-hidden", !this.isOpen );
+	_connectWith: function() {
+		var options = this.options;
+		return options.connectWith.constructor === String ?
+			[ options.connectWith ] :
+			options.connectWith;
 	},

-	_resizeButton: function() {
-		var width = this.options.width;
+	_getItemsAsjQuery: function( connected ) {

-		// For `width: false`, just remove inline style and stop
-		if ( width === false ) {
-			this.button.css( "width", "" );
-			return;
+		var i, j, cur, inst,
+			items = [],
+			queries = [],
+			connectWith = this._connectWith();
+
+		if ( connectWith && connected ) {
+			for ( i = connectWith.length - 1; i >= 0; i-- ) {
+				cur = $( connectWith[ i ], this.document[ 0 ] );
+				for ( j = cur.length - 1; j >= 0; j-- ) {
+					inst = $.data( cur[ j ], this.widgetFullName );
+					if ( inst && inst !== this && !inst.options.disabled ) {
+						queries.push( [ typeof inst.options.items === "function" ?
+							inst.options.items.call( inst.element ) :
+							$( inst.options.items, inst.element )
+								.not( ".ui-sortable-helper" )
+								.not( ".ui-sortable-placeholder" ), inst ] );
+					}
+				}
+			}
 		}

-		// For `width: null`, match the width of the original element
-		if ( width === null ) {
-			width = this.element.show().outerWidth();
-			this.element.hide();
+		queries.push( [ typeof this.options.items === "function" ?
+			this.options.items
+				.call( this.element, null, { options: this.options, item: this.currentItem } ) :
+			$( this.options.items, this.element )
+				.not( ".ui-sortable-helper" )
+				.not( ".ui-sortable-placeholder" ), this ] );
+
+		function addItems() {
+			items.push( this );
+		}
+		for ( i = queries.length - 1; i >= 0; i-- ) {
+			queries[ i ][ 0 ].each( addItems );
 		}

-		this.button.outerWidth( width );
+		return $( items );
+
 	},

-	_resizeMenu: function() {
-		this.menu.outerWidth( Math.max(
-			this.button.outerWidth(),
+	_removeCurrentsFromItems: function() {
+
+		var list = this.currentItem.find( ":data(" + this.widgetName + "-item)" );
+
+		this.items = $.grep( this.items, function( item ) {
+			for ( var j = 0; j < list.length; j++ ) {
+				if ( list[ j ] === item.item[ 0 ] ) {
+					return false;
+				}
+			}
+			return true;
+		} );

-			// Support: IE10
-			// IE10 wraps long text (possibly a rounding bug)
-			// so we add 1px to avoid the wrapping
-			this.menu.width( "" ).outerWidth() + 1
-		) );
 	},

-	_getCreateOptions: function() {
-		var options = this._super();
+	_refreshItems: function( event ) {

-		options.disabled = this.element.prop( "disabled" );
+		this.items = [];
+		this.containers = [ this ];

-		return options;
-	},
+		var i, j, cur, inst, targetData, _queries, item, queriesLength,
+			items = this.items,
+			queries = [ [ typeof this.options.items === "function" ?
+				this.options.items.call( this.element[ 0 ], event, { item: this.currentItem } ) :
+				$( this.options.items, this.element ), this ] ],
+			connectWith = this._connectWith();

-	_parseOptions: function( options ) {
-		var that = this,
-			data = [];
-		options.each( function( index, item ) {
-			if ( item.hidden ) {
-				return;
+		//Shouldn't be run the first time through due to massive slow-down
+		if ( connectWith && this.ready ) {
+			for ( i = connectWith.length - 1; i >= 0; i-- ) {
+				cur = $( connectWith[ i ], this.document[ 0 ] );
+				for ( j = cur.length - 1; j >= 0; j-- ) {
+					inst = $.data( cur[ j ], this.widgetFullName );
+					if ( inst && inst !== this && !inst.options.disabled ) {
+						queries.push( [ typeof inst.options.items === "function" ?
+							inst.options.items
+								.call( inst.element[ 0 ], event, { item: this.currentItem } ) :
+							$( inst.options.items, inst.element ), inst ] );
+						this.containers.push( inst );
+					}
+				}
 			}
+		}

-			data.push( that._parseOption( $( item ), index ) );
-		} );
-		this.items = data;
-	},
+		for ( i = queries.length - 1; i >= 0; i-- ) {
+			targetData = queries[ i ][ 1 ];
+			_queries = queries[ i ][ 0 ];

-	_parseOption: function( option, index ) {
-		var optgroup = option.parent( "optgroup" );
+			for ( j = 0, queriesLength = _queries.length; j < queriesLength; j++ ) {
+				item = $( _queries[ j ] );
+
+				// Data for target checking (mouse manager)
+				item.data( this.widgetName + "-item", targetData );
+
+				items.push( {
+					item: item,
+					instance: targetData,
+					width: 0, height: 0,
+					left: 0, top: 0
+				} );
+			}
+		}

-		return {
-			element: option,
-			index: index,
-			value: option.val(),
-			label: option.text(),
-			optgroup: optgroup.attr( "label" ) || "",
-			disabled: optgroup.prop( "disabled" ) || option.prop( "disabled" )
-		};
 	},

-	_destroy: function() {
-		this._unbindFormResetHandler();
-		this.menuWrap.remove();
-		this.button.remove();
-		this.element.show();
-		this.element.removeUniqueId();
-		this.labels.attr( "for", this.ids.element );
-	}
-} ] );
+	_refreshItemPositions: function( fast ) {
+		var i, item, t, p;

+		for ( i = this.items.length - 1; i >= 0; i-- ) {
+			item = this.items[ i ];

-/*!
- * jQuery UI Slider 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
+			//We ignore calculating positions of all connected containers when we're not over them
+			if ( this.currentContainer && item.instance !== this.currentContainer &&
+					item.item[ 0 ] !== this.currentItem[ 0 ] ) {
+				continue;
+			}

-//>>label: Slider
-//>>group: Widgets
-//>>description: Displays a flexible slider with ranges and accessibility via keyboard.
-//>>docs: http://api.jqueryui.com/slider/
-//>>demos: http://jqueryui.com/slider/
-//>>css.structure: ../../themes/base/core.css
-//>>css.structure: ../../themes/base/slider.css
-//>>css.theme: ../../themes/base/theme.css
+			t = this.options.toleranceElement ?
+				$( this.options.toleranceElement, item.item ) :
+				item.item;

+			if ( !fast ) {
+				item.width = t.outerWidth();
+				item.height = t.outerHeight();
+			}

-var widgetsSlider = $.widget( "ui.slider", $.ui.mouse, {
-	version: "1.13.1",
-	widgetEventPrefix: "slide",
+			p = t.offset();
+			item.left = p.left;
+			item.top = p.top;
+		}
+	},

-	options: {
-		animate: false,
-		classes: {
-			"ui-slider": "ui-corner-all",
-			"ui-slider-handle": "ui-corner-all",
+	refreshPositions: function( fast ) {

-			// Note: ui-widget-header isn't the most fittingly semantic framework class for this
-			// element, but worked best visually with a variety of themes
-			"ui-slider-range": "ui-corner-all ui-widget-header"
-		},
-		distance: 0,
-		max: 100,
-		min: 0,
-		orientation: "horizontal",
-		range: false,
-		step: 1,
-		value: 0,
-		values: null,
+		// Determine whether items are being displayed horizontally
+		this.floating = this.items.length ?
+			this.options.axis === "x" || this._isFloating( this.items[ 0 ].item ) :
+			false;

-		// Callbacks
-		change: null,
-		slide: null,
-		start: null,
-		stop: null
+		// This has to be redone because due to the item being moved out/into the offsetParent,
+		// the offsetParent's position will change
+		if ( this.offsetParent && this.helper ) {
+			this.offset.parent = this._getParentOffset();
+		}
+
+		this._refreshItemPositions( fast );
+
+		var i, p;
+
+		if ( this.options.custom && this.options.custom.refreshContainers ) {
+			this.options.custom.refreshContainers.call( this );
+		} else {
+			for ( i = this.containers.length - 1; i >= 0; i-- ) {
+				p = this.containers[ i ].element.offset();
+				this.containers[ i ].containerCache.left = p.left;
+				this.containers[ i ].containerCache.top = p.top;
+				this.containers[ i ].containerCache.width =
+					this.containers[ i ].element.outerWidth();
+				this.containers[ i ].containerCache.height =
+					this.containers[ i ].element.outerHeight();
+			}
+		}
+
+		return this;
 	},

-	// Number of pages in a slider
-	// (how many times can you page up/down to go through the whole range)
-	numPages: 5,
+	_createPlaceholder: function( that ) {
+		that = that || this;
+		var className, nodeName,
+			o = that.options;

-	_create: function() {
-		this._keySliding = false;
-		this._mouseSliding = false;
-		this._animateOff = true;
-		this._handleIndex = null;
-		this._detectOrientation();
-		this._mouseInit();
-		this._calculateNewMax();
+		if ( !o.placeholder || o.placeholder.constructor === String ) {
+			className = o.placeholder;
+			nodeName = that.currentItem[ 0 ].nodeName.toLowerCase();
+			o.placeholder = {
+				element: function() {

-		this._addClass( "ui-slider ui-slider-" + this.orientation,
-			"ui-widget ui-widget-content" );
+					var element = $( "<" + nodeName + ">", that.document[ 0 ] );

-		this._refresh();
+					that._addClass( element, "ui-sortable-placeholder",
+							className || that.currentItem[ 0 ].className )
+						._removeClass( element, "ui-sortable-helper" );

-		this._animateOff = false;
-	},
+					if ( nodeName === "tbody" ) {
+						that._createTrPlaceholder(
+							that.currentItem.find( "tr" ).eq( 0 ),
+							$( "<tr>", that.document[ 0 ] ).appendTo( element )
+						);
+					} else if ( nodeName === "tr" ) {
+						that._createTrPlaceholder( that.currentItem, element );
+					} else if ( nodeName === "img" ) {
+						element.attr( "src", that.currentItem.attr( "src" ) );
+					}

-	_refresh: function() {
-		this._createRange();
-		this._createHandles();
-		this._setupEvents();
-		this._refreshValue();
-	},
+					if ( !className ) {
+						element.css( "visibility", "hidden" );
+					}

-	_createHandles: function() {
-		var i, handleCount,
-			options = this.options,
-			existingHandles = this.element.find( ".ui-slider-handle" ),
-			handle = "<span tabindex='0'></span>",
-			handles = [];
+					return element;
+				},
+				update: function( container, p ) {

-		handleCount = ( options.values && options.values.length ) || 1;
+					// 1. If a className is set as 'placeholder option, we don't force sizes -
+					// the class is responsible for that
+					// 2. The option 'forcePlaceholderSize can be enabled to force it even if a
+					// class name is specified
+					if ( className && !o.forcePlaceholderSize ) {
+						return;
+					}

-		if ( existingHandles.length > handleCount ) {
-			existingHandles.slice( handleCount ).remove();
-			existingHandles = existingHandles.slice( 0, handleCount );
+					// If the element doesn't have a actual height or width by itself (without
+					// styles coming from a stylesheet), it receives the inline height and width
+					// from the dragged item. Or, if it's a tbody or tr, it's going to have a height
+					// anyway since we're populating them with <td>s above, but they're unlikely to
+					// be the correct height on their own if the row heights are dynamic, so we'll
+					// always assign the height of the dragged item given forcePlaceholderSize
+					// is true.
+					if ( !p.height() || ( o.forcePlaceholderSize &&
+							( nodeName === "tbody" || nodeName === "tr" ) ) ) {
+						p.height(
+							that.currentItem.innerHeight() -
+							parseInt( that.currentItem.css( "paddingTop" ) || 0, 10 ) -
+							parseInt( that.currentItem.css( "paddingBottom" ) || 0, 10 ) );
+					}
+					if ( !p.width() ) {
+						p.width(
+							that.currentItem.innerWidth() -
+							parseInt( that.currentItem.css( "paddingLeft" ) || 0, 10 ) -
+							parseInt( that.currentItem.css( "paddingRight" ) || 0, 10 ) );
+					}
+				}
+			};
 		}

-		for ( i = existingHandles.length; i < handleCount; i++ ) {
-			handles.push( handle );
-		}
+		//Create the placeholder
+		that.placeholder = $( o.placeholder.element.call( that.element, that.currentItem ) );

-		this.handles = existingHandles.add( $( handles.join( "" ) ).appendTo( this.element ) );
+		//Append it after the actual current item
+		that.currentItem.after( that.placeholder );

-		this._addClass( this.handles, "ui-slider-handle", "ui-state-default" );
+		//Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
+		o.placeholder.update( that, that.placeholder );

-		this.handle = this.handles.eq( 0 );
+	},

-		this.handles.each( function( i ) {
-			$( this )
-				.data( "ui-slider-handle-index", i )
-				.attr( "tabIndex", 0 );
+	_createTrPlaceholder: function( sourceTr, targetTr ) {
+		var that = this;
+
+		sourceTr.children().each( function() {
+			$( "<td>&#160;</td>", that.document[ 0 ] )
+				.attr( "colspan", $( this ).attr( "colspan" ) || 1 )
+				.appendTo( targetTr );
 		} );
 	},

-	_createRange: function() {
-		var options = this.options;
+	_contactContainers: function( event ) {
+		var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
+			floating, axis,
+			innermostContainer = null,
+			innermostIndex = null;

-		if ( options.range ) {
-			if ( options.range === true ) {
-				if ( !options.values ) {
-					options.values = [ this._valueMin(), this._valueMin() ];
-				} else if ( options.values.length && options.values.length !== 2 ) {
-					options.values = [ options.values[ 0 ], options.values[ 0 ] ];
-				} else if ( Array.isArray( options.values ) ) {
-					options.values = options.values.slice( 0 );
-				}
+		// Get innermost container that intersects with item
+		for ( i = this.containers.length - 1; i >= 0; i-- ) {
+
+			// Never consider a container that's located within the item itself
+			if ( $.contains( this.currentItem[ 0 ], this.containers[ i ].element[ 0 ] ) ) {
+				continue;
 			}

-			if ( !this.range || !this.range.length ) {
-				this.range = $( "<div>" )
-					.appendTo( this.element );
+			if ( this._intersectsWith( this.containers[ i ].containerCache ) ) {
+
+				// If we've already found a container and it's more "inner" than this, then continue
+				if ( innermostContainer &&
+						$.contains(
+							this.containers[ i ].element[ 0 ],
+							innermostContainer.element[ 0 ] ) ) {
+					continue;
+				}
+
+				innermostContainer = this.containers[ i ];
+				innermostIndex = i;

-				this._addClass( this.range, "ui-slider-range" );
 			} else {
-				this._removeClass( this.range, "ui-slider-range-min ui-slider-range-max" );

-				// Handle range switching from true to min/max
-				this.range.css( {
-					"left": "",
-					"bottom": ""
-				} );
-			}
-			if ( options.range === "min" || options.range === "max" ) {
-				this._addClass( this.range, "ui-slider-range-" + options.range );
-			}
-		} else {
-			if ( this.range ) {
-				this.range.remove();
+				// container doesn't intersect. trigger "out" event if necessary
+				if ( this.containers[ i ].containerCache.over ) {
+					this.containers[ i ]._trigger( "out", event, this._uiHash( this ) );
+					this.containers[ i ].containerCache.over = 0;
+				}
 			}
-			this.range = null;
-		}
-	},

-	_setupEvents: function() {
-		this._off( this.handles );
-		this._on( this.handles, this._handleEvents );
-		this._hoverable( this.handles );
-		this._focusable( this.handles );
-	},
+		}

-	_destroy: function() {
-		this.handles.remove();
-		if ( this.range ) {
-			this.range.remove();
+		// If no intersecting containers found, return
+		if ( !innermostContainer ) {
+			return;
 		}

-		this._mouseDestroy();
-	},
+		// Move the item into the container if it's not there already
+		if ( this.containers.length === 1 ) {
+			if ( !this.containers[ innermostIndex ].containerCache.over ) {
+				this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
+				this.containers[ innermostIndex ].containerCache.over = 1;
+			}
+		} else {

-	_mouseCapture: function( event ) {
-		var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
-			that = this,
-			o = this.options;
+			// When entering a new container, we will find the item with the least distance and
+			// append our item near it
+			dist = 10000;
+			itemWithLeastDistance = null;
+			floating = innermostContainer.floating || this._isFloating( this.currentItem );
+			posProperty = floating ? "left" : "top";
+			sizeProperty = floating ? "width" : "height";
+			axis = floating ? "pageX" : "pageY";

-		if ( o.disabled ) {
-			return false;
-		}
+			for ( j = this.items.length - 1; j >= 0; j-- ) {
+				if ( !$.contains(
+						this.containers[ innermostIndex ].element[ 0 ], this.items[ j ].item[ 0 ] )
+				) {
+					continue;
+				}
+				if ( this.items[ j ].item[ 0 ] === this.currentItem[ 0 ] ) {
+					continue;
+				}

-		this.elementSize = {
-			width: this.element.outerWidth(),
-			height: this.element.outerHeight()
-		};
-		this.elementOffset = this.element.offset();
+				cur = this.items[ j ].item.offset()[ posProperty ];
+				nearBottom = false;
+				if ( event[ axis ] - cur > this.items[ j ][ sizeProperty ] / 2 ) {
+					nearBottom = true;
+				}

-		position = { x: event.pageX, y: event.pageY };
-		normValue = this._normValueFromMouse( position );
-		distance = this._valueMax() - this._valueMin() + 1;
-		this.handles.each( function( i ) {
-			var thisDistance = Math.abs( normValue - that.values( i ) );
-			if ( ( distance > thisDistance ) ||
-				( distance === thisDistance &&
-					( i === that._lastChangedValue || that.values( i ) === o.min ) ) ) {
-				distance = thisDistance;
-				closestHandle = $( this );
-				index = i;
+				if ( Math.abs( event[ axis ] - cur ) < dist ) {
+					dist = Math.abs( event[ axis ] - cur );
+					itemWithLeastDistance = this.items[ j ];
+					this.direction = nearBottom ? "up" : "down";
+				}
 			}
-		} );

-		allowed = this._start( event, index );
-		if ( allowed === false ) {
-			return false;
-		}
-		this._mouseSliding = true;
+			//Check if dropOnEmpty is enabled
+			if ( !itemWithLeastDistance && !this.options.dropOnEmpty ) {
+				return;
+			}

-		this._handleIndex = index;
+			if ( this.currentContainer === this.containers[ innermostIndex ] ) {
+				if ( !this.currentContainer.containerCache.over ) {
+					this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash() );
+					this.currentContainer.containerCache.over = 1;
+				}
+				return;
+			}

-		this._addClass( closestHandle, null, "ui-state-active" );
-		closestHandle.trigger( "focus" );
+			if ( itemWithLeastDistance ) {
+				this._rearrange( event, itemWithLeastDistance, null, true );
+			} else {
+				this._rearrange( event, null, this.containers[ innermostIndex ].element, true );
+			}
+			this._trigger( "change", event, this._uiHash() );
+			this.containers[ innermostIndex ]._trigger( "change", event, this._uiHash( this ) );
+			this.currentContainer = this.containers[ innermostIndex ];

-		offset = closestHandle.offset();
-		mouseOverHandle = !$( event.target ).parents().addBack().is( ".ui-slider-handle" );
-		this._clickOffset = mouseOverHandle ? { left: 0, top: 0 } : {
-			left: event.pageX - offset.left - ( closestHandle.width() / 2 ),
-			top: event.pageY - offset.top -
-				( closestHandle.height() / 2 ) -
-				( parseInt( closestHandle.css( "borderTopWidth" ), 10 ) || 0 ) -
-				( parseInt( closestHandle.css( "borderBottomWidth" ), 10 ) || 0 ) +
-				( parseInt( closestHandle.css( "marginTop" ), 10 ) || 0 )
-		};
+			//Update the placeholder
+			this.options.placeholder.update( this.currentContainer, this.placeholder );

-		if ( !this.handles.hasClass( "ui-state-hover" ) ) {
-			this._slide( event, index, normValue );
+			//Update scrollParent
+			this.scrollParent = this.placeholder.scrollParent();
+
+			//Update overflowOffset
+			if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+					this.scrollParent[ 0 ].tagName !== "HTML" ) {
+				this.overflowOffset = this.scrollParent.offset();
+			}
+
+			this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
+			this.containers[ innermostIndex ].containerCache.over = 1;
 		}
-		this._animateOff = true;
-		return true;
-	},

-	_mouseStart: function() {
-		return true;
 	},

-	_mouseDrag: function( event ) {
-		var position = { x: event.pageX, y: event.pageY },
-			normValue = this._normValueFromMouse( position );
+	_createHelper: function( event ) {

-		this._slide( event, this._handleIndex, normValue );
+		var o = this.options,
+			helper = typeof o.helper === "function" ?
+				$( o.helper.apply( this.element[ 0 ], [ event, this.currentItem ] ) ) :
+				( o.helper === "clone" ? this.currentItem.clone() : this.currentItem );

-		return false;
-	},
+		//Add the helper to the DOM if that didn't happen already
+		if ( !helper.parents( "body" ).length ) {
+			this.appendTo[ 0 ].appendChild( helper[ 0 ] );
+		}

-	_mouseStop: function( event ) {
-		this._removeClass( this.handles, null, "ui-state-active" );
-		this._mouseSliding = false;
+		if ( helper[ 0 ] === this.currentItem[ 0 ] ) {
+			this._storedCSS = {
+				width: this.currentItem[ 0 ].style.width,
+				height: this.currentItem[ 0 ].style.height,
+				position: this.currentItem.css( "position" ),
+				top: this.currentItem.css( "top" ),
+				left: this.currentItem.css( "left" )
+			};
+		}

-		this._stop( event, this._handleIndex );
-		this._change( event, this._handleIndex );
+		if ( !helper[ 0 ].style.width || o.forceHelperSize ) {
+			helper.width( this.currentItem.width() );
+		}
+		if ( !helper[ 0 ].style.height || o.forceHelperSize ) {
+			helper.height( this.currentItem.height() );
+		}

-		this._handleIndex = null;
-		this._clickOffset = null;
-		this._animateOff = false;
+		return helper;

-		return false;
 	},

-	_detectOrientation: function() {
-		this.orientation = ( this.options.orientation === "vertical" ) ? "vertical" : "horizontal";
+	_adjustOffsetFromHelper: function( obj ) {
+		if ( typeof obj === "string" ) {
+			obj = obj.split( " " );
+		}
+		if ( Array.isArray( obj ) ) {
+			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
+		}
+		if ( "left" in obj ) {
+			this.offset.click.left = obj.left + this.margins.left;
+		}
+		if ( "right" in obj ) {
+			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
+		}
+		if ( "top" in obj ) {
+			this.offset.click.top = obj.top + this.margins.top;
+		}
+		if ( "bottom" in obj ) {
+			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
+		}
 	},

-	_normValueFromMouse: function( position ) {
-		var pixelTotal,
-			pixelMouse,
-			percentMouse,
-			valueTotal,
-			valueMouse;
+	_getParentOffset: function() {

-		if ( this.orientation === "horizontal" ) {
-			pixelTotal = this.elementSize.width;
-			pixelMouse = position.x - this.elementOffset.left -
-				( this._clickOffset ? this._clickOffset.left : 0 );
-		} else {
-			pixelTotal = this.elementSize.height;
-			pixelMouse = position.y - this.elementOffset.top -
-				( this._clickOffset ? this._clickOffset.top : 0 );
-		}
+		//Get the offsetParent and cache its position
+		this.offsetParent = this.helper.offsetParent();
+		var po = this.offsetParent.offset();

-		percentMouse = ( pixelMouse / pixelTotal );
-		if ( percentMouse > 1 ) {
-			percentMouse = 1;
-		}
-		if ( percentMouse < 0 ) {
-			percentMouse = 0;
+		// This is a special case where we need to modify a offset calculated on start, since the
+		// following happened:
+		// 1. The position of the helper is absolute, so it's position is calculated based on the
+		// next positioned parent
+		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
+		// the document, which means that the scroll is included in the initial calculation of the
+		// offset of the parent, and never recalculated upon drag
+		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
+			po.left += this.scrollParent.scrollLeft();
+			po.top += this.scrollParent.scrollTop();
 		}
-		if ( this.orientation === "vertical" ) {
-			percentMouse = 1 - percentMouse;
+
+		// This needs to be actually done for all browsers, since pageX/pageY includes this
+		// information with an ugly IE fix
+		if ( this.offsetParent[ 0 ] === this.document[ 0 ].body ||
+				( this.offsetParent[ 0 ].tagName &&
+				this.offsetParent[ 0 ].tagName.toLowerCase() === "html" && $.ui.ie ) ) {
+			po = { top: 0, left: 0 };
 		}

-		valueTotal = this._valueMax() - this._valueMin();
-		valueMouse = this._valueMin() + percentMouse * valueTotal;
+		return {
+			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
+			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
+		};

-		return this._trimAlignValue( valueMouse );
 	},

-	_uiHash: function( index, value, values ) {
-		var uiHash = {
-			handle: this.handles[ index ],
-			handleIndex: index,
-			value: value !== undefined ? value : this.value()
-		};
+	_getRelativeOffset: function() {

-		if ( this._hasMultipleValues() ) {
-			uiHash.value = value !== undefined ? value : this.values( index );
-			uiHash.values = values || this.values();
+		if ( this.cssPosition === "relative" ) {
+			var p = this.currentItem.position();
+			return {
+				top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
+					this.scrollParent.scrollTop(),
+				left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
+					this.scrollParent.scrollLeft()
+			};
+		} else {
+			return { top: 0, left: 0 };
 		}

-		return uiHash;
 	},

-	_hasMultipleValues: function() {
-		return this.options.values && this.options.values.length;
+	_cacheMargins: function() {
+		this.margins = {
+			left: ( parseInt( this.currentItem.css( "marginLeft" ), 10 ) || 0 ),
+			top: ( parseInt( this.currentItem.css( "marginTop" ), 10 ) || 0 )
+		};
 	},

-	_start: function( event, index ) {
-		return this._trigger( "start", event, this._uiHash( index ) );
+	_cacheHelperProportions: function() {
+		this.helperProportions = {
+			width: this.helper.outerWidth(),
+			height: this.helper.outerHeight()
+		};
 	},

-	_slide: function( event, index, newVal ) {
-		var allowed, otherVal,
-			currentValue = this.value(),
-			newValues = this.values();
+	_setContainment: function() {

-		if ( this._hasMultipleValues() ) {
-			otherVal = this.values( index ? 0 : 1 );
-			currentValue = this.values( index );
+		var ce, co, over,
+			o = this.options;
+		if ( o.containment === "parent" ) {
+			o.containment = this.helper[ 0 ].parentNode;
+		}
+		if ( o.containment === "document" || o.containment === "window" ) {
+			this.containment = [
+				0 - this.offset.relative.left - this.offset.parent.left,
+				0 - this.offset.relative.top - this.offset.parent.top,
+				o.containment === "document" ?
+					this.document.width() :
+					this.window.width() - this.helperProportions.width - this.margins.left,
+				( o.containment === "document" ?
+					( this.document.height() || document.body.parentNode.scrollHeight ) :
+					this.window.height() || this.document[ 0 ].body.parentNode.scrollHeight
+				) - this.helperProportions.height - this.margins.top
+			];
+		}

-			if ( this.options.values.length === 2 && this.options.range === true ) {
-				newVal =  index === 0 ? Math.min( otherVal, newVal ) : Math.max( otherVal, newVal );
-			}
+		if ( !( /^(document|window|parent)$/ ).test( o.containment ) ) {
+			ce = $( o.containment )[ 0 ];
+			co = $( o.containment ).offset();
+			over = ( $( ce ).css( "overflow" ) !== "hidden" );

-			newValues[ index ] = newVal;
+			this.containment = [
+				co.left + ( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) +
+					( parseInt( $( ce ).css( "paddingLeft" ), 10 ) || 0 ) - this.margins.left,
+				co.top + ( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) +
+					( parseInt( $( ce ).css( "paddingTop" ), 10 ) || 0 ) - this.margins.top,
+				co.left + ( over ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
+					( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) -
+					( parseInt( $( ce ).css( "paddingRight" ), 10 ) || 0 ) -
+					this.helperProportions.width - this.margins.left,
+				co.top + ( over ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
+					( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) -
+					( parseInt( $( ce ).css( "paddingBottom" ), 10 ) || 0 ) -
+					this.helperProportions.height - this.margins.top
+			];
 		}

-		if ( newVal === currentValue ) {
-			return;
-		}
+	},

-		allowed = this._trigger( "slide", event, this._uiHash( index, newVal, newValues ) );
+	_convertPositionTo: function( d, pos ) {

-		// A slide can be canceled by returning false from the slide callback
-		if ( allowed === false ) {
-			return;
+		if ( !pos ) {
+			pos = this.position;
 		}
+		var mod = d === "absolute" ? 1 : -1,
+			scroll = this.cssPosition === "absolute" &&
+				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
+					this.offsetParent :
+					this.scrollParent,
+			scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );

-		if ( this._hasMultipleValues() ) {
-			this.values( index, newVal );
-		} else {
-			this.value( newVal );
-		}
-	},
+		return {
+			top: (

-	_stop: function( event, index ) {
-		this._trigger( "stop", event, this._uiHash( index ) );
-	},
+				// The absolute mouse position
+				pos.top	+

-	_change: function( event, index ) {
-		if ( !this._keySliding && !this._mouseSliding ) {
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.top * mod +

-			//store the last changed value index for reference when handles overlap
-			this._lastChangedValue = index;
-			this._trigger( "change", event, this._uiHash( index ) );
-		}
-	},
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.top * mod -
+				( ( this.cssPosition === "fixed" ?
+					-this.scrollParent.scrollTop() :
+					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) * mod )
+			),
+			left: (

-	value: function( newValue ) {
-		if ( arguments.length ) {
-			this.options.value = this._trimAlignValue( newValue );
-			this._refreshValue();
-			this._change( null, 0 );
-			return;
-		}
+				// The absolute mouse position
+				pos.left +
+
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.left * mod +
+
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.left * mod	-
+				( ( this.cssPosition === "fixed" ?
+					-this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
+					scroll.scrollLeft() ) * mod )
+			)
+		};

-		return this._value();
 	},

-	values: function( index, newValue ) {
-		var vals,
-			newValues,
-			i;
+	_generatePosition: function( event ) {

-		if ( arguments.length > 1 ) {
-			this.options.values[ index ] = this._trimAlignValue( newValue );
-			this._refreshValue();
-			this._change( null, index );
-			return;
+		var top, left,
+			o = this.options,
+			pageX = event.pageX,
+			pageY = event.pageY,
+			scroll = this.cssPosition === "absolute" &&
+				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
+					this.offsetParent :
+					this.scrollParent,
+				scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );
+
+		// This is another very weird special case that only happens for relative elements:
+		// 1. If the css position is relative
+		// 2. and the scroll parent is the document or similar to the offset parent
+		// we have to refresh the relative offset during the scroll so there are no jumps
+		if ( this.cssPosition === "relative" && !( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
+				this.scrollParent[ 0 ] !== this.offsetParent[ 0 ] ) ) {
+			this.offset.relative = this._getRelativeOffset();
 		}

-		if ( arguments.length ) {
-			if ( Array.isArray( arguments[ 0 ] ) ) {
-				vals = this.options.values;
-				newValues = arguments[ 0 ];
-				for ( i = 0; i < vals.length; i += 1 ) {
-					vals[ i ] = this._trimAlignValue( newValues[ i ] );
-					this._change( null, i );
+		/*
+		 * - Position constraining -
+		 * Constrain the position to a mix of grid, containment.
+		 */
+
+		if ( this.originalPosition ) { //If we are not dragging yet, we won't check for options
+
+			if ( this.containment ) {
+				if ( event.pageX - this.offset.click.left < this.containment[ 0 ] ) {
+					pageX = this.containment[ 0 ] + this.offset.click.left;
 				}
-				this._refreshValue();
-			} else {
-				if ( this._hasMultipleValues() ) {
-					return this._values( index );
-				} else {
-					return this.value();
+				if ( event.pageY - this.offset.click.top < this.containment[ 1 ] ) {
+					pageY = this.containment[ 1 ] + this.offset.click.top;
+				}
+				if ( event.pageX - this.offset.click.left > this.containment[ 2 ] ) {
+					pageX = this.containment[ 2 ] + this.offset.click.left;
+				}
+				if ( event.pageY - this.offset.click.top > this.containment[ 3 ] ) {
+					pageY = this.containment[ 3 ] + this.offset.click.top;
 				}
 			}
-		} else {
-			return this._values();
-		}
-	},

-	_setOption: function( key, value ) {
-		var i,
-			valsLength = 0;
+			if ( o.grid ) {
+				top = this.originalPageY + Math.round( ( pageY - this.originalPageY ) /
+					o.grid[ 1 ] ) * o.grid[ 1 ];
+				pageY = this.containment ?
+					( ( top - this.offset.click.top >= this.containment[ 1 ] &&
+						top - this.offset.click.top <= this.containment[ 3 ] ) ?
+							top :
+							( ( top - this.offset.click.top >= this.containment[ 1 ] ) ?
+								top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) :
+								top;

-		if ( key === "range" && this.options.range === true ) {
-			if ( value === "min" ) {
-				this.options.value = this._values( 0 );
-				this.options.values = null;
-			} else if ( value === "max" ) {
-				this.options.value = this._values( this.options.values.length - 1 );
-				this.options.values = null;
+				left = this.originalPageX + Math.round( ( pageX - this.originalPageX ) /
+					o.grid[ 0 ] ) * o.grid[ 0 ];
+				pageX = this.containment ?
+					( ( left - this.offset.click.left >= this.containment[ 0 ] &&
+						left - this.offset.click.left <= this.containment[ 2 ] ) ?
+							left :
+							( ( left - this.offset.click.left >= this.containment[ 0 ] ) ?
+								left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) :
+								left;
 			}
-		}

-		if ( Array.isArray( this.options.values ) ) {
-			valsLength = this.options.values.length;
 		}

-		this._super( key, value );
-
-		switch ( key ) {
-			case "orientation":
-				this._detectOrientation();
-				this._removeClass( "ui-slider-horizontal ui-slider-vertical" )
-					._addClass( "ui-slider-" + this.orientation );
-				this._refreshValue();
-				if ( this.options.range ) {
-					this._refreshRange( value );
-				}
-
-				// Reset positioning from previous orientation
-				this.handles.css( value === "horizontal" ? "bottom" : "left", "" );
-				break;
-			case "value":
-				this._animateOff = true;
-				this._refreshValue();
-				this._change( null, 0 );
-				this._animateOff = false;
-				break;
-			case "values":
-				this._animateOff = true;
-				this._refreshValue();
-
-				// Start from the last handle to prevent unreachable handles (#9046)
-				for ( i = valsLength - 1; i >= 0; i-- ) {
-					this._change( null, i );
-				}
-				this._animateOff = false;
-				break;
-			case "step":
-			case "min":
-			case "max":
-				this._animateOff = true;
-				this._calculateNewMax();
-				this._refreshValue();
-				this._animateOff = false;
-				break;
-			case "range":
-				this._animateOff = true;
-				this._refresh();
-				this._animateOff = false;
-				break;
-		}
-	},
+		return {
+			top: (

-	_setOptionDisabled: function( value ) {
-		this._super( value );
+				// The absolute mouse position
+				pageY -

-		this._toggleClass( null, "ui-state-disabled", !!value );
-	},
+				// Click offset (relative to the element)
+				this.offset.click.top -

-	//internal value getter
-	// _value() returns value trimmed by min and max, aligned by step
-	_value: function() {
-		var val = this.options.value;
-		val = this._trimAlignValue( val );
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.top -

-		return val;
-	},
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.top +
+				( ( this.cssPosition === "fixed" ?
+					-this.scrollParent.scrollTop() :
+					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) )
+			),
+			left: (

-	//internal values getter
-	// _values() returns array of values trimmed by min and max, aligned by step
-	// _values( index ) returns single value trimmed by min and max, aligned by step
-	_values: function( index ) {
-		var val,
-			vals,
-			i;
+				// The absolute mouse position
+				pageX -

-		if ( arguments.length ) {
-			val = this.options.values[ index ];
-			val = this._trimAlignValue( val );
+				// Click offset (relative to the element)
+				this.offset.click.left -

-			return val;
-		} else if ( this._hasMultipleValues() ) {
+				// Only for relative positioned nodes: Relative offset from element to offset parent
+				this.offset.relative.left -

-			// .slice() creates a copy of the array
-			// this copy gets trimmed by min and max and then returned
-			vals = this.options.values.slice();
-			for ( i = 0; i < vals.length; i += 1 ) {
-				vals[ i ] = this._trimAlignValue( vals[ i ] );
-			}
+				// The offsetParent's offset without borders (offset + border)
+				this.offset.parent.left +
+				( ( this.cssPosition === "fixed" ?
+					-this.scrollParent.scrollLeft() :
+					scrollIsRootNode ? 0 : scroll.scrollLeft() ) )
+			)
+		};

-			return vals;
-		} else {
-			return [];
-		}
 	},

-	// Returns the step-aligned value that val is closest to, between (inclusive) min and max
-	_trimAlignValue: function( val ) {
-		if ( val <= this._valueMin() ) {
-			return this._valueMin();
-		}
-		if ( val >= this._valueMax() ) {
-			return this._valueMax();
-		}
-		var step = ( this.options.step > 0 ) ? this.options.step : 1,
-			valModStep = ( val - this._valueMin() ) % step,
-			alignValue = val - valModStep;
+	_rearrange: function( event, i, a, hardRefresh ) {

-		if ( Math.abs( valModStep ) * 2 >= step ) {
-			alignValue += ( valModStep > 0 ) ? step : ( -step );
+		if ( a ) {
+			a[ 0 ].appendChild( this.placeholder[ 0 ] );
+		} else {
+			i.item[ 0 ].parentNode.insertBefore( this.placeholder[ 0 ],
+				( this.direction === "down" ? i.item[ 0 ] : i.item[ 0 ].nextSibling ) );
 		}

-		// Since JavaScript has problems with large floats, round
-		// the final value to 5 digits after the decimal point (see #4124)
-		return parseFloat( alignValue.toFixed( 5 ) );
-	},
+		//Various things done here to improve the performance:
+		// 1. we create a setTimeout, that calls refreshPositions
+		// 2. on the instance, we have a counter variable, that get's higher after every append
+		// 3. on the local scope, we copy the counter variable, and check in the timeout,
+		// if it's still the same
+		// 4. this lets only the last addition to the timeout stack through
+		this.counter = this.counter ? ++this.counter : 1;
+		var counter = this.counter;

-	_calculateNewMax: function() {
-		var max = this.options.max,
-			min = this._valueMin(),
-			step = this.options.step,
-			aboveMin = Math.round( ( max - min ) / step ) * step;
-		max = aboveMin + min;
-		if ( max > this.options.max ) {
+		this._delay( function() {
+			if ( counter === this.counter ) {

-			//If max is not divisible by step, rounding off may increase its value
-			max -= step;
-		}
-		this.max = parseFloat( max.toFixed( this._precision() ) );
-	},
+				//Precompute after each DOM insertion, NOT on mousemove
+				this.refreshPositions( !hardRefresh );
+			}
+		} );

-	_precision: function() {
-		var precision = this._precisionOf( this.options.step );
-		if ( this.options.min !== null ) {
-			precision = Math.max( precision, this._precisionOf( this.options.min ) );
-		}
-		return precision;
 	},

-	_precisionOf: function( num ) {
-		var str = num.toString(),
-			decimal = str.indexOf( "." );
-		return decimal === -1 ? 0 : str.length - decimal - 1;
-	},
+	_clear: function( event, noPropagation ) {

-	_valueMin: function() {
-		return this.options.min;
-	},
+		this.reverting = false;

-	_valueMax: function() {
-		return this.max;
-	},
+		// We delay all events that have to be triggered to after the point where the placeholder
+		// has been removed and everything else normalized again
+		var i,
+			delayedTriggers = [];

-	_refreshRange: function( orientation ) {
-		if ( orientation === "vertical" ) {
-			this.range.css( { "width": "", "left": "" } );
+		// We first have to update the dom position of the actual currentItem
+		// Note: don't do it if the current item is already removed (by a user), or it gets
+		// reappended (see #4088)
+		if ( !this._noFinalSort && this.currentItem.parent().length ) {
+			this.placeholder.before( this.currentItem );
 		}
-		if ( orientation === "horizontal" ) {
-			this.range.css( { "height": "", "bottom": "" } );
+		this._noFinalSort = null;
+
+		if ( this.helper[ 0 ] === this.currentItem[ 0 ] ) {
+			for ( i in this._storedCSS ) {
+				if ( this._storedCSS[ i ] === "auto" || this._storedCSS[ i ] === "static" ) {
+					this._storedCSS[ i ] = "";
+				}
+			}
+			this.currentItem.css( this._storedCSS );
+			this._removeClass( this.currentItem, "ui-sortable-helper" );
+		} else {
+			this.currentItem.show();
 		}
-	},

-	_refreshValue: function() {
-		var lastValPercent, valPercent, value, valueMin, valueMax,
-			oRange = this.options.range,
-			o = this.options,
-			that = this,
-			animate = ( !this._animateOff ) ? o.animate : false,
-			_set = {};
+		if ( this.fromOutside && !noPropagation ) {
+			delayedTriggers.push( function( event ) {
+				this._trigger( "receive", event, this._uiHash( this.fromOutside ) );
+			} );
+		}
+		if ( ( this.fromOutside ||
+				this.domPosition.prev !==
+				this.currentItem.prev().not( ".ui-sortable-helper" )[ 0 ] ||
+				this.domPosition.parent !== this.currentItem.parent()[ 0 ] ) && !noPropagation ) {

-		if ( this._hasMultipleValues() ) {
-			this.handles.each( function( i ) {
-				valPercent = ( that.values( i ) - that._valueMin() ) / ( that._valueMax() -
-					that._valueMin() ) * 100;
-				_set[ that.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
-				$( this ).stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
-				if ( that.options.range === true ) {
-					if ( that.orientation === "horizontal" ) {
-						if ( i === 0 ) {
-							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-								left: valPercent + "%"
-							}, o.animate );
-						}
-						if ( i === 1 ) {
-							that.range[ animate ? "animate" : "css" ]( {
-								width: ( valPercent - lastValPercent ) + "%"
-							}, {
-								queue: false,
-								duration: o.animate
-							} );
-						}
-					} else {
-						if ( i === 0 ) {
-							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-								bottom: ( valPercent ) + "%"
-							}, o.animate );
-						}
-						if ( i === 1 ) {
-							that.range[ animate ? "animate" : "css" ]( {
-								height: ( valPercent - lastValPercent ) + "%"
-							}, {
-								queue: false,
-								duration: o.animate
-							} );
-						}
-					}
-				}
-				lastValPercent = valPercent;
+			// Trigger update callback if the DOM position has changed
+			delayedTriggers.push( function( event ) {
+				this._trigger( "update", event, this._uiHash() );
 			} );
-		} else {
-			value = this.value();
-			valueMin = this._valueMin();
-			valueMax = this._valueMax();
-			valPercent = ( valueMax !== valueMin ) ?
-					( value - valueMin ) / ( valueMax - valueMin ) * 100 :
-					0;
-			_set[ this.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
-			this.handle.stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
+		}

-			if ( oRange === "min" && this.orientation === "horizontal" ) {
-				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-					width: valPercent + "%"
-				}, o.animate );
-			}
-			if ( oRange === "max" && this.orientation === "horizontal" ) {
-				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-					width: ( 100 - valPercent ) + "%"
-				}, o.animate );
+		// Check if the items Container has Changed and trigger appropriate
+		// events.
+		if ( this !== this.currentContainer ) {
+			if ( !noPropagation ) {
+				delayedTriggers.push( function( event ) {
+					this._trigger( "remove", event, this._uiHash() );
+				} );
+				delayedTriggers.push( ( function( c ) {
+					return function( event ) {
+						c._trigger( "receive", event, this._uiHash( this ) );
+					};
+				} ).call( this, this.currentContainer ) );
+				delayedTriggers.push( ( function( c ) {
+					return function( event ) {
+						c._trigger( "update", event, this._uiHash( this ) );
+					};
+				} ).call( this, this.currentContainer ) );
 			}
-			if ( oRange === "min" && this.orientation === "vertical" ) {
-				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-					height: valPercent + "%"
-				}, o.animate );
+		}
+
+		//Post events to containers
+		function delayEvent( type, instance, container ) {
+			return function( event ) {
+				container._trigger( type, event, instance._uiHash( instance ) );
+			};
+		}
+		for ( i = this.containers.length - 1; i >= 0; i-- ) {
+			if ( !noPropagation ) {
+				delayedTriggers.push( delayEvent( "deactivate", this, this.containers[ i ] ) );
 			}
-			if ( oRange === "max" && this.orientation === "vertical" ) {
-				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
-					height: ( 100 - valPercent ) + "%"
-				}, o.animate );
+			if ( this.containers[ i ].containerCache.over ) {
+				delayedTriggers.push( delayEvent( "out", this, this.containers[ i ] ) );
+				this.containers[ i ].containerCache.over = 0;
 			}
 		}
-	},

-	_handleEvents: {
-		keydown: function( event ) {
-			var allowed, curVal, newVal, step,
-				index = $( event.target ).data( "ui-slider-handle-index" );
+		//Do what was originally in plugins
+		if ( this.storedCursor ) {
+			this.document.find( "body" ).css( "cursor", this.storedCursor );
+			this.storedStylesheet.remove();
+		}
+		if ( this._storedOpacity ) {
+			this.helper.css( "opacity", this._storedOpacity );
+		}
+		if ( this._storedZIndex ) {
+			this.helper.css( "zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex );
+		}

-			switch ( event.keyCode ) {
-				case $.ui.keyCode.HOME:
-				case $.ui.keyCode.END:
-				case $.ui.keyCode.PAGE_UP:
-				case $.ui.keyCode.PAGE_DOWN:
-				case $.ui.keyCode.UP:
-				case $.ui.keyCode.RIGHT:
-				case $.ui.keyCode.DOWN:
-				case $.ui.keyCode.LEFT:
-					event.preventDefault();
-					if ( !this._keySliding ) {
-						this._keySliding = true;
-						this._addClass( $( event.target ), null, "ui-state-active" );
-						allowed = this._start( event, index );
-						if ( allowed === false ) {
-							return;
-						}
-					}
-					break;
-			}
+		this.dragging = false;

-			step = this.options.step;
-			if ( this._hasMultipleValues() ) {
-				curVal = newVal = this.values( index );
-			} else {
-				curVal = newVal = this.value();
-			}
+		if ( !noPropagation ) {
+			this._trigger( "beforeStop", event, this._uiHash() );
+		}

-			switch ( event.keyCode ) {
-				case $.ui.keyCode.HOME:
-					newVal = this._valueMin();
-					break;
-				case $.ui.keyCode.END:
-					newVal = this._valueMax();
-					break;
-				case $.ui.keyCode.PAGE_UP:
-					newVal = this._trimAlignValue(
-						curVal + ( ( this._valueMax() - this._valueMin() ) / this.numPages )
-					);
-					break;
-				case $.ui.keyCode.PAGE_DOWN:
-					newVal = this._trimAlignValue(
-						curVal - ( ( this._valueMax() - this._valueMin() ) / this.numPages ) );
-					break;
-				case $.ui.keyCode.UP:
-				case $.ui.keyCode.RIGHT:
-					if ( curVal === this._valueMax() ) {
-						return;
-					}
-					newVal = this._trimAlignValue( curVal + step );
-					break;
-				case $.ui.keyCode.DOWN:
-				case $.ui.keyCode.LEFT:
-					if ( curVal === this._valueMin() ) {
-						return;
-					}
-					newVal = this._trimAlignValue( curVal - step );
-					break;
+		//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
+		// it unbinds ALL events from the original node!
+		this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );
+
+		if ( !this.cancelHelperRemoval ) {
+			if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
+				this.helper.remove();
 			}
+			this.helper = null;
+		}

-			this._slide( event, index, newVal );
-		},
-		keyup: function( event ) {
-			var index = $( event.target ).data( "ui-slider-handle-index" );
+		if ( !noPropagation ) {
+			for ( i = 0; i < delayedTriggers.length; i++ ) {

-			if ( this._keySliding ) {
-				this._keySliding = false;
-				this._stop( event, index );
-				this._change( event, index );
-				this._removeClass( $( event.target ), null, "ui-state-active" );
+				// Trigger all delayed events
+				delayedTriggers[ i ].call( this, event );
 			}
+			this._trigger( "stop", event, this._uiHash() );
+		}
+
+		this.fromOutside = false;
+		return !this.cancelHelperRemoval;
+
+	},
+
+	_trigger: function() {
+		if ( $.Widget.prototype._trigger.apply( this, arguments ) === false ) {
+			this.cancel();
 		}
+	},
+
+	_uiHash: function( _inst ) {
+		var inst = _inst || this;
+		return {
+			helper: inst.helper,
+			placeholder: inst.placeholder || $( [] ),
+			position: inst.position,
+			originalPosition: inst.originalPosition,
+			offset: inst.positionAbs,
+			item: inst.currentItem,
+			sender: _inst ? _inst.element : null
+		};
 	}
+
 } );


 /*!
- * jQuery UI Spinner 1.13.1
+ * jQuery UI Spinner 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -14504,7 +17117,7 @@
 }

 $.widget( "ui.spinner", {
-	version: "1.13.1",
+	version: "1.13.2",
 	defaultElement: "<input>",
 	widgetEventPrefix: "spin",
 	options: {
@@ -15035,7 +17648,7 @@


 /*!
- * jQuery UI Tabs 1.13.1
+ * jQuery UI Tabs 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -15054,7 +17667,7 @@


 $.widget( "ui.tabs", {
-	version: "1.13.1",
+	version: "1.13.2",
 	delay: 300,
 	options: {
 		active: null,
@@ -15939,7 +18552,7 @@


 /*!
- * jQuery UI Tooltip 1.13.1
+ * jQuery UI Tooltip 1.13.2
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
@@ -15958,7 +18571,7 @@


 $.widget( "ui.tooltip", {
-	version: "1.13.1",
+	version: "1.13.2",
 	options: {
 		classes: {
 			"ui-tooltip": "ui-corner-all ui-widget-shadow"
@@ -16445,2613 +19058,5 @@



-// Create a local jQuery because jQuery Color relies on it and the
-// global may not exist with AMD and a custom build (#10199).
-// This module is a noop if used as a regular AMD module.
-// eslint-disable-next-line no-unused-vars
-var jQuery = $;
-
-
-/*!
- * jQuery Color Animations v2.2.0
- * https://github.com/jquery/jquery-color
- *
- * Copyright OpenJS Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- *
- * Date: Sun May 10 09:02:36 2020 +0200
- */
-
-
-
-	var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor " +
-		"borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",
-
-	class2type = {},
-	toString = class2type.toString,
-
-	// plusequals test for += 100 -= 100
-	rplusequals = /^([\-+])=\s*(\d+\.?\d*)/,
-
-	// a set of RE's that can match strings and generate color tuples.
-	stringParsers = [ {
-			re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
-			parse: function( execResult ) {
-				return [
-					execResult[ 1 ],
-					execResult[ 2 ],
-					execResult[ 3 ],
-					execResult[ 4 ]
-				];
-			}
-		}, {
-			re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
-			parse: function( execResult ) {
-				return [
-					execResult[ 1 ] * 2.55,
-					execResult[ 2 ] * 2.55,
-					execResult[ 3 ] * 2.55,
-					execResult[ 4 ]
-				];
-			}
-		}, {
-
-			// this regex ignores A-F because it's compared against an already lowercased string
-			re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,
-			parse: function( execResult ) {
-				return [
-					parseInt( execResult[ 1 ], 16 ),
-					parseInt( execResult[ 2 ], 16 ),
-					parseInt( execResult[ 3 ], 16 ),
-					execResult[ 4 ] ?
-						( parseInt( execResult[ 4 ], 16 ) / 255 ).toFixed( 2 ) :
-						1
-				];
-			}
-		}, {
-
-			// this regex ignores A-F because it's compared against an already lowercased string
-			re: /#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,
-			parse: function( execResult ) {
-				return [
-					parseInt( execResult[ 1 ] + execResult[ 1 ], 16 ),
-					parseInt( execResult[ 2 ] + execResult[ 2 ], 16 ),
-					parseInt( execResult[ 3 ] + execResult[ 3 ], 16 ),
-					execResult[ 4 ] ?
-						( parseInt( execResult[ 4 ] + execResult[ 4 ], 16 ) / 255 )
-							.toFixed( 2 ) :
-						1
-				];
-			}
-		}, {
-			re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
-			space: "hsla",
-			parse: function( execResult ) {
-				return [
-					execResult[ 1 ],
-					execResult[ 2 ] / 100,
-					execResult[ 3 ] / 100,
-					execResult[ 4 ]
-				];
-			}
-		} ],
-
-	// jQuery.Color( )
-	color = jQuery.Color = function( color, green, blue, alpha ) {
-		return new jQuery.Color.fn.parse( color, green, blue, alpha );
-	},
-	spaces = {
-		rgba: {
-			props: {
-				red: {
-					idx: 0,
-					type: "byte"
-				},
-				green: {
-					idx: 1,
-					type: "byte"
-				},
-				blue: {
-					idx: 2,
-					type: "byte"
-				}
-			}
-		},
-
-		hsla: {
-			props: {
-				hue: {
-					idx: 0,
-					type: "degrees"
-				},
-				saturation: {
-					idx: 1,
-					type: "percent"
-				},
-				lightness: {
-					idx: 2,
-					type: "percent"
-				}
-			}
-		}
-	},
-	propTypes = {
-		"byte": {
-			floor: true,
-			max: 255
-		},
-		"percent": {
-			max: 1
-		},
-		"degrees": {
-			mod: 360,
-			floor: true
-		}
-	},
-	support = color.support = {},
-
-	// element for support tests
-	supportElem = jQuery( "<p>" )[ 0 ],
-
-	// colors = jQuery.Color.names
-	colors,
-
-	// local aliases of functions called often
-	each = jQuery.each;
-
-// determine rgba support immediately
-supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
-support.rgba = supportElem.style.backgroundColor.indexOf( "rgba" ) > -1;
-
-// define cache name and alpha properties
-// for rgba and hsla spaces
-each( spaces, function( spaceName, space ) {
-	space.cache = "_" + spaceName;
-	space.props.alpha = {
-		idx: 3,
-		type: "percent",
-		def: 1
-	};
-} );
-
-// Populate the class2type map
-jQuery.each( "Boolean Number String Function Array Date RegExp Object Error Symbol".split( " " ),
-	function( _i, name ) {
-		class2type[ "[object " + name + "]" ] = name.toLowerCase();
-	} );
-
-function getType( obj ) {
-	if ( obj == null ) {
-		return obj + "";
-	}
-
-	return typeof obj === "object" ?
-		class2type[ toString.call( obj ) ] || "object" :
-		typeof obj;
-}
-
-function clamp( value, prop, allowEmpty ) {
-	var type = propTypes[ prop.type ] || {};
-
-	if ( value == null ) {
-		return ( allowEmpty || !prop.def ) ? null : prop.def;
-	}
-
-	// ~~ is an short way of doing floor for positive numbers
-	value = type.floor ? ~~value : parseFloat( value );
-
-	// IE will pass in empty strings as value for alpha,
-	// which will hit this case
-	if ( isNaN( value ) ) {
-		return prop.def;
-	}
-
-	if ( type.mod ) {
-
-		// we add mod before modding to make sure that negatives values
-		// get converted properly: -10 -> 350
-		return ( value + type.mod ) % type.mod;
-	}
-
-	// for now all property types without mod have min and max
-	return Math.min( type.max, Math.max( 0, value ) );
-}
-
-function stringParse( string ) {
-	var inst = color(),
-		rgba = inst._rgba = [];
-
-	string = string.toLowerCase();
-
-	each( stringParsers, function( _i, parser ) {
-		var parsed,
-			match = parser.re.exec( string ),
-			values = match && parser.parse( match ),
-			spaceName = parser.space || "rgba";
-
-		if ( values ) {
-			parsed = inst[ spaceName ]( values );
-
-			// if this was an rgba parse the assignment might happen twice
-			// oh well....
-			inst[ spaces[ spaceName ].cache ] = parsed[ spaces[ spaceName ].cache ];
-			rgba = inst._rgba = parsed._rgba;
-
-			// exit each( stringParsers ) here because we matched
-			return false;
-		}
-	} );
-
-	// Found a stringParser that handled it
-	if ( rgba.length ) {
-
-		// if this came from a parsed string, force "transparent" when alpha is 0
-		// chrome, (and maybe others) return "transparent" as rgba(0,0,0,0)
-		if ( rgba.join() === "0,0,0,0" ) {
-			jQuery.extend( rgba, colors.transparent );
-		}
-		return inst;
-	}
-
-	// named colors
-	return colors[ string ];
-}
-
-color.fn = jQuery.extend( color.prototype, {
-	parse: function( red, green, blue, alpha ) {
-		if ( red === undefined ) {
-			this._rgba = [ null, null, null, null ];
-			return this;
-		}
-		if ( red.jquery || red.nodeType ) {
-			red = jQuery( red ).css( green );
-			green = undefined;
-		}
-
-		var inst = this,
-			type = getType( red ),
-			rgba = this._rgba = [];
-
-		// more than 1 argument specified - assume ( red, green, blue, alpha )
-		if ( green !== undefined ) {
-			red = [ red, green, blue, alpha ];
-			type = "array";
-		}
-
-		if ( type === "string" ) {
-			return this.parse( stringParse( red ) || colors._default );
-		}
-
-		if ( type === "array" ) {
-			each( spaces.rgba.props, function( _key, prop ) {
-				rgba[ prop.idx ] = clamp( red[ prop.idx ], prop );
-			} );
-			return this;
-		}
-
-		if ( type === "object" ) {
-			if ( red instanceof color ) {
-				each( spaces, function( _spaceName, space ) {
-					if ( red[ space.cache ] ) {
-						inst[ space.cache ] = red[ space.cache ].slice();
-					}
-				} );
-			} else {
-				each( spaces, function( _spaceName, space ) {
-					var cache = space.cache;
-					each( space.props, function( key, prop ) {
-
-						// if the cache doesn't exist, and we know how to convert
-						if ( !inst[ cache ] && space.to ) {
-
-							// if the value was null, we don't need to copy it
-							// if the key was alpha, we don't need to copy it either
-							if ( key === "alpha" || red[ key ] == null ) {
-								return;
-							}
-							inst[ cache ] = space.to( inst._rgba );
-						}
-
-						// this is the only case where we allow nulls for ALL properties.
-						// call clamp with alwaysAllowEmpty
-						inst[ cache ][ prop.idx ] = clamp( red[ key ], prop, true );
-					} );
-
-					// everything defined but alpha?
-					if ( inst[ cache ] && jQuery.inArray( null, inst[ cache ].slice( 0, 3 ) ) < 0 ) {
-
-						// use the default of 1
-						if ( inst[ cache ][ 3 ] == null ) {
-							inst[ cache ][ 3 ] = 1;
-						}
-
-						if ( space.from ) {
-							inst._rgba = space.from( inst[ cache ] );
-						}
-					}
-				} );
-			}
-			return this;
-		}
-	},
-	is: function( compare ) {
-		var is = color( compare ),
-			same = true,
-			inst = this;
-
-		each( spaces, function( _, space ) {
-			var localCache,
-				isCache = is[ space.cache ];
-			if ( isCache ) {
-				localCache = inst[ space.cache ] || space.to && space.to( inst._rgba ) || [];
-				each( space.props, function( _, prop ) {
-					if ( isCache[ prop.idx ] != null ) {
-						same = ( isCache[ prop.idx ] === localCache[ prop.idx ] );
-						return same;
-					}
-				} );
-			}
-			return same;
-		} );
-		return same;
-	},
-	_space: function() {
-		var used = [],
-			inst = this;
-		each( spaces, function( spaceName, space ) {
-			if ( inst[ space.cache ] ) {
-				used.push( spaceName );
-			}
-		} );
-		return used.pop();
-	},
-	transition: function( other, distance ) {
-		var end = color( other ),
-			spaceName = end._space(),
-			space = spaces[ spaceName ],
-			startColor = this.alpha() === 0 ? color( "transparent" ) : this,
-			start = startColor[ space.cache ] || space.to( startColor._rgba ),
-			result = start.slice();
-
-		end = end[ space.cache ];
-		each( space.props, function( _key, prop ) {
-			var index = prop.idx,
-				startValue = start[ index ],
-				endValue = end[ index ],
-				type = propTypes[ prop.type ] || {};
-
-			// if null, don't override start value
-			if ( endValue === null ) {
-				return;
-			}
-
-			// if null - use end
-			if ( startValue === null ) {
-				result[ index ] = endValue;
-			} else {
-				if ( type.mod ) {
-					if ( endValue - startValue > type.mod / 2 ) {
-						startValue += type.mod;
-					} else if ( startValue - endValue > type.mod / 2 ) {
-						startValue -= type.mod;
-					}
-				}
-				result[ index ] = clamp( ( endValue - startValue ) * distance + startValue, prop );
-			}
-		} );
-		return this[ spaceName ]( result );
-	},
-	blend: function( opaque ) {
-
-		// if we are already opaque - return ourself
-		if ( this._rgba[ 3 ] === 1 ) {
-			return this;
-		}
-
-		var rgb = this._rgba.slice(),
-			a = rgb.pop(),
-			blend = color( opaque )._rgba;
-
-		return color( jQuery.map( rgb, function( v, i ) {
-			return ( 1 - a ) * blend[ i ] + a * v;
-		} ) );
-	},
-	toRgbaString: function() {
-		var prefix = "rgba(",
-			rgba = jQuery.map( this._rgba, function( v, i ) {
-				if ( v != null ) {
-					return v;
-				}
-				return i > 2 ? 1 : 0;
-			} );
-
-		if ( rgba[ 3 ] === 1 ) {
-			rgba.pop();
-			prefix = "rgb(";
-		}
-
-		return prefix + rgba.join() + ")";
-	},
-	toHslaString: function() {
-		var prefix = "hsla(",
-			hsla = jQuery.map( this.hsla(), function( v, i ) {
-				if ( v == null ) {
-					v = i > 2 ? 1 : 0;
-				}
-
-				// catch 1 and 2
-				if ( i && i < 3 ) {
-					v = Math.round( v * 100 ) + "%";
-				}
-				return v;
-			} );
-
-		if ( hsla[ 3 ] === 1 ) {
-			hsla.pop();
-			prefix = "hsl(";
-		}
-		return prefix + hsla.join() + ")";
-	},
-	toHexString: function( includeAlpha ) {
-		var rgba = this._rgba.slice(),
-			alpha = rgba.pop();
-
-		if ( includeAlpha ) {
-			rgba.push( ~~( alpha * 255 ) );
-		}
-
-		return "#" + jQuery.map( rgba, function( v ) {
-
-			// default to 0 when nulls exist
-			v = ( v || 0 ).toString( 16 );
-			return v.length === 1 ? "0" + v : v;
-		} ).join( "" );
-	},
-	toString: function() {
-		return this._rgba[ 3 ] === 0 ? "transparent" : this.toRgbaString();
-	}
-} );
-color.fn.parse.prototype = color.fn;
-
-// hsla conversions adapted from:
-// https://code.google.com/p/maashaack/source/browse/packages/graphics/trunk/src/graphics/colors/HUE2RGB.as?r=5021
-
-function hue2rgb( p, q, h ) {
-	h = ( h + 1 ) % 1;
-	if ( h * 6 < 1 ) {
-		return p + ( q - p ) * h * 6;
-	}
-	if ( h * 2 < 1 ) {
-		return q;
-	}
-	if ( h * 3 < 2 ) {
-		return p + ( q - p ) * ( ( 2 / 3 ) - h ) * 6;
-	}
-	return p;
-}
-
-spaces.hsla.to = function( rgba ) {
-	if ( rgba[ 0 ] == null || rgba[ 1 ] == null || rgba[ 2 ] == null ) {
-		return [ null, null, null, rgba[ 3 ] ];
-	}
-	var r = rgba[ 0 ] / 255,
-		g = rgba[ 1 ] / 255,
-		b = rgba[ 2 ] / 255,
-		a = rgba[ 3 ],
-		max = Math.max( r, g, b ),
-		min = Math.min( r, g, b ),
-		diff = max - min,
-		add = max + min,
-		l = add * 0.5,
-		h, s;
-
-	if ( min === max ) {
-		h = 0;
-	} else if ( r === max ) {
-		h = ( 60 * ( g - b ) / diff ) + 360;
-	} else if ( g === max ) {
-		h = ( 60 * ( b - r ) / diff ) + 120;
-	} else {
-		h = ( 60 * ( r - g ) / diff ) + 240;
-	}
-
-	// chroma (diff) == 0 means greyscale which, by definition, saturation = 0%
-	// otherwise, saturation is based on the ratio of chroma (diff) to lightness (add)
-	if ( diff === 0 ) {
-		s = 0;
-	} else if ( l <= 0.5 ) {
-		s = diff / add;
-	} else {
-		s = diff / ( 2 - add );
-	}
-	return [ Math.round( h ) % 360, s, l, a == null ? 1 : a ];
-};
-
-spaces.hsla.from = function( hsla ) {
-	if ( hsla[ 0 ] == null || hsla[ 1 ] == null || hsla[ 2 ] == null ) {
-		return [ null, null, null, hsla[ 3 ] ];
-	}
-	var h = hsla[ 0 ] / 360,
-		s = hsla[ 1 ],
-		l = hsla[ 2 ],
-		a = hsla[ 3 ],
-		q = l <= 0.5 ? l * ( 1 + s ) : l + s - l * s,
-		p = 2 * l - q;
-
-	return [
-		Math.round( hue2rgb( p, q, h + ( 1 / 3 ) ) * 255 ),
-		Math.round( hue2rgb( p, q, h ) * 255 ),
-		Math.round( hue2rgb( p, q, h - ( 1 / 3 ) ) * 255 ),
-		a
-	];
-};
-
-
-each( spaces, function( spaceName, space ) {
-	var props = space.props,
-		cache = space.cache,
-		to = space.to,
-		from = space.from;
-
-	// makes rgba() and hsla()
-	color.fn[ spaceName ] = function( value ) {
-
-		// generate a cache for this space if it doesn't exist
-		if ( to && !this[ cache ] ) {
-			this[ cache ] = to( this._rgba );
-		}
-		if ( value === undefined ) {
-			return this[ cache ].slice();
-		}
-
-		var ret,
-			type = getType( value ),
-			arr = ( type === "array" || type === "object" ) ? value : arguments,
-			local = this[ cache ].slice();
-
-		each( props, function( key, prop ) {
-			var val = arr[ type === "object" ? key : prop.idx ];
-			if ( val == null ) {
-				val = local[ prop.idx ];
-			}
-			local[ prop.idx ] = clamp( val, prop );
-		} );
-
-		if ( from ) {
-			ret = color( from( local ) );
-			ret[ cache ] = local;
-			return ret;
-		} else {
-			return color( local );
-		}
-	};
-
-	// makes red() green() blue() alpha() hue() saturation() lightness()
-	each( props, function( key, prop ) {
-
-		// alpha is included in more than one space
-		if ( color.fn[ key ] ) {
-			return;
-		}
-		color.fn[ key ] = function( value ) {
-			var local, cur, match, fn,
-				vtype = getType( value );
-
-			if ( key === "alpha" ) {
-				fn = this._hsla ? "hsla" : "rgba";
-			} else {
-				fn = spaceName;
-			}
-			local = this[ fn ]();
-			cur = local[ prop.idx ];
-
-			if ( vtype === "undefined" ) {
-				return cur;
-			}
-
-			if ( vtype === "function" ) {
-				value = value.call( this, cur );
-				vtype = getType( value );
-			}
-			if ( value == null && prop.empty ) {
-				return this;
-			}
-			if ( vtype === "string" ) {
-				match = rplusequals.exec( value );
-				if ( match ) {
-					value = cur + parseFloat( match[ 2 ] ) * ( match[ 1 ] === "+" ? 1 : -1 );
-				}
-			}
-			local[ prop.idx ] = value;
-			return this[ fn ]( local );
-		};
-	} );
-} );
-
-// add cssHook and .fx.step function for each named hook.
-// accept a space separated string of properties
-color.hook = function( hook ) {
-	var hooks = hook.split( " " );
-	each( hooks, function( _i, hook ) {
-		jQuery.cssHooks[ hook ] = {
-			set: function( elem, value ) {
-				var parsed, curElem,
-					backgroundColor = "";
-
-				if ( value !== "transparent" && ( getType( value ) !== "string" || ( parsed = stringParse( value ) ) ) ) {
-					value = color( parsed || value );
-					if ( !support.rgba && value._rgba[ 3 ] !== 1 ) {
-						curElem = hook === "backgroundColor" ? elem.parentNode : elem;
-						while (
-							( backgroundColor === "" || backgroundColor === "transparent" ) &&
-							curElem && curElem.style
-						) {
-							try {
-								backgroundColor = jQuery.css( curElem, "backgroundColor" );
-								curElem = curElem.parentNode;
-							} catch ( e ) {
-							}
-						}
-
-						value = value.blend( backgroundColor && backgroundColor !== "transparent" ?
-							backgroundColor :
-							"_default" );
-					}
-
-					value = value.toRgbaString();
-				}
-				try {
-					elem.style[ hook ] = value;
-				} catch ( e ) {
-
-					// wrapped to prevent IE from throwing errors on "invalid" values like 'auto' or 'inherit'
-				}
-			}
-		};
-		jQuery.fx.step[ hook ] = function( fx ) {
-			if ( !fx.colorInit ) {
-				fx.start = color( fx.elem, hook );
-				fx.end = color( fx.end );
-				fx.colorInit = true;
-			}
-			jQuery.cssHooks[ hook ].set( fx.elem, fx.start.transition( fx.end, fx.pos ) );
-		};
-	} );
-
-};
-
-color.hook( stepHooks );
-
-jQuery.cssHooks.borderColor = {
-	expand: function( value ) {
-		var expanded = {};
-
-		each( [ "Top", "Right", "Bottom", "Left" ], function( _i, part ) {
-			expanded[ "border" + part + "Color" ] = value;
-		} );
-		return expanded;
-	}
-};
-
-// Basic color names only.
-// Usage of any of the other color names requires adding yourself or including
-// jquery.color.svg-names.js.
-colors = jQuery.Color.names = {
-
-	// 4.1. Basic color keywords
-	aqua: "#00ffff",
-	black: "#000000",
-	blue: "#0000ff",
-	fuchsia: "#ff00ff",
-	gray: "#808080",
-	green: "#008000",
-	lime: "#00ff00",
-	maroon: "#800000",
-	navy: "#000080",
-	olive: "#808000",
-	purple: "#800080",
-	red: "#ff0000",
-	silver: "#c0c0c0",
-	teal: "#008080",
-	white: "#ffffff",
-	yellow: "#ffff00",
-
-	// 4.2.3. "transparent" color keyword
-	transparent: [ null, null, null, 0 ],
-
-	_default: "#ffffff"
-};
-
-
-/*!
- * jQuery UI Effects 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Effects Core
-//>>group: Effects
-/* eslint-disable max-len */
-//>>description: Extends the internal jQuery effects. Includes morphing and easing. Required by all other effects.
-/* eslint-enable max-len */
-//>>docs: http://api.jqueryui.com/category/effects-core/
-//>>demos: http://jqueryui.com/effect/
-
-
-var dataSpace = "ui-effects-",
-	dataSpaceStyle = "ui-effects-style",
-	dataSpaceAnimated = "ui-effects-animated";
-
-$.effects = {
-	effect: {}
-};
-
-/******************************************************************************/
-/****************************** CLASS ANIMATIONS ******************************/
-/******************************************************************************/
-( function() {
-
-var classAnimationActions = [ "add", "remove", "toggle" ],
-	shorthandStyles = {
-		border: 1,
-		borderBottom: 1,
-		borderColor: 1,
-		borderLeft: 1,
-		borderRight: 1,
-		borderTop: 1,
-		borderWidth: 1,
-		margin: 1,
-		padding: 1
-	};
-
-$.each(
-	[ "borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle" ],
-	function( _, prop ) {
-		$.fx.step[ prop ] = function( fx ) {
-			if ( fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr ) {
-				jQuery.style( fx.elem, prop, fx.end );
-				fx.setAttr = true;
-			}
-		};
-	}
-);
-
-function camelCase( string ) {
-	return string.replace( /-([\da-z])/gi, function( all, letter ) {
-		return letter.toUpperCase();
-	} );
-}
-
-function getElementStyles( elem ) {
-	var key, len,
-		style = elem.ownerDocument.defaultView ?
-			elem.ownerDocument.defaultView.getComputedStyle( elem, null ) :
-			elem.currentStyle,
-		styles = {};
-
-	if ( style && style.length && style[ 0 ] && style[ style[ 0 ] ] ) {
-		len = style.length;
-		while ( len-- ) {
-			key = style[ len ];
-			if ( typeof style[ key ] === "string" ) {
-				styles[ camelCase( key ) ] = style[ key ];
-			}
-		}
-
-	// Support: Opera, IE <9
-	} else {
-		for ( key in style ) {
-			if ( typeof style[ key ] === "string" ) {
-				styles[ key ] = style[ key ];
-			}
-		}
-	}
-
-	return styles;
-}
-
-function styleDifference( oldStyle, newStyle ) {
-	var diff = {},
-		name, value;
-
-	for ( name in newStyle ) {
-		value = newStyle[ name ];
-		if ( oldStyle[ name ] !== value ) {
-			if ( !shorthandStyles[ name ] ) {
-				if ( $.fx.step[ name ] || !isNaN( parseFloat( value ) ) ) {
-					diff[ name ] = value;
-				}
-			}
-		}
-	}
-
-	return diff;
-}
-
-// Support: jQuery <1.8
-if ( !$.fn.addBack ) {
-	$.fn.addBack = function( selector ) {
-		return this.add( selector == null ?
-			this.prevObject : this.prevObject.filter( selector )
-		);
-	};
-}
-
-$.effects.animateClass = function( value, duration, easing, callback ) {
-	var o = $.speed( duration, easing, callback );
-
-	return this.queue( function() {
-		var animated = $( this ),
-			baseClass = animated.attr( "class" ) || "",
-			applyClassChange,
-			allAnimations = o.children ? animated.find( "*" ).addBack() : animated;
-
-		// Map the animated objects to store the original styles.
-		allAnimations = allAnimations.map( function() {
-			var el = $( this );
-			return {
-				el: el,
-				start: getElementStyles( this )
-			};
-		} );
-
-		// Apply class change
-		applyClassChange = function() {
-			$.each( classAnimationActions, function( i, action ) {
-				if ( value[ action ] ) {
-					animated[ action + "Class" ]( value[ action ] );
-				}
-			} );
-		};
-		applyClassChange();
-
-		// Map all animated objects again - calculate new styles and diff
-		allAnimations = allAnimations.map( function() {
-			this.end = getElementStyles( this.el[ 0 ] );
-			this.diff = styleDifference( this.start, this.end );
-			return this;
-		} );
-
-		// Apply original class
-		animated.attr( "class", baseClass );
-
-		// Map all animated objects again - this time collecting a promise
-		allAnimations = allAnimations.map( function() {
-			var styleInfo = this,
-				dfd = $.Deferred(),
-				opts = $.extend( {}, o, {
-					queue: false,
-					complete: function() {
-						dfd.resolve( styleInfo );
-					}
-				} );
-
-			this.el.animate( this.diff, opts );
-			return dfd.promise();
-		} );
-
-		// Once all animations have completed:
-		$.when.apply( $, allAnimations.get() ).done( function() {
-
-			// Set the final class
-			applyClassChange();
-
-			// For each animated element,
-			// clear all css properties that were animated
-			$.each( arguments, function() {
-				var el = this.el;
-				$.each( this.diff, function( key ) {
-					el.css( key, "" );
-				} );
-			} );
-
-			// This is guarnteed to be there if you use jQuery.speed()
-			// it also handles dequeuing the next anim...
-			o.complete.call( animated[ 0 ] );
-		} );
-	} );
-};
-
-$.fn.extend( {
-	addClass: ( function( orig ) {
-		return function( classNames, speed, easing, callback ) {
-			return speed ?
-				$.effects.animateClass.call( this,
-					{ add: classNames }, speed, easing, callback ) :
-				orig.apply( this, arguments );
-		};
-	} )( $.fn.addClass ),
-
-	removeClass: ( function( orig ) {
-		return function( classNames, speed, easing, callback ) {
-			return arguments.length > 1 ?
-				$.effects.animateClass.call( this,
-					{ remove: classNames }, speed, easing, callback ) :
-				orig.apply( this, arguments );
-		};
-	} )( $.fn.removeClass ),
-
-	toggleClass: ( function( orig ) {
-		return function( classNames, force, speed, easing, callback ) {
-			if ( typeof force === "boolean" || force === undefined ) {
-				if ( !speed ) {
-
-					// Without speed parameter
-					return orig.apply( this, arguments );
-				} else {
-					return $.effects.animateClass.call( this,
-						( force ? { add: classNames } : { remove: classNames } ),
-						speed, easing, callback );
-				}
-			} else {
-
-				// Without force parameter
-				return $.effects.animateClass.call( this,
-					{ toggle: classNames }, force, speed, easing );
-			}
-		};
-	} )( $.fn.toggleClass ),
-
-	switchClass: function( remove, add, speed, easing, callback ) {
-		return $.effects.animateClass.call( this, {
-			add: add,
-			remove: remove
-		}, speed, easing, callback );
-	}
-} );
-
-} )();
-
-/******************************************************************************/
-/*********************************** EFFECTS **********************************/
-/******************************************************************************/
-
-( function() {
-
-if ( $.expr && $.expr.pseudos && $.expr.pseudos.animated ) {
-	$.expr.pseudos.animated = ( function( orig ) {
-		return function( elem ) {
-			return !!$( elem ).data( dataSpaceAnimated ) || orig( elem );
-		};
-	} )( $.expr.pseudos.animated );
-}
-
-if ( $.uiBackCompat !== false ) {
-	$.extend( $.effects, {
-
-		// Saves a set of properties in a data storage
-		save: function( element, set ) {
-			var i = 0, length = set.length;
-			for ( ; i < length; i++ ) {
-				if ( set[ i ] !== null ) {
-					element.data( dataSpace + set[ i ], element[ 0 ].style[ set[ i ] ] );
-				}
-			}
-		},
-
-		// Restores a set of previously saved properties from a data storage
-		restore: function( element, set ) {
-			var val, i = 0, length = set.length;
-			for ( ; i < length; i++ ) {
-				if ( set[ i ] !== null ) {
-					val = element.data( dataSpace + set[ i ] );
-					element.css( set[ i ], val );
-				}
-			}
-		},
-
-		setMode: function( el, mode ) {
-			if ( mode === "toggle" ) {
-				mode = el.is( ":hidden" ) ? "show" : "hide";
-			}
-			return mode;
-		},
-
-		// Wraps the element around a wrapper that copies position properties
-		createWrapper: function( element ) {
-
-			// If the element is already wrapped, return it
-			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
-				return element.parent();
-			}
-
-			// Wrap the element
-			var props = {
-					width: element.outerWidth( true ),
-					height: element.outerHeight( true ),
-					"float": element.css( "float" )
-				},
-				wrapper = $( "<div></div>" )
-					.addClass( "ui-effects-wrapper" )
-					.css( {
-						fontSize: "100%",
-						background: "transparent",
-						border: "none",
-						margin: 0,
-						padding: 0
-					} ),
-
-				// Store the size in case width/height are defined in % - Fixes #5245
-				size = {
-					width: element.width(),
-					height: element.height()
-				},
-				active = document.activeElement;
-
-			// Support: Firefox
-			// Firefox incorrectly exposes anonymous content
-			// https://bugzilla.mozilla.org/show_bug.cgi?id=561664
-			try {
-				// eslint-disable-next-line no-unused-expressions
-				active.id;
-			} catch ( e ) {
-				active = document.body;
-			}
-
-			element.wrap( wrapper );
-
-			// Fixes #7595 - Elements lose focus when wrapped.
-			if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
-				$( active ).trigger( "focus" );
-			}
-
-			// Hotfix for jQuery 1.4 since some change in wrap() seems to actually
-			// lose the reference to the wrapped element
-			wrapper = element.parent();
-
-			// Transfer positioning properties to the wrapper
-			if ( element.css( "position" ) === "static" ) {
-				wrapper.css( { position: "relative" } );
-				element.css( { position: "relative" } );
-			} else {
-				$.extend( props, {
-					position: element.css( "position" ),
-					zIndex: element.css( "z-index" )
-				} );
-				$.each( [ "top", "left", "bottom", "right" ], function( i, pos ) {
-					props[ pos ] = element.css( pos );
-					if ( isNaN( parseInt( props[ pos ], 10 ) ) ) {
-						props[ pos ] = "auto";
-					}
-				} );
-				element.css( {
-					position: "relative",
-					top: 0,
-					left: 0,
-					right: "auto",
-					bottom: "auto"
-				} );
-			}
-			element.css( size );
-
-			return wrapper.css( props ).show();
-		},
-
-		removeWrapper: function( element ) {
-			var active = document.activeElement;
-
-			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
-				element.parent().replaceWith( element );
-
-				// Fixes #7595 - Elements lose focus when wrapped.
-				if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
-					$( active ).trigger( "focus" );
-				}
-			}
-
-			return element;
-		}
-	} );
-}
-
-$.extend( $.effects, {
-	version: "1.13.1",
-
-	define: function( name, mode, effect ) {
-		if ( !effect ) {
-			effect = mode;
-			mode = "effect";
-		}
-
-		$.effects.effect[ name ] = effect;
-		$.effects.effect[ name ].mode = mode;
-
-		return effect;
-	},
-
-	scaledDimensions: function( element, percent, direction ) {
-		if ( percent === 0 ) {
-			return {
-				height: 0,
-				width: 0,
-				outerHeight: 0,
-				outerWidth: 0
-			};
-		}
-
-		var x = direction !== "horizontal" ? ( ( percent || 100 ) / 100 ) : 1,
-			y = direction !== "vertical" ? ( ( percent || 100 ) / 100 ) : 1;
-
-		return {
-			height: element.height() * y,
-			width: element.width() * x,
-			outerHeight: element.outerHeight() * y,
-			outerWidth: element.outerWidth() * x
-		};
-
-	},
-
-	clipToBox: function( animation ) {
-		return {
-			width: animation.clip.right - animation.clip.left,
-			height: animation.clip.bottom - animation.clip.top,
-			left: animation.clip.left,
-			top: animation.clip.top
-		};
-	},
-
-	// Injects recently queued functions to be first in line (after "inprogress")
-	unshift: function( element, queueLength, count ) {
-		var queue = element.queue();
-
-		if ( queueLength > 1 ) {
-			queue.splice.apply( queue,
-				[ 1, 0 ].concat( queue.splice( queueLength, count ) ) );
-		}
-		element.dequeue();
-	},
-
-	saveStyle: function( element ) {
-		element.data( dataSpaceStyle, element[ 0 ].style.cssText );
-	},
-
-	restoreStyle: function( element ) {
-		element[ 0 ].style.cssText = element.data( dataSpaceStyle ) || "";
-		element.removeData( dataSpaceStyle );
-	},
-
-	mode: function( element, mode ) {
-		var hidden = element.is( ":hidden" );
-
-		if ( mode === "toggle" ) {
-			mode = hidden ? "show" : "hide";
-		}
-		if ( hidden ? mode === "hide" : mode === "show" ) {
-			mode = "none";
-		}
-		return mode;
-	},
-
-	// Translates a [top,left] array into a baseline value
-	getBaseline: function( origin, original ) {
-		var y, x;
-
-		switch ( origin[ 0 ] ) {
-		case "top":
-			y = 0;
-			break;
-		case "middle":
-			y = 0.5;
-			break;
-		case "bottom":
-			y = 1;
-			break;
-		default:
-			y = origin[ 0 ] / original.height;
-		}
-
-		switch ( origin[ 1 ] ) {
-		case "left":
-			x = 0;
-			break;
-		case "center":
-			x = 0.5;
-			break;
-		case "right":
-			x = 1;
-			break;
-		default:
-			x = origin[ 1 ] / original.width;
-		}
-
-		return {
-			x: x,
-			y: y
-		};
-	},
-
-	// Creates a placeholder element so that the original element can be made absolute
-	createPlaceholder: function( element ) {
-		var placeholder,
-			cssPosition = element.css( "position" ),
-			position = element.position();
-
-		// Lock in margins first to account for form elements, which
-		// will change margin if you explicitly set height
-		// see: http://jsfiddle.net/JZSMt/3/ https://bugs.webkit.org/show_bug.cgi?id=107380
-		// Support: Safari
-		element.css( {
-			marginTop: element.css( "marginTop" ),
-			marginBottom: element.css( "marginBottom" ),
-			marginLeft: element.css( "marginLeft" ),
-			marginRight: element.css( "marginRight" )
-		} )
-		.outerWidth( element.outerWidth() )
-		.outerHeight( element.outerHeight() );
-
-		if ( /^(static|relative)/.test( cssPosition ) ) {
-			cssPosition = "absolute";
-
-			placeholder = $( "<" + element[ 0 ].nodeName + ">" ).insertAfter( element ).css( {
-
-				// Convert inline to inline block to account for inline elements
-				// that turn to inline block based on content (like img)
-				display: /^(inline|ruby)/.test( element.css( "display" ) ) ?
-					"inline-block" :
-					"block",
-				visibility: "hidden",
-
-				// Margins need to be set to account for margin collapse
-				marginTop: element.css( "marginTop" ),
-				marginBottom: element.css( "marginBottom" ),
-				marginLeft: element.css( "marginLeft" ),
-				marginRight: element.css( "marginRight" ),
-				"float": element.css( "float" )
-			} )
-			.outerWidth( element.outerWidth() )
-			.outerHeight( element.outerHeight() )
-			.addClass( "ui-effects-placeholder" );
-
-			element.data( dataSpace + "placeholder", placeholder );
-		}
-
-		element.css( {
-			position: cssPosition,
-			left: position.left,
-			top: position.top
-		} );
-
-		return placeholder;
-	},
-
-	removePlaceholder: function( element ) {
-		var dataKey = dataSpace + "placeholder",
-				placeholder = element.data( dataKey );
-
-		if ( placeholder ) {
-			placeholder.remove();
-			element.removeData( dataKey );
-		}
-	},
-
-	// Removes a placeholder if it exists and restores
-	// properties that were modified during placeholder creation
-	cleanUp: function( element ) {
-		$.effects.restoreStyle( element );
-		$.effects.removePlaceholder( element );
-	},
-
-	setTransition: function( element, list, factor, value ) {
-		value = value || {};
-		$.each( list, function( i, x ) {
-			var unit = element.cssUnit( x );
-			if ( unit[ 0 ] > 0 ) {
-				value[ x ] = unit[ 0 ] * factor + unit[ 1 ];
-			}
-		} );
-		return value;
-	}
-} );
-
-// Return an effect options object for the given parameters:
-function _normalizeArguments( effect, options, speed, callback ) {
-
-	// Allow passing all options as the first parameter
-	if ( $.isPlainObject( effect ) ) {
-		options = effect;
-		effect = effect.effect;
-	}
-
-	// Convert to an object
-	effect = { effect: effect };
-
-	// Catch (effect, null, ...)
-	if ( options == null ) {
-		options = {};
-	}
-
-	// Catch (effect, callback)
-	if ( typeof options === "function" ) {
-		callback = options;
-		speed = null;
-		options = {};
-	}
-
-	// Catch (effect, speed, ?)
-	if ( typeof options === "number" || $.fx.speeds[ options ] ) {
-		callback = speed;
-		speed = options;
-		options = {};
-	}
-
-	// Catch (effect, options, callback)
-	if ( typeof speed === "function" ) {
-		callback = speed;
-		speed = null;
-	}
-
-	// Add options to effect
-	if ( options ) {
-		$.extend( effect, options );
-	}
-
-	speed = speed || options.duration;
-	effect.duration = $.fx.off ? 0 :
-		typeof speed === "number" ? speed :
-		speed in $.fx.speeds ? $.fx.speeds[ speed ] :
-		$.fx.speeds._default;
-
-	effect.complete = callback || options.complete;
-
-	return effect;
-}
-
-function standardAnimationOption( option ) {
-
-	// Valid standard speeds (nothing, number, named speed)
-	if ( !option || typeof option === "number" || $.fx.speeds[ option ] ) {
-		return true;
-	}
-
-	// Invalid strings - treat as "normal" speed
-	if ( typeof option === "string" && !$.effects.effect[ option ] ) {
-		return true;
-	}
-
-	// Complete callback
-	if ( typeof option === "function" ) {
-		return true;
-	}
-
-	// Options hash (but not naming an effect)
-	if ( typeof option === "object" && !option.effect ) {
-		return true;
-	}
-
-	// Didn't match any standard API
-	return false;
-}
-
-$.fn.extend( {
-	effect: function( /* effect, options, speed, callback */ ) {
-		var args = _normalizeArguments.apply( this, arguments ),
-			effectMethod = $.effects.effect[ args.effect ],
-			defaultMode = effectMethod.mode,
-			queue = args.queue,
-			queueName = queue || "fx",
-			complete = args.complete,
-			mode = args.mode,
-			modes = [],
-			prefilter = function( next ) {
-				var el = $( this ),
-					normalizedMode = $.effects.mode( el, mode ) || defaultMode;
-
-				// Sentinel for duck-punching the :animated pseudo-selector
-				el.data( dataSpaceAnimated, true );
-
-				// Save effect mode for later use,
-				// we can't just call $.effects.mode again later,
-				// as the .show() below destroys the initial state
-				modes.push( normalizedMode );
-
-				// See $.uiBackCompat inside of run() for removal of defaultMode in 1.14
-				if ( defaultMode && ( normalizedMode === "show" ||
-						( normalizedMode === defaultMode && normalizedMode === "hide" ) ) ) {
-					el.show();
-				}
-
-				if ( !defaultMode || normalizedMode !== "none" ) {
-					$.effects.saveStyle( el );
-				}
-
-				if ( typeof next === "function" ) {
-					next();
-				}
-			};
-
-		if ( $.fx.off || !effectMethod ) {
-
-			// Delegate to the original method (e.g., .show()) if possible
-			if ( mode ) {
-				return this[ mode ]( args.duration, complete );
-			} else {
-				return this.each( function() {
-					if ( complete ) {
-						complete.call( this );
-					}
-				} );
-			}
-		}
-
-		function run( next ) {
-			var elem = $( this );
-
-			function cleanup() {
-				elem.removeData( dataSpaceAnimated );
-
-				$.effects.cleanUp( elem );
-
-				if ( args.mode === "hide" ) {
-					elem.hide();
-				}
-
-				done();
-			}
-
-			function done() {
-				if ( typeof complete === "function" ) {
-					complete.call( elem[ 0 ] );
-				}
-
-				if ( typeof next === "function" ) {
-					next();
-				}
-			}
-
-			// Override mode option on a per element basis,
-			// as toggle can be either show or hide depending on element state
-			args.mode = modes.shift();
-
-			if ( $.uiBackCompat !== false && !defaultMode ) {
-				if ( elem.is( ":hidden" ) ? mode === "hide" : mode === "show" ) {
-
-					// Call the core method to track "olddisplay" properly
-					elem[ mode ]();
-					done();
-				} else {
-					effectMethod.call( elem[ 0 ], args, done );
-				}
-			} else {
-				if ( args.mode === "none" ) {
-
-					// Call the core method to track "olddisplay" properly
-					elem[ mode ]();
-					done();
-				} else {
-					effectMethod.call( elem[ 0 ], args, cleanup );
-				}
-			}
-		}
-
-		// Run prefilter on all elements first to ensure that
-		// any showing or hiding happens before placeholder creation,
-		// which ensures that any layout changes are correctly captured.
-		return queue === false ?
-			this.each( prefilter ).each( run ) :
-			this.queue( queueName, prefilter ).queue( queueName, run );
-	},
-
-	show: ( function( orig ) {
-		return function( option ) {
-			if ( standardAnimationOption( option ) ) {
-				return orig.apply( this, arguments );
-			} else {
-				var args = _normalizeArguments.apply( this, arguments );
-				args.mode = "show";
-				return this.effect.call( this, args );
-			}
-		};
-	} )( $.fn.show ),
-
-	hide: ( function( orig ) {
-		return function( option ) {
-			if ( standardAnimationOption( option ) ) {
-				return orig.apply( this, arguments );
-			} else {
-				var args = _normalizeArguments.apply( this, arguments );
-				args.mode = "hide";
-				return this.effect.call( this, args );
-			}
-		};
-	} )( $.fn.hide ),
-
-	toggle: ( function( orig ) {
-		return function( option ) {
-			if ( standardAnimationOption( option ) || typeof option === "boolean" ) {
-				return orig.apply( this, arguments );
-			} else {
-				var args = _normalizeArguments.apply( this, arguments );
-				args.mode = "toggle";
-				return this.effect.call( this, args );
-			}
-		};
-	} )( $.fn.toggle ),
-
-	cssUnit: function( key ) {
-		var style = this.css( key ),
-			val = [];
-
-		$.each( [ "em", "px", "%", "pt" ], function( i, unit ) {
-			if ( style.indexOf( unit ) > 0 ) {
-				val = [ parseFloat( style ), unit ];
-			}
-		} );
-		return val;
-	},
-
-	cssClip: function( clipObj ) {
-		if ( clipObj ) {
-			return this.css( "clip", "rect(" + clipObj.top + "px " + clipObj.right + "px " +
-				clipObj.bottom + "px " + clipObj.left + "px)" );
-		}
-		return parseClip( this.css( "clip" ), this );
-	},
-
-	transfer: function( options, done ) {
-		var element = $( this ),
-			target = $( options.to ),
-			targetFixed = target.css( "position" ) === "fixed",
-			body = $( "body" ),
-			fixTop = targetFixed ? body.scrollTop() : 0,
-			fixLeft = targetFixed ? body.scrollLeft() : 0,
-			endPosition = target.offset(),
-			animation = {
-				top: endPosition.top - fixTop,
-				left: endPosition.left - fixLeft,
-				height: target.innerHeight(),
-				width: target.innerWidth()
-			},
-			startPosition = element.offset(),
-			transfer = $( "<div class='ui-effects-transfer'></div>" );
-
-		transfer
-			.appendTo( "body" )
-			.addClass( options.className )
-			.css( {
-				top: startPosition.top - fixTop,
-				left: startPosition.left - fixLeft,
-				height: element.innerHeight(),
-				width: element.innerWidth(),
-				position: targetFixed ? "fixed" : "absolute"
-			} )
-			.animate( animation, options.duration, options.easing, function() {
-				transfer.remove();
-				if ( typeof done === "function" ) {
-					done();
-				}
-			} );
-	}
-} );
-
-function parseClip( str, element ) {
-		var outerWidth = element.outerWidth(),
-			outerHeight = element.outerHeight(),
-			clipRegex = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,
-			values = clipRegex.exec( str ) || [ "", 0, outerWidth, outerHeight, 0 ];
-
-		return {
-			top: parseFloat( values[ 1 ] ) || 0,
-			right: values[ 2 ] === "auto" ? outerWidth : parseFloat( values[ 2 ] ),
-			bottom: values[ 3 ] === "auto" ? outerHeight : parseFloat( values[ 3 ] ),
-			left: parseFloat( values[ 4 ] ) || 0
-		};
-}
-
-$.fx.step.clip = function( fx ) {
-	if ( !fx.clipInit ) {
-		fx.start = $( fx.elem ).cssClip();
-		if ( typeof fx.end === "string" ) {
-			fx.end = parseClip( fx.end, fx.elem );
-		}
-		fx.clipInit = true;
-	}
-
-	$( fx.elem ).cssClip( {
-		top: fx.pos * ( fx.end.top - fx.start.top ) + fx.start.top,
-		right: fx.pos * ( fx.end.right - fx.start.right ) + fx.start.right,
-		bottom: fx.pos * ( fx.end.bottom - fx.start.bottom ) + fx.start.bottom,
-		left: fx.pos * ( fx.end.left - fx.start.left ) + fx.start.left
-	} );
-};
-
-} )();
-
-/******************************************************************************/
-/*********************************** EASING ***********************************/
-/******************************************************************************/
-
-( function() {
-
-// Based on easing equations from Robert Penner (http://www.robertpenner.com/easing)
-
-var baseEasings = {};
-
-$.each( [ "Quad", "Cubic", "Quart", "Quint", "Expo" ], function( i, name ) {
-	baseEasings[ name ] = function( p ) {
-		return Math.pow( p, i + 2 );
-	};
-} );
-
-$.extend( baseEasings, {
-	Sine: function( p ) {
-		return 1 - Math.cos( p * Math.PI / 2 );
-	},
-	Circ: function( p ) {
-		return 1 - Math.sqrt( 1 - p * p );
-	},
-	Elastic: function( p ) {
-		return p === 0 || p === 1 ? p :
-			-Math.pow( 2, 8 * ( p - 1 ) ) * Math.sin( ( ( p - 1 ) * 80 - 7.5 ) * Math.PI / 15 );
-	},
-	Back: function( p ) {
-		return p * p * ( 3 * p - 2 );
-	},
-	Bounce: function( p ) {
-		var pow2,
-			bounce = 4;
-
-		while ( p < ( ( pow2 = Math.pow( 2, --bounce ) ) - 1 ) / 11 ) {}
-		return 1 / Math.pow( 4, 3 - bounce ) - 7.5625 * Math.pow( ( pow2 * 3 - 2 ) / 22 - p, 2 );
-	}
-} );
-
-$.each( baseEasings, function( name, easeIn ) {
-	$.easing[ "easeIn" + name ] = easeIn;
-	$.easing[ "easeOut" + name ] = function( p ) {
-		return 1 - easeIn( 1 - p );
-	};
-	$.easing[ "easeInOut" + name ] = function( p ) {
-		return p < 0.5 ?
-			easeIn( p * 2 ) / 2 :
-			1 - easeIn( p * -2 + 2 ) / 2;
-	};
-} );
-
-} )();
-
-var effect = $.effects;
-
-
-/*!
- * jQuery UI Effects Blind 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Blind Effect
-//>>group: Effects
-//>>description: Blinds the element.
-//>>docs: http://api.jqueryui.com/blind-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectBlind = $.effects.define( "blind", "hide", function( options, done ) {
-	var map = {
-			up: [ "bottom", "top" ],
-			vertical: [ "bottom", "top" ],
-			down: [ "top", "bottom" ],
-			left: [ "right", "left" ],
-			horizontal: [ "right", "left" ],
-			right: [ "left", "right" ]
-		},
-		element = $( this ),
-		direction = options.direction || "up",
-		start = element.cssClip(),
-		animate = { clip: $.extend( {}, start ) },
-		placeholder = $.effects.createPlaceholder( element );
-
-	animate.clip[ map[ direction ][ 0 ] ] = animate.clip[ map[ direction ][ 1 ] ];
-
-	if ( options.mode === "show" ) {
-		element.cssClip( animate.clip );
-		if ( placeholder ) {
-			placeholder.css( $.effects.clipToBox( animate ) );
-		}
-
-		animate.clip = start;
-	}
-
-	if ( placeholder ) {
-		placeholder.animate( $.effects.clipToBox( animate ), options.duration, options.easing );
-	}
-
-	element.animate( animate, {
-		queue: false,
-		duration: options.duration,
-		easing: options.easing,
-		complete: done
-	} );
-} );
-
-
-/*!
- * jQuery UI Effects Bounce 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Bounce Effect
-//>>group: Effects
-//>>description: Bounces an element horizontally or vertically n times.
-//>>docs: http://api.jqueryui.com/bounce-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectBounce = $.effects.define( "bounce", function( options, done ) {
-	var upAnim, downAnim, refValue,
-		element = $( this ),
-
-		// Defaults:
-		mode = options.mode,
-		hide = mode === "hide",
-		show = mode === "show",
-		direction = options.direction || "up",
-		distance = options.distance,
-		times = options.times || 5,
-
-		// Number of internal animations
-		anims = times * 2 + ( show || hide ? 1 : 0 ),
-		speed = options.duration / anims,
-		easing = options.easing,
-
-		// Utility:
-		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
-		motion = ( direction === "up" || direction === "left" ),
-		i = 0,
-
-		queuelen = element.queue().length;
-
-	$.effects.createPlaceholder( element );
-
-	refValue = element.css( ref );
-
-	// Default distance for the BIGGEST bounce is the outer Distance / 3
-	if ( !distance ) {
-		distance = element[ ref === "top" ? "outerHeight" : "outerWidth" ]() / 3;
-	}
-
-	if ( show ) {
-		downAnim = { opacity: 1 };
-		downAnim[ ref ] = refValue;
-
-		// If we are showing, force opacity 0 and set the initial position
-		// then do the "first" animation
-		element
-			.css( "opacity", 0 )
-			.css( ref, motion ? -distance * 2 : distance * 2 )
-			.animate( downAnim, speed, easing );
-	}
-
-	// Start at the smallest distance if we are hiding
-	if ( hide ) {
-		distance = distance / Math.pow( 2, times - 1 );
-	}
-
-	downAnim = {};
-	downAnim[ ref ] = refValue;
-
-	// Bounces up/down/left/right then back to 0 -- times * 2 animations happen here
-	for ( ; i < times; i++ ) {
-		upAnim = {};
-		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;
-
-		element
-			.animate( upAnim, speed, easing )
-			.animate( downAnim, speed, easing );
-
-		distance = hide ? distance * 2 : distance / 2;
-	}
-
-	// Last Bounce when Hiding
-	if ( hide ) {
-		upAnim = { opacity: 0 };
-		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;
-
-		element.animate( upAnim, speed, easing );
-	}
-
-	element.queue( done );
-
-	$.effects.unshift( element, queuelen, anims + 1 );
-} );
-
-
-/*!
- * jQuery UI Effects Clip 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Clip Effect
-//>>group: Effects
-//>>description: Clips the element on and off like an old TV.
-//>>docs: http://api.jqueryui.com/clip-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectClip = $.effects.define( "clip", "hide", function( options, done ) {
-	var start,
-		animate = {},
-		element = $( this ),
-		direction = options.direction || "vertical",
-		both = direction === "both",
-		horizontal = both || direction === "horizontal",
-		vertical = both || direction === "vertical";
-
-	start = element.cssClip();
-	animate.clip = {
-		top: vertical ? ( start.bottom - start.top ) / 2 : start.top,
-		right: horizontal ? ( start.right - start.left ) / 2 : start.right,
-		bottom: vertical ? ( start.bottom - start.top ) / 2 : start.bottom,
-		left: horizontal ? ( start.right - start.left ) / 2 : start.left
-	};
-
-	$.effects.createPlaceholder( element );
-
-	if ( options.mode === "show" ) {
-		element.cssClip( animate.clip );
-		animate.clip = start;
-	}
-
-	element.animate( animate, {
-		queue: false,
-		duration: options.duration,
-		easing: options.easing,
-		complete: done
-	} );
-
-} );
-
-
-/*!
- * jQuery UI Effects Drop 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Drop Effect
-//>>group: Effects
-//>>description: Moves an element in one direction and hides it at the same time.
-//>>docs: http://api.jqueryui.com/drop-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectDrop = $.effects.define( "drop", "hide", function( options, done ) {
-
-	var distance,
-		element = $( this ),
-		mode = options.mode,
-		show = mode === "show",
-		direction = options.direction || "left",
-		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
-		motion = ( direction === "up" || direction === "left" ) ? "-=" : "+=",
-		oppositeMotion = ( motion === "+=" ) ? "-=" : "+=",
-		animation = {
-			opacity: 0
-		};
-
-	$.effects.createPlaceholder( element );
-
-	distance = options.distance ||
-		element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ) / 2;
-
-	animation[ ref ] = motion + distance;
-
-	if ( show ) {
-		element.css( animation );
-
-		animation[ ref ] = oppositeMotion + distance;
-		animation.opacity = 1;
-	}
-
-	// Animate
-	element.animate( animation, {
-		queue: false,
-		duration: options.duration,
-		easing: options.easing,
-		complete: done
-	} );
-} );
-
-
-/*!
- * jQuery UI Effects Explode 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Explode Effect
-//>>group: Effects
-/* eslint-disable max-len */
-//>>description: Explodes an element in all directions into n pieces. Implodes an element to its original wholeness.
-/* eslint-enable max-len */
-//>>docs: http://api.jqueryui.com/explode-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectExplode = $.effects.define( "explode", "hide", function( options, done ) {
-
-	var i, j, left, top, mx, my,
-		rows = options.pieces ? Math.round( Math.sqrt( options.pieces ) ) : 3,
-		cells = rows,
-		element = $( this ),
-		mode = options.mode,
-		show = mode === "show",
-
-		// Show and then visibility:hidden the element before calculating offset
-		offset = element.show().css( "visibility", "hidden" ).offset(),
-
-		// Width and height of a piece
-		width = Math.ceil( element.outerWidth() / cells ),
-		height = Math.ceil( element.outerHeight() / rows ),
-		pieces = [];
-
-	// Children animate complete:
-	function childComplete() {
-		pieces.push( this );
-		if ( pieces.length === rows * cells ) {
-			animComplete();
-		}
-	}
-
-	// Clone the element for each row and cell.
-	for ( i = 0; i < rows; i++ ) { // ===>
-		top = offset.top + i * height;
-		my = i - ( rows - 1 ) / 2;
-
-		for ( j = 0; j < cells; j++ ) { // |||
-			left = offset.left + j * width;
-			mx = j - ( cells - 1 ) / 2;
-
-			// Create a clone of the now hidden main element that will be absolute positioned
-			// within a wrapper div off the -left and -top equal to size of our pieces
-			element
-				.clone()
-				.appendTo( "body" )
-				.wrap( "<div></div>" )
-				.css( {
-					position: "absolute",
-					visibility: "visible",
-					left: -j * width,
-					top: -i * height
-				} )
-
-				// Select the wrapper - make it overflow: hidden and absolute positioned based on
-				// where the original was located +left and +top equal to the size of pieces
-				.parent()
-					.addClass( "ui-effects-explode" )
-					.css( {
-						position: "absolute",
-						overflow: "hidden",
-						width: width,
-						height: height,
-						left: left + ( show ? mx * width : 0 ),
-						top: top + ( show ? my * height : 0 ),
-						opacity: show ? 0 : 1
-					} )
-					.animate( {
-						left: left + ( show ? 0 : mx * width ),
-						top: top + ( show ? 0 : my * height ),
-						opacity: show ? 1 : 0
-					}, options.duration || 500, options.easing, childComplete );
-		}
-	}
-
-	function animComplete() {
-		element.css( {
-			visibility: "visible"
-		} );
-		$( pieces ).remove();
-		done();
-	}
-} );
-
-
-/*!
- * jQuery UI Effects Fade 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Fade Effect
-//>>group: Effects
-//>>description: Fades the element.
-//>>docs: http://api.jqueryui.com/fade-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectFade = $.effects.define( "fade", "toggle", function( options, done ) {
-	var show = options.mode === "show";
-
-	$( this )
-		.css( "opacity", show ? 0 : 1 )
-		.animate( {
-			opacity: show ? 1 : 0
-		}, {
-			queue: false,
-			duration: options.duration,
-			easing: options.easing,
-			complete: done
-		} );
-} );
-
-
-/*!
- * jQuery UI Effects Fold 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Fold Effect
-//>>group: Effects
-//>>description: Folds an element first horizontally and then vertically.
-//>>docs: http://api.jqueryui.com/fold-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectFold = $.effects.define( "fold", "hide", function( options, done ) {
-
-	// Create element
-	var element = $( this ),
-		mode = options.mode,
-		show = mode === "show",
-		hide = mode === "hide",
-		size = options.size || 15,
-		percent = /([0-9]+)%/.exec( size ),
-		horizFirst = !!options.horizFirst,
-		ref = horizFirst ? [ "right", "bottom" ] : [ "bottom", "right" ],
-		duration = options.duration / 2,
-
-		placeholder = $.effects.createPlaceholder( element ),
-
-		start = element.cssClip(),
-		animation1 = { clip: $.extend( {}, start ) },
-		animation2 = { clip: $.extend( {}, start ) },
-
-		distance = [ start[ ref[ 0 ] ], start[ ref[ 1 ] ] ],
-
-		queuelen = element.queue().length;
-
-	if ( percent ) {
-		size = parseInt( percent[ 1 ], 10 ) / 100 * distance[ hide ? 0 : 1 ];
-	}
-	animation1.clip[ ref[ 0 ] ] = size;
-	animation2.clip[ ref[ 0 ] ] = size;
-	animation2.clip[ ref[ 1 ] ] = 0;
-
-	if ( show ) {
-		element.cssClip( animation2.clip );
-		if ( placeholder ) {
-			placeholder.css( $.effects.clipToBox( animation2 ) );
-		}
-
-		animation2.clip = start;
-	}
-
-	// Animate
-	element
-		.queue( function( next ) {
-			if ( placeholder ) {
-				placeholder
-					.animate( $.effects.clipToBox( animation1 ), duration, options.easing )
-					.animate( $.effects.clipToBox( animation2 ), duration, options.easing );
-			}
-
-			next();
-		} )
-		.animate( animation1, duration, options.easing )
-		.animate( animation2, duration, options.easing )
-		.queue( done );
-
-	$.effects.unshift( element, queuelen, 4 );
-} );
-
-
-/*!
- * jQuery UI Effects Highlight 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Highlight Effect
-//>>group: Effects
-//>>description: Highlights the background of an element in a defined color for a custom duration.
-//>>docs: http://api.jqueryui.com/highlight-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectHighlight = $.effects.define( "highlight", "show", function( options, done ) {
-	var element = $( this ),
-		animation = {
-			backgroundColor: element.css( "backgroundColor" )
-		};
-
-	if ( options.mode === "hide" ) {
-		animation.opacity = 0;
-	}
-
-	$.effects.saveStyle( element );
-
-	element
-		.css( {
-			backgroundImage: "none",
-			backgroundColor: options.color || "#ffff99"
-		} )
-		.animate( animation, {
-			queue: false,
-			duration: options.duration,
-			easing: options.easing,
-			complete: done
-		} );
-} );
-
-
-/*!
- * jQuery UI Effects Size 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Size Effect
-//>>group: Effects
-//>>description: Resize an element to a specified width and height.
-//>>docs: http://api.jqueryui.com/size-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectSize = $.effects.define( "size", function( options, done ) {
-
-	// Create element
-	var baseline, factor, temp,
-		element = $( this ),
-
-		// Copy for children
-		cProps = [ "fontSize" ],
-		vProps = [ "borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom" ],
-		hProps = [ "borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight" ],
-
-		// Set options
-		mode = options.mode,
-		restore = mode !== "effect",
-		scale = options.scale || "both",
-		origin = options.origin || [ "middle", "center" ],
-		position = element.css( "position" ),
-		pos = element.position(),
-		original = $.effects.scaledDimensions( element ),
-		from = options.from || original,
-		to = options.to || $.effects.scaledDimensions( element, 0 );
-
-	$.effects.createPlaceholder( element );
-
-	if ( mode === "show" ) {
-		temp = from;
-		from = to;
-		to = temp;
-	}
-
-	// Set scaling factor
-	factor = {
-		from: {
-			y: from.height / original.height,
-			x: from.width / original.width
-		},
-		to: {
-			y: to.height / original.height,
-			x: to.width / original.width
-		}
-	};
-
-	// Scale the css box
-	if ( scale === "box" || scale === "both" ) {
-
-		// Vertical props scaling
-		if ( factor.from.y !== factor.to.y ) {
-			from = $.effects.setTransition( element, vProps, factor.from.y, from );
-			to = $.effects.setTransition( element, vProps, factor.to.y, to );
-		}
-
-		// Horizontal props scaling
-		if ( factor.from.x !== factor.to.x ) {
-			from = $.effects.setTransition( element, hProps, factor.from.x, from );
-			to = $.effects.setTransition( element, hProps, factor.to.x, to );
-		}
-	}
-
-	// Scale the content
-	if ( scale === "content" || scale === "both" ) {
-
-		// Vertical props scaling
-		if ( factor.from.y !== factor.to.y ) {
-			from = $.effects.setTransition( element, cProps, factor.from.y, from );
-			to = $.effects.setTransition( element, cProps, factor.to.y, to );
-		}
-	}
-
-	// Adjust the position properties based on the provided origin points
-	if ( origin ) {
-		baseline = $.effects.getBaseline( origin, original );
-		from.top = ( original.outerHeight - from.outerHeight ) * baseline.y + pos.top;
-		from.left = ( original.outerWidth - from.outerWidth ) * baseline.x + pos.left;
-		to.top = ( original.outerHeight - to.outerHeight ) * baseline.y + pos.top;
-		to.left = ( original.outerWidth - to.outerWidth ) * baseline.x + pos.left;
-	}
-	delete from.outerHeight;
-	delete from.outerWidth;
-	element.css( from );
-
-	// Animate the children if desired
-	if ( scale === "content" || scale === "both" ) {
-
-		vProps = vProps.concat( [ "marginTop", "marginBottom" ] ).concat( cProps );
-		hProps = hProps.concat( [ "marginLeft", "marginRight" ] );
-
-		// Only animate children with width attributes specified
-		// TODO: is this right? should we include anything with css width specified as well
-		element.find( "*[width]" ).each( function() {
-			var child = $( this ),
-				childOriginal = $.effects.scaledDimensions( child ),
-				childFrom = {
-					height: childOriginal.height * factor.from.y,
-					width: childOriginal.width * factor.from.x,
-					outerHeight: childOriginal.outerHeight * factor.from.y,
-					outerWidth: childOriginal.outerWidth * factor.from.x
-				},
-				childTo = {
-					height: childOriginal.height * factor.to.y,
-					width: childOriginal.width * factor.to.x,
-					outerHeight: childOriginal.height * factor.to.y,
-					outerWidth: childOriginal.width * factor.to.x
-				};
-
-			// Vertical props scaling
-			if ( factor.from.y !== factor.to.y ) {
-				childFrom = $.effects.setTransition( child, vProps, factor.from.y, childFrom );
-				childTo = $.effects.setTransition( child, vProps, factor.to.y, childTo );
-			}
-
-			// Horizontal props scaling
-			if ( factor.from.x !== factor.to.x ) {
-				childFrom = $.effects.setTransition( child, hProps, factor.from.x, childFrom );
-				childTo = $.effects.setTransition( child, hProps, factor.to.x, childTo );
-			}
-
-			if ( restore ) {
-				$.effects.saveStyle( child );
-			}
-
-			// Animate children
-			child.css( childFrom );
-			child.animate( childTo, options.duration, options.easing, function() {
-
-				// Restore children
-				if ( restore ) {
-					$.effects.restoreStyle( child );
-				}
-			} );
-		} );
-	}
-
-	// Animate
-	element.animate( to, {
-		queue: false,
-		duration: options.duration,
-		easing: options.easing,
-		complete: function() {
-
-			var offset = element.offset();
-
-			if ( to.opacity === 0 ) {
-				element.css( "opacity", from.opacity );
-			}
-
-			if ( !restore ) {
-				element
-					.css( "position", position === "static" ? "relative" : position )
-					.offset( offset );
-
-				// Need to save style here so that automatic style restoration
-				// doesn't restore to the original styles from before the animation.
-				$.effects.saveStyle( element );
-			}
-
-			done();
-		}
-	} );
-
-} );
-
-
-/*!
- * jQuery UI Effects Scale 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Scale Effect
-//>>group: Effects
-//>>description: Grows or shrinks an element and its content.
-//>>docs: http://api.jqueryui.com/scale-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectScale = $.effects.define( "scale", function( options, done ) {
-
-	// Create element
-	var el = $( this ),
-		mode = options.mode,
-		percent = parseInt( options.percent, 10 ) ||
-			( parseInt( options.percent, 10 ) === 0 ? 0 : ( mode !== "effect" ? 0 : 100 ) ),
-
-		newOptions = $.extend( true, {
-			from: $.effects.scaledDimensions( el ),
-			to: $.effects.scaledDimensions( el, percent, options.direction || "both" ),
-			origin: options.origin || [ "middle", "center" ]
-		}, options );
-
-	// Fade option to support puff
-	if ( options.fade ) {
-		newOptions.from.opacity = 1;
-		newOptions.to.opacity = 0;
-	}
-
-	$.effects.effect.size.call( this, newOptions, done );
-} );
-
-
-/*!
- * jQuery UI Effects Puff 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Puff Effect
-//>>group: Effects
-//>>description: Creates a puff effect by scaling the element up and hiding it at the same time.
-//>>docs: http://api.jqueryui.com/puff-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectPuff = $.effects.define( "puff", "hide", function( options, done ) {
-	var newOptions = $.extend( true, {}, options, {
-		fade: true,
-		percent: parseInt( options.percent, 10 ) || 150
-	} );
-
-	$.effects.effect.scale.call( this, newOptions, done );
-} );
-
-
-/*!
- * jQuery UI Effects Pulsate 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Pulsate Effect
-//>>group: Effects
-//>>description: Pulsates an element n times by changing the opacity to zero and back.
-//>>docs: http://api.jqueryui.com/pulsate-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectPulsate = $.effects.define( "pulsate", "show", function( options, done ) {
-	var element = $( this ),
-		mode = options.mode,
-		show = mode === "show",
-		hide = mode === "hide",
-		showhide = show || hide,
-
-		// Showing or hiding leaves off the "last" animation
-		anims = ( ( options.times || 5 ) * 2 ) + ( showhide ? 1 : 0 ),
-		duration = options.duration / anims,
-		animateTo = 0,
-		i = 1,
-		queuelen = element.queue().length;
-
-	if ( show || !element.is( ":visible" ) ) {
-		element.css( "opacity", 0 ).show();
-		animateTo = 1;
-	}
-
-	// Anims - 1 opacity "toggles"
-	for ( ; i < anims; i++ ) {
-		element.animate( { opacity: animateTo }, duration, options.easing );
-		animateTo = 1 - animateTo;
-	}
-
-	element.animate( { opacity: animateTo }, duration, options.easing );
-
-	element.queue( done );
-
-	$.effects.unshift( element, queuelen, anims + 1 );
-} );
-
-
-/*!
- * jQuery UI Effects Shake 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Shake Effect
-//>>group: Effects
-//>>description: Shakes an element horizontally or vertically n times.
-//>>docs: http://api.jqueryui.com/shake-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectShake = $.effects.define( "shake", function( options, done ) {
-
-	var i = 1,
-		element = $( this ),
-		direction = options.direction || "left",
-		distance = options.distance || 20,
-		times = options.times || 3,
-		anims = times * 2 + 1,
-		speed = Math.round( options.duration / anims ),
-		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
-		positiveMotion = ( direction === "up" || direction === "left" ),
-		animation = {},
-		animation1 = {},
-		animation2 = {},
-
-		queuelen = element.queue().length;
-
-	$.effects.createPlaceholder( element );
-
-	// Animation
-	animation[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance;
-	animation1[ ref ] = ( positiveMotion ? "+=" : "-=" ) + distance * 2;
-	animation2[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance * 2;
-
-	// Animate
-	element.animate( animation, speed, options.easing );
-
-	// Shakes
-	for ( ; i < times; i++ ) {
-		element
-			.animate( animation1, speed, options.easing )
-			.animate( animation2, speed, options.easing );
-	}
-
-	element
-		.animate( animation1, speed, options.easing )
-		.animate( animation, speed / 2, options.easing )
-		.queue( done );
-
-	$.effects.unshift( element, queuelen, anims + 1 );
-} );
-
-
-/*!
- * jQuery UI Effects Slide 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Slide Effect
-//>>group: Effects
-//>>description: Slides an element in and out of the viewport.
-//>>docs: http://api.jqueryui.com/slide-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effectsEffectSlide = $.effects.define( "slide", "show", function( options, done ) {
-	var startClip, startRef,
-		element = $( this ),
-		map = {
-			up: [ "bottom", "top" ],
-			down: [ "top", "bottom" ],
-			left: [ "right", "left" ],
-			right: [ "left", "right" ]
-		},
-		mode = options.mode,
-		direction = options.direction || "left",
-		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
-		positiveMotion = ( direction === "up" || direction === "left" ),
-		distance = options.distance ||
-			element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ),
-		animation = {};
-
-	$.effects.createPlaceholder( element );
-
-	startClip = element.cssClip();
-	startRef = element.position()[ ref ];
-
-	// Define hide animation
-	animation[ ref ] = ( positiveMotion ? -1 : 1 ) * distance + startRef;
-	animation.clip = element.cssClip();
-	animation.clip[ map[ direction ][ 1 ] ] = animation.clip[ map[ direction ][ 0 ] ];
-
-	// Reverse the animation if we're showing
-	if ( mode === "show" ) {
-		element.cssClip( animation.clip );
-		element.css( ref, animation[ ref ] );
-		animation.clip = startClip;
-		animation[ ref ] = startRef;
-	}
-
-	// Actually animate
-	element.animate( animation, {
-		queue: false,
-		duration: options.duration,
-		easing: options.easing,
-		complete: done
-	} );
-} );
-
-
-/*!
- * jQuery UI Effects Transfer 1.13.1
- * http://jqueryui.com
- *
- * Copyright jQuery Foundation and other contributors
- * Released under the MIT license.
- * http://jquery.org/license
- */
-
-//>>label: Transfer Effect
-//>>group: Effects
-//>>description: Displays a transfer effect from one element to another.
-//>>docs: http://api.jqueryui.com/transfer-effect/
-//>>demos: http://jqueryui.com/effect/
-
-
-var effect;
-if ( $.uiBackCompat !== false ) {
-	effect = $.effects.define( "transfer", function( options, done ) {
-		$( this ).transfer( options, done );
-	} );
-}
-var effectsEffectTransfer = effect;
-
-
-

 } );
\ No newline at end of file
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/jquery/jquery.validate.js /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/jquery/jquery.validate.js
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/jquery/jquery.validate.js	2023-05-30 09:55:07.404891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/jquery/jquery.validate.js	2023-05-16 15:26:28.000000000 +0100
@@ -1,9 +1,9 @@
 /*!
- * jQuery Validation Plugin v1.19.3
+ * jQuery Validation Plugin v1.19.5
  *
  * https://jqueryvalidation.org/
  *
- * Copyright (c) 2021 Jörn Zaefferer
+ * Copyright (c) 2022 Jörn Zaefferer
  * Released under the MIT license
  */
 (function( factory ) {
@@ -378,7 +378,6 @@
             dateISO: "Please enter a valid date (ISO).",
             number: "Please enter a valid number.",
             digits: "Please enter only digits.",
-            creditcard: "Please enter a valid credit card number.",
             equalTo: "Please enter the same value again.",
             maxlength: $.validator.format( "Please enter no more than {0} characters." ),
             minlength: $.validator.format( "Please enter at least {0} characters." ),
@@ -784,7 +783,7 @@
                     normalizer = this.settings.normalizer;
                 }

-                // If normalizer is defined, then call it to retrieve the changed value instead
+                // If normalizer is defined, then call it to the changed value instead
                 // of using the real one.
                 // Note that `this` in the normalizer is `element`.
                 if ( normalizer ) {
@@ -875,13 +874,13 @@
                 }

                 var message = this.findDefined(
-                    this.customMessage( element.name, rule.method ),
-                    this.customDataMessage( element, rule.method ),
+                        this.customMessage( element.name, rule.method ),
+                        this.customDataMessage( element, rule.method ),

-                    // 'title' is never undefined, so handle empty string as undefined
-                    !this.settings.ignoreTitle && element.title || undefined,
-                    $.validator.messages[ rule.method ],
-                    "<strong>Warning: No message defined for " + element.name + "</strong>"
+                        // 'title' is never undefined, so handle empty string as undefined
+                        !this.settings.ignoreTitle && element.title || undefined,
+                        $.validator.messages[ rule.method ],
+                        "<strong>Warning: No message defined for " + element.name + "</strong>"
                     ),
                     theregex = /\$?\{(\d+)\}/g;
                 if ( typeof message === "function" ) {
@@ -982,7 +981,7 @@
                     if ( this.labelContainer.length ) {
                         this.labelContainer.append( place );
                     } else if ( this.settings.errorPlacement ) {
-                        this.settings.errorPlacement( place, $( element ) );
+                        this.settings.errorPlacement.call( this, place, $( element ) );
                     } else {
                         place.insertAfter( element );
                     }
@@ -1052,7 +1051,11 @@
             // meta-characters that should be escaped in order to be used with JQuery
             // as a literal part of a name/id or any selector.
             escapeCssMeta: function( string ) {
-                return (string || '').replace( /([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g, "\\$1" );
+                if ( string === undefined ) {
+                    return "";
+                }
+
+                return string.replace( /([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g, "\\$1" );
             },

             idOrName: function( element ) {
@@ -1128,8 +1131,8 @@
                 }
                 delete this.pending[ element.name ];
                 $( element ).removeClass( this.settings.pendingClass );
-                if ( valid && this.pendingRequest === 0 && this.formSubmitted && this.form() ) {
-                    $( this.currentForm ).submit();
+                if ( valid && this.pendingRequest === 0 && this.formSubmitted && this.form() && this.pendingRequest === 0 ) {
+                    $( this.currentForm ).trigger( "submit" );

                     // Remove the hidden input that was used as a replacement for the
                     // missing submit button. The hidden input is added by `handle()`
@@ -1234,7 +1237,7 @@

                 // Exception: the jquery validate 'range' method
                 // does not test for the html5 'range' type
-                rules[ method ] = true;
+                rules[ type === "date" ? "dateISO" : method ] = true;
             }
         },

@@ -1443,7 +1446,7 @@
                 // https://gist.github.com/dperini/729294
                 // see also https://mathiasbynens.be/demo/url-regex
                 // modified to allow protocol-relative URLs
-                return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test( value );
+                return this.optional( element ) || /^(?:(?:(?:https?|ftp):)?\/\/)(?:(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})+(?::(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test( value );
             },

             // https://jqueryvalidation.org/date-method/
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/moment.js /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/moment.js
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/lib/web/moment.js	2023-05-30 09:55:07.420891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/lib/web/moment.js	2023-05-16 15:26:28.000000000 +0100
@@ -1,6 +1,7 @@
 //! moment.js
-//! version : 2.29.1
+//! version : 2.29.4
 //! authors : Tim Wood, Iskren Chernev, Moment.js contributors
 //! license : MIT
 //! momentjs.com
-!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,i;function f(){return e.apply(null,arguments)}function o(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function l(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(m(e,t))return;return 1}function r(e){return void 0===e}function h(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function a(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function d(e,t){for(var n=[],s=0;s<e.length;++s)n.push(t(e[s],s));return n}function c(e,t){for(var n in t)m(t,n)&&(e[n]=t[n]);return m(t,"toString")&&(e.toString=t.toString),m(t,"valueOf")&&(e.valueOf=t.valueOf),e}function _(e,t,n,s){return xt(e,t,n,s,!0).utc()}function y(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function g(e){if(null==e._isValid){var t=y(e),n=i.call(t.parsedDateParts,function(e){return null!=e}),s=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(s=s&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return s;e._isValid=s}return e._isValid}function w(e){var t=_(NaN);return null!=e?c(y(t),e):y(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var p=f.momentProperties=[],t=!1;function v(e,t){var n,s,i;if(r(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),r(t._i)||(e._i=t._i),r(t._f)||(e._f=t._f),r(t._l)||(e._l=t._l),r(t._strict)||(e._strict=t._strict),r(t._tzm)||(e._tzm=t._tzm),r(t._isUTC)||(e._isUTC=t._isUTC),r(t._offset)||(e._offset=t._offset),r(t._pf)||(e._pf=y(t)),r(t._locale)||(e._locale=t._locale),0<p.length)for(n=0;n<p.length;n++)r(i=t[s=p[n]])||(e[s]=i);return e}function k(e){v(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,f.updateOffset(this),t=!1)}function M(e){return e instanceof k||null!=e&&null!=e._isAMomentObject}function D(e){!1===f.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(i,r){var a=!0;return c(function(){if(null!=f.deprecationHandler&&f.deprecationHandler(null,i),a){for(var e,t,n=[],s=0;s<arguments.length;s++){if(e="","object"==typeof arguments[s]){for(t in e+="\n["+s+"] ",arguments[0])m(arguments[0],t)&&(e+=t+": "+arguments[0][t]+", ");e=e.slice(0,-2)}else e=arguments[s];n.push(e)}D(i+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),a=!1}return r.apply(this,arguments)},r)}var s,S={};function Y(e,t){null!=f.deprecationHandler&&f.deprecationHandler(e,t),S[e]||(D(t),S[e]=!0)}function O(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=c({},e);for(n in t)m(t,n)&&(u(e[n])&&u(t[n])?(s[n]={},c(s[n],e[n]),c(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)m(e,n)&&!m(t,n)&&u(e[n])&&(s[n]=c({},s[n]));return s}function x(e){null!=e&&this.set(e)}f.suppressDeprecationWarnings=!1,f.deprecationHandler=null,s=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)m(e,t)&&n.push(t);return n};function T(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,P=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,R={},W={};function C(e,t,n,s){var i="string"==typeof s?function(){return this[s]()}:s;e&&(W[e]=i),t&&(W[t[0]]=function(){return T(i.apply(this,arguments),t[1],t[2])}),n&&(W[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function U(e,t){return e.isValid()?(t=H(t,e.localeData()),R[t]=R[t]||function(s){for(var e,i=s.match(N),t=0,r=i.length;t<r;t++)W[i[t]]?i[t]=W[i[t]]:i[t]=(e=i[t]).match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"");return function(e){for(var t="",n=0;n<r;n++)t+=O(i[n])?i[n].call(e,s):i[n];return t}}(t),R[t](e)):e.localeData().invalidDate()}function H(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(P.lastIndex=0;0<=n&&P.test(e);)e=e.replace(P,s),P.lastIndex=0,--n;return e}var F={};function L(e,t){var n=e.toLowerCase();F[n]=F[n+"s"]=F[t]=e}function V(e){return"string"==typeof e?F[e]||F[e.toLowerCase()]:void 0}function G(e){var t,n,s={};for(n in e)m(e,n)&&(t=V(n))&&(s[t]=e[n]);return s}var E={};function A(e,t){E[e]=t}function j(e){return e%4==0&&e%100!=0||e%400==0}function I(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function Z(e){var t=+e,n=0;return 0!=t&&isFinite(t)&&(n=I(t)),n}function z(t,n){return function(e){return null!=e?(q(this,t,e),f.updateOffset(this,n),this):$(this,t)}}function $(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function q(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&j(e.year())&&1===e.month()&&29===e.date()?(n=Z(n),e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),xe(n,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](n))}var B,J=/\d/,Q=/\d\d/,X=/\d{3}/,K=/\d{4}/,ee=/[+-]?\d{6}/,te=/\d\d?/,ne=/\d\d\d\d?/,se=/\d\d\d\d\d\d?/,ie=/\d{1,3}/,re=/\d{1,4}/,ae=/[+-]?\d{1,6}/,oe=/\d+/,ue=/[+-]?\d+/,le=/Z|[+-]\d\d:?\d\d/gi,he=/Z|[+-]\d\d(?::?\d\d)?/gi,de=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function ce(e,n,s){B[e]=O(n)?n:function(e,t){return e&&s?s:n}}function fe(e,t){return m(B,e)?B[e](t._strict,t._locale):new RegExp(me(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function me(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}B={};var _e={};function ye(e,n){var t,s=n;for("string"==typeof e&&(e=[e]),h(n)&&(s=function(e,t){t[n]=Z(e)}),t=0;t<e.length;t++)_e[e[t]]=s}function ge(e,i){ye(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}var we,pe=0,ve=1,ke=2,Me=3,De=4,Se=5,Ye=6,Oe=7,be=8;function xe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1==s?j(e)?29:28:31-s%7%2}we=Array.prototype.indexOf?Array.prototype.indexOf:function(e){for(var t=0;t<this.length;++t)if(this[t]===e)return t;return-1},C("M",["MM",2],"Mo",function(){return this.month()+1}),C("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),C("MMMM",0,0,function(e){return this.localeData().months(this,e)}),L("month","M"),A("month",8),ce("M",te),ce("MM",te,Q),ce("MMM",function(e,t){return t.monthsShortRegex(e)}),ce("MMMM",function(e,t){return t.monthsRegex(e)}),ye(["M","MM"],function(e,t){t[ve]=Z(e)-1}),ye(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[ve]=i:y(n).invalidMonth=e});var Te="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ne="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Pe=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Re=de,We=de;function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=Z(t);else if(!h(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),xe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Ue(e){return null!=e?(Ce(this,e),f.updateOffset(this,!0),this):$(this,"Month")}function He(){function e(e,t){return t.length-e.length}for(var t,n=[],s=[],i=[],r=0;r<12;r++)t=_([2e3,r]),n.push(this.monthsShort(t,"")),s.push(this.months(t,"")),i.push(this.months(t,"")),i.push(this.monthsShort(t,""));for(n.sort(e),s.sort(e),i.sort(e),r=0;r<12;r++)n[r]=me(n[r]),s[r]=me(s[r]);for(r=0;r<24;r++)i[r]=me(i[r]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function Fe(e){return j(e)?366:365}C("Y",0,0,function(){var e=this.year();return e<=9999?T(e,4):"+"+e}),C(0,["YY",2],0,function(){return this.year()%100}),C(0,["YYYY",4],0,"year"),C(0,["YYYYY",5],0,"year"),C(0,["YYYYYY",6,!0],0,"year"),L("year","y"),A("year",1),ce("Y",ue),ce("YY",te,Q),ce("YYYY",re,K),ce("YYYYY",ae,ee),ce("YYYYYY",ae,ee),ye(["YYYYY","YYYYYY"],pe),ye("YYYY",function(e,t){t[pe]=2===e.length?f.parseTwoDigitYear(e):Z(e)}),ye("YY",function(e,t){t[pe]=f.parseTwoDigitYear(e)}),ye("Y",function(e,t){t[pe]=parseInt(e,10)}),f.parseTwoDigitYear=function(e){return Z(e)+(68<Z(e)?1900:2e3)};var Le=z("FullYear",!0);function Ve(e){var t,n;return e<100&&0<=e?((n=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function Ge(e,t,n){var s=7+t-n;return s-(7+Ve(e,0,s).getUTCDay()-t)%7-1}function Ee(e,t,n,s,i){var r,a=1+7*(t-1)+(7+n-s)%7+Ge(e,s,i),o=a<=0?Fe(r=e-1)+a:a>Fe(e)?(r=e+1,a-Fe(e)):(r=e,a);return{year:r,dayOfYear:o}}function Ae(e,t,n){var s,i,r=Ge(e.year(),t,n),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?s=a+je(i=e.year()-1,t,n):a>je(e.year(),t,n)?(s=a-je(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function je(e,t,n){var s=Ge(e,t,n),i=Ge(e+1,t,n);return(Fe(e)-s+i)/7}C("w",["ww",2],"wo","week"),C("W",["WW",2],"Wo","isoWeek"),L("week","w"),L("isoWeek","W"),A("week",5),A("isoWeek",5),ce("w",te),ce("ww",te,Q),ce("W",te),ce("WW",te,Q),ge(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=Z(e)});function Ie(e,t){return e.slice(t,7).concat(e.slice(0,t))}C("d",0,"do","day"),C("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),C("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),C("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),C("e",0,0,"weekday"),C("E",0,0,"isoWeekday"),L("day","d"),L("weekday","e"),L("isoWeekday","E"),A("day",11),A("weekday",11),A("isoWeekday",11),ce("d",te),ce("e",te),ce("E",te),ce("dd",function(e,t){return t.weekdaysMinRegex(e)}),ce("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ce("dddd",function(e,t){return t.weekdaysRegex(e)}),ge(["dd","ddd","dddd"],function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:y(n).invalidWeekday=e}),ge(["d","e","E"],function(e,t,n,s){t[s]=Z(e)});var Ze="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),$e="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),qe=de,Be=de,Je=de;function Qe(){function e(e,t){return t.length-e.length}for(var t,n,s,i,r=[],a=[],o=[],u=[],l=0;l<7;l++)t=_([2e3,1]).day(l),n=me(this.weekdaysMin(t,"")),s=me(this.weekdaysShort(t,"")),i=me(this.weekdays(t,"")),r.push(n),a.push(s),o.push(i),u.push(n),u.push(s),u.push(i);r.sort(e),a.sort(e),o.sort(e),u.sort(e),this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Xe(){return this.hours()%12||12}function Ke(e,t){C(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function et(e,t){return t._meridiemParse}C("H",["HH",2],0,"hour"),C("h",["hh",2],0,Xe),C("k",["kk",2],0,function(){return this.hours()||24}),C("hmm",0,0,function(){return""+Xe.apply(this)+T(this.minutes(),2)}),C("hmmss",0,0,function(){return""+Xe.apply(this)+T(this.minutes(),2)+T(this.seconds(),2)}),C("Hmm",0,0,function(){return""+this.hours()+T(this.minutes(),2)}),C("Hmmss",0,0,function(){return""+this.hours()+T(this.minutes(),2)+T(this.seconds(),2)}),Ke("a",!0),Ke("A",!1),L("hour","h"),A("hour",13),ce("a",et),ce("A",et),ce("H",te),ce("h",te),ce("k",te),ce("HH",te,Q),ce("hh",te,Q),ce("kk",te,Q),ce("hmm",ne),ce("hmmss",se),ce("Hmm",ne),ce("Hmmss",se),ye(["H","HH"],Me),ye(["k","kk"],function(e,t,n){var s=Z(e);t[Me]=24===s?0:s}),ye(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ye(["h","hh"],function(e,t,n){t[Me]=Z(e),y(n).bigHour=!0}),ye("hmm",function(e,t,n){var s=e.length-2;t[Me]=Z(e.substr(0,s)),t[De]=Z(e.substr(s)),y(n).bigHour=!0}),ye("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[Me]=Z(e.substr(0,s)),t[De]=Z(e.substr(s,2)),t[Se]=Z(e.substr(i)),y(n).bigHour=!0}),ye("Hmm",function(e,t,n){var s=e.length-2;t[Me]=Z(e.substr(0,s)),t[De]=Z(e.substr(s))}),ye("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[Me]=Z(e.substr(0,s)),t[De]=Z(e.substr(s,2)),t[Se]=Z(e.substr(i))});var tt=z("Hours",!0);var nt,st={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Te,monthsShort:Ne,week:{dow:0,doy:6},weekdays:Ze,weekdaysMin:$e,weekdaysShort:ze,meridiemParse:/[ap]\.?m?\.?/i},it={},rt={};function at(e){return e?e.toLowerCase().replace("_","-"):e}function ot(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=at(e[r]).split("-")).length,n=(n=at(e[r+1]))?n.split("-"):null;0<t;){if(s=ut(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&function(e,t){for(var n=Math.min(e.length,t.length),s=0;s<n;s+=1)if(e[s]!==t[s])return s;return n}(i,n)>=t-1)break;t--}r++}return nt}function ut(t){var e;if(void 0===it[t]&&"undefined"!=typeof module&&module&&module.exports)try{e=nt._abbr,require("./locale/"+t),lt(e)}catch(e){it[t]=null}return it[t]}function lt(e,t){var n;return e&&((n=r(t)?dt(e):ht(e,t))?nt=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),nt._abbr}function ht(e,t){if(null===t)return delete it[e],null;var n,s=st;if(t.abbr=e,null!=it[e])Y("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=it[e]._config;else if(null!=t.parentLocale)if(null!=it[t.parentLocale])s=it[t.parentLocale]._config;else{if(null==(n=ut(t.parentLocale)))return rt[t.parentLocale]||(rt[t.parentLocale]=[]),rt[t.parentLocale].push({name:e,config:t}),null;s=n._config}return it[e]=new x(b(s,t)),rt[e]&&rt[e].forEach(function(e){ht(e.name,e.config)}),lt(e),it[e]}function dt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return nt;if(!o(e)){if(t=ut(e))return t;e=[e]}return ot(e)}function ct(e){var t,n=e._a;return n&&-2===y(e).overflow&&(t=n[ve]<0||11<n[ve]?ve:n[ke]<1||n[ke]>xe(n[pe],n[ve])?ke:n[Me]<0||24<n[Me]||24===n[Me]&&(0!==n[De]||0!==n[Se]||0!==n[Ye])?Me:n[De]<0||59<n[De]?De:n[Se]<0||59<n[Se]?Se:n[Ye]<0||999<n[Ye]?Ye:-1,y(e)._overflowDayOfYear&&(t<pe||ke<t)&&(t=ke),y(e)._overflowWeeks&&-1===t&&(t=Oe),y(e)._overflowWeekday&&-1===t&&(t=be),y(e).overflow=t),e}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],gt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],wt=/^\/?Date\((-?\d+)/i,pt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,vt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function kt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(y(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),Ot(e)}else e._isValid=!1}function Mt(e,t,n,s,i,r){var a=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Ne.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}function Dt(e){var t,n,s,i,r=pt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(r){if(t=Mt(r[4],r[3],r[2],r[5],r[6],r[7]),n=r[1],s=t,i=e,n&&ze.indexOf(n)!==new Date(s[0],s[1],s[2]).getDay()&&(y(i).weekdayMismatch=!0,!void(i._isValid=!1)))return;e._a=t,e._tzm=function(e,t,n){if(e)return vt[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return 60*((s-i)/100)+i}(r[8],r[9],r[10]),e._d=Ve.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),y(e).rfc2822=!0}else e._isValid=!1}function St(e,t,n){return null!=e?e:null!=t?t:n}function Yt(e){var t,n,s,i,r,a,o,u=[];if(!e._d){for(a=e,o=new Date(f.now()),s=a._useUTC?[o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()]:[o.getFullYear(),o.getMonth(),o.getDate()],e._w&&null==e._a[ke]&&null==e._a[ve]&&function(e){var t,n,s,i,r,a,o,u,l;null!=(t=e._w).GG||null!=t.W||null!=t.E?(r=1,a=4,n=St(t.GG,e._a[pe],Ae(Tt(),1,4).year),s=St(t.W,1),((i=St(t.E,1))<1||7<i)&&(u=!0)):(r=e._locale._week.dow,a=e._locale._week.doy,l=Ae(Tt(),r,a),n=St(t.gg,e._a[pe],l.year),s=St(t.w,l.week),null!=t.d?((i=t.d)<0||6<i)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||6<t.e)&&(u=!0)):i=r);s<1||s>je(n,r,a)?y(e)._overflowWeeks=!0:null!=u?y(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[pe]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(r=St(e._a[pe],s[pe]),(e._dayOfYear>Fe(r)||0===e._dayOfYear)&&(y(e)._overflowDayOfYear=!0),n=Ve(r,0,e._dayOfYear),e._a[ve]=n.getUTCMonth(),e._a[ke]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=u[t]=s[t];for(;t<7;t++)e._a[t]=u[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Me]&&0===e._a[De]&&0===e._a[Se]&&0===e._a[Ye]&&(e._nextDay=!0,e._a[Me]=0),e._d=(e._useUTC?Ve:function(e,t,n,s,i,r,a){var o;return e<100&&0<=e?(o=new Date(e+400,t,n,s,i,r,a),isFinite(o.getFullYear())&&o.setFullYear(e)):o=new Date(e,t,n,s,i,r,a),o}).apply(null,u),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Me]=24),e._w&&void 0!==e._w.d&&e._w.d!==i&&(y(e).weekdayMismatch=!0)}}function Ot(e){if(e._f!==f.ISO_8601)if(e._f!==f.RFC_2822){e._a=[],y(e).empty=!0;for(var t,n,s,i,r,a,o,u=""+e._i,l=u.length,h=0,d=H(e._f,e._locale).match(N)||[],c=0;c<d.length;c++)n=d[c],(t=(u.match(fe(n,e))||[])[0])&&(0<(s=u.substr(0,u.indexOf(t))).length&&y(e).unusedInput.push(s),u=u.slice(u.indexOf(t)+t.length),h+=t.length),W[n]?(t?y(e).empty=!1:y(e).unusedTokens.push(n),r=n,o=e,null!=(a=t)&&m(_e,r)&&_e[r](a,o._a,o,r)):e._strict&&!t&&y(e).unusedTokens.push(n);y(e).charsLeftOver=l-h,0<u.length&&y(e).unusedInput.push(u),e._a[Me]<=12&&!0===y(e).bigHour&&0<e._a[Me]&&(y(e).bigHour=void 0),y(e).parsedDateParts=e._a.slice(0),y(e).meridiem=e._meridiem,e._a[Me]=function(e,t,n){var s;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):(null!=e.isPM&&((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0)),t)}(e._locale,e._a[Me],e._meridiem),null!==(i=y(e).era)&&(e._a[pe]=e._locale.erasConvertYear(i,e._a[pe])),Yt(e),ct(e)}else Dt(e);else kt(e)}function bt(e){var t,n,s=e._i,i=e._f;return e._locale=e._locale||dt(e._l),null===s||void 0===i&&""===s?w({nullInput:!0}):("string"==typeof s&&(e._i=s=e._locale.preparse(s)),M(s)?new k(ct(s)):(a(s)?e._d=s:o(i)?function(e){var t,n,s,i,r,a,o=!1;if(0===e._f.length)return y(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<e._f.length;i++)r=0,a=!1,t=v({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Ot(t),g(t)&&(a=!0),r+=y(t).charsLeftOver,r+=10*y(t).unusedTokens.length,y(t).score=r,o?r<s&&(s=r,n=t):(null==s||r<s||a)&&(s=r,n=t,a&&(o=!0));c(e,n||t)}(e):i?Ot(e):r(n=(t=e)._i)?t._d=new Date(f.now()):a(n)?t._d=new Date(n.valueOf()):"string"==typeof n?function(e){var t=wt.exec(e._i);null===t?(kt(e),!1===e._isValid&&(delete e._isValid,Dt(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:f.createFromInputFallback(e)))):e._d=new Date(+t[1])}(t):o(n)?(t._a=d(n.slice(0),function(e){return parseInt(e,10)}),Yt(t)):u(n)?function(e){var t,n;e._d||(n=void 0===(t=G(e._i)).day?t.date:t.day,e._a=d([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),Yt(e))}(t):h(n)?t._d=new Date(n):f.createFromInputFallback(t),g(e)||(e._d=null),e))}function xt(e,t,n,s,i){var r,a={};return!0!==t&&!1!==t||(s=t,t=void 0),!0!==n&&!1!==n||(s=n,n=void 0),(u(e)&&l(e)||o(e)&&0===e.length)&&(e=void 0),a._isAMomentObject=!0,a._useUTC=a._isUTC=i,a._l=n,a._i=e,a._f=t,a._strict=s,(r=new k(ct(bt(a))))._nextDay&&(r.add(1,"d"),r._nextDay=void 0),r}function Tt(e,t,n,s){return xt(e,t,n,s,!1)}f.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),f.ISO_8601=function(){},f.RFC_2822=function(){};var Nt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:w()}),Pt=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:w()});function Rt(e,t){var n,s;if(1===t.length&&o(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ct(e){var t=G(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||t.isoWeek||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,h=t.millisecond||0;this._isValid=function(e){var t,n,s=!1;for(t in e)if(m(e,t)&&(-1===we.call(Wt,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<Wt.length;++n)if(e[Wt[n]]){if(s)return!1;parseFloat(e[Wt[n]])!==Z(e[Wt[n]])&&(s=!0)}return!0}(t),this._milliseconds=+h+1e3*l+6e4*u+1e3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=dt(),this._bubble()}function Ut(e){return e instanceof Ct}function Ht(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){C(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+T(~~(e/60),2)+n+T(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ce("Z",he),ce("ZZ",he),ye(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Vt(he,e)});var Lt=/([\+\-]|\d\d)/gi;function Vt(e,t){var n,s,i=(t||"").match(e);return null===i?null:0===(s=60*(n=((i[i.length-1]||[])+"").match(Lt)||["-",0,0])[1]+Z(n[2]))?0:"+"===n[0]?s:-s}function Gt(e,t){var n,s;return t._isUTC?(n=t.clone(),s=(M(e)||a(e)?e.valueOf():Tt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+s),f.updateOffset(n,!1),n):Tt(e).local()}function Et(e){return-Math.round(e._d.getTimezoneOffset())}function At(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}f.updateOffset=function(){};var jt=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Zt(e,t){var n,s,i,r=e,a=null;return Ut(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:h(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(a=jt.exec(e))?(n="-"===a[1]?-1:1,r={y:0,d:Z(a[ke])*n,h:Z(a[Me])*n,m:Z(a[De])*n,s:Z(a[Se])*n,ms:Z(Ht(1e3*a[Ye]))*n}):(a=It.exec(e))?(n="-"===a[1]?-1:1,r={y:zt(a[2],n),M:zt(a[3],n),w:zt(a[4],n),d:zt(a[5],n),h:zt(a[6],n),m:zt(a[7],n),s:zt(a[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Gt(t,e),e.isBefore(t)?n=$t(e,t):((n=$t(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=i.milliseconds,r.M=i.months),s=new Ct(r),Ut(e)&&m(e,"_locale")&&(s._locale=e._locale),Ut(e)&&m(e,"_isValid")&&(s._isValid=e._isValid),s}function zt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function $t(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=t-e.clone().add(n.months,"M"),n}function qt(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(Y(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),Bt(this,Zt(e,t),s),this}}function Bt(e,t,n,s){var i=t._milliseconds,r=Ht(t._days),a=Ht(t._months);e.isValid()&&(s=null==s||s,a&&Ce(e,$(e,"Month")+a*n),r&&q(e,"Date",$(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&f.updateOffset(e,r||a))}Zt.fn=Ct.prototype,Zt.invalid=function(){return Zt(NaN)};var Jt=qt(1,"add"),Qt=qt(-1,"subtract");function Xt(e){return"string"==typeof e||e instanceof String}function Kt(e){return M(e)||a(e)||Xt(e)||h(e)||function(t){var e=o(t),n=!1;e&&(n=0===t.filter(function(e){return!h(e)&&Xt(t)}).length);return e&&n}(e)||function(e){var t,n,s=u(e)&&!l(e),i=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"];for(t=0;t<r.length;t+=1)n=r[t],i=i||m(e,n);return s&&i}(e)||null==e}function en(e,t){if(e.date()<t.date())return-en(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months"),i=t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(1+n,"months")-s);return-(n+i)||0}function tn(e){var t;return void 0===e?this._locale._abbr:(null!=(t=dt(e))&&(this._locale=t),this)}f.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",f.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var nn=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function sn(){return this._locale}var rn=126227808e5;function an(e,t){return(e%t+t)%t}function on(e,t,n){return e<100&&0<=e?new Date(e+400,t,n)-rn:new Date(e,t,n).valueOf()}function un(e,t,n){return e<100&&0<=e?Date.UTC(e+400,t,n)-rn:Date.UTC(e,t,n)}function ln(e,t){return t.erasAbbrRegex(e)}function hn(){for(var e=[],t=[],n=[],s=[],i=this.eras(),r=0,a=i.length;r<a;++r)t.push(me(i[r].name)),e.push(me(i[r].abbr)),n.push(me(i[r].narrow)),s.push(me(i[r].name)),s.push(me(i[r].abbr)),s.push(me(i[r].narrow));this._erasRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+n.join("|")+")","i")}function dn(e,t){C(0,[e,e.length],0,t)}function cn(e,t,n,s,i){var r;return null==e?Ae(this,s,i).year:((r=je(e,s,i))<t&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ve(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}C("N",0,0,"eraAbbr"),C("NN",0,0,"eraAbbr"),C("NNN",0,0,"eraAbbr"),C("NNNN",0,0,"eraName"),C("NNNNN",0,0,"eraNarrow"),C("y",["y",1],"yo","eraYear"),C("y",["yy",2],0,"eraYear"),C("y",["yyy",3],0,"eraYear"),C("y",["yyyy",4],0,"eraYear"),ce("N",ln),ce("NN",ln),ce("NNN",ln),ce("NNNN",function(e,t){return t.erasNameRegex(e)}),ce("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),ye(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,s){var i=n._locale.erasParse(e,s,n._strict);i?y(n).era=i:y(n).invalidEra=e}),ce("y",oe),ce("yy",oe),ce("yyy",oe),ce("yyyy",oe),ce("yo",function(e,t){return t._eraYearOrdinalRegex||oe}),ye(["y","yy","yyy","yyyy"],pe),ye(["yo"],function(e,t,n,s){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[pe]=n._locale.eraYearOrdinalParse(e,i):t[pe]=parseInt(e,10)}),C(0,["gg",2],0,function(){return this.weekYear()%100}),C(0,["GG",2],0,function(){return this.isoWeekYear()%100}),dn("gggg","weekYear"),dn("ggggg","weekYear"),dn("GGGG","isoWeekYear"),dn("GGGGG","isoWeekYear"),L("weekYear","gg"),L("isoWeekYear","GG"),A("weekYear",1),A("isoWeekYear",1),ce("G",ue),ce("g",ue),ce("GG",te,Q),ce("gg",te,Q),ce("GGGG",re,K),ce("gggg",re,K),ce("GGGGG",ae,ee),ce("ggggg",ae,ee),ge(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=Z(e)}),ge(["gg","GG"],function(e,t,n,s){t[s]=f.parseTwoDigitYear(e)}),C("Q",0,"Qo","quarter"),L("quarter","Q"),A("quarter",7),ce("Q",J),ye("Q",function(e,t){t[ve]=3*(Z(e)-1)}),C("D",["DD",2],"Do","date"),L("date","D"),A("date",9),ce("D",te),ce("DD",te,Q),ce("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ye(["D","DD"],ke),ye("Do",function(e,t){t[ke]=Z(e.match(te)[0])});var fn=z("Date",!0);C("DDD",["DDDD",3],"DDDo","dayOfYear"),L("dayOfYear","DDD"),A("dayOfYear",4),ce("DDD",ie),ce("DDDD",X),ye(["DDD","DDDD"],function(e,t,n){n._dayOfYear=Z(e)}),C("m",["mm",2],0,"minute"),L("minute","m"),A("minute",14),ce("m",te),ce("mm",te,Q),ye(["m","mm"],De);var mn=z("Minutes",!1);C("s",["ss",2],0,"second"),L("second","s"),A("second",15),ce("s",te),ce("ss",te,Q),ye(["s","ss"],Se);var _n,yn,gn=z("Seconds",!1);for(C("S",0,0,function(){return~~(this.millisecond()/100)}),C(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),C(0,["SSS",3],0,"millisecond"),C(0,["SSSS",4],0,function(){return 10*this.millisecond()}),C(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),C(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),C(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),C(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),C(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),L("millisecond","ms"),A("millisecond",16),ce("S",ie,J),ce("SS",ie,Q),ce("SSS",ie,X),_n="SSSS";_n.length<=9;_n+="S")ce(_n,oe);function wn(e,t){t[Ye]=Z(1e3*("0."+e))}for(_n="S";_n.length<=9;_n+="S")ye(_n,wn);yn=z("Milliseconds",!1),C("z",0,0,"zoneAbbr"),C("zz",0,0,"zoneName");var pn=k.prototype;function vn(e){return e}pn.add=Jt,pn.calendar=function(e,t){1===arguments.length&&(arguments[0]?Kt(arguments[0])?(e=arguments[0],t=void 0):function(e){for(var t=u(e)&&!l(e),n=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i=0;i<s.length;i+=1)n=n||m(e,s[i]);return t&&n}(arguments[0])&&(t=arguments[0],e=void 0):t=e=void 0);var n=e||Tt(),s=Gt(n,this).startOf("day"),i=f.calendarFormat(this,s)||"sameElse",r=t&&(O(t[i])?t[i].call(this,n):t[i]);return this.format(r||this.localeData().calendar(i,this,Tt(n)))},pn.clone=function(){return new k(this)},pn.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Gt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=V(t)){case"year":r=en(this,s)/12;break;case"month":r=en(this,s);break;case"quarter":r=en(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:I(r)},pn.endOf=function(e){var t,n;if(void 0===(e=V(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?un:on,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-an(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-an(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-an(t,1e3)-1;break}return this._d.setTime(t),f.updateOffset(this,!0),this},pn.format=function(e){e=e||(this.isUtc()?f.defaultFormatUtc:f.defaultFormat);var t=U(this,e);return this.localeData().postformat(t)},pn.from=function(e,t){return this.isValid()&&(M(e)&&e.isValid()||Tt(e).isValid())?Zt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},pn.fromNow=function(e){return this.from(Tt(),e)},pn.to=function(e,t){return this.isValid()&&(M(e)&&e.isValid()||Tt(e).isValid())?Zt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},pn.toNow=function(e){return this.to(Tt(),e)},pn.get=function(e){return O(this[e=V(e)])?this[e]():this},pn.invalidAt=function(){return y(this).overflow},pn.isAfter=function(e,t){var n=M(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=V(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},pn.isBefore=function(e,t){var n=M(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=V(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},pn.isBetween=function(e,t,n,s){var i=M(e)?e:Tt(e),r=M(t)?t:Tt(t);return!!(this.isValid()&&i.isValid()&&r.isValid())&&(("("===(s=s||"()")[0]?this.isAfter(i,n):!this.isBefore(i,n))&&(")"===s[1]?this.isBefore(r,n):!this.isAfter(r,n)))},pn.isSame=function(e,t){var n,s=M(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=V(t)||"millisecond")?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},pn.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},pn.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},pn.isValid=function(){return g(this)},pn.lang=nn,pn.locale=tn,pn.localeData=sn,pn.max=Pt,pn.min=Nt,pn.parsingFlags=function(){return c({},y(this))},pn.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t,n=[];for(t in e)m(e,t)&&n.push({unit:t,priority:E[t]});return n.sort(function(e,t){return e.priority-t.priority}),n}(e=G(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(O(this[e=V(e)]))return this[e](t);return this},pn.startOf=function(e){var t,n;if(void 0===(e=V(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?un:on,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=an(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=an(t,6e4);break;case"second":t=this._d.valueOf(),t-=an(t,1e3);break}return this._d.setTime(t),f.updateOffset(this,!0),this},pn.subtract=Qt,pn.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},pn.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},pn.toDate=function(){return new Date(this.valueOf())},pn.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?U(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):O(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",U(n,"Z")):U(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},pn.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,n,s="moment",i="";return this.isLocal()||(s=0===this.utcOffset()?"moment.utc":"moment.parseZone",i="Z"),e="["+s+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=i+'[")]',this.format(e+t+"-MM-DD[T]HH:mm:ss.SSS"+n)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(pn[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),pn.toJSON=function(){return this.isValid()?this.toISOString():null},pn.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},pn.unix=function(){return Math.floor(this.valueOf()/1e3)},pn.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},pn.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},pn.eraName=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].name;if(t[n].until<=e&&e<=t[n].since)return t[n].name}return""},pn.eraNarrow=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].narrow;if(t[n].until<=e&&e<=t[n].since)return t[n].narrow}return""},pn.eraAbbr=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].abbr;if(t[n].until<=e&&e<=t[n].since)return t[n].abbr}return""},pn.eraYear=function(){for(var e,t,n=this.localeData().eras(),s=0,i=n.length;s<i;++s)if(e=n[s].since<=n[s].until?1:-1,t=this.clone().startOf("day").valueOf(),n[s].since<=t&&t<=n[s].until||n[s].until<=t&&t<=n[s].since)return(this.year()-f(n[s].since).year())*e+n[s].offset;return this.year()},pn.year=Le,pn.isLeapYear=function(){return j(this.year())},pn.weekYear=function(e){return cn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},pn.isoWeekYear=function(e){return cn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},pn.quarter=pn.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},pn.month=Ue,pn.daysInMonth=function(){return xe(this.year(),this.month())},pn.week=pn.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},pn.isoWeek=pn.isoWeeks=function(e){var t=Ae(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},pn.weeksInYear=function(){var e=this.localeData()._week;return je(this.year(),e.dow,e.doy)},pn.weeksInWeekYear=function(){var e=this.localeData()._week;return je(this.weekYear(),e.dow,e.doy)},pn.isoWeeksInYear=function(){return je(this.year(),1,4)},pn.isoWeeksInISOWeekYear=function(){return je(this.isoWeekYear(),1,4)},pn.date=fn,pn.day=pn.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},pn.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},pn.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null==e)return this.day()||7;var t,n,s=(t=e,n=this.localeData(),"string"==typeof t?n.weekdaysParse(t)%7||7:isNaN(t)?null:t);return this.day(this.day()%7?s:s-7)},pn.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},pn.hour=pn.hours=tt,pn.minute=pn.minutes=mn,pn.second=pn.seconds=gn,pn.millisecond=pn.milliseconds=yn,pn.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?i:Et(this);if("string"==typeof e){if(null===(e=Vt(he,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Et(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?Bt(this,Zt(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,f.updateOffset(this,!0),this._changeInProgress=null)),this},pn.utc=function(e){return this.utcOffset(0,e)},pn.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Et(this),"m")),this},pn.parseZone=function(){var e;return null!=this._tzm?this.utcOffset(this._tzm,!1,!0):"string"==typeof this._i&&(null!=(e=Vt(le,this._i))?this.utcOffset(e):this.utcOffset(0,!0)),this},pn.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},pn.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},pn.isLocal=function(){return!!this.isValid()&&!this._isUTC},pn.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},pn.isUtc=At,pn.isUTC=At,pn.zoneAbbr=function(){return this._isUTC?"UTC":""},pn.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},pn.dates=n("dates accessor is deprecated. Use date instead.",fn),pn.months=n("months accessor is deprecated. Use month instead",Ue),pn.years=n("years accessor is deprecated. Use year instead",Le),pn.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),pn.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!r(this._isDSTShifted))return this._isDSTShifted;var e,t={};return v(t,this),(t=bt(t))._a?(e=(t._isUTC?_:Tt)(t._a),this._isDSTShifted=this.isValid()&&0<function(e,t,n){for(var s=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),r=0,a=0;a<s;a++)(n&&e[a]!==t[a]||!n&&Z(e[a])!==Z(t[a]))&&r++;return r+i}(t._a,e.toArray())):this._isDSTShifted=!1,this._isDSTShifted});var kn=x.prototype;function Mn(e,t,n,s){var i=dt(),r=_().set(s,t);return i[n](r,e)}function Dn(e,t,n){if(h(e)&&(t=e,e=void 0),e=e||"",null!=t)return Mn(e,t,n,"month");for(var s=[],i=0;i<12;i++)s[i]=Mn(e,i,n,"month");return s}function Sn(e,t,n,s){t=("boolean"==typeof e?h(t)&&(n=t,t=void 0):(t=e,e=!1,h(n=t)&&(n=t,t=void 0)),t||"");var i,r=dt(),a=e?r._week.dow:0,o=[];if(null!=n)return Mn(t,(n+a)%7,s,"day");for(i=0;i<7;i++)o[i]=Mn(t,(i+a)%7,s,"day");return o}kn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return O(s)?s.call(t,n):s},kn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(N).map(function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},kn.invalidDate=function(){return this._invalidDate},kn.ordinal=function(e){return this._ordinal.replace("%d",e)},kn.preparse=vn,kn.postformat=vn,kn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return O(i)?i(e,t,n,s):i.replace(/%d/i,e)},kn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return O(n)?n(t):n.replace(/%s/i,t)},kn.set=function(e){var t,n;for(n in e)m(e,n)&&(O(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},kn.eras=function(e,t){for(var n,s=this._eras||dt("en")._eras,i=0,r=s.length;i<r;++i){switch(typeof s[i].since){case"string":n=f(s[i].since).startOf("day"),s[i].since=n.valueOf();break}switch(typeof s[i].until){case"undefined":s[i].until=1/0;break;case"string":n=f(s[i].until).startOf("day").valueOf(),s[i].until=n.valueOf();break}}return s},kn.erasParse=function(e,t,n){var s,i,r,a,o,u=this.eras();for(e=e.toUpperCase(),s=0,i=u.length;s<i;++s)if(r=u[s].name.toUpperCase(),a=u[s].abbr.toUpperCase(),o=u[s].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(a===e)return u[s];break;case"NNNN":if(r===e)return u[s];break;case"NNNNN":if(o===e)return u[s];break}else if(0<=[r,a,o].indexOf(e))return u[s]},kn.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?f(e.since).year():f(e.since).year()+(t-e.offset)*n},kn.erasAbbrRegex=function(e){return m(this,"_erasAbbrRegex")||hn.call(this),e?this._erasAbbrRegex:this._erasRegex},kn.erasNameRegex=function(e){return m(this,"_erasNameRegex")||hn.call(this),e?this._erasNameRegex:this._erasRegex},kn.erasNarrowRegex=function(e){return m(this,"_erasNarrowRegex")||hn.call(this),e?this._erasNarrowRegex:this._erasRegex},kn.months=function(e,t){return e?o(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Pe).test(t)?"format":"standalone"][e.month()]:o(this._months)?this._months:this._months.standalone},kn.monthsShort=function(e,t){return e?o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Pe.test(t)?"format":"standalone"][e.month()]:o(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},kn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=_([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=we.call(this._shortMonthsParse,a))?i:null:-1!==(i=we.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=we.call(this._shortMonthsParse,a))||-1!==(i=we.call(this._longMonthsParse,a))?i:null:-1!==(i=we.call(this._longMonthsParse,a))||-1!==(i=we.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=_([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},kn.monthsRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||He.call(this),e?this._monthsStrictRegex:this._monthsRegex):(m(this,"_monthsRegex")||(this._monthsRegex=We),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},kn.monthsShortRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||He.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(m(this,"_monthsShortRegex")||(this._monthsShortRegex=Re),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},kn.week=function(e){return Ae(e,this._week.dow,this._week.doy).week},kn.firstDayOfYear=function(){return this._week.doy},kn.firstDayOfWeek=function(){return this._week.dow},kn.weekdays=function(e,t){var n=o(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?Ie(n,this._week.dow):e?n[e.day()]:n},kn.weekdaysMin=function(e){return!0===e?Ie(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},kn.weekdaysShort=function(e){return!0===e?Ie(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},kn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=_([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=we.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=we.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=we.call(this._weekdaysParse,a))||-1!==(i=we.call(this._shortWeekdaysParse,a))||-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=we.call(this._shortWeekdaysParse,a))||-1!==(i=we.call(this._weekdaysParse,a))||-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:-1!==(i=we.call(this._minWeekdaysParse,a))||-1!==(i=we.call(this._weekdaysParse,a))||-1!==(i=we.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=_([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},kn.weekdaysRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(m(this,"_weekdaysRegex")||(this._weekdaysRegex=qe),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},kn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(m(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Be),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},kn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Qe.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(m(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},kn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},kn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},lt("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===Z(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th")}}),f.lang=n("moment.lang is deprecated. Use moment.locale instead.",lt),f.langData=n("moment.langData is deprecated. Use moment.localeData instead.",dt);var Yn=Math.abs;function On(e,t,n,s){var i=Zt(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function bn(e){return e<0?Math.floor(e):Math.ceil(e)}function xn(e){return 4800*e/146097}function Tn(e){return 146097*e/4800}function Nn(e){return function(){return this.as(e)}}var Pn=Nn("ms"),Rn=Nn("s"),Wn=Nn("m"),Cn=Nn("h"),Un=Nn("d"),Hn=Nn("w"),Fn=Nn("M"),Ln=Nn("Q"),Vn=Nn("y");function Gn(e){return function(){return this.isValid()?this._data[e]:NaN}}var En=Gn("milliseconds"),An=Gn("seconds"),jn=Gn("minutes"),In=Gn("hours"),Zn=Gn("days"),zn=Gn("months"),$n=Gn("years");var qn=Math.round,Bn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Jn(e,t,n,s){var i=Zt(e).abs(),r=qn(i.as("s")),a=qn(i.as("m")),o=qn(i.as("h")),u=qn(i.as("d")),l=qn(i.as("M")),h=qn(i.as("w")),d=qn(i.as("y")),c=(r<=n.ss?["s",r]:r<n.s&&["ss",r])||a<=1&&["m"]||a<n.m&&["mm",a]||o<=1&&["h"]||o<n.h&&["hh",o]||u<=1&&["d"]||u<n.d&&["dd",u];return null!=n.w&&(c=c||h<=1&&["w"]||h<n.w&&["ww",h]),(c=c||l<=1&&["M"]||l<n.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=t,c[3]=0<+e,c[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,c)}var Qn=Math.abs;function Xn(e){return(0<e)-(e<0)||+e}function Kn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,s,i,r,a,o,u=Qn(this._milliseconds)/1e3,l=Qn(this._days),h=Qn(this._months),d=this.asSeconds();return d?(e=I(u/60),t=I(e/60),u%=60,e%=60,n=I(h/12),h%=12,s=u?u.toFixed(3).replace(/\.?0+$/,""):"",i=d<0?"-":"",r=Xn(this._months)!==Xn(d)?"-":"",a=Xn(this._days)!==Xn(d)?"-":"",o=Xn(this._milliseconds)!==Xn(d)?"-":"",i+"P"+(n?r+n+"Y":"")+(h?r+h+"M":"")+(l?a+l+"D":"")+(t||e||u?"T":"")+(t?o+t+"H":"")+(e?o+e+"M":"")+(u?o+s+"S":"")):"P0D"}var es=Ct.prototype;return es.isValid=function(){return this._isValid},es.abs=function(){var e=this._data;return this._milliseconds=Yn(this._milliseconds),this._days=Yn(this._days),this._months=Yn(this._months),e.milliseconds=Yn(e.milliseconds),e.seconds=Yn(e.seconds),e.minutes=Yn(e.minutes),e.hours=Yn(e.hours),e.months=Yn(e.months),e.years=Yn(e.years),this},es.add=function(e,t){return On(this,e,t,1)},es.subtract=function(e,t){return On(this,e,t,-1)},es.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=V(e))||"quarter"===e||"year"===e)switch(t=this._days+s/864e5,n=this._months+xn(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(Tn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},es.asMilliseconds=Pn,es.asSeconds=Rn,es.asMinutes=Wn,es.asHours=Cn,es.asDays=Un,es.asWeeks=Hn,es.asMonths=Fn,es.asQuarters=Ln,es.asYears=Vn,es.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*Z(this._months/12):NaN},es._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,u=this._data;return 0<=r&&0<=a&&0<=o||r<=0&&a<=0&&o<=0||(r+=864e5*bn(Tn(o)+a),o=a=0),u.milliseconds=r%1e3,e=I(r/1e3),u.seconds=e%60,t=I(e/60),u.minutes=t%60,n=I(t/60),u.hours=n%24,a+=I(n/24),o+=i=I(xn(a)),a-=bn(Tn(i)),s=I(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},es.clone=function(){return Zt(this)},es.get=function(e){return e=V(e),this.isValid()?this[e+"s"]():NaN},es.milliseconds=En,es.seconds=An,es.minutes=jn,es.hours=In,es.days=Zn,es.weeks=function(){return I(this.days()/7)},es.months=zn,es.years=$n,es.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n,s,i=!1,r=Bn;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(i=e),"object"==typeof t&&(r=Object.assign({},Bn,t),null!=t.s&&null==t.ss&&(r.ss=t.s-1)),n=this.localeData(),s=Jn(this,!i,r,n),i&&(s=n.pastFuture(+this,s)),n.postformat(s)},es.toISOString=Kn,es.toString=Kn,es.toJSON=Kn,es.locale=tn,es.localeData=sn,es.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Kn),es.lang=nn,C("X",0,0,"unix"),C("x",0,0,"valueOf"),ce("x",ue),ce("X",/[+-]?\d+(\.\d{1,3})?/),ye("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e))}),ye("x",function(e,t,n){n._d=new Date(Z(e))}),f.version="2.29.1",e=Tt,f.fn=pn,f.min=function(){return Rt("isBefore",[].slice.call(arguments,0))},f.max=function(){return Rt("isAfter",[].slice.call(arguments,0))},f.now=function(){return Date.now?Date.now():+new Date},f.utc=_,f.unix=function(e){return Tt(1e3*e)},f.months=function(e,t){return Dn(e,t,"months")},f.isDate=a,f.locale=lt,f.invalid=w,f.duration=Zt,f.isMoment=M,f.weekdays=function(e,t,n){return Sn(e,t,n,"weekdays")},f.parseZone=function(){return Tt.apply(null,arguments).parseZone()},f.localeData=dt,f.isDuration=Ut,f.monthsShort=function(e,t){return Dn(e,t,"monthsShort")},f.weekdaysMin=function(e,t,n){return Sn(e,t,n,"weekdaysMin")},f.defineLocale=ht,f.updateLocale=function(e,t){var n,s,i;return null!=t?(i=st,null!=it[e]&&null!=it[e].parentLocale?it[e].set(b(it[e]._config,t)):(null!=(s=ut(e))&&(i=s._config),t=b(i,t),null==s&&(t.abbr=e),(n=new x(t)).parentLocale=it[e],it[e]=n),lt(e)):null!=it[e]&&(null!=it[e].parentLocale?(it[e]=it[e].parentLocale,e===lt()&&lt(e)):null!=it[e]&&delete it[e]),it[e]},f.locales=function(){return s(it)},f.weekdaysShort=function(e,t,n){return Sn(e,t,n,"weekdaysShort")},f.normalizeUnits=V,f.relativeTimeRounding=function(e){return void 0===e?qn:"function"==typeof e&&(qn=e,!0)},f.relativeTimeThreshold=function(e,t){return void 0!==Bn[e]&&(void 0===t?Bn[e]:(Bn[e]=t,"s"===e&&(Bn.ss=t-1),!0))},f.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},f.prototype=pn,f.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},f});
+!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var H;function f(){return H.apply(null,arguments)}function a(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function F(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(c(e,t))return;return 1}function o(e){return void 0===e}function u(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function V(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function G(e,t){for(var n=[],s=e.length,i=0;i<s;++i)n.push(t(e[i],i));return n}function E(e,t){for(var n in t)c(t,n)&&(e[n]=t[n]);return c(t,"toString")&&(e.toString=t.toString),c(t,"valueOf")&&(e.valueOf=t.valueOf),e}function l(e,t,n,s){return Pt(e,t,n,s,!0).utc()}function m(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function A(e){if(null==e._isValid){var t=m(e),n=j.call(t.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function I(e){var t=l(NaN);return null!=e?E(m(t),e):m(t).userInvalidated=!0,t}var j=Array.prototype.some||function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1},Z=f.momentProperties=[],z=!1;function $(e,t){var n,s,i,r=Z.length;if(o(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),o(t._i)||(e._i=t._i),o(t._f)||(e._f=t._f),o(t._l)||(e._l=t._l),o(t._strict)||(e._strict=t._strict),o(t._tzm)||(e._tzm=t._tzm),o(t._isUTC)||(e._isUTC=t._isUTC),o(t._offset)||(e._offset=t._offset),o(t._pf)||(e._pf=m(t)),o(t._locale)||(e._locale=t._locale),0<r)for(n=0;n<r;n++)o(i=t[s=Z[n]])||(e[s]=i);return e}function q(e){$(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===z&&(z=!0,f.updateOffset(this),z=!1)}function h(e){return e instanceof q||null!=e&&null!=e._isAMomentObject}function B(e){!1===f.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function e(r,a){var o=!0;return E(function(){if(null!=f.deprecationHandler&&f.deprecationHandler(null,r),o){for(var e,t,n=[],s=arguments.length,i=0;i<s;i++){if(e="","object"==typeof arguments[i]){for(t in e+="\n["+i+"] ",arguments[0])c(arguments[0],t)&&(e+=t+": "+arguments[0][t]+", ");e=e.slice(0,-2)}else e=arguments[i];n.push(e)}B(r+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),o=!1}return a.apply(this,arguments)},a)}var J={};function Q(e,t){null!=f.deprecationHandler&&f.deprecationHandler(e,t),J[e]||(B(t),J[e]=!0)}function d(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function X(e,t){var n,s=E({},e);for(n in t)c(t,n)&&(F(e[n])&&F(t[n])?(s[n]={},E(s[n],e[n]),E(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)c(e,n)&&!c(t,n)&&F(e[n])&&(s[n]=E({},s[n]));return s}function K(e){null!=e&&this.set(e)}f.suppressDeprecationWarnings=!1,f.deprecationHandler=null;var ee=Object.keys||function(e){var t,n=[];for(t in e)c(e,t)&&n.push(t);return n};function r(e,t,n){var s=""+Math.abs(e);return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,t-s.length)).toString().substr(1)+s}var te=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,ne=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,se={},ie={};function s(e,t,n,s){var i="string"==typeof s?function(){return this[s]()}:s;e&&(ie[e]=i),t&&(ie[t[0]]=function(){return r(i.apply(this,arguments),t[1],t[2])}),n&&(ie[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function re(e,t){return e.isValid()?(t=ae(t,e.localeData()),se[t]=se[t]||function(s){for(var e,i=s.match(te),t=0,r=i.length;t<r;t++)ie[i[t]]?i[t]=ie[i[t]]:i[t]=(e=i[t]).match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"");return function(e){for(var t="",n=0;n<r;n++)t+=d(i[n])?i[n].call(e,s):i[n];return t}}(t),se[t](e)):e.localeData().invalidDate()}function ae(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(ne.lastIndex=0;0<=n&&ne.test(e);)e=e.replace(ne,s),ne.lastIndex=0,--n;return e}var oe={};function t(e,t){var n=e.toLowerCase();oe[n]=oe[n+"s"]=oe[t]=e}function _(e){return"string"==typeof e?oe[e]||oe[e.toLowerCase()]:void 0}function ue(e){var t,n,s={};for(n in e)c(e,n)&&(t=_(n))&&(s[t]=e[n]);return s}var le={};function n(e,t){le[e]=t}function he(e){return e%4==0&&e%100!=0||e%400==0}function y(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function g(e){var e=+e,t=0;return t=0!=e&&isFinite(e)?y(e):t}function de(t,n){return function(e){return null!=e?(fe(this,t,e),f.updateOffset(this,n),this):ce(this,t)}}function ce(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function fe(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&he(e.year())&&1===e.month()&&29===e.date()?(n=g(n),e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),We(n,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](n))}var i=/\d/,w=/\d\d/,me=/\d{3}/,_e=/\d{4}/,ye=/[+-]?\d{6}/,p=/\d\d?/,ge=/\d\d\d\d?/,we=/\d\d\d\d\d\d?/,pe=/\d{1,3}/,ke=/\d{1,4}/,ve=/[+-]?\d{1,6}/,Me=/\d+/,De=/[+-]?\d+/,Se=/Z|[+-]\d\d:?\d\d/gi,Ye=/Z|[+-]\d\d(?::?\d\d)?/gi,k=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function v(e,n,s){be[e]=d(n)?n:function(e,t){return e&&s?s:n}}function Oe(e,t){return c(be,e)?be[e](t._strict,t._locale):new RegExp(M(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function M(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var be={},xe={};function D(e,n){var t,s,i=n;for("string"==typeof e&&(e=[e]),u(n)&&(i=function(e,t){t[n]=g(e)}),s=e.length,t=0;t<s;t++)xe[e[t]]=i}function Te(e,i){D(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}var S,Y=0,O=1,b=2,x=3,T=4,N=5,Ne=6,Pe=7,Re=8;function We(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=(t%(n=12)+n)%n;return e+=(t-n)/12,1==n?he(e)?29:28:31-n%7%2}S=Array.prototype.indexOf||function(e){for(var t=0;t<this.length;++t)if(this[t]===e)return t;return-1},s("M",["MM",2],"Mo",function(){return this.month()+1}),s("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),s("MMMM",0,0,function(e){return this.localeData().months(this,e)}),t("month","M"),n("month",8),v("M",p),v("MM",p,w),v("MMM",function(e,t){return t.monthsShortRegex(e)}),v("MMMM",function(e,t){return t.monthsRegex(e)}),D(["M","MM"],function(e,t){t[O]=g(e)-1}),D(["MMM","MMMM"],function(e,t,n,s){s=n._locale.monthsParse(e,s,n._strict);null!=s?t[O]=s:m(n).invalidMonth=e});var Ce="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ue="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),He=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Fe=k,Le=k;function Ve(e,t){var n;if(e.isValid()){if("string"==typeof t)if(/^\d+$/.test(t))t=g(t);else if(!u(t=e.localeData().monthsParse(t)))return;n=Math.min(e.date(),We(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n)}}function Ge(e){return null!=e?(Ve(this,e),f.updateOffset(this,!0),this):ce(this,"Month")}function Ee(){function e(e,t){return t.length-e.length}for(var t,n=[],s=[],i=[],r=0;r<12;r++)t=l([2e3,r]),n.push(this.monthsShort(t,"")),s.push(this.months(t,"")),i.push(this.months(t,"")),i.push(this.monthsShort(t,""));for(n.sort(e),s.sort(e),i.sort(e),r=0;r<12;r++)n[r]=M(n[r]),s[r]=M(s[r]);for(r=0;r<24;r++)i[r]=M(i[r]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function Ae(e){return he(e)?366:365}s("Y",0,0,function(){var e=this.year();return e<=9999?r(e,4):"+"+e}),s(0,["YY",2],0,function(){return this.year()%100}),s(0,["YYYY",4],0,"year"),s(0,["YYYYY",5],0,"year"),s(0,["YYYYYY",6,!0],0,"year"),t("year","y"),n("year",1),v("Y",De),v("YY",p,w),v("YYYY",ke,_e),v("YYYYY",ve,ye),v("YYYYYY",ve,ye),D(["YYYYY","YYYYYY"],Y),D("YYYY",function(e,t){t[Y]=2===e.length?f.parseTwoDigitYear(e):g(e)}),D("YY",function(e,t){t[Y]=f.parseTwoDigitYear(e)}),D("Y",function(e,t){t[Y]=parseInt(e,10)}),f.parseTwoDigitYear=function(e){return g(e)+(68<g(e)?1900:2e3)};var Ie=de("FullYear",!0);function je(e,t,n,s,i,r,a){var o;return e<100&&0<=e?(o=new Date(e+400,t,n,s,i,r,a),isFinite(o.getFullYear())&&o.setFullYear(e)):o=new Date(e,t,n,s,i,r,a),o}function Ze(e){var t;return e<100&&0<=e?((t=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,t)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function ze(e,t,n){n=7+t-n;return n-(7+Ze(e,0,n).getUTCDay()-t)%7-1}function $e(e,t,n,s,i){var r,t=1+7*(t-1)+(7+n-s)%7+ze(e,s,i),n=t<=0?Ae(r=e-1)+t:t>Ae(e)?(r=e+1,t-Ae(e)):(r=e,t);return{year:r,dayOfYear:n}}function qe(e,t,n){var s,i,r=ze(e.year(),t,n),r=Math.floor((e.dayOfYear()-r-1)/7)+1;return r<1?s=r+P(i=e.year()-1,t,n):r>P(e.year(),t,n)?(s=r-P(e.year(),t,n),i=e.year()+1):(i=e.year(),s=r),{week:s,year:i}}function P(e,t,n){var s=ze(e,t,n),t=ze(e+1,t,n);return(Ae(e)-s+t)/7}s("w",["ww",2],"wo","week"),s("W",["WW",2],"Wo","isoWeek"),t("week","w"),t("isoWeek","W"),n("week",5),n("isoWeek",5),v("w",p),v("ww",p,w),v("W",p),v("WW",p,w),Te(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=g(e)});function Be(e,t){return e.slice(t,7).concat(e.slice(0,t))}s("d",0,"do","day"),s("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),s("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),s("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),s("e",0,0,"weekday"),s("E",0,0,"isoWeekday"),t("day","d"),t("weekday","e"),t("isoWeekday","E"),n("day",11),n("weekday",11),n("isoWeekday",11),v("d",p),v("e",p),v("E",p),v("dd",function(e,t){return t.weekdaysMinRegex(e)}),v("ddd",function(e,t){return t.weekdaysShortRegex(e)}),v("dddd",function(e,t){return t.weekdaysRegex(e)}),Te(["dd","ddd","dddd"],function(e,t,n,s){s=n._locale.weekdaysParse(e,s,n._strict);null!=s?t.d=s:m(n).invalidWeekday=e}),Te(["d","e","E"],function(e,t,n,s){t[s]=g(e)});var Je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Qe="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Xe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ke=k,et=k,tt=k;function nt(){function e(e,t){return t.length-e.length}for(var t,n,s,i=[],r=[],a=[],o=[],u=0;u<7;u++)s=l([2e3,1]).day(u),t=M(this.weekdaysMin(s,"")),n=M(this.weekdaysShort(s,"")),s=M(this.weekdays(s,"")),i.push(t),r.push(n),a.push(s),o.push(t),o.push(n),o.push(s);i.sort(e),r.sort(e),a.sort(e),o.sort(e),this._weekdaysRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function st(){return this.hours()%12||12}function it(e,t){s(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function rt(e,t){return t._meridiemParse}s("H",["HH",2],0,"hour"),s("h",["hh",2],0,st),s("k",["kk",2],0,function(){return this.hours()||24}),s("hmm",0,0,function(){return""+st.apply(this)+r(this.minutes(),2)}),s("hmmss",0,0,function(){return""+st.apply(this)+r(this.minutes(),2)+r(this.seconds(),2)}),s("Hmm",0,0,function(){return""+this.hours()+r(this.minutes(),2)}),s("Hmmss",0,0,function(){return""+this.hours()+r(this.minutes(),2)+r(this.seconds(),2)}),it("a",!0),it("A",!1),t("hour","h"),n("hour",13),v("a",rt),v("A",rt),v("H",p),v("h",p),v("k",p),v("HH",p,w),v("hh",p,w),v("kk",p,w),v("hmm",ge),v("hmmss",we),v("Hmm",ge),v("Hmmss",we),D(["H","HH"],x),D(["k","kk"],function(e,t,n){e=g(e);t[x]=24===e?0:e}),D(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),D(["h","hh"],function(e,t,n){t[x]=g(e),m(n).bigHour=!0}),D("hmm",function(e,t,n){var s=e.length-2;t[x]=g(e.substr(0,s)),t[T]=g(e.substr(s)),m(n).bigHour=!0}),D("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[x]=g(e.substr(0,s)),t[T]=g(e.substr(s,2)),t[N]=g(e.substr(i)),m(n).bigHour=!0}),D("Hmm",function(e,t,n){var s=e.length-2;t[x]=g(e.substr(0,s)),t[T]=g(e.substr(s))}),D("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[x]=g(e.substr(0,s)),t[T]=g(e.substr(s,2)),t[N]=g(e.substr(i))});k=de("Hours",!0);var at,ot={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Ce,monthsShort:Ue,week:{dow:0,doy:6},weekdays:Je,weekdaysMin:Xe,weekdaysShort:Qe,meridiemParse:/[ap]\.?m?\.?/i},R={},ut={};function lt(e){return e&&e.toLowerCase().replace("_","-")}function ht(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=lt(e[r]).split("-")).length,n=(n=lt(e[r+1]))?n.split("-"):null;0<t;){if(s=dt(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&function(e,t){for(var n=Math.min(e.length,t.length),s=0;s<n;s+=1)if(e[s]!==t[s])return s;return n}(i,n)>=t-1)break;t--}r++}return at}function dt(t){var e;if(void 0===R[t]&&"undefined"!=typeof module&&module&&module.exports&&null!=t.match("^[^/\\\\]*$"))try{e=at._abbr,require("./locale/"+t),ct(e)}catch(e){R[t]=null}return R[t]}function ct(e,t){return e&&((t=o(t)?mt(e):ft(e,t))?at=t:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),at._abbr}function ft(e,t){if(null===t)return delete R[e],null;var n,s=ot;if(t.abbr=e,null!=R[e])Q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=R[e]._config;else if(null!=t.parentLocale)if(null!=R[t.parentLocale])s=R[t.parentLocale]._config;else{if(null==(n=dt(t.parentLocale)))return ut[t.parentLocale]||(ut[t.parentLocale]=[]),ut[t.parentLocale].push({name:e,config:t}),null;s=n._config}return R[e]=new K(X(s,t)),ut[e]&&ut[e].forEach(function(e){ft(e.name,e.config)}),ct(e),R[e]}function mt(e){var t;if(!(e=e&&e._locale&&e._locale._abbr?e._locale._abbr:e))return at;if(!a(e)){if(t=dt(e))return t;e=[e]}return ht(e)}function _t(e){var t=e._a;return t&&-2===m(e).overflow&&(t=t[O]<0||11<t[O]?O:t[b]<1||t[b]>We(t[Y],t[O])?b:t[x]<0||24<t[x]||24===t[x]&&(0!==t[T]||0!==t[N]||0!==t[Ne])?x:t[T]<0||59<t[T]?T:t[N]<0||59<t[N]?N:t[Ne]<0||999<t[Ne]?Ne:-1,m(e)._overflowDayOfYear&&(t<Y||b<t)&&(t=b),m(e)._overflowWeeks&&-1===t&&(t=Pe),m(e)._overflowWeekday&&-1===t&&(t=Re),m(e).overflow=t),e}var yt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,wt=/Z|[+-]\d\d(?::?\d\d)?/,pt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],kt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],vt=/^\/?Date\((-?\d+)/i,Mt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Dt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function St(e){var t,n,s,i,r,a,o=e._i,u=yt.exec(o)||gt.exec(o),o=pt.length,l=kt.length;if(u){for(m(e).iso=!0,t=0,n=o;t<n;t++)if(pt[t][1].exec(u[1])){i=pt[t][0],s=!1!==pt[t][2];break}if(null==i)e._isValid=!1;else{if(u[3]){for(t=0,n=l;t<n;t++)if(kt[t][1].exec(u[3])){r=(u[2]||" ")+kt[t][0];break}if(null==r)return void(e._isValid=!1)}if(s||null==r){if(u[4]){if(!wt.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),Tt(e)}else e._isValid=!1}}else e._isValid=!1}function Yt(e,t,n,s,i,r){e=[function(e){e=parseInt(e,10);{if(e<=49)return 2e3+e;if(e<=999)return 1900+e}return e}(e),Ue.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&e.push(parseInt(r,10)),e}function Ot(e){var t,n,s,i,r=Mt.exec(e._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));r?(t=Yt(r[4],r[3],r[2],r[5],r[6],r[7]),n=r[1],s=t,i=e,n&&Qe.indexOf(n)!==new Date(s[0],s[1],s[2]).getDay()?(m(i).weekdayMismatch=!0,i._isValid=!1):(e._a=t,e._tzm=(n=r[8],s=r[9],i=r[10],n?Dt[n]:s?0:60*(((n=parseInt(i,10))-(s=n%100))/100)+s),e._d=Ze.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),m(e).rfc2822=!0)):e._isValid=!1}function bt(e,t,n){return null!=e?e:null!=t?t:n}function xt(e){var t,n,s,i,r,a,o,u,l,h,d,c=[];if(!e._d){for(s=e,i=new Date(f.now()),n=s._useUTC?[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()]:[i.getFullYear(),i.getMonth(),i.getDate()],e._w&&null==e._a[b]&&null==e._a[O]&&(null!=(i=(s=e)._w).GG||null!=i.W||null!=i.E?(u=1,l=4,r=bt(i.GG,s._a[Y],qe(W(),1,4).year),a=bt(i.W,1),((o=bt(i.E,1))<1||7<o)&&(h=!0)):(u=s._locale._week.dow,l=s._locale._week.doy,d=qe(W(),u,l),r=bt(i.gg,s._a[Y],d.year),a=bt(i.w,d.week),null!=i.d?((o=i.d)<0||6<o)&&(h=!0):null!=i.e?(o=i.e+u,(i.e<0||6<i.e)&&(h=!0)):o=u),a<1||a>P(r,u,l)?m(s)._overflowWeeks=!0:null!=h?m(s)._overflowWeekday=!0:(d=$e(r,a,o,u,l),s._a[Y]=d.year,s._dayOfYear=d.dayOfYear)),null!=e._dayOfYear&&(i=bt(e._a[Y],n[Y]),(e._dayOfYear>Ae(i)||0===e._dayOfYear)&&(m(e)._overflowDayOfYear=!0),h=Ze(i,0,e._dayOfYear),e._a[O]=h.getUTCMonth(),e._a[b]=h.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=c[t]=n[t];for(;t<7;t++)e._a[t]=c[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[x]&&0===e._a[T]&&0===e._a[N]&&0===e._a[Ne]&&(e._nextDay=!0,e._a[x]=0),e._d=(e._useUTC?Ze:je).apply(null,c),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[x]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(m(e).weekdayMismatch=!0)}}function Tt(e){if(e._f===f.ISO_8601)St(e);else if(e._f===f.RFC_2822)Ot(e);else{e._a=[],m(e).empty=!0;for(var t,n,s,i,r,a=""+e._i,o=a.length,u=0,l=ae(e._f,e._locale).match(te)||[],h=l.length,d=0;d<h;d++)n=l[d],(t=(a.match(Oe(n,e))||[])[0])&&(0<(s=a.substr(0,a.indexOf(t))).length&&m(e).unusedInput.push(s),a=a.slice(a.indexOf(t)+t.length),u+=t.length),ie[n]?(t?m(e).empty=!1:m(e).unusedTokens.push(n),s=n,r=e,null!=(i=t)&&c(xe,s)&&xe[s](i,r._a,r,s)):e._strict&&!t&&m(e).unusedTokens.push(n);m(e).charsLeftOver=o-u,0<a.length&&m(e).unusedInput.push(a),e._a[x]<=12&&!0===m(e).bigHour&&0<e._a[x]&&(m(e).bigHour=void 0),m(e).parsedDateParts=e._a.slice(0),m(e).meridiem=e._meridiem,e._a[x]=function(e,t,n){if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((e=e.isPM(n))&&t<12&&(t+=12),t=e||12!==t?t:0):t}(e._locale,e._a[x],e._meridiem),null!==(o=m(e).era)&&(e._a[Y]=e._locale.erasConvertYear(o,e._a[Y])),xt(e),_t(e)}}function Nt(e){var t,n,s,i=e._i,r=e._f;if(e._locale=e._locale||mt(e._l),null===i||void 0===r&&""===i)return I({nullInput:!0});if("string"==typeof i&&(e._i=i=e._locale.preparse(i)),h(i))return new q(_t(i));if(V(i))e._d=i;else if(a(r))!function(e){var t,n,s,i,r,a,o=!1,u=e._f.length;if(0===u)return m(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<u;i++)r=0,a=!1,t=$({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Tt(t),A(t)&&(a=!0),r=(r+=m(t).charsLeftOver)+10*m(t).unusedTokens.length,m(t).score=r,o?r<s&&(s=r,n=t):(null==s||r<s||a)&&(s=r,n=t,a&&(o=!0));E(e,n||t)}(e);else if(r)Tt(e);else if(o(r=(i=e)._i))i._d=new Date(f.now());else V(r)?i._d=new Date(r.valueOf()):"string"==typeof r?(n=i,null!==(t=vt.exec(n._i))?n._d=new Date(+t[1]):(St(n),!1===n._isValid&&(delete n._isValid,Ot(n),!1===n._isValid&&(delete n._isValid,n._strict?n._isValid=!1:f.createFromInputFallback(n))))):a(r)?(i._a=G(r.slice(0),function(e){return parseInt(e,10)}),xt(i)):F(r)?(t=i)._d||(s=void 0===(n=ue(t._i)).day?n.date:n.day,t._a=G([n.year,n.month,s,n.hour,n.minute,n.second,n.millisecond],function(e){return e&&parseInt(e,10)}),xt(t)):u(r)?i._d=new Date(r):f.createFromInputFallback(i);return A(e)||(e._d=null),e}function Pt(e,t,n,s,i){var r={};return!0!==t&&!1!==t||(s=t,t=void 0),!0!==n&&!1!==n||(s=n,n=void 0),(F(e)&&L(e)||a(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=i,r._l=n,r._i=e,r._f=t,r._strict=s,(i=new q(_t(Nt(i=r))))._nextDay&&(i.add(1,"d"),i._nextDay=void 0),i}function W(e,t,n,s){return Pt(e,t,n,s,!1)}f.createFromInputFallback=e("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),f.ISO_8601=function(){},f.RFC_2822=function(){};ge=e("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=W.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:I()}),we=e("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=W.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:I()});function Rt(e,t){var n,s;if(!(t=1===t.length&&a(t[0])?t[0]:t).length)return W();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ct(e){var e=ue(e),t=e.year||0,n=e.quarter||0,s=e.month||0,i=e.week||e.isoWeek||0,r=e.day||0,a=e.hour||0,o=e.minute||0,u=e.second||0,l=e.millisecond||0;this._isValid=function(e){var t,n,s=!1,i=Wt.length;for(t in e)if(c(e,t)&&(-1===S.call(Wt,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<i;++n)if(e[Wt[n]]){if(s)return!1;parseFloat(e[Wt[n]])!==g(e[Wt[n]])&&(s=!0)}return!0}(e),this._milliseconds=+l+1e3*u+6e4*o+1e3*a*60*60,this._days=+r+7*i,this._months=+s+3*n+12*t,this._data={},this._locale=mt(),this._bubble()}function Ut(e){return e instanceof Ct}function Ht(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){s(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+r(~~(e/60),2)+n+r(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),v("Z",Ye),v("ZZ",Ye),D(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Vt(Ye,e)});var Lt=/([\+\-]|\d\d)/gi;function Vt(e,t){var t=(t||"").match(e);return null===t?null:0===(t=60*(e=((t[t.length-1]||[])+"").match(Lt)||["-",0,0])[1]+g(e[2]))?0:"+"===e[0]?t:-t}function Gt(e,t){var n;return t._isUTC?(t=t.clone(),n=(h(e)||V(e)?e:W(e)).valueOf()-t.valueOf(),t._d.setTime(t._d.valueOf()+n),f.updateOffset(t,!1),t):W(e).local()}function Et(e){return-Math.round(e._d.getTimezoneOffset())}function At(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}f.updateOffset=function(){};var It=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,jt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function C(e,t){var n,s=e,i=null;return Ut(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:u(e)||!isNaN(+e)?(s={},t?s[t]=+e:s.milliseconds=+e):(i=It.exec(e))?(n="-"===i[1]?-1:1,s={y:0,d:g(i[b])*n,h:g(i[x])*n,m:g(i[T])*n,s:g(i[N])*n,ms:g(Ht(1e3*i[Ne]))*n}):(i=jt.exec(e))?(n="-"===i[1]?-1:1,s={y:Zt(i[2],n),M:Zt(i[3],n),w:Zt(i[4],n),d:Zt(i[5],n),h:Zt(i[6],n),m:Zt(i[7],n),s:Zt(i[8],n)}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(t=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Gt(t,e),e.isBefore(t)?n=zt(e,t):((n=zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(W(s.from),W(s.to)),(s={}).ms=t.milliseconds,s.M=t.months),i=new Ct(s),Ut(e)&&c(e,"_locale")&&(i._locale=e._locale),Ut(e)&&c(e,"_isValid")&&(i._isValid=e._isValid),i}function Zt(e,t){e=e&&parseFloat(e.replace(",","."));return(isNaN(e)?0:e)*t}function zt(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function $t(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(Q(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),qt(this,C(e,t),s),this}}function qt(e,t,n,s){var i=t._milliseconds,r=Ht(t._days),t=Ht(t._months);e.isValid()&&(s=null==s||s,t&&Ve(e,ce(e,"Month")+t*n),r&&fe(e,"Date",ce(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&f.updateOffset(e,r||t))}C.fn=Ct.prototype,C.invalid=function(){return C(NaN)};Ce=$t(1,"add"),Je=$t(-1,"subtract");function Bt(e){return"string"==typeof e||e instanceof String}function Jt(e){return h(e)||V(e)||Bt(e)||u(e)||function(t){var e=a(t),n=!1;e&&(n=0===t.filter(function(e){return!u(e)&&Bt(t)}).length);return e&&n}(e)||function(e){var t,n,s=F(e)&&!L(e),i=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],a=r.length;for(t=0;t<a;t+=1)n=r[t],i=i||c(e,n);return s&&i}(e)||null==e}function Qt(e,t){if(e.date()<t.date())return-Qt(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months"),t=t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(1+n,"months")-s);return-(n+t)||0}function Xt(e){return void 0===e?this._locale._abbr:(null!=(e=mt(e))&&(this._locale=e),this)}f.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",f.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";Xe=e("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}var en=126227808e5;function tn(e,t){return(e%t+t)%t}function nn(e,t,n){return e<100&&0<=e?new Date(e+400,t,n)-en:new Date(e,t,n).valueOf()}function sn(e,t,n){return e<100&&0<=e?Date.UTC(e+400,t,n)-en:Date.UTC(e,t,n)}function rn(e,t){return t.erasAbbrRegex(e)}function an(){for(var e=[],t=[],n=[],s=[],i=this.eras(),r=0,a=i.length;r<a;++r)t.push(M(i[r].name)),e.push(M(i[r].abbr)),n.push(M(i[r].narrow)),s.push(M(i[r].name)),s.push(M(i[r].abbr)),s.push(M(i[r].narrow));this._erasRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+n.join("|")+")","i")}function on(e,t){s(0,[e,e.length],0,t)}function un(e,t,n,s,i){var r;return null==e?qe(this,s,i).year:(r=P(e,s,i),function(e,t,n,s,i){e=$e(e,t,n,s,i),t=Ze(e.year,0,e.dayOfYear);return this.year(t.getUTCFullYear()),this.month(t.getUTCMonth()),this.date(t.getUTCDate()),this}.call(this,e,t=r<t?r:t,n,s,i))}s("N",0,0,"eraAbbr"),s("NN",0,0,"eraAbbr"),s("NNN",0,0,"eraAbbr"),s("NNNN",0,0,"eraName"),s("NNNNN",0,0,"eraNarrow"),s("y",["y",1],"yo","eraYear"),s("y",["yy",2],0,"eraYear"),s("y",["yyy",3],0,"eraYear"),s("y",["yyyy",4],0,"eraYear"),v("N",rn),v("NN",rn),v("NNN",rn),v("NNNN",function(e,t){return t.erasNameRegex(e)}),v("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),D(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,s){s=n._locale.erasParse(e,s,n._strict);s?m(n).era=s:m(n).invalidEra=e}),v("y",Me),v("yy",Me),v("yyy",Me),v("yyyy",Me),v("yo",function(e,t){return t._eraYearOrdinalRegex||Me}),D(["y","yy","yyy","yyyy"],Y),D(["yo"],function(e,t,n,s){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[Y]=n._locale.eraYearOrdinalParse(e,i):t[Y]=parseInt(e,10)}),s(0,["gg",2],0,function(){return this.weekYear()%100}),s(0,["GG",2],0,function(){return this.isoWeekYear()%100}),on("gggg","weekYear"),on("ggggg","weekYear"),on("GGGG","isoWeekYear"),on("GGGGG","isoWeekYear"),t("weekYear","gg"),t("isoWeekYear","GG"),n("weekYear",1),n("isoWeekYear",1),v("G",De),v("g",De),v("GG",p,w),v("gg",p,w),v("GGGG",ke,_e),v("gggg",ke,_e),v("GGGGG",ve,ye),v("ggggg",ve,ye),Te(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=g(e)}),Te(["gg","GG"],function(e,t,n,s){t[s]=f.parseTwoDigitYear(e)}),s("Q",0,"Qo","quarter"),t("quarter","Q"),n("quarter",7),v("Q",i),D("Q",function(e,t){t[O]=3*(g(e)-1)}),s("D",["DD",2],"Do","date"),t("date","D"),n("date",9),v("D",p),v("DD",p,w),v("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),D(["D","DD"],b),D("Do",function(e,t){t[b]=g(e.match(p)[0])});ke=de("Date",!0);s("DDD",["DDDD",3],"DDDo","dayOfYear"),t("dayOfYear","DDD"),n("dayOfYear",4),v("DDD",pe),v("DDDD",me),D(["DDD","DDDD"],function(e,t,n){n._dayOfYear=g(e)}),s("m",["mm",2],0,"minute"),t("minute","m"),n("minute",14),v("m",p),v("mm",p,w),D(["m","mm"],T);var ln,_e=de("Minutes",!1),ve=(s("s",["ss",2],0,"second"),t("second","s"),n("second",15),v("s",p),v("ss",p,w),D(["s","ss"],N),de("Seconds",!1));for(s("S",0,0,function(){return~~(this.millisecond()/100)}),s(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),s(0,["SSS",3],0,"millisecond"),s(0,["SSSS",4],0,function(){return 10*this.millisecond()}),s(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),s(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),s(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),s(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),s(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),t("millisecond","ms"),n("millisecond",16),v("S",pe,i),v("SS",pe,w),v("SSS",pe,me),ln="SSSS";ln.length<=9;ln+="S")v(ln,Me);function hn(e,t){t[Ne]=g(1e3*("0."+e))}for(ln="S";ln.length<=9;ln+="S")D(ln,hn);ye=de("Milliseconds",!1),s("z",0,0,"zoneAbbr"),s("zz",0,0,"zoneName");i=q.prototype;function dn(e){return e}i.add=Ce,i.calendar=function(e,t){1===arguments.length&&(arguments[0]?Jt(arguments[0])?(e=arguments[0],t=void 0):function(e){for(var t=F(e)&&!L(e),n=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i=0;i<s.length;i+=1)n=n||c(e,s[i]);return t&&n}(arguments[0])&&(t=arguments[0],e=void 0):t=e=void 0);var e=e||W(),n=Gt(e,this).startOf("day"),n=f.calendarFormat(this,n)||"sameElse",t=t&&(d(t[n])?t[n].call(this,e):t[n]);return this.format(t||this.localeData().calendar(n,this,W(e)))},i.clone=function(){return new q(this)},i.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Gt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=_(t)){case"year":r=Qt(this,s)/12;break;case"month":r=Qt(this,s);break;case"quarter":r=Qt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:y(r)},i.endOf=function(e){var t,n;if(void 0===(e=_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?sn:nn,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-tn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-tn(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-tn(t,1e3)-1;break}return this._d.setTime(t),f.updateOffset(this,!0),this},i.format=function(e){return e=e||(this.isUtc()?f.defaultFormatUtc:f.defaultFormat),e=re(this,e),this.localeData().postformat(e)},i.from=function(e,t){return this.isValid()&&(h(e)&&e.isValid()||W(e).isValid())?C({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},i.fromNow=function(e){return this.from(W(),e)},i.to=function(e,t){return this.isValid()&&(h(e)&&e.isValid()||W(e).isValid())?C({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},i.toNow=function(e){return this.to(W(),e)},i.get=function(e){return d(this[e=_(e)])?this[e]():this},i.invalidAt=function(){return m(this).overflow},i.isAfter=function(e,t){return e=h(e)?e:W(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(t).valueOf())},i.isBefore=function(e,t){return e=h(e)?e:W(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()<e.valueOf():this.clone().endOf(t).valueOf()<e.valueOf())},i.isBetween=function(e,t,n,s){return e=h(e)?e:W(e),t=h(t)?t:W(t),!!(this.isValid()&&e.isValid()&&t.isValid())&&(("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n)))},i.isSame=function(e,t){var e=h(e)?e:W(e);return!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()===e.valueOf():(e=e.valueOf(),this.clone().startOf(t).valueOf()<=e&&e<=this.clone().endOf(t).valueOf()))},i.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},i.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},i.isValid=function(){return A(this)},i.lang=Xe,i.locale=Xt,i.localeData=Kt,i.max=we,i.min=ge,i.parsingFlags=function(){return E({},m(this))},i.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t,n=[];for(t in e)c(e,t)&&n.push({unit:t,priority:le[t]});return n.sort(function(e,t){return e.priority-t.priority}),n}(e=ue(e)),s=n.length,i=0;i<s;i++)this[n[i].unit](e[n[i].unit]);else if(d(this[e=_(e)]))return this[e](t);return this},i.startOf=function(e){var t,n;if(void 0===(e=_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?sn:nn,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=tn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=tn(t,6e4);break;case"second":t=this._d.valueOf(),t-=tn(t,1e3);break}return this._d.setTime(t),f.updateOffset(this,!0),this},i.subtract=Je,i.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},i.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},i.toDate=function(){return new Date(this.valueOf())},i.toISOString=function(e){if(!this.isValid())return null;var t=(e=!0!==e)?this.clone().utc():this;return t.year()<0||9999<t.year()?re(t,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):d(Date.prototype.toISOString)?e?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",re(t,"Z")):re(t,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},i.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t="moment",n="";return this.isLocal()||(t=0===this.utcOffset()?"moment.utc":"moment.parseZone",n="Z"),t="["+t+'("]',e=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",this.format(t+e+"-MM-DD[T]HH:mm:ss.SSS"+(n+'[")]'))},"undefined"!=typeof Symbol&&null!=Symbol.for&&(i[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},i.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},i.eraName=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].name;if(t[n].until<=e&&e<=t[n].since)return t[n].name}return""},i.eraNarrow=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].narrow;if(t[n].until<=e&&e<=t[n].since)return t[n].narrow}return""},i.eraAbbr=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].abbr;if(t[n].until<=e&&e<=t[n].since)return t[n].abbr}return""},i.eraYear=function(){for(var e,t,n=this.localeData().eras(),s=0,i=n.length;s<i;++s)if(e=n[s].since<=n[s].until?1:-1,t=this.clone().startOf("day").valueOf(),n[s].since<=t&&t<=n[s].until||n[s].until<=t&&t<=n[s].since)return(this.year()-f(n[s].since).year())*e+n[s].offset;return this.year()},i.year=Ie,i.isLeapYear=function(){return he(this.year())},i.weekYear=function(e){return un.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},i.isoWeekYear=function(e){return un.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},i.quarter=i.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},i.month=Ge,i.daysInMonth=function(){return We(this.year(),this.month())},i.week=i.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},i.isoWeek=i.isoWeeks=function(e){var t=qe(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},i.weeksInYear=function(){var e=this.localeData()._week;return P(this.year(),e.dow,e.doy)},i.weeksInWeekYear=function(){var e=this.localeData()._week;return P(this.weekYear(),e.dow,e.doy)},i.isoWeeksInYear=function(){return P(this.year(),1,4)},i.isoWeeksInISOWeekYear=function(){return P(this.isoWeekYear(),1,4)},i.date=ke,i.day=i.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},i.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},i.isoWeekday=function(e){return this.isValid()?null!=e?(t=e,n=this.localeData(),n="string"==typeof t?n.weekdaysParse(t)%7||7:isNaN(t)?null:t,this.day(this.day()%7?n:n-7)):this.day()||7:null!=e?this:NaN;var t,n},i.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},i.hour=i.hours=k,i.minute=i.minutes=_e,i.second=i.seconds=ve,i.millisecond=i.milliseconds=ye,i.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?i:Et(this);if("string"==typeof e){if(null===(e=Vt(Ye,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Et(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?qt(this,C(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,f.updateOffset(this,!0),this._changeInProgress=null)),this},i.utc=function(e){return this.utcOffset(0,e)},i.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Et(this),"m")),this},i.parseZone=function(){var e;return null!=this._tzm?this.utcOffset(this._tzm,!1,!0):"string"==typeof this._i&&(null!=(e=Vt(Se,this._i))?this.utcOffset(e):this.utcOffset(0,!0)),this},i.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?W(e).utcOffset():0,(this.utcOffset()-e)%60==0)},i.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},i.isLocal=function(){return!!this.isValid()&&!this._isUTC},i.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},i.isUtc=At,i.isUTC=At,i.zoneAbbr=function(){return this._isUTC?"UTC":""},i.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},i.dates=e("dates accessor is deprecated. Use date instead.",ke),i.months=e("months accessor is deprecated. Use month instead",Ge),i.years=e("years accessor is deprecated. Use year instead",Ie),i.zone=e("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?(this.utcOffset(e="string"!=typeof e?-e:e,t),this):-this.utcOffset()}),i.isDSTShifted=e("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!o(this._isDSTShifted))return this._isDSTShifted;var e,t={};return $(t,this),(t=Nt(t))._a?(e=(t._isUTC?l:W)(t._a),this._isDSTShifted=this.isValid()&&0<function(e,t,n){for(var s=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),r=0,a=0;a<s;a++)(n&&e[a]!==t[a]||!n&&g(e[a])!==g(t[a]))&&r++;return r+i}(t._a,e.toArray())):this._isDSTShifted=!1,this._isDSTShifted});w=K.prototype;function cn(e,t,n,s){var i=mt(),s=l().set(s,t);return i[n](s,e)}function fn(e,t,n){if(u(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");for(var s=[],i=0;i<12;i++)s[i]=cn(e,i,n,"month");return s}function mn(e,t,n,s){t=("boolean"==typeof e?u(t)&&(n=t,t=void 0):(t=e,e=!1,u(n=t)&&(n=t,t=void 0)),t||"");var i,r=mt(),a=e?r._week.dow:0,o=[];if(null!=n)return cn(t,(n+a)%7,s,"day");for(i=0;i<7;i++)o[i]=cn(t,(i+a)%7,s,"day");return o}w.calendar=function(e,t,n){return d(e=this._calendar[e]||this._calendar.sameElse)?e.call(t,n):e},w.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(te).map(function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},w.invalidDate=function(){return this._invalidDate},w.ordinal=function(e){return this._ordinal.replace("%d",e)},w.preparse=dn,w.postformat=dn,w.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return d(i)?i(e,t,n,s):i.replace(/%d/i,e)},w.pastFuture=function(e,t){return d(e=this._relativeTime[0<e?"future":"past"])?e(t):e.replace(/%s/i,t)},w.set=function(e){var t,n;for(n in e)c(e,n)&&(d(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},w.eras=function(e,t){for(var n,s=this._eras||mt("en")._eras,i=0,r=s.length;i<r;++i){switch(typeof s[i].since){case"string":n=f(s[i].since).startOf("day"),s[i].since=n.valueOf();break}switch(typeof s[i].until){case"undefined":s[i].until=1/0;break;case"string":n=f(s[i].until).startOf("day").valueOf(),s[i].until=n.valueOf();break}}return s},w.erasParse=function(e,t,n){var s,i,r,a,o,u=this.eras();for(e=e.toUpperCase(),s=0,i=u.length;s<i;++s)if(r=u[s].name.toUpperCase(),a=u[s].abbr.toUpperCase(),o=u[s].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(a===e)return u[s];break;case"NNNN":if(r===e)return u[s];break;case"NNNNN":if(o===e)return u[s];break}else if(0<=[r,a,o].indexOf(e))return u[s]},w.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?f(e.since).year():f(e.since).year()+(t-e.offset)*n},w.erasAbbrRegex=function(e){return c(this,"_erasAbbrRegex")||an.call(this),e?this._erasAbbrRegex:this._erasRegex},w.erasNameRegex=function(e){return c(this,"_erasNameRegex")||an.call(this),e?this._erasNameRegex:this._erasRegex},w.erasNarrowRegex=function(e){return c(this,"_erasNarrowRegex")||an.call(this),e?this._erasNarrowRegex:this._erasRegex},w.months=function(e,t){return e?(a(this._months)?this._months:this._months[(this._months.isFormat||He).test(t)?"format":"standalone"])[e.month()]:a(this._months)?this._months:this._months.standalone},w.monthsShort=function(e,t){return e?(a(this._monthsShort)?this._monthsShort:this._monthsShort[He.test(t)?"format":"standalone"])[e.month()]:a(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},w.monthsParse=function(e,t,n){var s,i;if(this._monthsParseExact)return function(e,t,n){var s,i,r,e=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=l([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=S.call(this._shortMonthsParse,e))?i:null:-1!==(i=S.call(this._longMonthsParse,e))?i:null:"MMM"===t?-1!==(i=S.call(this._shortMonthsParse,e))||-1!==(i=S.call(this._longMonthsParse,e))?i:null:-1!==(i=S.call(this._longMonthsParse,e))||-1!==(i=S.call(this._shortMonthsParse,e))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=l([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(i="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},w.monthsRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ee.call(this),e?this._monthsStrictRegex:this._monthsRegex):(c(this,"_monthsRegex")||(this._monthsRegex=Le),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},w.monthsShortRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ee.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(c(this,"_monthsShortRegex")||(this._monthsShortRegex=Fe),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},w.week=function(e){return qe(e,this._week.dow,this._week.doy).week},w.firstDayOfYear=function(){return this._week.doy},w.firstDayOfWeek=function(){return this._week.dow},w.weekdays=function(e,t){return t=a(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"],!0===e?Be(t,this._week.dow):e?t[e.day()]:t},w.weekdaysMin=function(e){return!0===e?Be(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},w.weekdaysShort=function(e){return!0===e?Be(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},w.weekdaysParse=function(e,t,n){var s,i;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,e=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=l([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=S.call(this._weekdaysParse,e))?i:null:"ddd"===t?-1!==(i=S.call(this._shortWeekdaysParse,e))?i:null:-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:"dddd"===t?-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._shortWeekdaysParse,e))||-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:"ddd"===t?-1!==(i=S.call(this._shortWeekdaysParse,e))||-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:-1!==(i=S.call(this._minWeekdaysParse,e))||-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._shortWeekdaysParse,e))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=l([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(i="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(i.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},w.weekdaysRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(c(this,"_weekdaysRegex")||(this._weekdaysRegex=Ke),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},w.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(c(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=et),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},w.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(c(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=tt),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},w.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},w.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ct("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===g(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th")}}),f.lang=e("moment.lang is deprecated. Use moment.locale instead.",ct),f.langData=e("moment.langData is deprecated. Use moment.localeData instead.",mt);var _n=Math.abs;function yn(e,t,n,s){t=C(t,n);return e._milliseconds+=s*t._milliseconds,e._days+=s*t._days,e._months+=s*t._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function wn(e){return 4800*e/146097}function pn(e){return 146097*e/4800}function kn(e){return function(){return this.as(e)}}pe=kn("ms"),me=kn("s"),Ce=kn("m"),we=kn("h"),ge=kn("d"),Je=kn("w"),k=kn("M"),_e=kn("Q"),ve=kn("y");function vn(e){return function(){return this.isValid()?this._data[e]:NaN}}var ye=vn("milliseconds"),ke=vn("seconds"),Ie=vn("minutes"),w=vn("hours"),Mn=vn("days"),Dn=vn("months"),Sn=vn("years");var Yn=Math.round,On={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function bn(e,t,n,s){var i=C(e).abs(),r=Yn(i.as("s")),a=Yn(i.as("m")),o=Yn(i.as("h")),u=Yn(i.as("d")),l=Yn(i.as("M")),h=Yn(i.as("w")),i=Yn(i.as("y")),r=(r<=n.ss?["s",r]:r<n.s&&["ss",r])||a<=1&&["m"]||a<n.m&&["mm",a]||o<=1&&["h"]||o<n.h&&["hh",o]||u<=1&&["d"]||u<n.d&&["dd",u];return(r=(r=null!=n.w?r||h<=1&&["w"]||h<n.w&&["ww",h]:r)||l<=1&&["M"]||l<n.M&&["MM",l]||i<=1&&["y"]||["yy",i])[2]=t,r[3]=0<+e,r[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,r)}var xn=Math.abs;function Tn(e){return(0<e)-(e<0)||+e}function Nn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,s,i,r,a,o=xn(this._milliseconds)/1e3,u=xn(this._days),l=xn(this._months),h=this.asSeconds();return h?(e=y(o/60),t=y(e/60),o%=60,e%=60,n=y(l/12),l%=12,s=o?o.toFixed(3).replace(/\.?0+$/,""):"",i=Tn(this._months)!==Tn(h)?"-":"",r=Tn(this._days)!==Tn(h)?"-":"",a=Tn(this._milliseconds)!==Tn(h)?"-":"",(h<0?"-":"")+"P"+(n?i+n+"Y":"")+(l?i+l+"M":"")+(u?r+u+"D":"")+(t||e||o?"T":"")+(t?a+t+"H":"")+(e?a+e+"M":"")+(o?a+s+"S":"")):"P0D"}var U=Ct.prototype;return U.isValid=function(){return this._isValid},U.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},U.add=function(e,t){return yn(this,e,t,1)},U.subtract=function(e,t){return yn(this,e,t,-1)},U.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=_(e))||"quarter"===e||"year"===e)switch(t=this._days+s/864e5,n=this._months+wn(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(pn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},U.asMilliseconds=pe,U.asSeconds=me,U.asMinutes=Ce,U.asHours=we,U.asDays=ge,U.asWeeks=Je,U.asMonths=k,U.asQuarters=_e,U.asYears=ve,U.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*g(this._months/12):NaN},U._bubble=function(){var e=this._milliseconds,t=this._days,n=this._months,s=this._data;return 0<=e&&0<=t&&0<=n||e<=0&&t<=0&&n<=0||(e+=864e5*gn(pn(n)+t),n=t=0),s.milliseconds=e%1e3,e=y(e/1e3),s.seconds=e%60,e=y(e/60),s.minutes=e%60,e=y(e/60),s.hours=e%24,t+=y(e/24),n+=e=y(wn(t)),t-=gn(pn(e)),e=y(n/12),n%=12,s.days=t,s.months=n,s.years=e,this},U.clone=function(){return C(this)},U.get=function(e){return e=_(e),this.isValid()?this[e+"s"]():NaN},U.milliseconds=ye,U.seconds=ke,U.minutes=Ie,U.hours=w,U.days=Mn,U.weeks=function(){return y(this.days()/7)},U.months=Dn,U.years=Sn,U.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n=!1,s=On;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(n=e),"object"==typeof t&&(s=Object.assign({},On,t),null!=t.s&&null==t.ss&&(s.ss=t.s-1)),e=this.localeData(),t=bn(this,!n,s,e),n&&(t=e.pastFuture(+this,t)),e.postformat(t)},U.toISOString=Nn,U.toString=Nn,U.toJSON=Nn,U.locale=Xt,U.localeData=Kt,U.toIsoString=e("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Nn),U.lang=Xe,s("X",0,0,"unix"),s("x",0,0,"valueOf"),v("x",De),v("X",/[+-]?\d+(\.\d{1,3})?/),D("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e))}),D("x",function(e,t,n){n._d=new Date(g(e))}),f.version="2.29.4",H=W,f.fn=i,f.min=function(){return Rt("isBefore",[].slice.call(arguments,0))},f.max=function(){return Rt("isAfter",[].slice.call(arguments,0))},f.now=function(){return Date.now?Date.now():+new Date},f.utc=l,f.unix=function(e){return W(1e3*e)},f.months=function(e,t){return fn(e,t,"months")},f.isDate=V,f.locale=ct,f.invalid=I,f.duration=C,f.isMoment=h,f.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},f.parseZone=function(){return W.apply(null,arguments).parseZone()},f.localeData=mt,f.isDuration=Ut,f.monthsShort=function(e,t){return fn(e,t,"monthsShort")},f.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},f.defineLocale=ft,f.updateLocale=function(e,t){var n,s;return null!=t?(s=ot,null!=R[e]&&null!=R[e].parentLocale?R[e].set(X(R[e]._config,t)):(t=X(s=null!=(n=dt(e))?n._config:s,t),null==n&&(t.abbr=e),(s=new K(t)).parentLocale=R[e],R[e]=s),ct(e)):null!=R[e]&&(null!=R[e].parentLocale?(R[e]=R[e].parentLocale,e===ct()&&ct(e)):null!=R[e]&&delete R[e]),R[e]},f.locales=function(){return ee(R)},f.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},f.normalizeUnits=_,f.relativeTimeRounding=function(e){return void 0===e?Yn:"function"==typeof e&&(Yn=e,!0)},f.relativeTimeThreshold=function(e,t){return void 0!==On[e]&&(void 0===t?On[e]:(On[e]=t,"s"===e&&(On.ss=t-1),!0))},f.calendarFormat=function(e,t){return(e=e.diff(t,"days",!0))<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse"},f.prototype=i,f.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},f});
+//# sourceMappingURL=moment.min.js.map
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/nginx.conf.sample /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/nginx.conf.sample
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/nginx.conf.sample	2023-05-30 09:55:07.436891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/nginx.conf.sample	2023-05-16 15:26:50.000000000 +0100
@@ -47,7 +47,7 @@
 location ~* ^/setup($|/) {
     root $MAGE_ROOT;
     location ~ ^/setup/index.php {
-        fastcgi_pass   fastcgi_backend;
+        fastcgi_pass   php-fpm:9000;

         fastcgi_param  PHP_FLAG  "session.auto_start=off \n suhosin.session.cryptua=off";
         fastcgi_param  PHP_VALUE "memory_limit=756M \n max_execution_time=600";
@@ -74,7 +74,7 @@

     location ~ ^/update/index.php {
         fastcgi_split_path_info ^(/update/index.php)(/.+)$;
-        fastcgi_pass   fastcgi_backend;
+        fastcgi_pass   php-fpm:9000;
         fastcgi_index  index.php;
         fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
         fastcgi_param  PATH_INFO        $fastcgi_path_info;
@@ -206,7 +206,7 @@
 # PHP entry point for main application
 location ~ ^/(index|get|static|errors/report|errors/404|errors/503|health_check)\.php$ {
     try_files $uri =404;
-    fastcgi_pass   fastcgi_backend;
+    fastcgi_pass   php-fpm:9000;
     fastcgi_buffers 16 16k;
     fastcgi_buffer_size 32k;

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/pub/opt/magento/var/resource_config.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/pub/opt/magento/var/resource_config.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/pub/opt/magento/var/resource_config.json	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/pub/opt/magento/var/resource_config.json	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1 @@
+{"media_directory":"\/opt\/magento\/pub\/media","allowed_resources":["css","css_secure","js","theme","favicon","wysiwyg","catalog","custom_options","email","captcha","dhl"],"update_time":"3600"}
\ No newline at end of file
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/var/.htaccess /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/var/.htaccess
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-base/var/.htaccess	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-base/var/.htaccess	2023-05-16 15:26:28.000000000 +0100
@@ -0,0 +1,8 @@
+<IfVersion < 2.4>
+    order allow,deny
+    deny from all
+</IfVersion>
+<IfVersion >= 2.4>
+    Require all denied
+</IfVersion>
+
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/composer.json	2023-05-30 09:55:07.464891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/composer.json	2023-05-16 15:31:46.000000000 +0100
@@ -5,7 +5,7 @@
     "license": [
         "proprietary"
     ],
-    "version": "2.4.6",
+    "version": "2.4.6-p1",
     "require": {
         "magento/magento-composer-installer": "*",
         "php": "~8.1.0||~8.2.0",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerTest.php	2023-05-30 09:55:07.484891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerTest.php	2023-05-16 15:31:36.000000000 +0100
@@ -171,6 +171,7 @@
         $segment = $this->segment->load('Customer Segment Multi-Website', 'name');
         $customer = $this->customerRepository->get('customer@example.com');
         $customerSegment = $this->objectManager->create(CustomerSegment::class);
+        sleep(30);
         $this->waitForAsynchronousResult($customer);
         $this->assertEquals(
             [$segment->getId()],
@@ -197,6 +198,7 @@
         $customerSegment = $this->objectManager->create(CustomerSegment::class);
         $segment = $this->segment->load('Customer Segment Multi-Website', 'name');
         $customer = $this->customerRepository->get('customer@example.com');
+        sleep(30);
         $this->waitForAsynchronousResult($customer);
         $this->assertEquals(
             [$segment->getId()],
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerWithoutRealTimeCustomerSegmentValidationTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerWithoutRealTimeCustomerSegmentValidationTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerWithoutRealTimeCustomerSegmentValidationTest.php	2023-05-30 09:55:07.484891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-ee-base/dev/tests/integration/testsuite/Magento/CustomerSegment/Model/SegmentMatchConsumerWithoutRealTimeCustomerSegmentValidationTest.php	2023-05-16 15:31:36.000000000 +0100
@@ -114,8 +114,9 @@
      */
     private function waitForAsynchronousResult(CustomerInterface $customer): void
     {
+        sleep(30); // timeout to processing Magento queue
         $customerSegment = $this->objectManager->create(CustomerSegment::class);
-        sleep(15); // timeout to processing Magento queue
+        sleep(30); // timeout to processing Magento queue
         $this->publisherConsumerController->waitForAsynchronousResult(
             function ($customerId, $websiteId) use ($customerSegment) {
                 return $customerSegment->getCustomerSegmentIdsForWebsite($customerId, $websiteId);
@@ -157,6 +158,7 @@
         $segment->matchCustomers();
         /** @var CustomerInterface $customer */
         $customer = $this->customerRepository->get('customer@search.example.com');
+        sleep(30); // timeout to processing Magento queue
         $this->waitForAsynchronousResult($customer);
         $this->assertEquals(
             [$segment->getId()],
@@ -179,6 +181,7 @@
         $segment = $this->segment->load('Customer Segment Multi-Website', 'name');
         $customer = $this->customerRepository->get('customer@example.com');
         $customerSegment = $this->objectManager->create(CustomerSegment::class);
+        sleep(30); // timeout to processing Magento queue
         $this->waitForAsynchronousResult($customer);
         $this->assertEquals(
             [$segment->getId()],
@@ -205,6 +208,7 @@
         $customerSegment = $this->objectManager->create(CustomerSegment::class);
         $segment = $this->segment->load('Customer Segment Multi-Website', 'name');
         $customer = $this->customerRepository->get('customer@example.com');
+        sleep(30); // timeout to processing Magento queue
         $this->waitForAsynchronousResult($customer);
         $this->assertEquals(
             [$segment->getId()],
@@ -237,6 +241,7 @@
         $orderRepository->save($order);
         $segment->matchCustomers();
         $customer = $this->customerRepository->get('customer@example.com');
+        sleep(30); // timeout to processing Magento queue
         $this->waitForAsynchronousResult($customer);
         /** @var Registry $registry */
         $registry = $this->objectManager->get(Registry::class);
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/CHANGELOG.md /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/CHANGELOG.md
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/CHANGELOG.md	2023-05-30 09:55:07.512891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/CHANGELOG.md	2023-05-03 05:08:55.000000000 +0100
@@ -1,5 +1,16 @@
 Magento Functional Testing Framework Changelog
 ================================================
+4.3.0
+---------
+### Enhancements
+* Bumped `allure-framework/allure-codeception` dependency to `^2.1`.
+* Bumped `codeception/codeception` to `^5.0` and upgraded its dependent packages.
+* Replaced Yandex methods with Qameta related methods.
+* Created methods for modifying step name and for formatting allure.
+
+### Fixes
+* Fixed all issues and exceptions thrown after codeception upgrade.
+* Removed dependency of MagentoAllureAdapter in codeception.yml file.

 4.2.1
 ---------
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/composer.json	2023-05-30 09:55:07.512891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/composer.json	2023-05-03 05:08:55.000000000 +0100
@@ -2,7 +2,7 @@
     "name": "magento/magento2-functional-testing-framework",
     "description": "Magento2 Functional Testing Framework",
     "type": "library",
-    "version": "4.2.1",
+    "version": "4.3.0",
     "license": "AGPL-3.0",
     "keywords": ["magento", "automation", "functional", "testing"],
     "config": {
@@ -16,13 +16,13 @@
         "ext-intl": "*",
         "ext-json": "*",
         "ext-openssl": "*",
-        "allure-framework/allure-codeception": "^1.5",
+        "allure-framework/allure-codeception": "^2.1",
         "allure-framework/allure-phpunit": "^2",
         "aws/aws-sdk-php": "^3.132",
-        "codeception/codeception": "^4.1",
-        "codeception/module-asserts": "^1.1",
-        "codeception/module-sequence": "^1.0",
-        "codeception/module-webdriver": "^1.0",
+        "codeception/codeception": "^5.0",
+        "codeception/module-asserts": "^3.0",
+        "codeception/module-sequence": "^3.0",
+        "codeception/module-webdriver": "^3.0",
         "composer/composer": "^1.9 || ^2.0, !=2.2.16",
         "csharpru/vault-php": "^4.2.1",
         "guzzlehttp/guzzle": "^7.3.0",
@@ -47,7 +47,7 @@
         "codacy/coverage": "^1.4",
         "php-coveralls/php-coveralls": "^1.0||^2.2",
         "phpmd/phpmd": "^2.8.0",
-        "phpunit/phpunit": "^9.0",
+        "phpunit/phpunit": "<=9.5.20",
         "sebastian/phpcpd": "~6.0.0",
         "squizlabs/php_codesniffer": "~3.6.0"
     },
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/composer.lock /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/composer.lock
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/composer.lock	2023-05-30 09:55:07.512891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/composer.lock	2023-05-03 05:08:55.000000000 +0100
@@ -4,38 +4,40 @@
         "Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies",
         "This file is @generated automatically"
     ],
-    "content-hash": "94ccb9217137f49890557810720f193e",
+    "content-hash": "723f5ee4d66a45e6312b9b33b0490ba2",
     "packages": [
         {
             "name": "allure-framework/allure-codeception",
-            "version": "1.5.2",
+            "version": "v2.1.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/allure-framework/allure-codeception.git",
-                "reference": "a6156aef942a4e4de0add34a73d066a9458cefc6"
+                "reference": "1d3b80bce18ea130e2c34a3ec1f57138a77b6fa8"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/allure-framework/allure-codeception/zipball/a6156aef942a4e4de0add34a73d066a9458cefc6",
-                "reference": "a6156aef942a4e4de0add34a73d066a9458cefc6",
+                "url": "https://api.github.com/repos/allure-framework/allure-codeception/zipball/1d3b80bce18ea130e2c34a3ec1f57138a77b6fa8",
+                "reference": "1d3b80bce18ea130e2c34a3ec1f57138a77b6fa8",
                 "shasum": ""
             },
             "require": {
-                "allure-framework/allure-php-api": "^1.3",
-                "codeception/codeception": "^2.5 | ^3 | ^4",
+                "allure-framework/allure-php-commons": "^2",
+                "codeception/codeception": "^5",
                 "ext-json": "*",
-                "php": ">=7.1.3",
-                "symfony/filesystem": "^2.7 | ^3 | ^4 | ^5",
-                "symfony/finder": "^2.7 | ^3 | ^4 | ^5"
+                "php": "^8"
             },
             "require-dev": {
-                "ext-dom": "*",
-                "phpunit/phpunit": "^7.2 | ^8 | ^9"
+                "phpunit/phpunit": "^9",
+                "psalm/plugin-phpunit": "^0.18.4",
+                "remorhaz/php-json-data": "^0.5.3",
+                "remorhaz/php-json-path": "^0.7.7",
+                "squizlabs/php_codesniffer": "^3.7.1",
+                "vimeo/psalm": "^5.2"
             },
             "type": "library",
             "autoload": {
-                "psr-0": {
-                    "Yandex": "src/"
+                "psr-4": {
+                    "Qameta\\Allure\\Codeception\\": "src/"
                 }
             },
             "notification-url": "https://packagist.org/downloads/",
@@ -47,6 +49,11 @@
                     "name": "Ivan Krutov",
                     "email": "vania-pooh@aerokube.com",
                     "role": "Developer"
+                },
+                {
+                    "name": "Edward Surov",
+                    "email": "zoohie@gmail.com",
+                    "role": "Developer"
                 }
             ],
             "description": "Allure Codeception integration",
@@ -65,65 +72,7 @@
                 "issues": "https://github.com/allure-framework/allure-codeception/issues",
                 "source": "https://github.com/allure-framework/allure-codeception"
             },
-            "time": "2021-06-04T13:24:36+00:00"
-        },
-        {
-            "name": "allure-framework/allure-php-api",
-            "version": "1.4.0",
-            "source": {
-                "type": "git",
-                "url": "https://github.com/allure-framework/allure-php-api.git",
-                "reference": "50507f482d490f114054f2281cca487db47fa2bd"
-            },
-            "dist": {
-                "type": "zip",
-                "url": "https://api.github.com/repos/allure-framework/allure-php-api/zipball/50507f482d490f114054f2281cca487db47fa2bd",
-                "reference": "50507f482d490f114054f2281cca487db47fa2bd",
-                "shasum": ""
-            },
-            "require": {
-                "jms/serializer": "^1 | ^2 | ^3",
-                "php": ">=7.1.3",
-                "ramsey/uuid": "^3 | ^4",
-                "symfony/mime": "^4.3 | ^5"
-            },
-            "require-dev": {
-                "phpunit/phpunit": "^7 | ^8 | ^9"
-            },
-            "type": "library",
-            "autoload": {
-                "psr-0": {
-                    "Yandex": [
-                        "src/",
-                        "test/"
-                    ]
-                }
-            },
-            "notification-url": "https://packagist.org/downloads/",
-            "license": [
-                "Apache-2.0"
-            ],
-            "authors": [
-                {
-                    "name": "Ivan Krutov",
-                    "email": "vania-pooh@yandex-team.ru",
-                    "role": "Developer"
-                }
-            ],
-            "description": "Allure PHP commons",
-            "homepage": "http://allure.qatools.ru/",
-            "keywords": [
-                "allure",
-                "api",
-                "php",
-                "report"
-            ],
-            "support": {
-                "email": "allure@qameta.io",
-                "issues": "https://github.com/allure-framework/allure-php-api/issues",
-                "source": "https://github.com/allure-framework/allure-php-api"
-            },
-            "time": "2021-11-15T13:15:20+00:00"
+            "time": "2023-01-09T08:09:01+00:00"
         },
         {
             "name": "allure-framework/allure-php-commons",
@@ -265,23 +214,27 @@
         },
         {
             "name": "aws/aws-crt-php",
-            "version": "v1.0.4",
+            "version": "v1.2.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/awslabs/aws-crt-php.git",
-                "reference": "f5c64ee7c5fce196e2519b3d9b7138649efe032d"
+                "reference": "1926277fc71d253dfa820271ac5987bdb193ccf5"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/awslabs/aws-crt-php/zipball/f5c64ee7c5fce196e2519b3d9b7138649efe032d",
-                "reference": "f5c64ee7c5fce196e2519b3d9b7138649efe032d",
+                "url": "https://api.github.com/repos/awslabs/aws-crt-php/zipball/1926277fc71d253dfa820271ac5987bdb193ccf5",
+                "reference": "1926277fc71d253dfa820271ac5987bdb193ccf5",
                 "shasum": ""
             },
             "require": {
                 "php": ">=5.5"
             },
             "require-dev": {
-                "phpunit/phpunit": "^4.8.35|^5.6.3"
+                "phpunit/phpunit": "^4.8.35||^5.6.3||^9.5",
+                "yoast/phpunit-polyfills": "^1.0"
+            },
+            "suggest": {
+                "ext-awscrt": "Make sure you install awscrt native extension to use any of the functionality."
             },
             "type": "library",
             "autoload": {
@@ -300,7 +253,7 @@
                 }
             ],
             "description": "AWS Common Runtime for PHP",
-            "homepage": "http://aws.amazon.com/sdkforphp",
+            "homepage": "https://github.com/awslabs/aws-crt-php",
             "keywords": [
                 "amazon",
                 "aws",
@@ -309,22 +262,22 @@
             ],
             "support": {
                 "issues": "https://github.com/awslabs/aws-crt-php/issues",
-                "source": "https://github.com/awslabs/aws-crt-php/tree/v1.0.4"
+                "source": "https://github.com/awslabs/aws-crt-php/tree/v1.2.1"
             },
-            "time": "2023-01-31T23:08:25+00:00"
+            "time": "2023-03-24T20:22:19+00:00"
         },
         {
             "name": "aws/aws-sdk-php",
-            "version": "3.260.0",
+            "version": "3.268.16",
             "source": {
                 "type": "git",
                 "url": "https://github.com/aws/aws-sdk-php.git",
-                "reference": "25a14f63cc927d72adad3cc24d6bcdadfe6e0fc7"
+                "reference": "b59134c9ca64dcb9de6f7dbbcb9d5a75ed665a98"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/aws/aws-sdk-php/zipball/25a14f63cc927d72adad3cc24d6bcdadfe6e0fc7",
-                "reference": "25a14f63cc927d72adad3cc24d6bcdadfe6e0fc7",
+                "url": "https://api.github.com/repos/aws/aws-sdk-php/zipball/b59134c9ca64dcb9de6f7dbbcb9d5a75ed665a98",
+                "reference": "b59134c9ca64dcb9de6f7dbbcb9d5a75ed665a98",
                 "shasum": ""
             },
             "require": {
@@ -334,7 +287,7 @@
                 "ext-simplexml": "*",
                 "guzzlehttp/guzzle": "^6.5.8 || ^7.4.5",
                 "guzzlehttp/promises": "^1.4.0",
-                "guzzlehttp/psr7": "^1.8.5 || ^2.3",
+                "guzzlehttp/psr7": "^1.9.1 || ^2.4.5",
                 "mtdowling/jmespath.php": "^2.6",
                 "php": ">=5.5"
             },
@@ -353,6 +306,7 @@
                 "paragonie/random_compat": ">= 2",
                 "phpunit/phpunit": "^4.8.35 || ^5.6.3 || ^9.5",
                 "psr/cache": "^1.0",
+                "psr/http-message": "^1.0",
                 "psr/simple-cache": "^1.0",
                 "sebastian/comparator": "^1.2.3 || ^4.0",
                 "yoast/phpunit-polyfills": "^1.0"
@@ -403,9 +357,9 @@
             "support": {
                 "forum": "https://forums.aws.amazon.com/forum.jspa?forumID=80",
                 "issues": "https://github.com/aws/aws-sdk-php/issues",
-                "source": "https://github.com/aws/aws-sdk-php/tree/3.260.0"
+                "source": "https://github.com/aws/aws-sdk-php/tree/3.268.16"
             },
-            "time": "2023-02-21T20:26:17+00:00"
+            "time": "2023-04-21T21:37:05+00:00"
         },
         {
             "name": "beberlei/assert",
@@ -539,26 +493,25 @@
         },
         {
             "name": "brick/math",
-            "version": "0.10.2",
+            "version": "0.11.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/brick/math.git",
-                "reference": "459f2781e1a08d52ee56b0b1444086e038561e3f"
+                "reference": "0ad82ce168c82ba30d1c01ec86116ab52f589478"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/brick/math/zipball/459f2781e1a08d52ee56b0b1444086e038561e3f",
-                "reference": "459f2781e1a08d52ee56b0b1444086e038561e3f",
+                "url": "https://api.github.com/repos/brick/math/zipball/0ad82ce168c82ba30d1c01ec86116ab52f589478",
+                "reference": "0ad82ce168c82ba30d1c01ec86116ab52f589478",
                 "shasum": ""
             },
             "require": {
-                "ext-json": "*",
-                "php": "^7.4 || ^8.0"
+                "php": "^8.0"
             },
             "require-dev": {
                 "php-coveralls/php-coveralls": "^2.2",
                 "phpunit/phpunit": "^9.0",
-                "vimeo/psalm": "4.25.0"
+                "vimeo/psalm": "5.0.0"
             },
             "type": "library",
             "autoload": {
@@ -583,7 +536,7 @@
             ],
             "support": {
                 "issues": "https://github.com/brick/math/issues",
-                "source": "https://github.com/brick/math/tree/0.10.2"
+                "source": "https://github.com/brick/math/tree/0.11.0"
             },
             "funding": [
                 {
@@ -591,65 +544,80 @@
                     "type": "github"
                 }
             ],
-            "time": "2022-08-10T22:54:19+00:00"
+            "time": "2023-01-15T23:15:59+00:00"
         },
         {
             "name": "codeception/codeception",
-            "version": "4.2.2",
+            "version": "5.0.10",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/Codeception.git",
-                "reference": "b88014f3348c93f3df99dc6d0967b0dbfa804474"
+                "reference": "ed4af7fd4103cdd035916fbb8f35124edd2d018b"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/Codeception/zipball/b88014f3348c93f3df99dc6d0967b0dbfa804474",
-                "reference": "b88014f3348c93f3df99dc6d0967b0dbfa804474",
+                "url": "https://api.github.com/repos/Codeception/Codeception/zipball/ed4af7fd4103cdd035916fbb8f35124edd2d018b",
+                "reference": "ed4af7fd4103cdd035916fbb8f35124edd2d018b",
                 "shasum": ""
             },
             "require": {
-                "behat/gherkin": "^4.4.0",
-                "codeception/lib-asserts": "^1.0 | 2.0.*@dev",
-                "codeception/phpunit-wrapper": ">6.0.15 <6.1.0 | ^6.6.1 | ^7.7.1 | ^8.1.1 | ^9.0",
-                "codeception/stub": "^2.0 | ^3.0 | ^4.0",
+                "behat/gherkin": "^4.6.2",
+                "codeception/lib-asserts": "^2.0",
+                "codeception/stub": "^4.1",
                 "ext-curl": "*",
                 "ext-json": "*",
                 "ext-mbstring": "*",
-                "guzzlehttp/psr7": "^1.4 | ^2.0",
-                "php": ">=5.6.0 <9.0",
-                "symfony/console": ">=2.7 <6.0",
-                "symfony/css-selector": ">=2.7 <6.0",
-                "symfony/event-dispatcher": ">=2.7 <6.0",
-                "symfony/finder": ">=2.7 <6.0",
-                "symfony/yaml": ">=2.7 <6.0"
+                "php": "^8.0",
+                "phpunit/php-code-coverage": "^9.2 || ^10.0",
+                "phpunit/php-text-template": "^2.0 || ^3.0",
+                "phpunit/php-timer": "^5.0.3 || ^6.0",
+                "phpunit/phpunit": "^9.5.20 || ^10.0",
+                "psy/psysh": "^0.11.2",
+                "sebastian/comparator": "^4.0.5 || ^5.0",
+                "sebastian/diff": "^4.0.3 || ^5.0",
+                "symfony/console": ">=4.4.24 <7.0",
+                "symfony/css-selector": ">=4.4.24 <7.0",
+                "symfony/event-dispatcher": ">=4.4.24 <7.0",
+                "symfony/finder": ">=4.4.24 <7.0",
+                "symfony/var-dumper": ">=4.4.24 < 7.0",
+                "symfony/yaml": ">=4.4.24 <7.0"
+            },
+            "conflict": {
+                "codeception/lib-innerbrowser": "<3.1.3",
+                "codeception/module-filesystem": "<3.0",
+                "codeception/module-phpbrowser": "<2.5"
+            },
+            "replace": {
+                "codeception/phpunit-wrapper": "*"
             },
             "require-dev": {
-                "codeception/module-asserts": "^1.0 | 2.0.*@dev",
-                "codeception/module-cli": "^1.0 | 2.0.*@dev",
-                "codeception/module-db": "^1.0 | 2.0.*@dev",
-                "codeception/module-filesystem": "^1.0 | 2.0.*@dev",
-                "codeception/module-phpbrowser": "^1.0 | 2.0.*@dev",
-                "codeception/specify": "~0.3",
+                "codeception/lib-innerbrowser": "*@dev",
+                "codeception/lib-web": "^1.0",
+                "codeception/module-asserts": "*@dev",
+                "codeception/module-cli": "*@dev",
+                "codeception/module-db": "*@dev",
+                "codeception/module-filesystem": "*@dev",
+                "codeception/module-phpbrowser": "*@dev",
                 "codeception/util-universalframework": "*@dev",
-                "monolog/monolog": "~1.8",
-                "squizlabs/php_codesniffer": "~2.0",
-                "symfony/process": ">=2.7 <6.0",
-                "vlucas/phpdotenv": "^2.0 | ^3.0 | ^4.0 | ^5.0"
+                "ext-simplexml": "*",
+                "jetbrains/phpstorm-attributes": "^1.0",
+                "symfony/dotenv": ">=4.4.24 <7.0",
+                "symfony/process": ">=4.4.24 <7.0",
+                "vlucas/phpdotenv": "^5.1"
             },
             "suggest": {
                 "codeception/specify": "BDD-style code blocks",
                 "codeception/verify": "BDD-style assertions",
-                "hoa/console": "For interactive console functionality",
+                "ext-simplexml": "For loading params from XML files",
                 "stecman/symfony-console-completion": "For BASH autocompletion",
-                "symfony/phpunit-bridge": "For phpunit-bridge support"
+                "symfony/dotenv": "For loading params from .env files",
+                "symfony/phpunit-bridge": "For phpunit-bridge support",
+                "vlucas/phpdotenv": "For loading params from .env files"
             },
             "bin": [
                 "codecept"
             ],
             "type": "library",
-            "extra": {
-                "branch-alias": []
-            },
             "autoload": {
                 "files": [
                     "functions.php"
@@ -657,7 +625,10 @@
                 "psr-4": {
                     "Codeception\\": "src/Codeception",
                     "Codeception\\Extension\\": "ext"
-                }
+                },
+                "classmap": [
+                    "src/PHPUnit/TestCase.php"
+                ]
             },
             "notification-url": "https://packagist.org/downloads/",
             "license": [
@@ -666,8 +637,8 @@
             "authors": [
                 {
                     "name": "Michael Bodnarchuk",
-                    "email": "davert@mail.ua",
-                    "homepage": "https://codegyre.com"
+                    "email": "davert.ua@gmail.com",
+                    "homepage": "https://codeception.com"
                 }
             ],
             "description": "BDD-style testing framework",
@@ -681,7 +652,7 @@
             ],
             "support": {
                 "issues": "https://github.com/Codeception/Codeception/issues",
-                "source": "https://github.com/Codeception/Codeception/tree/4.2.2"
+                "source": "https://github.com/Codeception/Codeception/tree/5.0.10"
             },
             "funding": [
                 {
@@ -689,26 +660,26 @@
                     "type": "open_collective"
                 }
             ],
-            "time": "2022-08-13T13:28:25+00:00"
+            "time": "2023-03-14T07:21:10+00:00"
         },
         {
             "name": "codeception/lib-asserts",
-            "version": "1.13.2",
+            "version": "2.1.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/lib-asserts.git",
-                "reference": "184231d5eab66bc69afd6b9429344d80c67a33b6"
+                "reference": "b8c7dff552249e560879c682ba44a4b963af91bc"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/lib-asserts/zipball/184231d5eab66bc69afd6b9429344d80c67a33b6",
-                "reference": "184231d5eab66bc69afd6b9429344d80c67a33b6",
+                "url": "https://api.github.com/repos/Codeception/lib-asserts/zipball/b8c7dff552249e560879c682ba44a4b963af91bc",
+                "reference": "b8c7dff552249e560879c682ba44a4b963af91bc",
                 "shasum": ""
             },
             "require": {
-                "codeception/phpunit-wrapper": ">6.0.15 <6.1.0 | ^6.6.1 | ^7.7.1 | ^8.0.3 | ^9.0",
+                "codeception/phpunit-wrapper": "^7.7.1 | ^8.0.3 | ^9.0",
                 "ext-dom": "*",
-                "php": ">=5.6.0 <9.0"
+                "php": "^7.4 | ^8.0"
             },
             "type": "library",
             "autoload": {
@@ -741,31 +712,84 @@
             ],
             "support": {
                 "issues": "https://github.com/Codeception/lib-asserts/issues",
-                "source": "https://github.com/Codeception/lib-asserts/tree/1.13.2"
+                "source": "https://github.com/Codeception/lib-asserts/tree/2.1.0"
             },
-            "time": "2020-10-21T16:26:20+00:00"
+            "time": "2023-02-10T18:36:23+00:00"
+        },
+        {
+            "name": "codeception/lib-web",
+            "version": "1.0.2",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/Codeception/lib-web.git",
+                "reference": "f488ff9bc08c8985d43796db28da0bd18813bcae"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/Codeception/lib-web/zipball/f488ff9bc08c8985d43796db28da0bd18813bcae",
+                "reference": "f488ff9bc08c8985d43796db28da0bd18813bcae",
+                "shasum": ""
+            },
+            "require": {
+                "ext-mbstring": "*",
+                "guzzlehttp/psr7": "^2.0",
+                "php": "^8.0",
+                "symfony/css-selector": ">=4.4.24 <7.0"
+            },
+            "conflict": {
+                "codeception/codeception": "<5.0.0-alpha3"
+            },
+            "require-dev": {
+                "php-webdriver/webdriver": "^1.12",
+                "phpunit/phpunit": "^9.5 | ^10.0"
+            },
+            "type": "library",
+            "autoload": {
+                "classmap": [
+                    "src/"
+                ]
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Gintautas Miselis"
+                }
+            ],
+            "description": "Library containing files used by module-webdriver and lib-innerbrowser or module-phpbrowser",
+            "homepage": "https://codeception.com/",
+            "keywords": [
+                "codeception"
+            ],
+            "support": {
+                "issues": "https://github.com/Codeception/lib-web/issues",
+                "source": "https://github.com/Codeception/lib-web/tree/1.0.2"
+            },
+            "time": "2023-04-18T20:32:51+00:00"
         },
         {
             "name": "codeception/module-asserts",
-            "version": "1.3.1",
+            "version": "3.0.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/module-asserts.git",
-                "reference": "59374f2fef0cabb9e8ddb53277e85cdca74328de"
+                "reference": "1b6b150b30586c3614e7e5761b31834ed7968603"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/module-asserts/zipball/59374f2fef0cabb9e8ddb53277e85cdca74328de",
-                "reference": "59374f2fef0cabb9e8ddb53277e85cdca74328de",
+                "url": "https://api.github.com/repos/Codeception/module-asserts/zipball/1b6b150b30586c3614e7e5761b31834ed7968603",
+                "reference": "1b6b150b30586c3614e7e5761b31834ed7968603",
                 "shasum": ""
             },
             "require": {
                 "codeception/codeception": "*@dev",
-                "codeception/lib-asserts": "^1.13.1",
-                "php": ">=5.6.0 <9.0"
+                "codeception/lib-asserts": "^2.0",
+                "php": "^8.0"
             },
             "conflict": {
-                "codeception/codeception": "<4.0"
+                "codeception/codeception": "<5.0"
             },
             "type": "library",
             "autoload": {
@@ -798,30 +822,33 @@
             ],
             "support": {
                 "issues": "https://github.com/Codeception/module-asserts/issues",
-                "source": "https://github.com/Codeception/module-asserts/tree/1.3.1"
+                "source": "https://github.com/Codeception/module-asserts/tree/3.0.0"
             },
-            "time": "2020-10-21T16:48:15+00:00"
+            "time": "2022-02-16T19:48:08+00:00"
         },
         {
             "name": "codeception/module-sequence",
-            "version": "1.0.1",
+            "version": "3.0.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/module-sequence.git",
-                "reference": "b75be26681ae90824cde8f8df785981f293667e1"
+                "reference": "9738e2eb06035a0975171a0aa3fce00d284b4dfb"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/module-sequence/zipball/b75be26681ae90824cde8f8df785981f293667e1",
-                "reference": "b75be26681ae90824cde8f8df785981f293667e1",
+                "url": "https://api.github.com/repos/Codeception/module-sequence/zipball/9738e2eb06035a0975171a0aa3fce00d284b4dfb",
+                "reference": "9738e2eb06035a0975171a0aa3fce00d284b4dfb",
                 "shasum": ""
             },
             "require": {
-                "codeception/codeception": "^4.0",
-                "php": ">=5.6.0 <9.0"
+                "codeception/codeception": "^5.0",
+                "php": "^8.0"
             },
             "type": "library",
             "autoload": {
+                "files": [
+                    "src/Codeception/Util/sq.php"
+                ],
                 "classmap": [
                     "src/"
                 ]
@@ -836,34 +863,39 @@
                 }
             ],
             "description": "Sequence module for Codeception",
-            "homepage": "http://codeception.com/",
+            "homepage": "https://codeception.com/",
             "keywords": [
                 "codeception"
             ],
             "support": {
                 "issues": "https://github.com/Codeception/module-sequence/issues",
-                "source": "https://github.com/Codeception/module-sequence/tree/1.0.1"
+                "source": "https://github.com/Codeception/module-sequence/tree/3.0.0"
             },
-            "time": "2020-10-31T18:36:26+00:00"
+            "time": "2022-05-31T05:45:36+00:00"
         },
         {
             "name": "codeception/module-webdriver",
-            "version": "1.4.1",
+            "version": "3.2.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/module-webdriver.git",
-                "reference": "e22ac7da756df659df6dd4fac2dff9c859e30131"
+                "reference": "59b6fe426dddbe889c23593f8698c52e08bba6e9"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/module-webdriver/zipball/e22ac7da756df659df6dd4fac2dff9c859e30131",
-                "reference": "e22ac7da756df659df6dd4fac2dff9c859e30131",
+                "url": "https://api.github.com/repos/Codeception/module-webdriver/zipball/59b6fe426dddbe889c23593f8698c52e08bba6e9",
+                "reference": "59b6fe426dddbe889c23593f8698c52e08bba6e9",
                 "shasum": ""
             },
             "require": {
-                "codeception/codeception": "^4.0",
-                "php": ">=5.6.0 <9.0",
-                "php-webdriver/webdriver": "^1.8.0"
+                "codeception/codeception": "^5.0.0-RC2",
+                "codeception/lib-web": "^1.0.1",
+                "codeception/stub": "^4.0",
+                "ext-json": "*",
+                "ext-mbstring": "*",
+                "php": "^8.0",
+                "php-webdriver/webdriver": "^1.8.0",
+                "phpunit/phpunit": "^9.5"
             },
             "suggest": {
                 "codeception/phpbuiltinserver": "Start and stop PHP built-in web server for your tests"
@@ -890,7 +922,7 @@
                 }
             ],
             "description": "WebDriver module for Codeception",
-            "homepage": "http://codeception.com/",
+            "homepage": "https://codeception.com/",
             "keywords": [
                 "acceptance-testing",
                 "browser-testing",
@@ -898,77 +930,31 @@
             ],
             "support": {
                 "issues": "https://github.com/Codeception/module-webdriver/issues",
-                "source": "https://github.com/Codeception/module-webdriver/tree/1.4.1"
-            },
-            "time": "2022-09-12T05:09:51+00:00"
-        },
-        {
-            "name": "codeception/phpunit-wrapper",
-            "version": "9.0.9",
-            "source": {
-                "type": "git",
-                "url": "https://github.com/Codeception/phpunit-wrapper.git",
-                "reference": "7439a53ae367986e9c22b2ac00f9d7376bb2f8cf"
-            },
-            "dist": {
-                "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/phpunit-wrapper/zipball/7439a53ae367986e9c22b2ac00f9d7376bb2f8cf",
-                "reference": "7439a53ae367986e9c22b2ac00f9d7376bb2f8cf",
-                "shasum": ""
-            },
-            "require": {
-                "php": ">=7.2",
-                "phpunit/phpunit": "^9.0"
-            },
-            "require-dev": {
-                "codeception/specify": "*",
-                "consolidation/robo": "^3.0.0-alpha3",
-                "vlucas/phpdotenv": "^3.0"
-            },
-            "type": "library",
-            "autoload": {
-                "psr-4": {
-                    "Codeception\\PHPUnit\\": "src/"
-                }
-            },
-            "notification-url": "https://packagist.org/downloads/",
-            "license": [
-                "MIT"
-            ],
-            "authors": [
-                {
-                    "name": "Davert",
-                    "email": "davert.php@resend.cc"
-                },
-                {
-                    "name": "Naktibalda"
-                }
-            ],
-            "description": "PHPUnit classes used by Codeception",
-            "support": {
-                "issues": "https://github.com/Codeception/phpunit-wrapper/issues",
-                "source": "https://github.com/Codeception/phpunit-wrapper/tree/9.0.9"
+                "source": "https://github.com/Codeception/module-webdriver/tree/3.2.1"
             },
-            "time": "2022-05-23T06:24:11+00:00"
+            "time": "2023-02-03T21:46:32+00:00"
         },
         {
             "name": "codeception/stub",
-            "version": "4.0.2",
+            "version": "4.1.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/Codeception/Stub.git",
-                "reference": "18a148dacd293fc7b044042f5aa63a82b08bff5d"
+                "reference": "58751aed08a68ae960a952fd3fe74ee9a56cdb1b"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/Codeception/Stub/zipball/18a148dacd293fc7b044042f5aa63a82b08bff5d",
-                "reference": "18a148dacd293fc7b044042f5aa63a82b08bff5d",
+                "url": "https://api.github.com/repos/Codeception/Stub/zipball/58751aed08a68ae960a952fd3fe74ee9a56cdb1b",
+                "reference": "58751aed08a68ae960a952fd3fe74ee9a56cdb1b",
                 "shasum": ""
             },
             "require": {
                 "php": "^7.4 | ^8.0",
                 "phpunit/phpunit": "^8.4 | ^9.0 | ^10.0 | 10.0.x-dev"
             },
+            "conflict": {
+                "codeception/codeception": "<5.0.6"
+            },
             "require-dev": {
                 "consolidation/robo": "^3.0"
             },
@@ -985,9 +971,9 @@
             "description": "Flexible Stub wrapper for PHPUnit's Mock Builder",
             "support": {
                 "issues": "https://github.com/Codeception/Stub/issues",
-                "source": "https://github.com/Codeception/Stub/tree/4.0.2"
+                "source": "https://github.com/Codeception/Stub/tree/4.1.0"
             },
-            "time": "2022-01-31T19:25:15+00:00"
+            "time": "2022-12-27T18:41:43+00:00"
         },
         {
             "name": "composer/ca-bundle",
@@ -1140,16 +1126,16 @@
         },
         {
             "name": "composer/composer",
-            "version": "2.5.4",
+            "version": "2.5.5",
             "source": {
                 "type": "git",
                 "url": "https://github.com/composer/composer.git",
-                "reference": "6b67eeea4d72051c369ccdbfb2423a56e2ab51a9"
+                "reference": "c7cffaad16a60636a776017eac5bd8cd0095c32f"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/composer/composer/zipball/6b67eeea4d72051c369ccdbfb2423a56e2ab51a9",
-                "reference": "6b67eeea4d72051c369ccdbfb2423a56e2ab51a9",
+                "url": "https://api.github.com/repos/composer/composer/zipball/c7cffaad16a60636a776017eac5bd8cd0095c32f",
+                "reference": "c7cffaad16a60636a776017eac5bd8cd0095c32f",
                 "shasum": ""
             },
             "require": {
@@ -1233,7 +1219,7 @@
             "support": {
                 "irc": "ircs://irc.libera.chat:6697/composer",
                 "issues": "https://github.com/composer/composer/issues",
-                "source": "https://github.com/composer/composer/tree/2.5.4"
+                "source": "https://github.com/composer/composer/tree/2.5.5"
             },
             "funding": [
                 {
@@ -1249,7 +1235,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-02-15T12:10:06+00:00"
+            "time": "2023-03-21T10:50:05+00:00"
         },
         {
             "name": "composer/metadata-minifier",
@@ -1949,22 +1935,22 @@
         },
         {
             "name": "guzzlehttp/guzzle",
-            "version": "7.5.0",
+            "version": "7.5.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/guzzle/guzzle.git",
-                "reference": "b50a2a1251152e43f6a37f0fa053e730a67d25ba"
+                "reference": "b964ca597e86b752cd994f27293e9fa6b6a95ed9"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/guzzle/guzzle/zipball/b50a2a1251152e43f6a37f0fa053e730a67d25ba",
-                "reference": "b50a2a1251152e43f6a37f0fa053e730a67d25ba",
+                "url": "https://api.github.com/repos/guzzle/guzzle/zipball/b964ca597e86b752cd994f27293e9fa6b6a95ed9",
+                "reference": "b964ca597e86b752cd994f27293e9fa6b6a95ed9",
                 "shasum": ""
             },
             "require": {
                 "ext-json": "*",
                 "guzzlehttp/promises": "^1.5",
-                "guzzlehttp/psr7": "^1.9 || ^2.4",
+                "guzzlehttp/psr7": "^1.9.1 || ^2.4.5",
                 "php": "^7.2.5 || ^8.0",
                 "psr/http-client": "^1.0",
                 "symfony/deprecation-contracts": "^2.2 || ^3.0"
@@ -2057,7 +2043,7 @@
             ],
             "support": {
                 "issues": "https://github.com/guzzle/guzzle/issues",
-                "source": "https://github.com/guzzle/guzzle/tree/7.5.0"
+                "source": "https://github.com/guzzle/guzzle/tree/7.5.1"
             },
             "funding": [
                 {
@@ -2073,7 +2059,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-08-28T15:39:27+00:00"
+            "time": "2023-04-17T16:30:08+00:00"
         },
         {
             "name": "guzzlehttp/promises",
@@ -2161,22 +2147,22 @@
         },
         {
             "name": "guzzlehttp/psr7",
-            "version": "2.4.3",
+            "version": "2.5.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/guzzle/psr7.git",
-                "reference": "67c26b443f348a51926030c83481b85718457d3d"
+                "reference": "b635f279edd83fc275f822a1188157ffea568ff6"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/guzzle/psr7/zipball/67c26b443f348a51926030c83481b85718457d3d",
-                "reference": "67c26b443f348a51926030c83481b85718457d3d",
+                "url": "https://api.github.com/repos/guzzle/psr7/zipball/b635f279edd83fc275f822a1188157ffea568ff6",
+                "reference": "b635f279edd83fc275f822a1188157ffea568ff6",
                 "shasum": ""
             },
             "require": {
                 "php": "^7.2.5 || ^8.0",
                 "psr/http-factory": "^1.0",
-                "psr/http-message": "^1.0",
+                "psr/http-message": "^1.1 || ^2.0",
                 "ralouphie/getallheaders": "^3.0"
             },
             "provide": {
@@ -2196,9 +2182,6 @@
                 "bamarni-bin": {
                     "bin-links": true,
                     "forward-command": false
-                },
-                "branch-alias": {
-                    "dev-master": "2.4-dev"
                 }
             },
             "autoload": {
@@ -2260,7 +2243,7 @@
             ],
             "support": {
                 "issues": "https://github.com/guzzle/psr7/issues",
-                "source": "https://github.com/guzzle/psr7/tree/2.4.3"
+                "source": "https://github.com/guzzle/psr7/tree/2.5.0"
             },
             "funding": [
                 {
@@ -2276,167 +2259,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-10-26T14:07:24+00:00"
-        },
-        {
-            "name": "jms/metadata",
-            "version": "2.8.0",
-            "source": {
-                "type": "git",
-                "url": "https://github.com/schmittjoh/metadata.git",
-                "reference": "7ca240dcac0c655eb15933ee55736ccd2ea0d7a6"
-            },
-            "dist": {
-                "type": "zip",
-                "url": "https://api.github.com/repos/schmittjoh/metadata/zipball/7ca240dcac0c655eb15933ee55736ccd2ea0d7a6",
-                "reference": "7ca240dcac0c655eb15933ee55736ccd2ea0d7a6",
-                "shasum": ""
-            },
-            "require": {
-                "php": "^7.2|^8.0"
-            },
-            "require-dev": {
-                "doctrine/cache": "^1.0",
-                "doctrine/coding-standard": "^8.0",
-                "mikey179/vfsstream": "^1.6.7",
-                "phpunit/phpunit": "^8.5|^9.0",
-                "psr/container": "^1.0|^2.0",
-                "symfony/cache": "^3.1|^4.0|^5.0",
-                "symfony/dependency-injection": "^3.1|^4.0|^5.0"
-            },
-            "type": "library",
-            "extra": {
-                "branch-alias": {
-                    "dev-master": "2.x-dev"
-                }
-            },
-            "autoload": {
-                "psr-4": {
-                    "Metadata\\": "src/"
-                }
-            },
-            "notification-url": "https://packagist.org/downloads/",
-            "license": [
-                "MIT"
-            ],
-            "authors": [
-                {
-                    "name": "Johannes M. Schmitt",
-                    "email": "schmittjoh@gmail.com"
-                },
-                {
-                    "name": "Asmir Mustafic",
-                    "email": "goetas@gmail.com"
-                }
-            ],
-            "description": "Class/method/property metadata management in PHP",
-            "keywords": [
-                "annotations",
-                "metadata",
-                "xml",
-                "yaml"
-            ],
-            "support": {
-                "issues": "https://github.com/schmittjoh/metadata/issues",
-                "source": "https://github.com/schmittjoh/metadata/tree/2.8.0"
-            },
-            "time": "2023-02-15T13:44:18+00:00"
-        },
-        {
-            "name": "jms/serializer",
-            "version": "3.23.0",
-            "source": {
-                "type": "git",
-                "url": "https://github.com/schmittjoh/serializer.git",
-                "reference": "ac0b16ee5317d1aacc41deb91c6c325eae97c176"
-            },
-            "dist": {
-                "type": "zip",
-                "url": "https://api.github.com/repos/schmittjoh/serializer/zipball/ac0b16ee5317d1aacc41deb91c6c325eae97c176",
-                "reference": "ac0b16ee5317d1aacc41deb91c6c325eae97c176",
-                "shasum": ""
-            },
-            "require": {
-                "doctrine/annotations": "^1.13 || ^2.0",
-                "doctrine/instantiator": "^1.0.3",
-                "doctrine/lexer": "^1.1 || ^2",
-                "jms/metadata": "^2.6",
-                "php": "^7.2||^8.0",
-                "phpstan/phpdoc-parser": "^0.4 || ^0.5 || ^1.0"
-            },
-            "require-dev": {
-                "doctrine/coding-standard": "^8.1",
-                "doctrine/orm": "~2.1",
-                "doctrine/persistence": "^1.3.3|^2.0|^3.0",
-                "doctrine/phpcr-odm": "^1.3|^2.0",
-                "ext-pdo_sqlite": "*",
-                "jackalope/jackalope-doctrine-dbal": "^1.1.5",
-                "ocramius/proxy-manager": "^1.0|^2.0",
-                "phpbench/phpbench": "^1.0",
-                "phpstan/phpstan": "^1.0.2",
-                "phpunit/phpunit": "^8.5.21||^9.0",
-                "psr/container": "^1.0|^2.0",
-                "symfony/dependency-injection": "^3.0|^4.0|^5.0|^6.0",
-                "symfony/expression-language": "^3.2|^4.0|^5.0|^6.0",
-                "symfony/filesystem": "^3.0|^4.0|^5.0|^6.0",
-                "symfony/form": "^3.0|^4.0|^5.0|^6.0",
-                "symfony/translation": "^3.0|^4.0|^5.0|^6.0",
-                "symfony/uid": "^5.1|^6.0",
-                "symfony/validator": "^3.1.9|^4.0|^5.0|^6.0",
-                "symfony/yaml": "^3.3|^4.0|^5.0|^6.0",
-                "twig/twig": "~1.34|~2.4|^3.0"
-            },
-            "suggest": {
-                "doctrine/collections": "Required if you like to use doctrine collection types as ArrayCollection.",
-                "symfony/cache": "Required if you like to use cache functionality.",
-                "symfony/uid": "Required if you'd like to serialize UID objects.",
-                "symfony/yaml": "Required if you'd like to use the YAML metadata format."
-            },
-            "type": "library",
-            "extra": {
-                "branch-alias": {
-                    "dev-master": "3.x-dev"
-                }
-            },
-            "autoload": {
-                "psr-4": {
-                    "JMS\\Serializer\\": "src/"
-                }
-            },
-            "notification-url": "https://packagist.org/downloads/",
-            "license": [
-                "MIT"
-            ],
-            "authors": [
-                {
-                    "name": "Johannes M. Schmitt",
-                    "email": "schmittjoh@gmail.com"
-                },
-                {
-                    "name": "Asmir Mustafic",
-                    "email": "goetas@gmail.com"
-                }
-            ],
-            "description": "Library for (de-)serializing data of any complexity; supports XML, and JSON.",
-            "homepage": "http://jmsyst.com/libs/serializer",
-            "keywords": [
-                "deserialization",
-                "jaxb",
-                "json",
-                "serialization",
-                "xml"
-            ],
-            "support": {
-                "issues": "https://github.com/schmittjoh/serializer/issues",
-                "source": "https://github.com/schmittjoh/serializer/tree/3.23.0"
-            },
-            "funding": [
-                {
-                    "url": "https://github.com/goetas",
-                    "type": "github"
-                }
-            ],
-            "time": "2023-02-17T17:40:48+00:00"
+            "time": "2023-04-17T16:11:26+00:00"
         },
         {
             "name": "justinrainbow/json-schema",
@@ -2510,22 +2333,22 @@
         },
         {
             "name": "laminas/laminas-diactoros",
-            "version": "2.24.0",
+            "version": "2.25.2",
             "source": {
                 "type": "git",
                 "url": "https://github.com/laminas/laminas-diactoros.git",
-                "reference": "6028af6c3b5ced4d063a680d2483cce67578b902"
+                "reference": "9f3f4bf5b99c9538b6f1dbcc20f6fec357914f9e"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/laminas/laminas-diactoros/zipball/6028af6c3b5ced4d063a680d2483cce67578b902",
-                "reference": "6028af6c3b5ced4d063a680d2483cce67578b902",
+                "url": "https://api.github.com/repos/laminas/laminas-diactoros/zipball/9f3f4bf5b99c9538b6f1dbcc20f6fec357914f9e",
+                "reference": "9f3f4bf5b99c9538b6f1dbcc20f6fec357914f9e",
                 "shasum": ""
             },
             "require": {
                 "php": "~8.0.0 || ~8.1.0 || ~8.2.0",
                 "psr/http-factory": "^1.0",
-                "psr/http-message": "^1.0"
+                "psr/http-message": "^1.1"
             },
             "conflict": {
                 "zendframework/zend-diactoros": "*"
@@ -2540,11 +2363,11 @@
                 "ext-gd": "*",
                 "ext-libxml": "*",
                 "http-interop/http-factory-tests": "^0.9.0",
-                "laminas/laminas-coding-standard": "^2.4.0",
+                "laminas/laminas-coding-standard": "^2.5",
                 "php-http/psr7-integration-tests": "^1.2",
-                "phpunit/phpunit": "^9.5.27",
+                "phpunit/phpunit": "^9.5.28",
                 "psalm/plugin-phpunit": "^0.18.4",
-                "vimeo/psalm": "^5.4"
+                "vimeo/psalm": "^5.6"
             },
             "type": "library",
             "extra": {
@@ -2603,7 +2426,7 @@
                     "type": "community_bridge"
                 }
             ],
-            "time": "2022-12-20T12:22:40+00:00"
+            "time": "2023-04-17T15:44:17+00:00"
         },
         {
             "name": "monolog/monolog",
@@ -2820,16 +2643,16 @@
         },
         {
             "name": "myclabs/deep-copy",
-            "version": "1.11.0",
+            "version": "1.11.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/myclabs/DeepCopy.git",
-                "reference": "14daed4296fae74d9e3201d2c4925d1acb7aa614"
+                "reference": "7284c22080590fb39f2ffa3e9057f10a4ddd0e0c"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/myclabs/DeepCopy/zipball/14daed4296fae74d9e3201d2c4925d1acb7aa614",
-                "reference": "14daed4296fae74d9e3201d2c4925d1acb7aa614",
+                "url": "https://api.github.com/repos/myclabs/DeepCopy/zipball/7284c22080590fb39f2ffa3e9057f10a4ddd0e0c",
+                "reference": "7284c22080590fb39f2ffa3e9057f10a4ddd0e0c",
                 "shasum": ""
             },
             "require": {
@@ -2867,7 +2690,7 @@
             ],
             "support": {
                 "issues": "https://github.com/myclabs/DeepCopy/issues",
-                "source": "https://github.com/myclabs/DeepCopy/tree/1.11.0"
+                "source": "https://github.com/myclabs/DeepCopy/tree/1.11.1"
             },
             "funding": [
                 {
@@ -2875,20 +2698,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-03-03T13:19:32+00:00"
+            "time": "2023-03-08T13:26:56+00:00"
         },
         {
             "name": "nikic/php-parser",
-            "version": "v4.15.3",
+            "version": "v4.15.4",
             "source": {
                 "type": "git",
                 "url": "https://github.com/nikic/PHP-Parser.git",
-                "reference": "570e980a201d8ed0236b0a62ddf2c9cbb2034039"
+                "reference": "6bb5176bc4af8bcb7d926f88718db9b96a2d4290"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/nikic/PHP-Parser/zipball/570e980a201d8ed0236b0a62ddf2c9cbb2034039",
-                "reference": "570e980a201d8ed0236b0a62ddf2c9cbb2034039",
+                "url": "https://api.github.com/repos/nikic/PHP-Parser/zipball/6bb5176bc4af8bcb7d926f88718db9b96a2d4290",
+                "reference": "6bb5176bc4af8bcb7d926f88718db9b96a2d4290",
                 "shasum": ""
             },
             "require": {
@@ -2929,9 +2752,9 @@
             ],
             "support": {
                 "issues": "https://github.com/nikic/PHP-Parser/issues",
-                "source": "https://github.com/nikic/PHP-Parser/tree/v4.15.3"
+                "source": "https://github.com/nikic/PHP-Parser/tree/v4.15.4"
             },
-            "time": "2023-01-16T22:05:37+00:00"
+            "time": "2023-03-05T19:49:14+00:00"
         },
         {
             "name": "paragonie/constant_time_encoding",
@@ -3177,17 +3000,253 @@
             "time": "2022-10-11T11:49:44+00:00"
         },
         {
+            "name": "phpdocumentor/reflection-common",
+            "version": "2.2.0",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/phpDocumentor/ReflectionCommon.git",
+                "reference": "1d01c49d4ed62f25aa84a747ad35d5a16924662b"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/phpDocumentor/ReflectionCommon/zipball/1d01c49d4ed62f25aa84a747ad35d5a16924662b",
+                "reference": "1d01c49d4ed62f25aa84a747ad35d5a16924662b",
+                "shasum": ""
+            },
+            "require": {
+                "php": "^7.2 || ^8.0"
+            },
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-2.x": "2.x-dev"
+                }
+            },
+            "autoload": {
+                "psr-4": {
+                    "phpDocumentor\\Reflection\\": "src/"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Jaap van Otterdijk",
+                    "email": "opensource@ijaap.nl"
+                }
+            ],
+            "description": "Common reflection classes used by phpdocumentor to reflect the code structure",
+            "homepage": "http://www.phpdoc.org",
+            "keywords": [
+                "FQSEN",
+                "phpDocumentor",
+                "phpdoc",
+                "reflection",
+                "static analysis"
+            ],
+            "support": {
+                "issues": "https://github.com/phpDocumentor/ReflectionCommon/issues",
+                "source": "https://github.com/phpDocumentor/ReflectionCommon/tree/2.x"
+            },
+            "time": "2020-06-27T09:03:43+00:00"
+        },
+        {
+            "name": "phpdocumentor/reflection-docblock",
+            "version": "5.3.0",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/phpDocumentor/ReflectionDocBlock.git",
+                "reference": "622548b623e81ca6d78b721c5e029f4ce664f170"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/phpDocumentor/ReflectionDocBlock/zipball/622548b623e81ca6d78b721c5e029f4ce664f170",
+                "reference": "622548b623e81ca6d78b721c5e029f4ce664f170",
+                "shasum": ""
+            },
+            "require": {
+                "ext-filter": "*",
+                "php": "^7.2 || ^8.0",
+                "phpdocumentor/reflection-common": "^2.2",
+                "phpdocumentor/type-resolver": "^1.3",
+                "webmozart/assert": "^1.9.1"
+            },
+            "require-dev": {
+                "mockery/mockery": "~1.3.2",
+                "psalm/phar": "^4.8"
+            },
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-master": "5.x-dev"
+                }
+            },
+            "autoload": {
+                "psr-4": {
+                    "phpDocumentor\\Reflection\\": "src"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Mike van Riel",
+                    "email": "me@mikevanriel.com"
+                },
+                {
+                    "name": "Jaap van Otterdijk",
+                    "email": "account@ijaap.nl"
+                }
+            ],
+            "description": "With this component, a library can provide support for annotations via DocBlocks or otherwise retrieve information that is embedded in a DocBlock.",
+            "support": {
+                "issues": "https://github.com/phpDocumentor/ReflectionDocBlock/issues",
+                "source": "https://github.com/phpDocumentor/ReflectionDocBlock/tree/5.3.0"
+            },
+            "time": "2021-10-19T17:43:47+00:00"
+        },
+        {
+            "name": "phpdocumentor/type-resolver",
+            "version": "1.7.1",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/phpDocumentor/TypeResolver.git",
+                "reference": "dfc078e8af9c99210337325ff5aa152872c98714"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/phpDocumentor/TypeResolver/zipball/dfc078e8af9c99210337325ff5aa152872c98714",
+                "reference": "dfc078e8af9c99210337325ff5aa152872c98714",
+                "shasum": ""
+            },
+            "require": {
+                "doctrine/deprecations": "^1.0",
+                "php": "^7.4 || ^8.0",
+                "phpdocumentor/reflection-common": "^2.0",
+                "phpstan/phpdoc-parser": "^1.13"
+            },
+            "require-dev": {
+                "ext-tokenizer": "*",
+                "phpbench/phpbench": "^1.2",
+                "phpstan/extension-installer": "^1.1",
+                "phpstan/phpstan": "^1.8",
+                "phpstan/phpstan-phpunit": "^1.1",
+                "phpunit/phpunit": "^9.5",
+                "rector/rector": "^0.13.9",
+                "vimeo/psalm": "^4.25"
+            },
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-1.x": "1.x-dev"
+                }
+            },
+            "autoload": {
+                "psr-4": {
+                    "phpDocumentor\\Reflection\\": "src"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Mike van Riel",
+                    "email": "me@mikevanriel.com"
+                }
+            ],
+            "description": "A PSR-5 based resolver of Class names, Types and Structural Element Names",
+            "support": {
+                "issues": "https://github.com/phpDocumentor/TypeResolver/issues",
+                "source": "https://github.com/phpDocumentor/TypeResolver/tree/1.7.1"
+            },
+            "time": "2023-03-27T19:02:04+00:00"
+        },
+        {
+            "name": "phpspec/prophecy",
+            "version": "v1.17.0",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/phpspec/prophecy.git",
+                "reference": "15873c65b207b07765dbc3c95d20fdf4a320cbe2"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/phpspec/prophecy/zipball/15873c65b207b07765dbc3c95d20fdf4a320cbe2",
+                "reference": "15873c65b207b07765dbc3c95d20fdf4a320cbe2",
+                "shasum": ""
+            },
+            "require": {
+                "doctrine/instantiator": "^1.2 || ^2.0",
+                "php": "^7.2 || 8.0.* || 8.1.* || 8.2.*",
+                "phpdocumentor/reflection-docblock": "^5.2",
+                "sebastian/comparator": "^3.0 || ^4.0",
+                "sebastian/recursion-context": "^3.0 || ^4.0"
+            },
+            "require-dev": {
+                "phpspec/phpspec": "^6.0 || ^7.0",
+                "phpstan/phpstan": "^1.9",
+                "phpunit/phpunit": "^8.0 || ^9.0"
+            },
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-master": "1.x-dev"
+                }
+            },
+            "autoload": {
+                "psr-4": {
+                    "Prophecy\\": "src/Prophecy"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Konstantin Kudryashov",
+                    "email": "ever.zet@gmail.com",
+                    "homepage": "http://everzet.com"
+                },
+                {
+                    "name": "Marcello Duarte",
+                    "email": "marcello.duarte@gmail.com"
+                }
+            ],
+            "description": "Highly opinionated mocking framework for PHP 5.3+",
+            "homepage": "https://github.com/phpspec/prophecy",
+            "keywords": [
+                "Double",
+                "Dummy",
+                "fake",
+                "mock",
+                "spy",
+                "stub"
+            ],
+            "support": {
+                "issues": "https://github.com/phpspec/prophecy/issues",
+                "source": "https://github.com/phpspec/prophecy/tree/v1.17.0"
+            },
+            "time": "2023-02-02T15:41:36+00:00"
+        },
+        {
             "name": "phpstan/phpdoc-parser",
-            "version": "1.16.1",
+            "version": "1.20.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/phpstan/phpdoc-parser.git",
-                "reference": "e27e92d939e2e3636f0a1f0afaba59692c0bf571"
+                "reference": "57f6787f0bb6431905a18aa7caea25dcd2bd59e0"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/phpstan/phpdoc-parser/zipball/e27e92d939e2e3636f0a1f0afaba59692c0bf571",
-                "reference": "e27e92d939e2e3636f0a1f0afaba59692c0bf571",
+                "url": "https://api.github.com/repos/phpstan/phpdoc-parser/zipball/57f6787f0bb6431905a18aa7caea25dcd2bd59e0",
+                "reference": "57f6787f0bb6431905a18aa7caea25dcd2bd59e0",
                 "shasum": ""
             },
             "require": {
@@ -3217,29 +3276,29 @@
             "description": "PHPDoc parser with support for nullable, intersection and generic types",
             "support": {
                 "issues": "https://github.com/phpstan/phpdoc-parser/issues",
-                "source": "https://github.com/phpstan/phpdoc-parser/tree/1.16.1"
+                "source": "https://github.com/phpstan/phpdoc-parser/tree/1.20.1"
             },
-            "time": "2023-02-07T18:11:17+00:00"
+            "time": "2023-04-22T09:05:52+00:00"
         },
         {
             "name": "phpunit/php-code-coverage",
-            "version": "9.2.24",
+            "version": "9.2.26",
             "source": {
                 "type": "git",
                 "url": "https://github.com/sebastianbergmann/php-code-coverage.git",
-                "reference": "2cf940ebc6355a9d430462811b5aaa308b174bed"
+                "reference": "443bc6912c9bd5b409254a40f4b0f4ced7c80ea1"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/sebastianbergmann/php-code-coverage/zipball/2cf940ebc6355a9d430462811b5aaa308b174bed",
-                "reference": "2cf940ebc6355a9d430462811b5aaa308b174bed",
+                "url": "https://api.github.com/repos/sebastianbergmann/php-code-coverage/zipball/443bc6912c9bd5b409254a40f4b0f4ced7c80ea1",
+                "reference": "443bc6912c9bd5b409254a40f4b0f4ced7c80ea1",
                 "shasum": ""
             },
             "require": {
                 "ext-dom": "*",
                 "ext-libxml": "*",
                 "ext-xmlwriter": "*",
-                "nikic/php-parser": "^4.14",
+                "nikic/php-parser": "^4.15",
                 "php": ">=7.3",
                 "phpunit/php-file-iterator": "^3.0.3",
                 "phpunit/php-text-template": "^2.0.2",
@@ -3254,8 +3313,8 @@
                 "phpunit/phpunit": "^9.3"
             },
             "suggest": {
-                "ext-pcov": "*",
-                "ext-xdebug": "*"
+                "ext-pcov": "PHP extension that provides line coverage",
+                "ext-xdebug": "PHP extension that provides line coverage as well as branch and path coverage"
             },
             "type": "library",
             "extra": {
@@ -3288,7 +3347,7 @@
             ],
             "support": {
                 "issues": "https://github.com/sebastianbergmann/php-code-coverage/issues",
-                "source": "https://github.com/sebastianbergmann/php-code-coverage/tree/9.2.24"
+                "source": "https://github.com/sebastianbergmann/php-code-coverage/tree/9.2.26"
             },
             "funding": [
                 {
@@ -3296,7 +3355,7 @@
                     "type": "github"
                 }
             ],
-            "time": "2023-01-26T08:26:55+00:00"
+            "time": "2023-03-06T12:58:08+00:00"
         },
         {
             "name": "phpunit/php-file-iterator",
@@ -3541,20 +3600,20 @@
         },
         {
             "name": "phpunit/phpunit",
-            "version": "9.6.3",
+            "version": "9.5.20",
             "source": {
                 "type": "git",
                 "url": "https://github.com/sebastianbergmann/phpunit.git",
-                "reference": "e7b1615e3e887d6c719121c6d4a44b0ab9645555"
+                "reference": "12bc8879fb65aef2138b26fc633cb1e3620cffba"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/sebastianbergmann/phpunit/zipball/e7b1615e3e887d6c719121c6d4a44b0ab9645555",
-                "reference": "e7b1615e3e887d6c719121c6d4a44b0ab9645555",
+                "url": "https://api.github.com/repos/sebastianbergmann/phpunit/zipball/12bc8879fb65aef2138b26fc633cb1e3620cffba",
+                "reference": "12bc8879fb65aef2138b26fc633cb1e3620cffba",
                 "shasum": ""
             },
             "require": {
-                "doctrine/instantiator": "^1.3.1 || ^2",
+                "doctrine/instantiator": "^1.3.1",
                 "ext-dom": "*",
                 "ext-json": "*",
                 "ext-libxml": "*",
@@ -3565,6 +3624,7 @@
                 "phar-io/manifest": "^2.0.3",
                 "phar-io/version": "^3.0.2",
                 "php": ">=7.3",
+                "phpspec/prophecy": "^1.12.1",
                 "phpunit/php-code-coverage": "^9.2.13",
                 "phpunit/php-file-iterator": "^3.0.5",
                 "phpunit/php-invoker": "^3.1.1",
@@ -3572,16 +3632,20 @@
                 "phpunit/php-timer": "^5.0.2",
                 "sebastian/cli-parser": "^1.0.1",
                 "sebastian/code-unit": "^1.0.6",
-                "sebastian/comparator": "^4.0.8",
+                "sebastian/comparator": "^4.0.5",
                 "sebastian/diff": "^4.0.3",
                 "sebastian/environment": "^5.1.3",
-                "sebastian/exporter": "^4.0.5",
+                "sebastian/exporter": "^4.0.3",
                 "sebastian/global-state": "^5.0.1",
                 "sebastian/object-enumerator": "^4.0.3",
                 "sebastian/resource-operations": "^3.0.3",
-                "sebastian/type": "^3.2",
+                "sebastian/type": "^3.0",
                 "sebastian/version": "^3.0.2"
             },
+            "require-dev": {
+                "ext-pdo": "*",
+                "phpspec/prophecy-phpunit": "^2.0.1"
+            },
             "suggest": {
                 "ext-soap": "*",
                 "ext-xdebug": "*"
@@ -3592,7 +3656,7 @@
             "type": "library",
             "extra": {
                 "branch-alias": {
-                    "dev-master": "9.6-dev"
+                    "dev-master": "9.5-dev"
                 }
             },
             "autoload": {
@@ -3623,7 +3687,7 @@
             ],
             "support": {
                 "issues": "https://github.com/sebastianbergmann/phpunit/issues",
-                "source": "https://github.com/sebastianbergmann/phpunit/tree/9.6.3"
+                "source": "https://github.com/sebastianbergmann/phpunit/tree/9.5.20"
             },
             "funding": [
                 {
@@ -3633,13 +3697,9 @@
                 {
                     "url": "https://github.com/sebastianbergmann",
                     "type": "github"
-                },
-                {
-                    "url": "https://tidelift.com/funding/github/packagist/phpunit/phpunit",
-                    "type": "tidelift"
                 }
             ],
-            "time": "2023-02-04T13:37:15+00:00"
+            "time": "2022-04-01T12:37:26+00:00"
         },
         {
             "name": "psr/cache",
@@ -3795,21 +3855,21 @@
         },
         {
             "name": "psr/http-client",
-            "version": "1.0.1",
+            "version": "1.0.2",
             "source": {
                 "type": "git",
                 "url": "https://github.com/php-fig/http-client.git",
-                "reference": "2dfb5f6c5eff0e91e20e913f8c5452ed95b86621"
+                "reference": "0955afe48220520692d2d09f7ab7e0f93ffd6a31"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/php-fig/http-client/zipball/2dfb5f6c5eff0e91e20e913f8c5452ed95b86621",
-                "reference": "2dfb5f6c5eff0e91e20e913f8c5452ed95b86621",
+                "url": "https://api.github.com/repos/php-fig/http-client/zipball/0955afe48220520692d2d09f7ab7e0f93ffd6a31",
+                "reference": "0955afe48220520692d2d09f7ab7e0f93ffd6a31",
                 "shasum": ""
             },
             "require": {
                 "php": "^7.0 || ^8.0",
-                "psr/http-message": "^1.0"
+                "psr/http-message": "^1.0 || ^2.0"
             },
             "type": "library",
             "extra": {
@@ -3829,7 +3889,7 @@
             "authors": [
                 {
                     "name": "PHP-FIG",
-                    "homepage": "http://www.php-fig.org/"
+                    "homepage": "https://www.php-fig.org/"
                 }
             ],
             "description": "Common interface for HTTP clients",
@@ -3841,27 +3901,27 @@
                 "psr-18"
             ],
             "support": {
-                "source": "https://github.com/php-fig/http-client/tree/master"
+                "source": "https://github.com/php-fig/http-client/tree/1.0.2"
             },
-            "time": "2020-06-29T06:28:15+00:00"
+            "time": "2023-04-10T20:12:12+00:00"
         },
         {
             "name": "psr/http-factory",
-            "version": "1.0.1",
+            "version": "1.0.2",
             "source": {
                 "type": "git",
                 "url": "https://github.com/php-fig/http-factory.git",
-                "reference": "12ac7fcd07e5b077433f5f2bee95b3a771bf61be"
+                "reference": "e616d01114759c4c489f93b099585439f795fe35"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/php-fig/http-factory/zipball/12ac7fcd07e5b077433f5f2bee95b3a771bf61be",
-                "reference": "12ac7fcd07e5b077433f5f2bee95b3a771bf61be",
+                "url": "https://api.github.com/repos/php-fig/http-factory/zipball/e616d01114759c4c489f93b099585439f795fe35",
+                "reference": "e616d01114759c4c489f93b099585439f795fe35",
                 "shasum": ""
             },
             "require": {
                 "php": ">=7.0.0",
-                "psr/http-message": "^1.0"
+                "psr/http-message": "^1.0 || ^2.0"
             },
             "type": "library",
             "extra": {
@@ -3881,7 +3941,7 @@
             "authors": [
                 {
                     "name": "PHP-FIG",
-                    "homepage": "http://www.php-fig.org/"
+                    "homepage": "https://www.php-fig.org/"
                 }
             ],
             "description": "Common interfaces for PSR-7 HTTP message factories",
@@ -3896,31 +3956,31 @@
                 "response"
             ],
             "support": {
-                "source": "https://github.com/php-fig/http-factory/tree/master"
+                "source": "https://github.com/php-fig/http-factory/tree/1.0.2"
             },
-            "time": "2019-04-30T12:38:16+00:00"
+            "time": "2023-04-10T20:10:41+00:00"
         },
         {
             "name": "psr/http-message",
-            "version": "1.0.1",
+            "version": "1.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/php-fig/http-message.git",
-                "reference": "f6561bf28d520154e4b0ec72be95418abe6d9363"
+                "reference": "cb6ce4845ce34a8ad9e68117c10ee90a29919eba"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/php-fig/http-message/zipball/f6561bf28d520154e4b0ec72be95418abe6d9363",
-                "reference": "f6561bf28d520154e4b0ec72be95418abe6d9363",
+                "url": "https://api.github.com/repos/php-fig/http-message/zipball/cb6ce4845ce34a8ad9e68117c10ee90a29919eba",
+                "reference": "cb6ce4845ce34a8ad9e68117c10ee90a29919eba",
                 "shasum": ""
             },
             "require": {
-                "php": ">=5.3.0"
+                "php": "^7.2 || ^8.0"
             },
             "type": "library",
             "extra": {
                 "branch-alias": {
-                    "dev-master": "1.0.x-dev"
+                    "dev-master": "1.1.x-dev"
                 }
             },
             "autoload": {
@@ -3949,9 +4009,9 @@
                 "response"
             ],
             "support": {
-                "source": "https://github.com/php-fig/http-message/tree/master"
+                "source": "https://github.com/php-fig/http-message/tree/1.1"
             },
-            "time": "2016-08-06T14:39:51+00:00"
+            "time": "2023-04-04T09:50:52+00:00"
         },
         {
             "name": "psr/log",
@@ -4004,6 +4064,82 @@
             "time": "2021-07-14T16:41:46+00:00"
         },
         {
+            "name": "psy/psysh",
+            "version": "v0.11.15",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/bobthecow/psysh.git",
+                "reference": "5350ce0ec8ecf2c5b5cf554cd2496f97b444af85"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/bobthecow/psysh/zipball/5350ce0ec8ecf2c5b5cf554cd2496f97b444af85",
+                "reference": "5350ce0ec8ecf2c5b5cf554cd2496f97b444af85",
+                "shasum": ""
+            },
+            "require": {
+                "ext-json": "*",
+                "ext-tokenizer": "*",
+                "nikic/php-parser": "^4.0 || ^3.1",
+                "php": "^8.0 || ^7.0.8",
+                "symfony/console": "^6.0 || ^5.0 || ^4.0 || ^3.4",
+                "symfony/var-dumper": "^6.0 || ^5.0 || ^4.0 || ^3.4"
+            },
+            "conflict": {
+                "symfony/console": "4.4.37 || 5.3.14 || 5.3.15 || 5.4.3 || 5.4.4 || 6.0.3 || 6.0.4"
+            },
+            "require-dev": {
+                "bamarni/composer-bin-plugin": "^1.2"
+            },
+            "suggest": {
+                "ext-pcntl": "Enabling the PCNTL extension makes PsySH a lot happier :)",
+                "ext-pdo-sqlite": "The doc command requires SQLite to work.",
+                "ext-posix": "If you have PCNTL, you'll want the POSIX extension as well.",
+                "ext-readline": "Enables support for arrow-key history navigation, and showing and manipulating command history."
+            },
+            "bin": [
+                "bin/psysh"
+            ],
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-main": "0.11.x-dev"
+                }
+            },
+            "autoload": {
+                "files": [
+                    "src/functions.php"
+                ],
+                "psr-4": {
+                    "Psy\\": "src/"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Justin Hileman",
+                    "email": "justin@justinhileman.info",
+                    "homepage": "http://justinhileman.com"
+                }
+            ],
+            "description": "An interactive shell for modern PHP.",
+            "homepage": "http://psysh.org",
+            "keywords": [
+                "REPL",
+                "console",
+                "interactive",
+                "shell"
+            ],
+            "support": {
+                "issues": "https://github.com/bobthecow/psysh/issues",
+                "source": "https://github.com/bobthecow/psysh/tree/v0.11.15"
+            },
+            "time": "2023-04-07T21:57:09+00:00"
+        },
+        {
             "name": "ralouphie/getallheaders",
             "version": "3.0.3",
             "source": {
@@ -4138,20 +4274,20 @@
         },
         {
             "name": "ramsey/uuid",
-            "version": "4.7.3",
+            "version": "4.7.4",
             "source": {
                 "type": "git",
                 "url": "https://github.com/ramsey/uuid.git",
-                "reference": "433b2014e3979047db08a17a205f410ba3869cf2"
+                "reference": "60a4c63ab724854332900504274f6150ff26d286"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/ramsey/uuid/zipball/433b2014e3979047db08a17a205f410ba3869cf2",
-                "reference": "433b2014e3979047db08a17a205f410ba3869cf2",
+                "url": "https://api.github.com/repos/ramsey/uuid/zipball/60a4c63ab724854332900504274f6150ff26d286",
+                "reference": "60a4c63ab724854332900504274f6150ff26d286",
                 "shasum": ""
             },
             "require": {
-                "brick/math": "^0.8.8 || ^0.9 || ^0.10",
+                "brick/math": "^0.8.8 || ^0.9 || ^0.10 || ^0.11",
                 "ext-json": "*",
                 "php": "^8.0",
                 "ramsey/collection": "^1.2 || ^2.0"
@@ -4214,7 +4350,7 @@
             ],
             "support": {
                 "issues": "https://github.com/ramsey/uuid/issues",
-                "source": "https://github.com/ramsey/uuid/tree/4.7.3"
+                "source": "https://github.com/ramsey/uuid/tree/4.7.4"
             },
             "funding": [
                 {
@@ -4226,7 +4362,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-12T18:13:24+00:00"
+            "time": "2023-04-15T23:01:58+00:00"
         },
         {
             "name": "react/promise",
@@ -5518,16 +5654,16 @@
         },
         {
             "name": "symfony/console",
-            "version": "v5.4.19",
+            "version": "v5.4.22",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/console.git",
-                "reference": "dccb8d251a9017d5994c988b034d3e18aaabf740"
+                "reference": "3cd51fd2e6c461ca678f84d419461281bd87a0a8"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/console/zipball/dccb8d251a9017d5994c988b034d3e18aaabf740",
-                "reference": "dccb8d251a9017d5994c988b034d3e18aaabf740",
+                "url": "https://api.github.com/repos/symfony/console/zipball/3cd51fd2e6c461ca678f84d419461281bd87a0a8",
+                "reference": "3cd51fd2e6c461ca678f84d419461281bd87a0a8",
                 "shasum": ""
             },
             "require": {
@@ -5592,12 +5728,12 @@
             "homepage": "https://symfony.com",
             "keywords": [
                 "cli",
-                "command line",
+                "command-line",
                 "console",
                 "terminal"
             ],
             "support": {
-                "source": "https://github.com/symfony/console/tree/v5.4.19"
+                "source": "https://github.com/symfony/console/tree/v5.4.22"
             },
             "funding": [
                 {
@@ -5613,25 +5749,24 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-03-25T09:27:28+00:00"
         },
         {
             "name": "symfony/css-selector",
-            "version": "v5.4.19",
+            "version": "v6.2.7",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/css-selector.git",
-                "reference": "f4a7d150f5b9e8f974f6f127d8167e420d11fc62"
+                "reference": "aedf3cb0f5b929ec255d96bbb4909e9932c769e0"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/css-selector/zipball/f4a7d150f5b9e8f974f6f127d8167e420d11fc62",
-                "reference": "f4a7d150f5b9e8f974f6f127d8167e420d11fc62",
+                "url": "https://api.github.com/repos/symfony/css-selector/zipball/aedf3cb0f5b929ec255d96bbb4909e9932c769e0",
+                "reference": "aedf3cb0f5b929ec255d96bbb4909e9932c769e0",
                 "shasum": ""
             },
             "require": {
-                "php": ">=7.2.5",
-                "symfony/polyfill-php80": "^1.16"
+                "php": ">=8.1"
             },
             "type": "library",
             "autoload": {
@@ -5663,7 +5798,7 @@
             "description": "Converts CSS selectors to XPath expressions",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/css-selector/tree/v5.4.19"
+                "source": "https://github.com/symfony/css-selector/tree/v6.2.7"
             },
             "funding": [
                 {
@@ -5679,20 +5814,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-02-14T08:44:56+00:00"
         },
         {
             "name": "symfony/deprecation-contracts",
-            "version": "v3.2.0",
+            "version": "v3.2.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/deprecation-contracts.git",
-                "reference": "1ee04c65529dea5d8744774d474e7cbd2f1206d3"
+                "reference": "e2d1534420bd723d0ef5aec58a22c5fe60ce6f5e"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/deprecation-contracts/zipball/1ee04c65529dea5d8744774d474e7cbd2f1206d3",
-                "reference": "1ee04c65529dea5d8744774d474e7cbd2f1206d3",
+                "url": "https://api.github.com/repos/symfony/deprecation-contracts/zipball/e2d1534420bd723d0ef5aec58a22c5fe60ce6f5e",
+                "reference": "e2d1534420bd723d0ef5aec58a22c5fe60ce6f5e",
                 "shasum": ""
             },
             "require": {
@@ -5730,7 +5865,7 @@
             "description": "A generic function and convention to trigger deprecation notices",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/deprecation-contracts/tree/v3.2.0"
+                "source": "https://github.com/symfony/deprecation-contracts/tree/v3.2.1"
             },
             "funding": [
                 {
@@ -5746,20 +5881,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-11-25T10:21:52+00:00"
+            "time": "2023-03-01T10:25:55+00:00"
         },
         {
             "name": "symfony/dotenv",
-            "version": "v5.4.19",
+            "version": "v5.4.22",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/dotenv.git",
-                "reference": "38190ba62566afa26ca723a795d0a004e061bd2a"
+                "reference": "77b7660bfcb85e8f28287d557d7af0046bcd2ca3"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/dotenv/zipball/38190ba62566afa26ca723a795d0a004e061bd2a",
-                "reference": "38190ba62566afa26ca723a795d0a004e061bd2a",
+                "url": "https://api.github.com/repos/symfony/dotenv/zipball/77b7660bfcb85e8f28287d557d7af0046bcd2ca3",
+                "reference": "77b7660bfcb85e8f28287d557d7af0046bcd2ca3",
                 "shasum": ""
             },
             "require": {
@@ -5801,7 +5936,7 @@
                 "environment"
             ],
             "support": {
-                "source": "https://github.com/symfony/dotenv/tree/v5.4.19"
+                "source": "https://github.com/symfony/dotenv/tree/v5.4.22"
             },
             "funding": [
                 {
@@ -5817,44 +5952,42 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-03-09T20:36:58+00:00"
         },
         {
             "name": "symfony/event-dispatcher",
-            "version": "v5.4.19",
+            "version": "v6.2.8",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/event-dispatcher.git",
-                "reference": "abf49cc084c087d94b4cb939c3f3672971784e0c"
+                "reference": "04046f35fd7d72f9646e721fc2ecb8f9c67d3339"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/event-dispatcher/zipball/abf49cc084c087d94b4cb939c3f3672971784e0c",
-                "reference": "abf49cc084c087d94b4cb939c3f3672971784e0c",
+                "url": "https://api.github.com/repos/symfony/event-dispatcher/zipball/04046f35fd7d72f9646e721fc2ecb8f9c67d3339",
+                "reference": "04046f35fd7d72f9646e721fc2ecb8f9c67d3339",
                 "shasum": ""
             },
             "require": {
-                "php": ">=7.2.5",
-                "symfony/deprecation-contracts": "^2.1|^3",
-                "symfony/event-dispatcher-contracts": "^2|^3",
-                "symfony/polyfill-php80": "^1.16"
+                "php": ">=8.1",
+                "symfony/event-dispatcher-contracts": "^2|^3"
             },
             "conflict": {
-                "symfony/dependency-injection": "<4.4"
+                "symfony/dependency-injection": "<5.4"
             },
             "provide": {
                 "psr/event-dispatcher-implementation": "1.0",
-                "symfony/event-dispatcher-implementation": "2.0"
+                "symfony/event-dispatcher-implementation": "2.0|3.0"
             },
             "require-dev": {
                 "psr/log": "^1|^2|^3",
-                "symfony/config": "^4.4|^5.0|^6.0",
-                "symfony/dependency-injection": "^4.4|^5.0|^6.0",
-                "symfony/error-handler": "^4.4|^5.0|^6.0",
-                "symfony/expression-language": "^4.4|^5.0|^6.0",
-                "symfony/http-foundation": "^4.4|^5.0|^6.0",
+                "symfony/config": "^5.4|^6.0",
+                "symfony/dependency-injection": "^5.4|^6.0",
+                "symfony/error-handler": "^5.4|^6.0",
+                "symfony/expression-language": "^5.4|^6.0",
+                "symfony/http-foundation": "^5.4|^6.0",
                 "symfony/service-contracts": "^1.1|^2|^3",
-                "symfony/stopwatch": "^4.4|^5.0|^6.0"
+                "symfony/stopwatch": "^5.4|^6.0"
             },
             "suggest": {
                 "symfony/dependency-injection": "",
@@ -5886,7 +6019,7 @@
             "description": "Provides tools that allow your application components to communicate with each other by dispatching events and listening to them",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/event-dispatcher/tree/v5.4.19"
+                "source": "https://github.com/symfony/event-dispatcher/tree/v6.2.8"
             },
             "funding": [
                 {
@@ -5902,20 +6035,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-03-20T16:06:02+00:00"
         },
         {
             "name": "symfony/event-dispatcher-contracts",
-            "version": "v3.2.0",
+            "version": "v3.2.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/event-dispatcher-contracts.git",
-                "reference": "0782b0b52a737a05b4383d0df35a474303cabdae"
+                "reference": "0ad3b6f1e4e2da5690fefe075cd53a238646d8dd"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/event-dispatcher-contracts/zipball/0782b0b52a737a05b4383d0df35a474303cabdae",
-                "reference": "0782b0b52a737a05b4383d0df35a474303cabdae",
+                "url": "https://api.github.com/repos/symfony/event-dispatcher-contracts/zipball/0ad3b6f1e4e2da5690fefe075cd53a238646d8dd",
+                "reference": "0ad3b6f1e4e2da5690fefe075cd53a238646d8dd",
                 "shasum": ""
             },
             "require": {
@@ -5965,7 +6098,7 @@
                 "standards"
             ],
             "support": {
-                "source": "https://github.com/symfony/event-dispatcher-contracts/tree/v3.2.0"
+                "source": "https://github.com/symfony/event-dispatcher-contracts/tree/v3.2.1"
             },
             "funding": [
                 {
@@ -5981,27 +6114,26 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-11-25T10:21:52+00:00"
+            "time": "2023-03-01T10:32:47+00:00"
         },
         {
             "name": "symfony/filesystem",
-            "version": "v5.4.19",
+            "version": "v6.2.7",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/filesystem.git",
-                "reference": "648bfaca6a494f3e22378123bcee2894045dc9d8"
+                "reference": "82b6c62b959f642d000456f08c6d219d749215b3"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/filesystem/zipball/648bfaca6a494f3e22378123bcee2894045dc9d8",
-                "reference": "648bfaca6a494f3e22378123bcee2894045dc9d8",
+                "url": "https://api.github.com/repos/symfony/filesystem/zipball/82b6c62b959f642d000456f08c6d219d749215b3",
+                "reference": "82b6c62b959f642d000456f08c6d219d749215b3",
                 "shasum": ""
             },
             "require": {
-                "php": ">=7.2.5",
+                "php": ">=8.1",
                 "symfony/polyfill-ctype": "~1.8",
-                "symfony/polyfill-mbstring": "~1.8",
-                "symfony/polyfill-php80": "^1.16"
+                "symfony/polyfill-mbstring": "~1.8"
             },
             "type": "library",
             "autoload": {
@@ -6029,7 +6161,7 @@
             "description": "Provides basic utilities for the filesystem",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/filesystem/tree/v5.4.19"
+                "source": "https://github.com/symfony/filesystem/tree/v6.2.7"
             },
             "funding": [
                 {
@@ -6045,20 +6177,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-14T19:14:44+00:00"
+            "time": "2023-02-14T08:44:56+00:00"
         },
         {
             "name": "symfony/finder",
-            "version": "v5.4.19",
+            "version": "v5.4.21",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/finder.git",
-                "reference": "6071aebf810ad13fe8200c224f36103abb37cf1f"
+                "reference": "078e9a5e1871fcfe6a5ce421b539344c21afef19"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/finder/zipball/6071aebf810ad13fe8200c224f36103abb37cf1f",
-                "reference": "6071aebf810ad13fe8200c224f36103abb37cf1f",
+                "url": "https://api.github.com/repos/symfony/finder/zipball/078e9a5e1871fcfe6a5ce421b539344c21afef19",
+                "reference": "078e9a5e1871fcfe6a5ce421b539344c21afef19",
                 "shasum": ""
             },
             "require": {
@@ -6092,7 +6224,7 @@
             "description": "Finds files and directories via an intuitive fluent interface",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/finder/tree/v5.4.19"
+                "source": "https://github.com/symfony/finder/tree/v5.4.21"
             },
             "funding": [
                 {
@@ -6108,20 +6240,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-14T19:14:44+00:00"
+            "time": "2023-02-16T09:33:00+00:00"
         },
         {
             "name": "symfony/http-foundation",
-            "version": "v5.4.20",
+            "version": "v5.4.22",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/http-foundation.git",
-                "reference": "d0435363362a47c14e9cf50663cb8ffbf491875a"
+                "reference": "05cd1acdd0e3ce8473aaba1d86c188321d85f313"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/http-foundation/zipball/d0435363362a47c14e9cf50663cb8ffbf491875a",
-                "reference": "d0435363362a47c14e9cf50663cb8ffbf491875a",
+                "url": "https://api.github.com/repos/symfony/http-foundation/zipball/05cd1acdd0e3ce8473aaba1d86c188321d85f313",
+                "reference": "05cd1acdd0e3ce8473aaba1d86c188321d85f313",
                 "shasum": ""
             },
             "require": {
@@ -6168,7 +6300,7 @@
             "description": "Defines an object-oriented layer for the HTTP specification",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/http-foundation/tree/v5.4.20"
+                "source": "https://github.com/symfony/http-foundation/tree/v5.4.22"
             },
             "funding": [
                 {
@@ -6184,20 +6316,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-29T11:11:52+00:00"
+            "time": "2023-03-28T07:28:17+00:00"
         },
         {
             "name": "symfony/mime",
-            "version": "v5.4.19",
+            "version": "v5.4.21",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/mime.git",
-                "reference": "a858429a9c704edc53fe057228cf9ca282ba48eb"
+                "reference": "ef57d9fb9cdd5e6b2ffc567d109865d10b6920cd"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/mime/zipball/a858429a9c704edc53fe057228cf9ca282ba48eb",
-                "reference": "a858429a9c704edc53fe057228cf9ca282ba48eb",
+                "url": "https://api.github.com/repos/symfony/mime/zipball/ef57d9fb9cdd5e6b2ffc567d109865d10b6920cd",
+                "reference": "ef57d9fb9cdd5e6b2ffc567d109865d10b6920cd",
                 "shasum": ""
             },
             "require": {
@@ -6252,7 +6384,7 @@
                 "mime-type"
             ],
             "support": {
-                "source": "https://github.com/symfony/mime/tree/v5.4.19"
+                "source": "https://github.com/symfony/mime/tree/v5.4.21"
             },
             "funding": [
                 {
@@ -6268,7 +6400,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-09T05:43:46+00:00"
+            "time": "2023-02-21T19:46:44+00:00"
         },
         {
             "name": "symfony/polyfill-ctype",
@@ -7006,16 +7138,16 @@
         },
         {
             "name": "symfony/process",
-            "version": "v5.4.19",
+            "version": "v5.4.22",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/process.git",
-                "reference": "c5ba874c9b636dbccf761e22ce750e88ec3f55e1"
+                "reference": "4b850da0cc3a2a9181c1ed407adbca4733dc839b"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/process/zipball/c5ba874c9b636dbccf761e22ce750e88ec3f55e1",
-                "reference": "c5ba874c9b636dbccf761e22ce750e88ec3f55e1",
+                "url": "https://api.github.com/repos/symfony/process/zipball/4b850da0cc3a2a9181c1ed407adbca4733dc839b",
+                "reference": "4b850da0cc3a2a9181c1ed407adbca4733dc839b",
                 "shasum": ""
             },
             "require": {
@@ -7048,7 +7180,7 @@
             "description": "Executes commands in sub-processes",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/process/tree/v5.4.19"
+                "source": "https://github.com/symfony/process/tree/v5.4.22"
             },
             "funding": [
                 {
@@ -7064,20 +7196,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-03-06T21:29:33+00:00"
         },
         {
             "name": "symfony/service-contracts",
-            "version": "v3.2.0",
+            "version": "v3.2.1",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/service-contracts.git",
-                "reference": "aac98028c69df04ee77eb69b96b86ee51fbf4b75"
+                "reference": "a8c9cedf55f314f3a186041d19537303766df09a"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/service-contracts/zipball/aac98028c69df04ee77eb69b96b86ee51fbf4b75",
-                "reference": "aac98028c69df04ee77eb69b96b86ee51fbf4b75",
+                "url": "https://api.github.com/repos/symfony/service-contracts/zipball/a8c9cedf55f314f3a186041d19537303766df09a",
+                "reference": "a8c9cedf55f314f3a186041d19537303766df09a",
                 "shasum": ""
             },
             "require": {
@@ -7133,7 +7265,7 @@
                 "standards"
             ],
             "support": {
-                "source": "https://github.com/symfony/service-contracts/tree/v3.2.0"
+                "source": "https://github.com/symfony/service-contracts/tree/v3.2.1"
             },
             "funding": [
                 {
@@ -7149,20 +7281,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-11-25T10:21:52+00:00"
+            "time": "2023-03-01T10:32:47+00:00"
         },
         {
             "name": "symfony/string",
-            "version": "v5.4.19",
+            "version": "v5.4.22",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/string.git",
-                "reference": "0a01071610fd861cc160dfb7e2682ceec66064cb"
+                "reference": "8036a4c76c0dd29e60b6a7cafcacc50cf088ea62"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/string/zipball/0a01071610fd861cc160dfb7e2682ceec66064cb",
-                "reference": "0a01071610fd861cc160dfb7e2682ceec66064cb",
+                "url": "https://api.github.com/repos/symfony/string/zipball/8036a4c76c0dd29e60b6a7cafcacc50cf088ea62",
+                "reference": "8036a4c76c0dd29e60b6a7cafcacc50cf088ea62",
                 "shasum": ""
             },
             "require": {
@@ -7219,7 +7351,7 @@
                 "utf8"
             ],
             "support": {
-                "source": "https://github.com/symfony/string/tree/v5.4.19"
+                "source": "https://github.com/symfony/string/tree/v5.4.22"
             },
             "funding": [
                 {
@@ -7235,32 +7367,119 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:32:19+00:00"
+            "time": "2023-03-14T06:11:53+00:00"
+        },
+        {
+            "name": "symfony/var-dumper",
+            "version": "v6.2.8",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/symfony/var-dumper.git",
+                "reference": "d37ab6787be2db993747b6218fcc96e8e3bb4bd0"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/symfony/var-dumper/zipball/d37ab6787be2db993747b6218fcc96e8e3bb4bd0",
+                "reference": "d37ab6787be2db993747b6218fcc96e8e3bb4bd0",
+                "shasum": ""
+            },
+            "require": {
+                "php": ">=8.1",
+                "symfony/polyfill-mbstring": "~1.0"
+            },
+            "conflict": {
+                "phpunit/phpunit": "<5.4.3",
+                "symfony/console": "<5.4"
+            },
+            "require-dev": {
+                "ext-iconv": "*",
+                "symfony/console": "^5.4|^6.0",
+                "symfony/process": "^5.4|^6.0",
+                "symfony/uid": "^5.4|^6.0",
+                "twig/twig": "^2.13|^3.0.4"
+            },
+            "suggest": {
+                "ext-iconv": "To convert non-UTF-8 strings to UTF-8 (or symfony/polyfill-iconv in case ext-iconv cannot be used).",
+                "ext-intl": "To show region name in time zone dump",
+                "symfony/console": "To use the ServerDumpCommand and/or the bin/var-dump-server script"
+            },
+            "bin": [
+                "Resources/bin/var-dump-server"
+            ],
+            "type": "library",
+            "autoload": {
+                "files": [
+                    "Resources/functions/dump.php"
+                ],
+                "psr-4": {
+                    "Symfony\\Component\\VarDumper\\": ""
+                },
+                "exclude-from-classmap": [
+                    "/Tests/"
+                ]
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Nicolas Grekas",
+                    "email": "p@tchwork.com"
+                },
+                {
+                    "name": "Symfony Community",
+                    "homepage": "https://symfony.com/contributors"
+                }
+            ],
+            "description": "Provides mechanisms for walking through any arbitrary PHP variable",
+            "homepage": "https://symfony.com",
+            "keywords": [
+                "debug",
+                "dump"
+            ],
+            "support": {
+                "source": "https://github.com/symfony/var-dumper/tree/v6.2.8"
+            },
+            "funding": [
+                {
+                    "url": "https://symfony.com/sponsor",
+                    "type": "custom"
+                },
+                {
+                    "url": "https://github.com/fabpot",
+                    "type": "github"
+                },
+                {
+                    "url": "https://tidelift.com/funding/github/packagist/symfony/symfony",
+                    "type": "tidelift"
+                }
+            ],
+            "time": "2023-03-29T21:42:15+00:00"
         },
         {
             "name": "symfony/yaml",
-            "version": "v5.4.19",
+            "version": "v6.2.7",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/yaml.git",
-                "reference": "71c05db20cb9b54d381a28255f17580e2b7e36a5"
+                "reference": "e8e6a1d59e050525f27a1f530aa9703423cb7f57"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/yaml/zipball/71c05db20cb9b54d381a28255f17580e2b7e36a5",
-                "reference": "71c05db20cb9b54d381a28255f17580e2b7e36a5",
+                "url": "https://api.github.com/repos/symfony/yaml/zipball/e8e6a1d59e050525f27a1f530aa9703423cb7f57",
+                "reference": "e8e6a1d59e050525f27a1f530aa9703423cb7f57",
                 "shasum": ""
             },
             "require": {
-                "php": ">=7.2.5",
-                "symfony/deprecation-contracts": "^2.1|^3",
+                "php": ">=8.1",
                 "symfony/polyfill-ctype": "^1.8"
             },
             "conflict": {
-                "symfony/console": "<5.3"
+                "symfony/console": "<5.4"
             },
             "require-dev": {
-                "symfony/console": "^5.3|^6.0"
+                "symfony/console": "^5.4|^6.0"
             },
             "suggest": {
                 "symfony/console": "For validating YAML files using the lint command"
@@ -7294,7 +7513,7 @@
             "description": "Loads and dumps YAML files",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/yaml/tree/v5.4.19"
+                "source": "https://github.com/symfony/yaml/tree/v6.2.7"
             },
             "funding": [
                 {
@@ -7310,20 +7529,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-10T18:51:14+00:00"
+            "time": "2023-02-16T09:57:23+00:00"
         },
         {
             "name": "thecodingmachine/safe",
-            "version": "v2.4.0",
+            "version": "v2.5.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/thecodingmachine/safe.git",
-                "reference": "e788f3d09dcd36f806350aedb77eac348fafadd3"
+                "reference": "3115ecd6b4391662b4931daac4eba6b07a2ac1f0"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/thecodingmachine/safe/zipball/e788f3d09dcd36f806350aedb77eac348fafadd3",
-                "reference": "e788f3d09dcd36f806350aedb77eac348fafadd3",
+                "url": "https://api.github.com/repos/thecodingmachine/safe/zipball/3115ecd6b4391662b4931daac4eba6b07a2ac1f0",
+                "reference": "3115ecd6b4391662b4931daac4eba6b07a2ac1f0",
                 "shasum": ""
             },
             "require": {
@@ -7447,9 +7666,9 @@
             "description": "PHP core functions that throw exceptions instead of returning FALSE on error",
             "support": {
                 "issues": "https://github.com/thecodingmachine/safe/issues",
-                "source": "https://github.com/thecodingmachine/safe/tree/v2.4.0"
+                "source": "https://github.com/thecodingmachine/safe/tree/v2.5.0"
             },
-            "time": "2022-10-07T14:02:17+00:00"
+            "time": "2023-04-05T11:54:14+00:00"
         },
         {
             "name": "theseer/tokenizer",
@@ -7502,6 +7721,64 @@
             "time": "2021-07-28T10:34:58+00:00"
         },
         {
+            "name": "webmozart/assert",
+            "version": "1.11.0",
+            "source": {
+                "type": "git",
+                "url": "https://github.com/webmozarts/assert.git",
+                "reference": "11cb2199493b2f8a3b53e7f19068fc6aac760991"
+            },
+            "dist": {
+                "type": "zip",
+                "url": "https://api.github.com/repos/webmozarts/assert/zipball/11cb2199493b2f8a3b53e7f19068fc6aac760991",
+                "reference": "11cb2199493b2f8a3b53e7f19068fc6aac760991",
+                "shasum": ""
+            },
+            "require": {
+                "ext-ctype": "*",
+                "php": "^7.2 || ^8.0"
+            },
+            "conflict": {
+                "phpstan/phpstan": "<0.12.20",
+                "vimeo/psalm": "<4.6.1 || 4.6.2"
+            },
+            "require-dev": {
+                "phpunit/phpunit": "^8.5.13"
+            },
+            "type": "library",
+            "extra": {
+                "branch-alias": {
+                    "dev-master": "1.10-dev"
+                }
+            },
+            "autoload": {
+                "psr-4": {
+                    "Webmozart\\Assert\\": "src/"
+                }
+            },
+            "notification-url": "https://packagist.org/downloads/",
+            "license": [
+                "MIT"
+            ],
+            "authors": [
+                {
+                    "name": "Bernhard Schussek",
+                    "email": "bschussek@gmail.com"
+                }
+            ],
+            "description": "Assertions to validate method input/output with nice error messages.",
+            "keywords": [
+                "assert",
+                "check",
+                "validate"
+            ],
+            "support": {
+                "issues": "https://github.com/webmozarts/assert/issues",
+                "source": "https://github.com/webmozarts/assert/tree/1.11.0"
+            },
+            "time": "2022-06-03T18:03:27+00:00"
+        },
+        {
             "name": "weew/helpers-array",
             "version": "v1.3.1",
             "source": {
@@ -7745,16 +8022,16 @@
         },
         {
             "name": "pdepend/pdepend",
-            "version": "2.12.1",
+            "version": "2.13.0",
             "source": {
                 "type": "git",
                 "url": "https://github.com/pdepend/pdepend.git",
-                "reference": "7a892d56ceafd804b4a2ecc85184640937ce9e84"
+                "reference": "31be7cd4f305f3f7b52af99c1cb13fc938d1cfad"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/pdepend/pdepend/zipball/7a892d56ceafd804b4a2ecc85184640937ce9e84",
-                "reference": "7a892d56ceafd804b4a2ecc85184640937ce9e84",
+                "url": "https://api.github.com/repos/pdepend/pdepend/zipball/31be7cd4f305f3f7b52af99c1cb13fc938d1cfad",
+                "reference": "31be7cd4f305f3f7b52af99c1cb13fc938d1cfad",
                 "shasum": ""
             },
             "require": {
@@ -7790,7 +8067,7 @@
             "description": "Official version of pdepend to be handled with Composer",
             "support": {
                 "issues": "https://github.com/pdepend/pdepend/issues",
-                "source": "https://github.com/pdepend/pdepend/tree/2.12.1"
+                "source": "https://github.com/pdepend/pdepend/tree/2.13.0"
             },
             "funding": [
                 {
@@ -7798,7 +8075,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2022-09-08T19:30:37+00:00"
+            "time": "2023-02-28T20:56:15+00:00"
         },
         {
             "name": "php-coveralls/php-coveralls",
@@ -8086,16 +8363,16 @@
         },
         {
             "name": "symfony/config",
-            "version": "v6.2.5",
+            "version": "v6.2.7",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/config.git",
-                "reference": "f31b3c78a3650157188a240695e688d6a182aa91"
+                "reference": "249271da6f545d6579e0663374f8249a80be2893"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/config/zipball/f31b3c78a3650157188a240695e688d6a182aa91",
-                "reference": "f31b3c78a3650157188a240695e688d6a182aa91",
+                "url": "https://api.github.com/repos/symfony/config/zipball/249271da6f545d6579e0663374f8249a80be2893",
+                "reference": "249271da6f545d6579e0663374f8249a80be2893",
                 "shasum": ""
             },
             "require": {
@@ -8143,7 +8420,7 @@
             "description": "Helps you find, load, combine, autofill and validate configuration values of any kind",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/config/tree/v6.2.5"
+                "source": "https://github.com/symfony/config/tree/v6.2.7"
             },
             "funding": [
                 {
@@ -8159,20 +8436,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-09T04:38:22+00:00"
+            "time": "2023-02-14T08:44:56+00:00"
         },
         {
             "name": "symfony/dependency-injection",
-            "version": "v6.2.6",
+            "version": "v6.2.8",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/dependency-injection.git",
-                "reference": "2a6dd148589b9db59717db8b75f8d9fbb2ae714f"
+                "reference": "b6195feacceb88fc58a02b69522b569e4c6188ac"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/dependency-injection/zipball/2a6dd148589b9db59717db8b75f8d9fbb2ae714f",
-                "reference": "2a6dd148589b9db59717db8b75f8d9fbb2ae714f",
+                "url": "https://api.github.com/repos/symfony/dependency-injection/zipball/b6195feacceb88fc58a02b69522b569e4c6188ac",
+                "reference": "b6195feacceb88fc58a02b69522b569e4c6188ac",
                 "shasum": ""
             },
             "require": {
@@ -8180,7 +8457,7 @@
                 "psr/container": "^1.1|^2.0",
                 "symfony/deprecation-contracts": "^2.1|^3",
                 "symfony/service-contracts": "^1.1.6|^2.0|^3.0",
-                "symfony/var-exporter": "^6.2"
+                "symfony/var-exporter": "^6.2.7"
             },
             "conflict": {
                 "ext-psr": "<1.1|>=2",
@@ -8230,7 +8507,7 @@
             "description": "Allows you to standardize and centralize the way objects are constructed in your application",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/dependency-injection/tree/v6.2.6"
+                "source": "https://github.com/symfony/dependency-injection/tree/v6.2.8"
             },
             "funding": [
                 {
@@ -8246,20 +8523,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-30T15:46:28+00:00"
+            "time": "2023-03-30T13:35:57+00:00"
         },
         {
             "name": "symfony/stopwatch",
-            "version": "v6.2.5",
+            "version": "v6.2.7",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/stopwatch.git",
-                "reference": "00b6ac156aacffc53487c930e0ab14587a6607f6"
+                "reference": "f3adc98c1061875dd2edcd45e5b04e63d0e29f8f"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/stopwatch/zipball/00b6ac156aacffc53487c930e0ab14587a6607f6",
-                "reference": "00b6ac156aacffc53487c930e0ab14587a6607f6",
+                "url": "https://api.github.com/repos/symfony/stopwatch/zipball/f3adc98c1061875dd2edcd45e5b04e63d0e29f8f",
+                "reference": "f3adc98c1061875dd2edcd45e5b04e63d0e29f8f",
                 "shasum": ""
             },
             "require": {
@@ -8292,7 +8569,7 @@
             "description": "Provides a way to profile code",
             "homepage": "https://symfony.com",
             "support": {
-                "source": "https://github.com/symfony/stopwatch/tree/v6.2.5"
+                "source": "https://github.com/symfony/stopwatch/tree/v6.2.7"
             },
             "funding": [
                 {
@@ -8308,20 +8585,20 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-01T08:36:55+00:00"
+            "time": "2023-02-14T08:44:56+00:00"
         },
         {
             "name": "symfony/var-exporter",
-            "version": "v6.2.5",
+            "version": "v6.2.8",
             "source": {
                 "type": "git",
                 "url": "https://github.com/symfony/var-exporter.git",
-                "reference": "108f9c6451eea8e04a7fb83bbacb5b812ef30e35"
+                "reference": "8302bb670204500d492c6b8c595ee9a27da62cd6"
             },
             "dist": {
                 "type": "zip",
-                "url": "https://api.github.com/repos/symfony/var-exporter/zipball/108f9c6451eea8e04a7fb83bbacb5b812ef30e35",
-                "reference": "108f9c6451eea8e04a7fb83bbacb5b812ef30e35",
+                "url": "https://api.github.com/repos/symfony/var-exporter/zipball/8302bb670204500d492c6b8c595ee9a27da62cd6",
+                "reference": "8302bb670204500d492c6b8c595ee9a27da62cd6",
                 "shasum": ""
             },
             "require": {
@@ -8361,12 +8638,12 @@
                 "export",
                 "hydrate",
                 "instantiate",
-                "lazy loading",
+                "lazy-loading",
                 "proxy",
                 "serialize"
             ],
             "support": {
-                "source": "https://github.com/symfony/var-exporter/tree/v6.2.5"
+                "source": "https://github.com/symfony/var-exporter/tree/v6.2.8"
             },
             "funding": [
                 {
@@ -8382,7 +8659,7 @@
                     "type": "tidelift"
                 }
             ],
-            "time": "2023-01-13T08:35:57+00:00"
+            "time": "2023-03-14T15:48:45+00:00"
         }
     ],
     "aliases": [],
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/unit/Magento/FunctionalTestFramework/Allure/AllureHelperTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/unit/Magento/FunctionalTestFramework/Allure/AllureHelperTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/unit/Magento/FunctionalTestFramework/Allure/AllureHelperTest.php	2023-05-30 09:55:07.512891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/unit/Magento/FunctionalTestFramework/Allure/AllureHelperTest.php	2023-05-03 05:08:55.000000000 +0100
@@ -8,158 +8,129 @@
 namespace tests\unit\Magento\FunctionalTestFramework\Allure;

 use Magento\FunctionalTestingFramework\Allure\AllureHelper;
-use Magento\FunctionalTestingFramework\Allure\Event\AddUniqueAttachmentEvent;
-use Magento\FunctionalTestingFramework\ObjectManager;
 use PHPUnit\Framework\TestCase;
-use ReflectionProperty;
-use Yandex\Allure\Adapter\Allure;
-use Yandex\Allure\Adapter\AllureException;
-use Yandex\Allure\Adapter\Event\StepFinishedEvent;
-use Yandex\Allure\Adapter\Event\StepStartedEvent;
-use Yandex\Allure\Adapter\Model\Attachment;
-
+use Qameta\Allure\Allure;
+use Qameta\Allure\Io\DataSourceFactory;
+use Qameta\Allure\Model\AttachmentResult;
+use Qameta\Allure\Model\ResultFactoryInterface;
+use Qameta\Allure\Setup\LifecycleBuilderInterface;
+use const STDOUT;
+
+/**
+ * @covers \Qameta\Allure\Allure
+ */
 class AllureHelperTest extends TestCase
 {
-    private const MOCK_FILENAME = 'filename';
+    public function setUp(): void
+    {
+        Allure::reset();
+    }

     /**
-     * The AddAttachmentToStep should add an attachment to the current step.
-     *
-     * @return void
-     * @throws AllureException
+     * @dataProvider providerAttachmentProperties
      */
-    public function testAddAttachmentToStep(): void
-    {
-        $expectedData = 'string';
-        $expectedCaption = 'caption';
-        $this->mockAttachmentWriteEvent($expectedData, $expectedCaption);
-
-        //Prepare Allure lifecycle
-        Allure::lifecycle()->fire(new StepStartedEvent('firstStep'));
-
-        //Call function
-        AllureHelper::addAttachmentToCurrentStep($expectedData, $expectedCaption);
-
-        // Assert Attachment is created as expected
-        $step = Allure::lifecycle()->getStepStorage()->pollLast();
-        $expectedAttachment = new Attachment($expectedCaption, self::MOCK_FILENAME, null);
-        $this->assertEquals($step->getAttachments()[0], $expectedAttachment);
+    public function testDoAddAttachmentMethod(
+        string $name,
+        $type,
+        ?string $fileExtension,
+    ): void {
+        $attachment = new AttachmentResult('a');
+        Allure::setLifecycleBuilder(
+            $this->createLifecycleBuilder($this->createResultFactoryWithAttachment($attachment)),
+        );
+
+        AllureHelper::doAddAttachment(
+            DataSourceFactory::fromFile('test'),
+            'nameOfTheFile',
+            'typeOfTheFile',
+            $fileExtension
+        );
+        self::assertSame('nameOfTheFile', $attachment->getName());
+        self::assertSame('typeOfTheFile', $attachment->getType());
     }

     /**
-     * The AddAttachmentToLastStep should add an attachment only to the last step.
-     *
-     * @return void
-     * @throws AllureException
+     * @dataProvider providerAttachmentProperties
      */
-    public function testAddAttachmentToLastStep(): void
-    {
-        $expectedData = 'string';
-        $expectedCaption = 'caption';
-        $this->mockAttachmentWriteEvent($expectedData, $expectedCaption);
-
-        //Prepare Allure lifecycle
-        Allure::lifecycle()->fire(new StepStartedEvent('firstStep'));
-        Allure::lifecycle()->fire(new StepFinishedEvent('firstStep'));
-        Allure::lifecycle()->fire(new StepStartedEvent('secondStep'));
-        Allure::lifecycle()->fire(new StepFinishedEvent('secondStep'));
-
-        //Call function
-        AllureHelper::addAttachmentToLastStep($expectedData, $expectedCaption);
-
-        //Continue Allure lifecycle
-        Allure::lifecycle()->fire(new StepStartedEvent('thirdStep'));
-        Allure::lifecycle()->fire(new StepFinishedEvent('thirdStep'));
-
-        // Assert Attachment is created as expected on the right step
-        $rootStep = Allure::lifecycle()->getStepStorage()->pollLast();
-
-        $firstStep = $rootStep->getSteps()[0];
-        $secondStep = $rootStep->getSteps()[1];
-        $thirdStep = $rootStep->getSteps()[2];
-
-        $expectedAttachment = new Attachment($expectedCaption, self::MOCK_FILENAME, null);
-        $this->assertEmpty($firstStep->getAttachments());
-        $this->assertEquals($secondStep->getAttachments()[0], $expectedAttachment);
-        $this->assertEmpty($thirdStep->getAttachments());
+    public function testAddAttachmentToStep(
+        string $name,
+        ?string $type,
+        ?string $fileExtension,
+    ): void {
+        $attachment = new AttachmentResult('a');
+        Allure::setLifecycleBuilder(
+            $this->createLifecycleBuilder($this->createResultFactoryWithAttachment($attachment)),
+        );
+
+        Allure::attachment($name, 'nameOfTheFile', $type, $fileExtension);
+        self::assertSame($name, $attachment->getName());
+        self::assertSame($type, $attachment->getType());
+        self::assertSame($fileExtension, $attachment->getFileExtension());
     }

     /**
-     * The AddAttachment actions should have files with different attachment names.
-     *
-     * @return void
-     * @throws AllureException
+     * @dataProvider providerAttachmentProperties
      */
-    public function testAddAttachmentUniqueName(): void
-    {
-        $expectedData = 'string';
-        $expectedCaption = 'caption';
-
-        //Prepare Allure lifecycle
-        Allure::lifecycle()->fire(new StepStartedEvent('firstStep'));
-
-        //Call function twice
-        AllureHelper::addAttachmentToCurrentStep($expectedData, $expectedCaption);
-        AllureHelper::addAttachmentToCurrentStep($expectedData, $expectedCaption);
-
-        // Assert file names for both attachments are not the same.
-        $step = Allure::lifecycle()->getStepStorage()->pollLast();
-        $attachmentOne = $step->getAttachments()[0]->getSource();
-        $attachmentTwo = $step->getAttachments()[1]->getSource();
-        $this->assertNotEquals($attachmentOne, $attachmentTwo);
+    public function testAddAttachmentFileToStep(
+        string $name,
+        ?string $type,
+        ?string $fileExtension,
+    ): void {
+        $attachment = new AttachmentResult('a');
+        Allure::setLifecycleBuilder(
+            $this->createLifecycleBuilder($this->createResultFactoryWithAttachment($attachment)),
+        );
+
+        Allure::attachmentFile($name, 'b', $type, '.html');
+        self::assertSame('c', $attachment->getName());
+        self::assertSame('.html', $attachment->getFileExtension());
     }

     /**
-     * Clear Allure Lifecycle.
-     *
-     * @return void
+     * @return iterable<string, array{string, string|null, string|null}>
      */
-    protected function tearDown(): void
+    public static function providerAttachmentProperties(): iterable
     {
-        Allure::setDefaultLifecycle();
-
-        $objectManagerProperty = new ReflectionProperty(ObjectManager::class, 'instance');
-        $objectManagerProperty->setAccessible(true);
-        $objectManagerProperty->setValue(null);
+        return [
+            'Only name' => ['c', null, null],
+            'Name and type' => ['c', 'd', null],
+            'Name and file extension' => ['c', null, 'd'],
+            'Name, type and file extension' => ['c', 'd', 'e'],
+        ];
     }

-    /**
-     * Mock entire attachment writing mechanisms.
-     *
-     * @param string $filePathOrContents
-     * @param string $caption
-     *
-     * @return void
-     */
-    private function mockAttachmentWriteEvent(string $filePathOrContents, string $caption): void
+    private function createResultFactoryWithAttachment(AttachmentResult $attachment): ResultFactoryInterface
     {
-        $mockInstance = $this->getMockBuilder(AddUniqueAttachmentEvent::class)
-            ->setConstructorArgs([$filePathOrContents, $caption])
-            ->disallowMockingUnknownTypes()
-            ->onlyMethods(['getAttachmentFileName'])
-            ->getMock();
-
-        $mockInstance
-            ->method('getAttachmentFileName')
-            ->willReturn(self::MOCK_FILENAME);
-
-        $objectManagerMockInstance = $this->createMock(ObjectManager::class);
-        $objectManagerMockInstance
-            ->method('create')
-            ->will(
-                $this->returnCallback(
-                    function (string $class) use ($mockInstance) {
-                        if ($class === AddUniqueAttachmentEvent::class) {
-                            return $mockInstance;
-                        }
-
-                        return null;
-                    }
-                )
-            );
-
-        $objectManagerProperty = new ReflectionProperty(ObjectManager::class, 'instance');
-        $objectManagerProperty->setAccessible(true);
-        $objectManagerProperty->setValue($objectManagerMockInstance, $objectManagerMockInstance);
+        $resultFactory = $this->createStub(ResultFactoryInterface::class);
+        $resultFactory
+            ->method('createAttachment')
+            ->willReturn($attachment);
+
+        return $resultFactory;
+    }
+
+    private function createLifecycleBuilder(
+        ?ResultFactoryInterface $resultFactory = null,
+        ?AllureLifecycleInterface $lifecycle = null,
+        ?StatusDetectorInterface $statusDetector = null,
+    ): LifecycleBuilderInterface {
+        $builder = $this->createStub(LifecycleBuilderInterface::class);
+        if (isset($resultFactory)) {
+            $builder
+                ->method('getResultFactory')
+                ->willReturn($resultFactory);
+        }
+        if (isset($lifecycle)) {
+            $builder
+                ->method('createLifecycle')
+                ->willReturn($lifecycle);
+        }
+        if (isset($statusDetector)) {
+            $builder
+                ->method('getStatusDetector')
+                ->willReturn($statusDetector);
+        }
+
+        return $builder;
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/ActionsInDifferentModulesSuite.txt /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/ActionsInDifferentModulesSuite.txt
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/ActionsInDifferentModulesSuite.txt	2023-05-30 09:55:07.520891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/ActionsInDifferentModulesSuite.txt	2023-05-03 05:08:55.000000000 +0100
@@ -120,7 +120,7 @@
                 //Access private TestResultObject to find stack and if there are any errors (as opposed to failures)
                 $testResultObject = call_user_func(\Closure::bind(
                     function () use ($cest) {
-                        return $cest->getTestResultObject();
+                        return $cest->getResultAggregator();
                     },
                     $cest
                 ));
@@ -128,7 +128,7 @@

                 if (!empty($errors)) {
                     foreach ($errors as $error) {
-                        if ($error->failedTest()->getTestMethod() == $cest->getName()) {
+                        if ($error->getTest()->getTestMethod() == $cest->getName()) {
                             // Do not attempt to run _after if failure was in the _after block
                             // Try to run _after but catch exceptions to prevent them from overwriting original failure.
                             print("LAST TEST IN SUITE FAILED, TEST AFTER MAY NOT BE SUCCESSFUL\n");
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteHooks.txt /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteHooks.txt
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteHooks.txt	2023-05-30 09:55:07.520891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteHooks.txt	2023-05-03 05:08:55.000000000 +0100
@@ -122,7 +122,7 @@
                 //Access private TestResultObject to find stack and if there are any errors (as opposed to failures)
                 $testResultObject = call_user_func(\Closure::bind(
                     function () use ($cest) {
-                        return $cest->getTestResultObject();
+                        return $cest->getResultAggregator();
                     },
                     $cest
                 ));
@@ -130,7 +130,7 @@

                 if (!empty($errors)) {
                     foreach ($errors as $error) {
-                        if ($error->failedTest()->getTestMethod() == $cest->getName()) {
+                        if ($error->getTest()->getTestMethod() == $cest->getName()) {
                             // Do not attempt to run _after if failure was in the _after block
                             // Try to run _after but catch exceptions to prevent them from overwriting original failure.
                             print("LAST TEST IN SUITE FAILED, TEST AFTER MAY NOT BE SUCCESSFUL\n");
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteWithComments.txt /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteWithComments.txt
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteWithComments.txt	2023-05-30 09:55:07.520891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/dev/tests/verification/Resources/functionalSuiteWithComments.txt	2023-05-03 05:08:55.000000000 +0100
@@ -106,7 +106,7 @@
                 //Access private TestResultObject to find stack and if there are any errors (as opposed to failures)
                 $testResultObject = call_user_func(\Closure::bind(
                     function () use ($cest) {
-                        return $cest->getTestResultObject();
+                        return $cest->getResultAggregator();
                     },
                     $cest
                 ));
@@ -114,7 +114,7 @@

                 if (!empty($errors)) {
                     foreach ($errors as $error) {
-                        if ($error->failedTest()->getTestMethod() == $cest->getName()) {
+                        if ($error->getTest()->getTestMethod() == $cest->getName()) {
                             // Do not attempt to run _after if failure was in the _after block
                             // Try to run _after but catch exceptions to prevent them from overwriting original failure.
                             print("LAST TEST IN SUITE FAILED, TEST AFTER MAY NOT BE SUCCESSFUL\n");
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/codeception.dist.yml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/codeception.dist.yml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/codeception.dist.yml	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/codeception.dist.yml	2023-05-03 05:08:55.000000000 +0100
@@ -7,6 +7,7 @@
     data: tests/_data
     support: src/Magento/FunctionalTestingFramework
     envs: etc/_envs
+    output: tests/_output
 settings:
     silent: true
     colors: true
@@ -15,9 +16,9 @@
     enabled:
         - Magento\FunctionalTestingFramework\Codeception\Subscriber\Console
         - Magento\FunctionalTestingFramework\Extension\TestContextExtension
-        - Magento\FunctionalTestingFramework\Allure\Adapter\MagentoAllureAdapter
+        - Qameta\Allure\Codeception\AllureCodeception
     config:
-        Magento\FunctionalTestingFramework\Allure\Adapter\MagentoAllureAdapter:
+        Qameta\Allure\Codeception\AllureCodeception:
             deletePreviousResults: false
             outputDirectory: allure-results
             ignoredAnnotations:
@@ -27,4 +28,4 @@
         Magento\FunctionalTestingFramework\Extension\TestContextExtension:
             driver: \Magento\FunctionalTestingFramework\Module\MagentoWebDriver
 params:
-    - .env
\ No newline at end of file
+    - .env
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/.env.example /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/.env.example
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/.env.example	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/.env.example	2023-05-03 05:08:55.000000000 +0100
@@ -57,7 +57,7 @@
 #ALLOW_SKIPPED=true

 #*** Default timeout for wait actions
-#WAIT_TIMEOUT=30
+WAIT_TIMEOUT=60

 #*** Uncomment and set to enable all tests, regardless of passing status, to have all their Allure artifacts.
 #VERBOSE_ARTIFACTS=true
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/functional.suite.dist.yml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/functional.suite.dist.yml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/etc/config/functional.suite.dist.yml	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/etc/config/functional.suite.dist.yml	2023-05-03 05:08:55.000000000 +0100
@@ -7,7 +7,7 @@
 # Perform tests in browser using the WebDriver or PhpBrowser.
 # If you need both WebDriver and PHPBrowser tests - create a separate suite.

-class_name: AcceptanceTester
+actor: AcceptanceTester
 namespace: Magento\FunctionalTestingFramework
 modules:
     enabled:
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Allure/AllureHelper.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Allure/AllureHelper.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Allure/AllureHelper.php	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Allure/AllureHelper.php	2023-05-03 05:08:55.000000000 +0100
@@ -7,10 +7,8 @@

 namespace Magento\FunctionalTestingFramework\Allure;

-use Magento\FunctionalTestingFramework\Allure\Event\AddUniqueAttachmentEvent;
-use Magento\FunctionalTestingFramework\ObjectManagerFactory;
-use Yandex\Allure\Adapter\Allure;
-use Yandex\Allure\Adapter\AllureException;
+use Qameta\Allure\Allure;
+use Qameta\Allure\Io\DataSourceInterface;

 class AllureHelper
 {
@@ -21,19 +19,17 @@
      * @param string $caption
      *
      * @return void
-     * @throws AllureException
      */
     public static function addAttachmentToCurrentStep($data, $caption): void
     {
-        /** @var AddUniqueAttachmentEvent $event */
-        $event = ObjectManagerFactory::getObjectManager()->create(
-            AddUniqueAttachmentEvent::class,
-            [
-                'filePathOrContents' => $data,
-                'caption' => $caption
-            ]
-        );
-        Allure::lifecycle()->fire($event);
+        if (!is_string($data)) {
+            $data = serialize($data);
+        }
+        if (@file_exists($data) && is_file($data)) {
+            Allure::attachmentFile($caption, $data);
+        } else {
+            Allure::attachment($caption, $data);
+        }
     }

     /**
@@ -47,22 +43,35 @@
      */
     public static function addAttachmentToLastStep($data, $caption): void
     {
-        $rootStep = Allure::lifecycle()->getStepStorage()->getLast();
-        $trueLastStep = array_last($rootStep->getSteps());
-
-        if ($trueLastStep === null) {
-            // Nothing to attach to; do not fire off allure event
-            return;
+        if (!is_string($data)) {
+            $data = serialize($data);
+        }
+        if (@file_exists($data) && is_file($data)) {
+            Allure::attachmentFile($caption, $data);
+        } else {
+            Allure::attachment($caption, $data);
         }
+    }

-        /** @var AddUniqueAttachmentEvent $attachmentEvent */
-        $attachmentEvent = ObjectManagerFactory::getObjectManager()->create(
-            AddUniqueAttachmentEvent::class,
-            [
-                'filePathOrContents' => $data,
-                'caption' => $caption
-            ]
-        );
-        $attachmentEvent->process($trueLastStep);
+    /**
+     * @param DataSourceInterface $dataSource
+     * @param string              $name
+     * @param string|null         $type
+     * @param string|null         $fileExtension
+     * @return void
+     */
+    public static function doAddAttachment(
+        DataSourceInterface $dataSource,
+        string $name,
+        ?string $type = null,
+        ?string $fileExtension = null,
+    ): void {
+        $attachment = Allure::getConfig()
+            ->getResultFactory()
+            ->createAttachment()
+            ->setName($name)
+            ->setType($type)
+            ->setFileExtension($fileExtension);
+        Allure::getLifecycle()->addAttachment($attachment, $dataSource);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Codeception/Subscriber/Console.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Codeception/Subscriber/Console.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Codeception/Subscriber/Console.php	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Codeception/Subscriber/Console.php	2023-05-03 05:08:55.000000000 +0100
@@ -70,9 +70,11 @@
      * @return void
      * @throws \Exception
      */
-    public function startTest(TestEvent $e)
+    public function startTest(TestEvent $e): void
     {
-        $test = $e->getTest()->getTestClass();
+        $test = $e->getTest();
+        $testReflection = new \ReflectionClass($test);
+
         try {
             $testReflection = new \ReflectionClass($test);
             $isDeprecated = preg_match_all(self::DEPRECATED_NOTICE, $testReflection->getDocComment(), $match);
@@ -99,7 +101,7 @@
      * @param StepEvent $e
      * @return void
      */
-    public function beforeStep(StepEvent $e)
+    public function beforeStep(StepEvent $e): void
     {
         if ($this->silent or !$this->steps or !$e->getTest() instanceof ScenarioDriven) {
             return;
@@ -162,7 +164,7 @@
             return; // don't print empty comments
         }

-        $stepKey = $this->retrieveStepKey($step->getLine());
+        $stepKey = $this->retrieveStepKey($step);

         $isActionGroup = (strpos($step->__toString(), ActionGroupObject::ACTION_GROUP_CONTEXT_START) !== false);
         if ($isActionGroup) {
@@ -220,13 +222,14 @@
     /**
      * Reading stepKey from file.
      *
-     * @param string $stepLine
+     * @param Step $step
      * @return string|null
      */
-    private function retrieveStepKey($stepLine)
+    private function retrieveStepKey(Step $step)
     {
         $stepKey = null;
-        list($filePath, $stepLine) = explode(":", $stepLine);
+        $stepLine = $step->getLineNumber();
+        $filePath = $step->getFilePath();
         $stepLine = $stepLine - 1;

         if (!array_key_exists($filePath, $this->testFiles)) {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Console/CodeceptRunCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Console/CodeceptRunCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Console/CodeceptRunCommand.php	2023-05-30 09:55:07.528891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Console/CodeceptRunCommand.php	2023-05-03 05:08:55.000000000 +0100
@@ -20,7 +20,7 @@
      *
      * @return void
      */
-    protected function configure()
+    protected function configure():void
     {
         $this->setName('codecept:run')
             ->setDescription(
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/DataGenerator/Objects/OperationDefinitionObject.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/DataGenerator/Objects/OperationDefinitionObject.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/DataGenerator/Objects/OperationDefinitionObject.php	2023-05-30 09:55:07.532891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/DataGenerator/Objects/OperationDefinitionObject.php	2023-05-03 05:08:55.000000000 +0100
@@ -167,7 +167,7 @@
         $this->operation = $operation;
         $this->dataType = $dataType;
         $this->apiMethod = $apiMethod;
-        $this->apiUri = trim($apiUri, '/');
+        $this->apiUri = trim($apiUri ?? '', '/');
         $this->auth = $auth;
         $this->headers = $headers;
         $this->params = $params;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Extension/TestContextExtension.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Extension/TestContextExtension.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Extension/TestContextExtension.php	2023-05-30 09:55:07.532891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Extension/TestContextExtension.php	2023-05-03 05:08:55.000000000 +0100
@@ -7,8 +7,18 @@
 namespace Magento\FunctionalTestingFramework\Extension;

 use Codeception\Events;
+use Codeception\Step;
 use Magento\FunctionalTestingFramework\Allure\AllureHelper;
 use Magento\FunctionalTestingFramework\DataGenerator\Handlers\PersistedObjectHandler;
+use Magento\FunctionalTestingFramework\Util\Logger\LoggingUtil;
+use Qameta\Allure\Allure;
+use Qameta\Allure\Model\StepResult;
+use Magento\FunctionalTestingFramework\Test\Objects\ActionObject;
+use Magento\FunctionalTestingFramework\Test\Objects\ActionGroupObject;
+use Magento\FunctionalTestingFramework\Util\TestGenerator;
+use Qameta\Allure\Model\TestResult;
+use Qameta\Allure\Model\Status;
+use Magento\FunctionalTestingFramework\Codeception\Subscriber\Console;

 /**
  * Class TestContextExtension
@@ -17,6 +27,28 @@
  */
 class TestContextExtension extends BaseExtension
 {
+    private const STEP_PASSED = "passed";
+
+    /**
+     * Test files cache.
+     *
+     * @var array
+     */
+    private $testFiles = [];
+
+    /**
+     * Action group step key.
+     *
+     * @var null|string
+     */
+    private $actionGroupStepKey = null;
+
+    /**
+     * Boolean value to indicate if steps are invisible steps
+     *
+     * @var boolean
+     */
+    private $atInvisibleSteps = false;
     const TEST_PHASE_AFTER = "_after";
     const TEST_PHASE_BEFORE = "_before";

@@ -44,7 +76,7 @@
      * @return void
      * @throws \Exception
      */
-    public function _initialize()
+    public function _initialize(): void
     {
         $events = [
             Events::TEST_START => 'testStart',
@@ -95,7 +127,7 @@
         //Access private TestResultObject to find stack and if there are any errors/failures
         $testResultObject = call_user_func(\Closure::bind(
             function () use ($cest) {
-                return $cest->getTestResultObject();
+                return $cest->getResultAggregator();
             },
             $cest
         ));
@@ -103,8 +135,8 @@
         // check for errors in all test hooks and attach in allure
         if (!empty($testResultObject->errors())) {
             foreach ($testResultObject->errors() as $error) {
-                if ($error->failedTest()->getTestMethod() === $cest->getTestMethod()) {
-                    $this->attachExceptionToAllure($error->thrownException(), $cest->getTestMethod());
+                if ($error->getTest()->getTestMethod() === $cest->getTestMethod()) {
+                    $this->attachExceptionToAllure($error->getFail(), $cest->getTestMethod());
                 }
             }
         }
@@ -112,13 +144,86 @@
         // check for failures in all test hooks and attach in allure
         if (!empty($testResultObject->failures())) {
             foreach ($testResultObject->failures() as $failure) {
-                if ($failure->failedTest()->getTestMethod() === $cest->getTestMethod()) {
-                    $this->attachExceptionToAllure($failure->thrownException(), $cest->getTestMethod());
+                if ($failure->getTest()->getTestMethod() === $cest->getTestMethod()) {
+                    $this->attachExceptionToAllure($failure->getFail(), $cest->getTestMethod());
                 }
             }
         }
         // Reset Session and Cookies after all Test Runs, workaround due to functional.suite.yml restart: true
         $this->getDriver()->_runAfter($e->getTest());
+
+        $lifecycle = Allure::getLifecycle();
+        $lifecycle->updateTest(
+            function (TestResult $testResult) {
+                $this->getFormattedSteps($testResult);
+            }
+        );
+    }
+
+    /**
+     * @param TestResult $testResult
+     * @return void
+     *
+     * @SuppressWarnings(PHPMD.CyclomaticComplexity)
+     * @SuppressWarnings(PHPMD.NPathComplexity)
+     * Revisited to reduce cyclomatic complexity, left unrefactored for readability
+     */
+    private function getFormattedSteps(TestResult $testResult): void
+    {
+        $steps = $testResult->getSteps();
+        $formattedSteps = [];
+        $actionGroupKey = null;
+        foreach ($steps as $key => $step) {
+            if (str_contains($step->getName(), 'start before hook')
+                || str_contains($step->getName(), 'end before hook')
+                || str_contains($step->getName(), 'start after hook')
+                || str_contains($step->getName(), 'end after hook')
+             ) {
+                 $step->setName(strtoupper($step->getName()));
+            }
+            // Remove all parameters from step because parameters already added in formatted step
+            call_user_func(\Closure::bind(
+                function () use ($step) {
+                    $step->parameters = [];
+                },
+                null,
+                $step
+            ));
+            if (strpos($step->getName(), ActionGroupObject::ACTION_GROUP_CONTEXT_START) !== false) {
+                $step->setName(str_replace(ActionGroupObject::ACTION_GROUP_CONTEXT_START, '', $step->getName()));
+                $actionGroupKey = $key;
+                $formattedSteps[$actionGroupKey] = $step;
+                continue;
+            }
+            if (stripos($step->getName(), ActionGroupObject::ACTION_GROUP_CONTEXT_END) !== false) {
+                $actionGroupKey = null;
+                continue;
+            }
+            if ($actionGroupKey !== null) {
+                if ($step->getName() !== null) {
+                    $formattedSteps[$actionGroupKey]->addSteps($step);
+                    if ($step->getStatus()->jsonSerialize() !== self::STEP_PASSED) {
+                        $formattedSteps[$actionGroupKey]->setStatus($step->getStatus());
+                        $actionGroupKey = null;
+                    }
+                }
+            } else {
+                if ($step->getName() !== null) {
+                    $formattedSteps[$key] = $step;
+                }
+            }
+        }
+        /** @var StepResult[] $formattedSteps*/
+        $formattedSteps = array_values($formattedSteps);
+
+        // No public function for setting the testResult steps
+        call_user_func(\Closure::bind(
+            function () use ($testResult, $formattedSteps) {
+                $testResult->steps = $formattedSteps;
+            },
+            null,
+            $testResult
+        ));
     }

     /**
@@ -170,7 +275,6 @@
                 return $this->getPrevious();
             }
         };
-
         $previousException = $change->call($exception);

         if ($previousException !== null) {
@@ -188,12 +292,88 @@
      */
     public function beforeStep(\Codeception\Event\StepEvent $e)
     {
+
         if ($this->pageChanged($e->getStep())) {
             $this->getDriver()->cleanJsError();
         }
     }

     /**
+     * @param \Codeception\Event\StepEvent $e
+     * @return string|void
+     *
+     * @SuppressWarnings(PHPMD.CyclomaticComplexity)
+     * @SuppressWarnings(PHPMD.NPathComplexity)
+     * Revisited to reduce cyclomatic complexity, left unrefactored for readability
+     */
+    public function stepName(\Codeception\Event\StepEvent $e)
+    {
+        $stepAction = $e->getStep()->getAction();
+        if (in_array($stepAction, ActionObject::INVISIBLE_STEP_ACTIONS)) {
+            $this->atInvisibleSteps = true;
+            return;
+        }
+        // Set back atInvisibleSteps flag
+        if ($this->atInvisibleSteps && !in_array($stepAction, ActionObject::INVISIBLE_STEP_ACTIONS)) {
+            $this->atInvisibleSteps = false;
+        }
+
+        //Hard set to 200; we don't expose this config in MFTF
+        $argumentsLength = 200;
+        $stepKey = null;
+
+        if (!($e->getStep() instanceof Comment)) {
+            $stepKey = $this->retrieveStepKeyForAllure($e->getStep(), $e->getTest()->getMetadata()->getFilename());
+            $isActionGroup = (
+                strpos(
+                    $e->getStep()->__toString(),
+                    ActionGroupObject::ACTION_GROUP_CONTEXT_START
+                ) !== false
+            );
+            if ($isActionGroup) {
+                preg_match(TestGenerator::ACTION_GROUP_STEP_KEY_REGEX, $e->getStep()->__toString(), $matches);
+                if (!empty($matches['actionGroupStepKey'])) {
+                    $this->actionGroupStepKey = ucfirst($matches['actionGroupStepKey']);
+                }
+            }
+        }
+        // DO NOT alter action if actionGroup is starting, need the exact actionGroup name for good logging
+        if (strpos($stepAction, ActionGroupObject::ACTION_GROUP_CONTEXT_START) === false
+            && !($e->getStep() instanceof Comment)
+        ) {
+            $stepAction = $e->getStep()->getHumanizedActionWithoutArguments();
+        }
+        $stepArgs = $e->getStep()->getArgumentsAsString($argumentsLength);
+        if (!trim($stepAction)) {
+            $stepAction = $e->getStep()->getMetaStep()->getHumanizedActionWithoutArguments();
+            $stepArgs = $e->getStep()->getMetaStep()->getArgumentsAsString($argumentsLength);
+        }
+        $stepName = '';
+
+        if (isset($stepName)) {
+            $stepName .= '[' . $stepKey . '] ';
+            if (empty($stepKey)) {
+                $stepName = "";
+            }
+        }
+        $stepName .= $stepAction . ' ' . $stepArgs;
+        // Strip control characters so that report generation does not fail
+        $stepName = preg_replace('/[[:cntrl:]]/', '', $stepName);
+        if (stripos($stepName, "\mftf\helper")) {
+            preg_match("/\[(.*?)\]/", $stepName, $matches);
+            $stepKeyData = preg_split('/\s+/', ucwords($matches[1]));
+            if (count($stepKeyData) > 0) {
+                $this->actionGroupStepKey = (isset($this->actionGroupStepKey))
+                    ?$this->actionGroupStepKey
+                    : "";
+                $stepKeyHelper = str_replace($this->actionGroupStepKey, '', lcfirst(implode("", $stepKeyData)));
+                $stepName= '['.$stepKeyHelper.'] '.preg_replace('#\[.*\]#', '', $stepName);
+            }
+        }
+        return ucfirst($stepName);
+    }
+
+    /**
      * Codeception event listener function, triggered after step.
      * Calls ErrorLogger to log JS errors encountered.
      * @param \Codeception\Event\StepEvent $e
@@ -202,6 +382,13 @@
      */
     public function afterStep(\Codeception\Event\StepEvent $e)
     {
+        $lifecycle = Allure::getLifecycle();
+        $stepName = $this->stepName($e);
+        $lifecycle->updateStep(
+            function (StepResult $step) use ($stepName) {
+                $step->setName($stepName);
+            }
+        );
         $browserLog = [];
         try {
             $browserLog = $this->getDriver()->webDriver->manage()->getLog("browser");
@@ -236,13 +423,13 @@
         }

         foreach ($result->failures() as $fail) {
-            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->failedTest()));
+            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->getTest()));
         }
         foreach ($result->errors() as $fail) {
-            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->failedTest()));
+            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->getTest()));
         }
-        foreach ($result->notImplemented() as $fail) {
-            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->failedTest()));
+        foreach ($result->incomplete() as $fail) {
+            $output[] = $this->localizePath(\Codeception\Test\Descriptor::getTestFullName($fail->getTest()));
         }

         if (empty($output)) {
@@ -265,4 +452,38 @@
         }
         return $path;
     }
+
+    /**
+     * Reading stepKey from file.
+     *
+     * @param Step   $step
+     * @param string $filePath
+     * @return string|null
+     */
+    private function retrieveStepKeyForAllure(Step $step, string $filePath)
+    {
+        $stepKey = null;
+        $stepLine = $step->getLineNumber();
+        $stepLine = $stepLine - 1;
+
+        //If the step's filepath is different from the test, it's a comment action.
+        if ($this->getRootDir() . $step->getFilePath() != $filePath) {
+            return "";
+        }
+
+        if (!array_key_exists($filePath, $this->testFiles)) {
+            $this->testFiles[$filePath] = explode(PHP_EOL, file_get_contents($filePath));
+        }
+
+        preg_match(TestGenerator::ACTION_STEP_KEY_REGEX, $this->testFiles[$filePath][$stepLine], $matches);
+        if (!empty($matches['stepKey'])) {
+            $stepKey = $matches['stepKey'];
+        }
+        if ($this->actionGroupStepKey !== null) {
+            $stepKey = str_replace($this->actionGroupStepKey, '', $stepKey);
+        }
+
+        $stepKey = $stepKey === '[]' ? null : $stepKey;
+        return $stepKey;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoSequence.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoSequence.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoSequence.php	2023-05-30 09:55:07.532891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoSequence.php	2023-05-03 05:08:55.000000000 +0100
@@ -16,7 +16,7 @@
  */
 class MagentoSequence extends Sequence
 {
-    protected $config = ['prefix' => ''];
+    protected array $config = ['prefix' => ''];
 }
 if (!function_exists('msq') && !function_exists('msqs')) {
     require_once __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'Util' . DIRECTORY_SEPARATOR . 'msq.php';
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoWebDriver.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoWebDriver.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoWebDriver.php	2023-05-30 09:55:07.536891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Module/MagentoWebDriver.php	2023-05-03 05:08:55.000000000 +0100
@@ -25,13 +25,9 @@
 use Magento\FunctionalTestingFramework\Util\Path\UrlFormatter;
 use Magento\FunctionalTestingFramework\Util\ConfigSanitizerUtil;
 use Qameta\Allure\Allure;
-use Yandex\Allure\Adapter\AllureException;
 use Magento\FunctionalTestingFramework\DataTransport\Protocol\CurlTransport;
-use Yandex\Allure\Adapter\Support\AttachmentSupport;
+use Qameta\Allure\Io\DataSourceFactory;
 use Magento\FunctionalTestingFramework\Exceptions\TestFrameworkException;
-use Magento\FunctionalTestingFramework\DataGenerator\Handlers\PersistedObjectHandler;
-use Yandex\Allure\Adapter\Allure as YandexAllure;
-use Yandex\Allure\Adapter\Event\AddAttachmentEvent;

 /**
  * MagentoWebDriver module provides common Magento web actions through Selenium WebDriver.
@@ -57,7 +53,6 @@
  */
 class MagentoWebDriver extends WebDriver
 {
-    use AttachmentSupport;
     use Pause {
         pause as codeceptPause;
     }
@@ -82,19 +77,6 @@
     ];

     /**
-     * The module required fields, to be set in the suite .yml configuration file.
-     *
-     * @var array
-     */
-    protected $requiredFields = [
-        'url',
-        'backend_name',
-        'username',
-        'password',
-        'browser',
-    ];
-
-    /**
      * Set all Locale variables to NULL.
      *
      * @var array $localeAll
@@ -151,9 +133,7 @@
     public function _initialize()
     {
         $this->config = ConfigSanitizerUtil::sanitizeWebDriverConfig($this->config);
-        Allure::getLifecycleConfigurator()->setOutputDirectory(
-            realpath(PROJECT_ROOT . '/dev/tests/acceptance/tests/_output/allure-results')
-        );
+
         parent::_initialize();
         $this->cleanJsError();
     }
@@ -163,7 +143,7 @@
      *
      * @return void
      */
-    public function _resetConfig()
+    public function _resetConfig():void
     {
         parent::_resetConfig();
         $this->config = ConfigSanitizerUtil::sanitizeWebDriverConfig($this->config);
@@ -229,14 +209,14 @@
      * @throws ModuleException
      * @api
      */
-    public function _getCurrentUri()
+    public function _getCurrentUri():string
     {
         $url = $this->webDriver->getCurrentURL();
         if ($url === 'about:blank') {
             throw new ModuleException($this, 'Current url is blank, no page was opened');
         }

-        return Uri::retrieveUri($url);
+        return Uri::retrieveUri((string)$url);
     }

     /**
@@ -244,9 +224,8 @@
      *
      * @param string $url
      * @return void
-     * @throws AllureException
      */
-    public function dontSeeCurrentUrlEquals($url)
+    public function dontSeeCurrentUrlEquals($url):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $url\nActual: $actualUrl";
@@ -259,9 +238,8 @@
      *
      * @param string $regex
      * @return void
-     * @throws AllureException
      */
-    public function dontSeeCurrentUrlMatches($regex)
+    public function dontSeeCurrentUrlMatches($regex):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $regex\nActual: $actualUrl";
@@ -274,9 +252,8 @@
      *
      * @param string $needle
      * @return void
-     * @throws AllureException
      */
-    public function dontSeeInCurrentUrl($needle)
+    public function dontSeeInCurrentUrl($needle):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $needle\nActual: $actualUrl";
@@ -290,7 +267,7 @@
      * @param string|null $regex
      * @return string
      */
-    public function grabFromCurrentUrl($regex = null)
+    public function grabFromCurrentUrl($regex = null):string
     {
         $fullUrl = $this->webDriver->getCurrentURL();
         if (!$regex) {
@@ -313,9 +290,8 @@
      *
      * @param string $url
      * @return void
-     * @throws AllureException
      */
-    public function seeCurrentUrlEquals($url)
+    public function seeCurrentUrlEquals($url):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $url\nActual: $actualUrl";
@@ -328,9 +304,8 @@
      *
      * @param string $regex
      * @return void
-     * @throws AllureException
      */
-    public function seeCurrentUrlMatches($regex)
+    public function seeCurrentUrlMatches($regex):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $regex\nActual: $actualUrl";
@@ -343,9 +318,8 @@
      *
      * @param string $needle
      * @return void
-     * @throws AllureException
      */
-    public function seeInCurrentUrl($needle)
+    public function seeInCurrentUrl($needle):void
     {
         $actualUrl = $this->webDriver->getCurrentURL();
         $comparison = "Expected: $needle\nActual: $actualUrl";
@@ -463,7 +437,7 @@
     public function waitForLoadingMaskToDisappear($timeout = null)
     {
         $timeout = $timeout ?? $this->_getConfig()['pageload_timeout'];
-
+
         foreach ($this->loadingMasksLocators as $maskLocator) {
             // Get count of elements found for looping.
             // Elements are NOT useful for interaction, as they cannot be fed to codeception actions.
@@ -720,7 +694,7 @@
      * @param string $selector
      * @return void
      */
-    public function clearField($selector)
+    public function clearField($selector):void
     {
         $this->fillField($selector, "");
     }
@@ -770,7 +744,7 @@
      * @param integer $yOffset
      * @return void
      */
-    public function dragAndDrop($source, $target, $xOffset = null, $yOffset = null)
+    public function dragAndDrop($source, $target, $xOffset = null, $yOffset = null):void
     {
         $snodes = $this->matchFirstOrFail($this->baseElement, $source);
         $tnodes = $this->matchFirstOrFail($this->baseElement, $target);
@@ -798,7 +772,7 @@
             $action->release($tnodes)->perform();
         }
     }
-
+
     /**
      * Simple rapid click as per given count number.
      *
@@ -814,15 +788,15 @@
         }
     }

-  /**
-   * Grabs a cookie attributes value.
-   * You can set additional cookie params like `domain`, `path` in array passed as last argument.
-   * If the cookie is set by an ajax request (XMLHttpRequest),
-   * there might be some delay caused by the browser, so try `$I->wait(0.1)`.
-   * @param  string $cookie
-   * @param array  $params
-   * @return mixed
-   */
+    /**
+     * Grabs a cookie attributes value.
+     * You can set additional cookie params like `domain`, `path` in array passed as last argument.
+     * If the cookie is set by an ajax request (XMLHttpRequest),
+     * there might be some delay caused by the browser, so try `$I->wait(0.1)`.
+     * @param  string $cookie
+     * @param array  $params
+     * @return mixed
+     */
     public function grabCookieAttributes(string $cookie, array $params = []): array
     {
         $params['name'] = $cookie;
@@ -910,14 +884,20 @@
         }

         if ($this->current_test === null) {
-             throw new \RuntimeException("Suite condition failure: \n"
+            throw new \RuntimeException("Suite condition failure: \n"
                 . " Something went wrong with selenium server/chrome driver : \n .
                     {$fail->getMessage()}\n{$fail->getTraceAsString()}");
         }
-        YandexAllure::lifecycle()
-          ->fire(new AddAttachmentEvent($this->pngReport, $test->getMetadata()->getName() . '.png', 'image/png'));
-        YandexAllure::lifecycle()
-          ->fire(new AddAttachmentEvent($this->htmlReport, $test->getMetadata()->getName() . '.html', 'text/html'));
+        AllureHelper::doAddAttachment(
+            DataSourceFactory::fromFile($this->pngReport),
+            $test->getMetadata()->getName() . '.png',
+            'image/png'
+        );
+        AllureHelper::doAddAttachment(
+            DataSourceFactory::fromFile($this->htmlReport),
+            $test->getMetadata()->getName() . '.html',
+            'text/html'
+        );
         $this->debug("Failure due to : {$fail->getMessage()}");
         $this->debug("Screenshot saved to {$this->pngReport}");
         $this->debug("Html saved to {$this->htmlReport}");
@@ -948,7 +928,7 @@
      * @return void
      * @throws \Exception
      */
-    public function amOnPage($page)
+    public function amOnPage($page):void
     {
         (0 === strpos($page, 'http')) ? parent::amOnUrl($page) : parent::amOnPage($page);
         $this->waitForPageLoad();
@@ -1012,9 +992,8 @@
      *
      * @param string $name
      * @return void
-     * @throws AllureException
      */
-    public function makeScreenshot($name = null)
+    public function makeScreenshot($name = null):void
     {
         if (empty($name)) {
             $name = uniqid(date("Y-m-d_H-i-s_"));
@@ -1080,7 +1059,7 @@
      * @return void
      * @throws \Exception
      */
-    public function switchToIFrame($locator = null)
+    public function switchToIFrame($locator = null):void
     {
         try {
             parent::switchToIFrame($locator);
@@ -1100,7 +1079,7 @@
      * @param boolean $pauseOnFail
      * @return void
      */
-    public function pause($pauseOnFail = false)
+    public function pause($pauseOnFail = false):void
     {
         if (\Composer\InstalledVersions::isInstalled('hoa/console') === false) {
             $message = "<pause /> action is unavailable." . PHP_EOL;
@@ -1118,4 +1097,66 @@

         $this->codeceptPause();
     }
+
+    /**
+     * @param string $selector
+     * @param string $expected
+     * @return void
+     */
+    public function seeNumberOfElements($selector, $expected): void
+    {
+        $counted = count($this->matchVisible($selector));
+        if (is_array($expected)) {
+            [$floor, $ceil] = $expected;
+            $this->assertTrue(
+                $floor <= $counted && $ceil >= $counted,
+                'Number of elements counted differs from expected range'
+            );
+        } else {
+            $this->assertSame(
+                (int)$expected,
+                (int)$counted,
+                'Number of elements counted differs from expected number'
+            );
+        }
+    }
+
+    /**
+     * @param string $text
+     * @param string $selector
+     * @return void
+     */
+    public function see($text, $selector = null): void
+    {
+        $text = (isset($text))
+            ? (string)$text
+            : "";
+        if (!$selector) {
+            $this->assertPageContains($text);
+            return;
+        }
+
+        $this->enableImplicitWait();
+        $nodes = $this->matchVisible($selector);
+        $this->disableImplicitWait();
+        $this->assertNodesContain($text, $nodes, $selector);
+    }
+
+    /**
+     * @param string $text
+     * @param string $selector
+     * @return void
+     */
+    public function dontSee($text, $selector = null): void
+    {
+        $text = (isset($text))
+            ? (string)$text
+            : "";
+        if (!$selector) {
+            $this->assertPageNotContains($text);
+        } else {
+            $nodes = $this->matchVisible($selector);
+            $this->assertNodesNotContain($text, $nodes, $selector);
+        }
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Suite/views/SuiteClass.mustache /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Suite/views/SuiteClass.mustache
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Suite/views/SuiteClass.mustache	2023-05-30 09:55:07.536891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Suite/views/SuiteClass.mustache	2023-05-03 05:08:55.000000000 +0100
@@ -103,7 +103,7 @@
                 //Access private TestResultObject to find stack and if there are any errors (as opposed to failures)
                 $testResultObject = call_user_func(\Closure::bind(
                     function () use ($cest) {
-                        return $cest->getTestResultObject();
+                        return $cest->getResultAggregator();
                     },
                     $cest
                 ));
@@ -111,7 +111,7 @@

                 if (!empty($errors)) {
                     foreach ($errors as $error) {
-                        if ($error->failedTest()->getTestMethod() == $cest->getName()) {
+                        if ($error->getTest()->getTestMethod() == $cest->getName()) {
                             // Do not attempt to run _after if failure was in the _after block
                             // Try to run _after but catch exceptions to prevent them from overwriting original failure.
                             print("LAST TEST IN SUITE FAILED, TEST AFTER MAY NOT BE SUCCESSFUL\n");
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/Util/TestObjectExtractor.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/Util/TestObjectExtractor.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/Util/TestObjectExtractor.php	2023-05-30 09:55:07.540891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/Util/TestObjectExtractor.php	2023-05-03 05:08:55.000000000 +0100
@@ -99,7 +99,7 @@
         $testAnnotations = [];
         $testHooks = [];
         $filename = $testData['filename'] ?? null;
-        $fileNames = explode(",", $filename);
+        $fileNames = explode(",", $filename ?? '');
         $baseFileName = $fileNames[0];
         $module = $this->modulePathExtractor->extractModuleName($baseFileName);
         $testReference = $testData['extends']  ?? null;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Api/Data/EventInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Api/Data/EventInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Api/Data/EventInterface.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Api/Data/EventInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -11,6 +11,9 @@

 /**
  * Defines the event database model
+ *
+ * @api
+ * @since 1.1.0
  */
 interface EventInterface
 {
@@ -20,35 +23,49 @@
     public const FIELD_METADATA = 'metadata';
     public const FIELD_RETRIES = 'retries_count';
     public const FIELD_STATUS = 'status';
+    public const FIELD_INFO = 'info';
+    public const FIELD_PRIORITY = 'priority';

     public const WAITING_STATUS = 0;
     public const SUCCESS_STATUS = 1;
     public const FAILURE_STATUS = 2;
     public const SENDING_STATUS = 3;

+    public const PRIORITY_HIGH = 1;
+
     /**
-     * @return ?string
+     * Returns event id.
+     *
+     * @return null|string
      */
     public function getId(): ?string;

     /**
-     * @return ?string
+     * Returns event code.
+     *
+     * @return null|string
      */
     public function getEventCode(): ?string;

     /**
+     * Sets event code.
+     *
      * @param string $eventCode
      * @return EventInterface
      */
     public function setEventCode(string $eventCode): EventInterface;

     /**
+     * Returns event data.
+     *
      * @return array
      * @throws EventException
      */
     public function getEventData(): array;

     /**
+     * Sets event data.
+     *
      * @param array $eventData
      * @return EventInterface
      * @throws EventException
@@ -56,12 +73,16 @@
     public function setEventData(array $eventData): EventInterface;

     /**
+     * Returns event metadata.
+     *
      * @return array
      * @throws EventException
      */
     public function getMetadata(): array;

     /**
+     * Sets event metadata.
+     *
      * @param array $metadata
      * @return EventInterface
      * @throws EventException
@@ -69,19 +90,55 @@
     public function setMetadata(array $metadata): EventInterface;

     /**
+     * Sets event status.
+     *
      * @param int $statusCode
      * @return EventInterface
      */
     public function setStatus(int $statusCode): EventInterface;

     /**
+     * Returns count of retries event sending.
+     *
      * @return int
      */
     public function getRetriesCount(): int;

     /**
+     * Set retries count.
+     *
      * @param int $retriesCount
      * @return EventInterface
      */
     public function setRetriesCount(int $retriesCount): EventInterface;
+
+    /**
+     * Returns event info.
+     *
+     * @return string
+     */
+    public function getInfo(): string;
+
+    /**
+     * Sets event info.
+     *
+     * @param string $info
+     * @return EventInterface
+     */
+    public function setInfo(string $info): EventInterface;
+
+    /**
+     * Returns event priority.
+     *
+     * @return int
+     */
+    public function getPriority(): int;
+
+    /**
+     * Sets event priority
+     *
+     * @param int $priority
+     * @return EventInterface
+     */
+    public function setPriority(int $priority): EventInterface;
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Api/EventRepositoryInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Api/EventRepositoryInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Api/EventRepositoryInterface.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Api/EventRepositoryInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,15 +10,25 @@
 use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\Framework\Exception\AlreadyExistsException;

+/**
+ * Event storage interface
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface EventRepositoryInterface
 {
     /**
+     * Returns event by event id.
+     *
      * @param int $entityId
      * @return EventInterface
      */
     public function getById(int $entityId): EventInterface;

     /**
+     * Saving the event.
+     *
      * @param EventInterface $event
      * @return EventInterface
      * @throws AlreadyExistsException
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Block/Events/EventPayload.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Block/Events/EventPayload.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Block/Events/EventPayload.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Block/Events/EventPayload.php	2023-05-25 20:23:12.000000000 +0100
@@ -19,6 +19,7 @@
  * Returns event payload
  *
  * @api
+ * @since 1.0.0
  */
 class EventPayload extends Template
 {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Block/Events/ModuleList.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Block/Events/ModuleList.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Block/Events/ModuleList.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Block/Events/ModuleList.php	2023-05-25 20:23:12.000000000 +0100
@@ -17,6 +17,7 @@
  * Renders block with modules and the list of events.
  *
  * @api
+ * @since 1.0.0
  */
 class ModuleList extends Template
 {
@@ -80,7 +81,7 @@
             }
         }
         array_multisort($modules, SORT_ASC, array_column($modules, 'name'));
-
+
         return $modules;
     }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/composer.json	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/composer.json	2023-05-25 20:23:16.000000000 +0100
@@ -9,15 +9,16 @@
     "config": {
         "sort-packages": true
     },
-    "version": "1.0.1",
+    "version": "1.2.0",
     "require": {
-        "php": "~7.4.0||~8.1.0||~8.2.0",
+        "php": "~8.1.0||~8.2.0",
         "ext-json": "*",
         "magento/framework": ">=103.0.5",
+        "magento/framework-message-queue": ">=100.4.5",
         "magento/module-backend": ">=102.0.5",
         "magento/module-config": ">=101.2.5",
         "magento/module-store": ">=101.1.5",
-        "magento/module-adobe-io-events-client": "^1.0"
+        "magento/module-adobe-io-events-client": "^1.2"
     },
     "autoload": {
         "files": [
@@ -31,7 +32,8 @@
         "phpmd/phpmd": "^2.12.0",
         "phpstan/phpstan": "^1.6.8",
         "phpunit/phpunit": "~9.5.20",
-        "squizlabs/php_codesniffer": "~3.6.0"
+        "squizlabs/php_codesniffer": "~3.6.0",
+        "magento/magento-coding-standard": "*"
     },
     "scripts": {
         "test:all": [
@@ -40,7 +42,11 @@
             "@test:phpmd",
             "@test:unit"
         ],
-        "test:phpcs": "phpcs Event/ Model/ Setup/ Console/ Config/ Api/ Test/Unit/ --standard=Test/static/ruleset/phpcs.xml -p -n",
+        "test:phpcs": [
+            "phpcs --config-set installed_paths vendor/phpcompatibility/php-compatibility/PHPCompatibility",
+            "phpcs * --standard=vendor/magento/magento-coding-standard/Magento2 --ignore=vendor,*.phtml",
+            "phpcs * --standard=vendor/magento/magento-coding-standard/Magento2Framework --ignore=vendor,*.phtml"
+        ],
         "test:phpmd": "phpmd Event,Model,Setup,Console,Config,Api xml Test/static/ruleset/phpmd.xml",
         "test:phpstan": "phpstan analyse -c Test/static/phpstan.neon",
         "test:unit": "phpunit --configuration Test/Unit/phpunit.xml.dist"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/Converter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/Converter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/Converter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/Converter.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,9 @@

 namespace Magento\AdobeCommerceEventsClient\Config;

+use DOMDocument;
+use DOMElement;
+use InvalidArgumentException;
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\Framework\Config\ConverterInterface;

@@ -18,16 +21,15 @@
     /**
      * Convert dom node tree to array
      *
-     * @param \DOMDocument $source
+     * @param DOMDocument $source
      * @return array
-     * @throws \InvalidArgumentException
+     * @throws InvalidArgumentException
      */
     public function convert($source)
     {
         $output = [];
-        /** @var \DOMNodeList $events */
         $events = $source->getElementsByTagName('event');
-        /** @var \DOMElement $eventConfig */
+        /** @var DOMElement $eventConfig */
         foreach ($events as $eventConfig) {
             $fields = $rules = [];
             foreach ($eventConfig->getElementsByTagName('field') as $field) {
@@ -45,14 +47,16 @@
                 $rules[] = $ruleData;
             }

-            $eventName = strtolower($eventConfig->getAttribute('name'));
-            $eventParent = strtolower($eventConfig->getAttribute('parent')) ?: null;
+            $eventName = strtolower($eventConfig->getAttribute(Event::EVENT_NAME));
+            $eventParent = strtolower($eventConfig->getAttribute(Event::EVENT_PARENT)) ?: null;
+            $priority = $eventConfig->getAttribute(Event::EVENT_PRIORITY) ?: false;

             $output[$eventName] = [
                 Event::EVENT_NAME => $eventName,
                 Event::EVENT_FIELDS => $fields,
                 Event::EVENT_RULES => $rules,
-                Event::EVENT_PARENT => $eventParent
+                Event::EVENT_PARENT => $eventParent,
+                Event::EVENT_PRIORITY => $priority
             ];
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/Reader.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/Reader.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/Reader.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/Reader.php	2023-05-25 20:23:12.000000000 +0100
@@ -31,6 +31,8 @@
      * @param SchemaLocator $schemaLocator
      * @param ValidationStateInterface $validationState
      * @param string $fileName
+     *
+     * phpcs:disable Generic.CodeAnalysis.UselessOverridingMethod
      */
     public function __construct(
         FileResolverInterface $fileResolver,
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/SchemaLocator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/SchemaLocator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Config/SchemaLocator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Config/SchemaLocator.php	2023-05-25 20:23:12.000000000 +0100
@@ -19,7 +19,7 @@
     /**
      * @var UrnResolver
      */
-    protected $urnResolver;
+    protected UrnResolver $urnResolver;

     /**
      * Initialize dependencies.
@@ -32,7 +32,7 @@
     }

     /**
-     * {@inheritDoc}
+     * @inheritDoc
      *
      * @throws NotFoundException
      */
@@ -44,7 +44,7 @@
     }

     /**
-     * {@inheritDoc}
+     * @inheritDoc
      *
      * @throws NotFoundException
      */
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventInfoCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventInfoCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventInfoCommand.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventInfoCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -16,6 +16,7 @@
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Input\InputOption;
 use Symfony\Component\Console\Output\OutputInterface;
+use Throwable;

 /**
  * Command for displaying a payload of the specified event.
@@ -75,6 +76,8 @@
     }

     /**
+     * Returns the payload of the specified event.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
@@ -94,7 +97,7 @@
                     (int)$input->getOption(self::OPTION_DEPTH)
                 )
             );
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             $output->writeln(sprintf('<error>%s</error>', $e->getMessage()));
             return Cli::RETURN_FAILURE;
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListAllCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListAllCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListAllCommand.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListAllCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Console\Command;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Event\Collector\CollectorInterface;
 use Magento\Framework\Console\Cli;
 use Magento\Framework\Module\Dir;
@@ -74,7 +75,7 @@
      *
      * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
-    protected function execute(InputInterface $input, OutputInterface $output): int
+    protected function execute(InputInterface $input, OutputInterface $output)
     {
         try {
             $modulePath = $this->dir->getDir($input->getArgument(self::ARGUMENT_MODULE_NAME));
@@ -85,7 +86,7 @@
             }

             return Cli::RETURN_SUCCESS;
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             $output->writeln($e->getMessage());

             return Cli::RETURN_FAILURE;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListCommand.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventListCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,13 +7,15 @@

 namespace Magento\AdobeCommerceEventsClient\Console\Command;

+use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\Rule\Rule;
+use Magento\AdobeCommerceEventsClient\Event\Rule\RuleInterface;
 use Magento\Framework\Console\Cli;
 use Symfony\Component\Console\Command\Command;
 use Symfony\Component\Console\Helper\Table;
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Output\OutputInterface;
+use Throwable;

 /**
  * Command for displaying a list of subscribed events
@@ -23,7 +25,7 @@
     /**
      * @var EventList
      */
-    private $eventList;
+    private EventList $eventList;

     /**
      * @param EventList $eventList
@@ -49,6 +51,8 @@
     }

     /**
+     * Displays a list of subscribed events.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
@@ -67,12 +71,19 @@

                 foreach ($events as $event) {
                     if ($event->isEnabled()) {
-                        $table->setHeaders(['name', 'parent', 'fields', 'rules']);
+                        $table->setHeaders([
+                            Event::EVENT_NAME,
+                            Event::EVENT_PARENT,
+                            Event::EVENT_FIELDS,
+                            Event::EVENT_RULES,
+                            Event::EVENT_PRIORITY
+                        ]);
                         $table->addRow([
-                            'name' => $event->getName(),
-                            'parent' => $event->getParent()?? '',
-                            'fields' => json_encode($event->getFields(), JSON_PRETTY_PRINT),
-                            'rules' => $this->formatRules($event->getRules())
+                            Event::EVENT_NAME => $event->getName(),
+                            Event::EVENT_PARENT => $event->getParent()?? '',
+                            Event::EVENT_FIELDS => json_encode($event->getFields(), JSON_PRETTY_PRINT),
+                            Event::EVENT_RULES => $this->formatRules($event->getRules()),
+                            Event::EVENT_PRIORITY => $event->isPriority() ? 'true' : 'false'
                         ]);
                     }
                 }
@@ -91,7 +102,7 @@
             }

             return Cli::RETURN_SUCCESS;
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             $output->writeln($e->getMessage());
             return Cli::RETURN_FAILURE;
         }
@@ -109,9 +120,9 @@
         foreach ($rules as $rule) {
             $ruleOutput[] = sprintf(
                 '{ field: %s, operator: %s, value: %s }',
-                $rule[Rule::RULE_FIELD],
-                $rule[Rule::RULE_OPERATOR],
-                $rule[Rule::RULE_VALUE]
+                $rule[RuleInterface::RULE_FIELD],
+                $rule[RuleInterface::RULE_OPERATOR],
+                $rule[RuleInterface::RULE_VALUE]
             );
         }
         return str_replace(
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventMetadataPopulate.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventMetadataPopulate.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventMetadataPopulate.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventMetadataPopulate.php	2023-05-25 20:23:12.000000000 +0100
@@ -12,6 +12,7 @@
 use Symfony\Component\Console\Command\Command;
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Output\OutputInterface;
+use Throwable;

 /**
  * Commands for creating events metadata in Adobe I/O from the XML and application configurations
@@ -51,13 +52,15 @@
     }

     /**
+     * Creates events metadata in Adobe I/O from the XML and application configurations.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
      *
      * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
-    public function execute(InputInterface $input, OutputInterface $output): int
+    public function execute(InputInterface $input, OutputInterface $output)
     {
         try {
             $messages = $this->eventMetadataSynchronizer->run();
@@ -71,7 +74,7 @@
             }

             return Cli::RETURN_SUCCESS;
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             $output->writeln("<error>{$e->getMessage()}</error>");

             return Cli::RETURN_FAILURE;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventSubscribeCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventSubscribeCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventSubscribeCommand.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventSubscribeCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,16 +9,18 @@

 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\EventFactory;
-use Magento\AdobeCommerceEventsClient\Event\Rule\Rule;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
+use Magento\AdobeCommerceEventsClient\Event\Rule\RuleInterface;
 use Magento\AdobeIoEventsClient\Console\CreateEventProvider;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\Framework\Console\Cli;
+use Magento\Framework\Exception\LocalizedException;
 use Symfony\Component\Console\Command\Command;
 use Symfony\Component\Console\Input\InputArgument;
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Input\InputOption;
 use Symfony\Component\Console\Output\OutputInterface;
+use Throwable;

 /**
  * Command for subscribing to events
@@ -28,10 +30,11 @@
 class EventSubscribeCommand extends Command
 {
     private const ARGUMENT_EVENT_CODE = 'event-code';
-    private const OPTION_FIELDS = 'fields';
+    private const OPTION_FIELDS = Event::EVENT_FIELDS;
     private const OPTION_FORCE = 'force';
-    private const OPTION_PARENT = 'parent';
-    private const OPTION_RULES = 'rules';
+    private const OPTION_PARENT = Event::EVENT_PARENT;
+    private const OPTION_RULES = Event::EVENT_RULES;
+    private const OPTION_PRIORITY = Event::EVENT_PRIORITY;
     private const RULE_FORMAT = 'field|operator|value';

     /**
@@ -105,17 +108,27 @@
                     'The list of rules for the event subscription, where each rule is formatted as "%s".',
                     self::RULE_FORMAT
                 )
+            )
+            ->addOption(
+                self::OPTION_PRIORITY,
+                'p',
+                InputOption::VALUE_NONE,
+                'Expedites the transmission of this event. ' .
+                'Specify this option for events that need to be delivered immediately. ' .
+                'By default, events are sent by cron once per minute.'
             );

         parent::configure();
     }

     /**
+     * Subscribes to the event.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
      */
-    public function execute(InputInterface $input, OutputInterface $output): int
+    public function execute(InputInterface $input, OutputInterface $output)
     {
         try {
             if (!$this->configurationProvider->isConfigured()) {
@@ -128,7 +141,6 @@
                 return Cli::RETURN_FAILURE;
             }

-            $eventCode = $input->getArgument(self::ARGUMENT_EVENT_CODE);
             $fields = $input->getOption(self::OPTION_FIELDS);
             $isForced = $input->getOption(self::OPTION_FORCE);
             $parent = $input->getOption(self::OPTION_PARENT);
@@ -145,10 +157,11 @@
             }

             $event = $this->eventFactory->create([
-                Event::EVENT_NAME => $eventCode,
+                Event::EVENT_NAME => $input->getArgument(self::ARGUMENT_EVENT_CODE),
                 Event::EVENT_FIELDS => $fields,
                 Event::EVENT_PARENT => $parent,
-                Event::EVENT_RULES => $this->convertRules($rules)
+                Event::EVENT_RULES => $this->convertRules($rules),
+                Event::EVENT_PRIORITY => $input->getOption(self::OPTION_PRIORITY)
             ]);

             $this->eventSubscriber->subscribe($event, $isForced);
@@ -161,7 +174,7 @@
                     'bin/magento events:generate:module' . PHP_EOL . 'bin/magento setup:di:compile'
                 );
             }
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             $output->writeln("<error>{$e->getMessage()}</error>");
             return Cli::RETURN_FAILURE;
         }
@@ -177,7 +190,7 @@
      *
      * @param array $rules
      * @return array
-     * @throws \Exception
+     * @throws LocalizedException
      */
     private function convertRules(array $rules): array
     {
@@ -186,16 +199,16 @@
         foreach ($rules as $rule) {
             $ruleComponents = explode('|', trim($rule, '\'\"'), 3);
             if (count($ruleComponents) != 3) {
-                throw new \Exception(
-                    sprintf(
+                throw new LocalizedException(
+                    __(sprintf(
                         'Input rules must be formatted as "%s"',
                         self::RULE_FORMAT
-                    )
+                    ))
                 );
             }

             $convertedRules[] = array_combine(
-                [Rule::RULE_FIELD, Rule::RULE_OPERATOR, Rule::RULE_VALUE],
+                [RuleInterface::RULE_FIELD, RuleInterface::RULE_OPERATOR, RuleInterface::RULE_VALUE],
                 $ruleComponents
             );
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventUnsubscribeCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventUnsubscribeCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventUnsubscribeCommand.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Console/Command/EventUnsubscribeCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -17,6 +17,7 @@
 use Symfony\Component\Console\Input\InputArgument;
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Output\OutputInterface;
+use Throwable;

 /**
  * Command for unsubscribing from events
@@ -72,11 +73,13 @@
     }

     /**
+     * Removes the subscription to the event.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
      */
-    public function execute(InputInterface $input, OutputInterface $output): int
+    public function execute(InputInterface $input, OutputInterface $output)
     {
         $eventCode = $input->getArgument(self::ARGUMENT_EVENT_CODE);
         try {
@@ -94,7 +97,7 @@
                 $this->eventFactory->create([Event::EVENT_NAME => $eventCode])
             );
             $output->writeln(sprintf("Successfully unsubscribed from the '%s' event", $eventCode));
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             $output->writeln("<error>Error unsubscribing from event '$eventCode': {$e->getMessage()}</error>");
             return Cli::RETURN_FAILURE;
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/communication.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/communication.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/communication.xml	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/communication.xml	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,12 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
+<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Communication/etc/communication.xsd">
+    <topic name="commerce.eventing.event.publish" is_synchronous="false" request="string">
+        <handler name="commerce.eventing.event.publish.handler" type="Magento\AdobeCommerceEventsClient\Event\Queue\Consumer\EventHandler" method="execute" />
+    </topic>
+</config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/db_schema_whitelist.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/db_schema_whitelist.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/db_schema_whitelist.json	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/db_schema_whitelist.json	2023-05-25 20:23:12.000000000 +0100
@@ -7,7 +7,10 @@
             "metadata": true,
             "created_at": true,
             "retries_count": true,
-            "status": true
+            "status": true,
+            "updated_at": true,
+            "info": true,
+            "priority": true
         },
         "index": {
             "EVENT_DATA_STATUS": true
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/db_schema.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/db_schema.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/db_schema.xml	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/db_schema.xml	2023-05-25 20:23:12.000000000 +0100
@@ -17,10 +17,15 @@
         <column xsi:type="text" name="metadata" nullable="false" comment="Metadata to send to the pipeline"/>
         <column xsi:type="timestamp" name="created_at" on_update="false" nullable="false" default="CURRENT_TIMESTAMP"
                 comment="Created At"/>
+        <column xsi:type="timestamp" name="updated_at" on_update="true" nullable="false" default="CURRENT_TIMESTAMP"
+                comment="Updated At"/>
         <column xsi:type="int" name="retries_count" unsigned="true" nullable="false" default="0"
                 comment="Retry count for sending event data"/>
         <column xsi:type="tinyint" name="status" unsigned="true" nullable="false" default="0"
                 comment="Status of sending event data"/>
+        <column xsi:type="text" name="info" nullable="false" comment="Additional information about event status"/>
+        <column xsi:type="tinyint" name="priority" unsigned="true" nullable="false" default="0"
+                comment="Priority of sending event data"/>
         <constraint xsi:type="primary" referenceId="PRIMARY">
             <column name="event_id"/>
         </constraint>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/di.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/di.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/di.xml	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/di.xml	2023-05-25 20:23:12.000000000 +0100
@@ -11,6 +11,8 @@
     <preference for="Magento\AdobeCommerceEventsClient\Event\DataFilterInterface" type="Magento\AdobeCommerceEventsClient\Event\Filter\CompositeFilter" />
     <preference for="Magento\AdobeCommerceEventsClient\Api\EventRepositoryInterface" type="Magento\AdobeCommerceEventsClient\Model\EventRepository" />
     <preference for="Magento\AdobeCommerceEventsClient\Event\Collector\CollectorInterface" type="Magento\AdobeCommerceEventsClient\Event\Collector\CompositeCollector" />
+    <preference for="Magento\AdobeCommerceEventsClient\Event\EventRetrieverInterface" type="Magento\AdobeCommerceEventsClient\Event\EventRetriever\WaitingEventRetriever" />
+    <preference for="Magento\AdobeCommerceEventsClient\Event\Rule\RuleInterface" type="Magento\AdobeCommerceEventsClient\Event\Rule\Rule" />
     <type name="Magento\AdobeCommerceEventsClient\Event\Operator\OperatorFactory">
         <arguments>
             <argument name="operators" xsi:type="array">
@@ -22,6 +24,15 @@
             </argument>
         </arguments>
     </type>
+    <type name="Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataPool">
+        <arguments>
+            <argument name="metadata" xsi:type="array">
+                <item name="edition" xsi:type="object">Magento\AdobeCommerceEventsClient\Event\Metadata\CommerceEdition</item>
+                <item name="clientVersion" xsi:type="object">Magento\AdobeCommerceEventsClient\Event\Metadata\ClientVersion</item>
+                <item name="store" xsi:type="object">Magento\AdobeCommerceEventsClient\Event\Metadata\Store</item>
+            </argument>
+        </arguments>
+    </type>
     <type name="Magento\Framework\Console\CommandListInterface">
         <arguments>
             <argument name="commands" xsi:type="array">
@@ -77,6 +88,23 @@
             <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
         </arguments>
     </type>
+    <type name="Magento\AdobeCommerceEventsClient\Event\Queue\Consumer\EventHandler">
+        <arguments>
+            <argument name="eventBatchSender" xsi:type="object">priorityEventBatchSender</argument>
+        </arguments>
+    </type>
+    <type name="Magento\AdobeCommerceEventsClient\Event\Queue\EventBatchConsumer">
+        <arguments>
+            <argument name="interval" xsi:type="number">1</argument>
+        </arguments>
+    </type>
+    <type name="Magento\Framework\MessageQueue\MergerFactory">
+        <arguments>
+            <argument name="mergers" xsi:type="array">
+                <item name="commerce.eventing.event.publish" xsi:type="string">Magento\AdobeCommerceEventsClient\Event\Queue\Merger</item>
+            </argument>
+        </arguments>
+    </type>
     <virtualType name="subscribeValidatorComposite" type="Magento\AdobeCommerceEventsClient\Event\Validator\CompositeEventValidator">
         <arguments>
             <argument name="validators" xsi:type="array">
@@ -95,4 +123,9 @@
             </argument>
         </arguments>
     </virtualType>
+    <virtualType name="priorityEventBatchSender" type="Magento\AdobeCommerceEventsClient\Event\EventBatchSender">
+        <arguments>
+            <argument name="eventRetriever" xsi:type="object">Magento\AdobeCommerceEventsClient\Event\EventRetriever\PriorityWaitingEventRetriever</argument>
+        </arguments>
+    </virtualType>
 </config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/io_events.xsd /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/io_events.xsd
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/io_events.xsd	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/io_events.xsd	2023-05-25 20:23:12.000000000 +0100
@@ -35,6 +35,7 @@
         </xs:sequence>
         <xs:attribute name="name" type="eventName" use="required" />
         <xs:attribute name="parent" type="eventName" use="optional" />
+        <xs:attribute name="priority" type="xs:boolean" default="false" />
     </xs:complexType>

     <xs:complexType name="fieldsType">
@@ -84,11 +85,11 @@
     <xs:simpleType name="fieldName">
         <xs:annotation>
             <xs:documentation>
-                Field name can contain only [a-zA-Z0-9_\-\.].
+                Field name can contain only [a-zA-Z0-9_-.[]].
             </xs:documentation>
         </xs:annotation>
         <xs:restriction base="xs:string">
-            <xs:pattern value="[a-zA-Z0-9_\-\.]+" />
+            <xs:pattern value="[a-zA-Z0-9_\-\.\[\]]+" />
         </xs:restriction>
     </xs:simpleType>
 </xs:schema>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_consumer.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_consumer.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_consumer.xml	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_consumer.xml	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
+<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework-message-queue:etc/consumer.xsd">
+    <consumer
+            name="commerce.eventing.event.publish"
+            queue="commerce.eventing.event.publish"
+            consumerInstance="Magento\AdobeCommerceEventsClient\Event\Queue\EventBatchConsumer"
+            handler="Magento\AdobeCommerceEventsClient\Event\Queue\Consumer\EventHandler::execute"
+            onlySpawnWhenMessageAvailable="0"
+            maxMessages="0"
+    />
+</config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_publisher.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_publisher.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_publisher.xml	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_publisher.xml	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,12 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
+<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework-message-queue:etc/publisher.xsd">
+    <publisher topic="commerce.eventing.event.publish">
+        <connection exchange="magento-commerce-eventing" />
+    </publisher>
+</config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_topology.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_topology.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/etc/queue_topology.xml	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/etc/queue_topology.xml	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,12 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
+<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework-message-queue:etc/topology.xsd">
+    <exchange name="magento-commerce-eventing" type="topic">
+        <binding id="commerceEventingEventPublish" topic="commerce.eventing.event.publish" destinationType="queue" destination="commerce.eventing.event.publish"/>
+    </exchange>
+</config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/AdobeIoEventMetadataFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/AdobeIoEventMetadataFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/AdobeIoEventMetadataFactory.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/AdobeIoEventMetadataFactory.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,8 +7,8 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

+use Magento\AdobeIoEventsClient\Api\EventMetadataInterface;
 use Magento\AdobeIoEventsClient\Model\Data\EventMetadataFactory;
-use Magento\AdobeIoEventsClient\Model\Data\EventMetadata;

 /**
  * Generates metadata for given event code
@@ -32,9 +32,9 @@
      * Generates metadata info base on event type.
      *
      * @param string $eventCode
-     * @return EventMetadata
+     * @return EventMetadataInterface
      */
-    public function generate(string $eventCode): EventMetadata
+    public function generate(string $eventCode): EventMetadataInterface
     {
         $data = [
             'event_code' => $eventCode,
@@ -42,12 +42,12 @@
             'label' => 'event' . $eventCode
         ];

-        $eventCodeParts = explode('.', str_replace(EventSubscriber::EVENT_PREFIX_COMMERCE, '', $eventCode), 2);
+        $eventCodeParts = explode('.', str_replace(EventSubscriberInterface::EVENT_PREFIX_COMMERCE, '', $eventCode), 2);

-        if ($eventCodeParts[0] === EventSubscriber::EVENT_TYPE_PLUGIN) {
+        if ($eventCodeParts[0] === EventSubscriberInterface::EVENT_TYPE_PLUGIN) {
             $data['description'] = 'Plugin event ' . $eventCodeParts[1];
             $data['label'] = 'Plugin event ' . $eventCodeParts[1];
-        } else if ($eventCodeParts[0] === EventSubscriber::EVENT_TYPE_OBSERVER) {
+        } elseif ($eventCodeParts[0] === EventSubscriberInterface::EVENT_TYPE_OBSERVER) {
             $data['label'] = 'Observer event ' . $eventCodeParts[1];
             $data['description'] = 'Observer event ' . $eventCodeParts[1];
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Client.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Client.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Client.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Client.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,12 +7,13 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

+use GuzzleHttp\Client as GuzzleHttpClient;
 use GuzzleHttp\ClientFactory;
 use GuzzleHttp\Exception\GuzzleException;
 use GuzzleHttp\RequestOptions;
 use Magento\AdobeCommerceEventsClient\Event\Config as EventsConfig;
-use Magento\AdobeIoEventsClient\Api\AccessTokenProviderInterface;
-use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException as AdobeIOConfigurationException;
+use Magento\AdobeIoEventsClient\Model\Credentials\ScopeConfigCredentialsFactory;
 use Magento\Framework\Exception\AuthorizationException;
 use Magento\Framework\Exception\NotFoundException;
 use Psr\Http\Message\ResponseInterface;
@@ -23,41 +24,15 @@
 class Client
 {
     /**
-     * @var Config
-     */
-    private EventsConfig $config;
-
-    /**
-     * @var AccessTokenProviderInterface
-     */
-    private AccessTokenProviderInterface $accessTokenProvider;
-
-    /**
-     * @var AdobeIOConfigurationProvider
-     */
-    private AdobeIOConfigurationProvider $configurationProvider;
-
-    /**
-     * @var ClientFactory
-     */
-    private ClientFactory $clientFactory;
-
-    /**
      * @param Config $config
-     * @param AccessTokenProviderInterface $accessTokenProvider
      * @param ClientFactory $clientFactory
-     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param ScopeConfigCredentialsFactory $credentialsFactory
      */
     public function __construct(
-        EventsConfig $config,
-        AccessTokenProviderInterface $accessTokenProvider,
-        ClientFactory $clientFactory,
-        AdobeIOConfigurationProvider $configurationProvider
+        private EventsConfig $config,
+        private ClientFactory $clientFactory,
+        private ScopeConfigCredentialsFactory $credentialsFactory
     ) {
-        $this->config = $config;
-        $this->accessTokenProvider = $accessTokenProvider;
-        $this->clientFactory = $clientFactory;
-        $this->configurationProvider = $configurationProvider;
     }

     /**
@@ -91,34 +66,33 @@
     }

     /**
+     * Makes request to the provided url.
+     *
      * @param string $method
      * @param string $uri
      * @param array $params
      * @return ResponseInterface
      * @throws AuthorizationException
      * @throws GuzzleException
-     * @throws NotFoundException
      * @throws InvalidConfigurationException
+     * @throws NotFoundException
      */
     private function doRequest(
         string $method,
         string $uri,
         array $params = []
     ): ResponseInterface {
-        $token = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-        $client = $this->clientFactory->create();
-
+        $credentials = $this->credentialsFactory->create();
         try {
-            $credentials = $configuration->getFirstCredential();
-        } catch (\Exception $exception) {
+            $params['headers']['Authorization'] = 'Bearer ' . $credentials->getToken()->getAccessToken();
+            $params['headers']['x-api-key'] = $credentials->getClientId();
+            $params['headers']['x-ims-org-id'] = $credentials->getImsOrgId();
+        } catch (AdobeIOConfigurationException $exception) {
             throw new InvalidConfigurationException(__($exception->getMessage()));
         }

-        $params['headers']['x-api-key'] = $credentials->getJwt()->getClientId();
-        $params['headers']['Authorization'] = 'Bearer ' . $token->getAccessToken();
-        $params['headers']['x-ims-org-id'] = $configuration->getProject()->getOrganization()->getImsOrgId();
-
+        /** @var GuzzleHttpClient $client */
+        $client = $this->clientFactory->create();
         return $client->request($method, $uri, $params);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ApiServiceCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ApiServiceCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ApiServiceCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ApiServiceCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Util\FileOperator;
 use Magento\Framework\App\Utility\ReflectionClassFactory;
 use Magento\Framework\Exception\FileSystemException;
@@ -67,7 +68,8 @@
     /**
      * Collects API interfaces events from the Adobe Commerce module.
      *
-     * {@inheritDoc}
+     * @param string $modulePath
+     * @return EventData[]
      */
     public function collect(string $modulePath): array
     {
@@ -93,10 +95,11 @@
             try {
                 $interface = $this->nameFetcher->getNameFromFile($fileItem);
                 $refClass = $this->reflectionClassFactory->create($interface);
-            } catch (\Exception $e) {
+            } catch (Exception $e) {
                 continue;
             }

+            // phpcs:ignore Magento2.Performance.ForeachArrayMerge
             $events = array_merge($events, $this->eventMethodCollector->collect($refClass));
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/CompositeCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/CompositeCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/CompositeCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/CompositeCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -71,6 +71,7 @@

         $events = [];
         foreach ($this->collectors as $collector) {
+            // phpcs:ignore Magento2.Performance.ForeachArrayMerge
             $events = array_merge($events, $collector->collect($modulePath));
         }
         $this->cache->save($this->serializeEvents($events), $cacheId);
@@ -111,7 +112,7 @@
      * @param string $eventsData
      * @return array
      */
-    private function unserializeEvents(string $eventsData)
+    private function unserializeEvents(string $eventsData): array
     {
         $events = [];

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/EventMethodCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/EventMethodCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/EventMethodCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/EventMethodCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,9 +7,10 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
 use ReflectionClass;
+use ReflectionMethod;

 /**
  * Collects event methods for the provided class
@@ -57,7 +58,7 @@
         $events = [];

         $className = $reflectionClass->getName();
-        $methodList = $reflectionClass->getMethods(\ReflectionMethod::IS_PUBLIC);
+        $methodList = $reflectionClass->getMethods(ReflectionMethod::IS_PUBLIC);

         foreach ($methodList as $method) {
             $methodName = $method->getName();
@@ -65,7 +66,7 @@
                 continue;
             }

-            $eventName = EventSubscriber::EVENT_TYPE_PLUGIN . '.' .
+            $eventName = EventSubscriberInterface::EVENT_TYPE_PLUGIN . '.' .
                 $this->eventCodeConverter->convertToEventName($className, $methodName);

             $events[$eventName] = $this->eventDataFactory->create([
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/MethodFilter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/MethodFilter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/MethodFilter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/MethodFilter.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,8 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

+use Magento\Framework\Exception\InvalidArgumentException;
+
 /**
  * Filters methods from services.
  * Example of list of excluded methods:
@@ -39,15 +41,22 @@
     ];

     /**
-     * @var array
+     * @var string[]
      */
     private array $excludedMethods;

     /**
-     * @param array $excludedMethods
+     * @param string[] $excludedMethods
+     * @throws InvalidArgumentException
      */
     public function __construct(array $excludedMethods = self::DEFAULT_EXCLUDES)
     {
+        foreach ($excludedMethods as $filter) {
+            if (!is_string($filter)) {
+                throw new InvalidArgumentException(__('All elements in excludedMethods must be type of the string.'));
+            }
+        }
+
         $this->excludedMethods = $excludedMethods;
     }

@@ -60,11 +69,9 @@
     public function isExcluded(string $methodName): bool
     {
         foreach ($this->excludedMethods as $filter) {
-            try {
-                if ($methodName === $filter || @preg_match($filter, $methodName) === 1) {
-                    return true;
-                }
-            } catch (\Throwable $e) {
+            // phpcs:ignore Generic.PHP.NoSilencedErrors
+            if ($methodName === $filter || @preg_match($filter, $methodName) === 1) {
+                return true;
             }
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/NameFetcher.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/NameFetcher.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/NameFetcher.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/NameFetcher.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

+use Magento\Framework\Exception\LocalizedException;
 use SplFileInfo;

 /**
@@ -16,23 +17,25 @@
 {
     /**
      * Simple way to get class or interface name from Class.
+     *
      * Can be improved by parsing file with php token.
      *
      * @param SplFileInfo $fileInfo
      * @param string|null $fileContent
      * @return string
-     * @throws \Exception
+     * @throws LocalizedException
      */
     public function getNameFromFile(SplFileInfo $fileInfo, string $fileContent = null): string
     {
         if (empty($fileContent)) {
+            //phpcs:ignore Magento2.Functions.DiscouragedFunction
             $fileContent = file_get_contents($fileInfo->getPathname());
         }

         preg_match('/^namespace\s+(?<namespace>.*).*;/im', $fileContent, $matches);

         if (empty($matches['namespace'])) {
-            throw new \Exception('Could not fetch namespace from the file: '  . $fileInfo->getPathname());
+            throw new LocalizedException(__('Could not fetch namespace from the file: %1', $fileInfo->getPathname()));
         }
         $namespace = $matches['namespace'];

@@ -49,6 +52,8 @@
             }
         }

-        throw new \Exception('Could not fetch Class or Interface name from the file: ' . $fileInfo->getPathname());
+        throw new LocalizedException(
+            __('Could not fetch Class or Interface name from the file: %1', $fileInfo->getPathname())
+        );
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/DispatchMethodCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/DispatchMethodCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/DispatchMethodCollector.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/DispatchMethodCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,78 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector;
+
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventData;
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventDataFactory;
+use Magento\AdobeCommerceEventsClient\Event\Collector\NameFetcher;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
+use Magento\Framework\Exception\LocalizedException;
+use SplFileInfo;
+
+/**
+ * Collects event names from dispatch methods.
+ */
+class DispatchMethodCollector
+{
+    /**
+     * @var NameFetcher
+     */
+    private NameFetcher $nameFetcher;
+
+    /**
+     * @var EventDataFactory
+     */
+    private EventDataFactory $eventDataFactory;
+
+    /**
+     * @param NameFetcher $nameFetcher
+     * @param EventDataFactory $eventDataFactory
+     */
+    public function __construct(
+        NameFetcher $nameFetcher,
+        EventDataFactory $eventDataFactory
+    ) {
+        $this->nameFetcher = $nameFetcher;
+        $this->eventDataFactory = $eventDataFactory;
+    }
+
+    /**
+     * Parses and returns array of event names from dispatch methods.
+     *
+     * @param SplFileInfo $fileInfo
+     * @param string $fileContent
+     * @return array
+     * @throws LocalizedException
+     */
+    public function fetchEvents(SplFileInfo $fileInfo, string $fileContent): array
+    {
+        $events = [];
+
+        preg_match_all(
+            '/->dispatch\([^\)\.]*?\n?[^\)\.]*?(?<eventName>(\'[^\']*\'|\"[^\"]*\"))\s*\,/im',
+            $fileContent,
+            $matches
+        );
+
+        if (!empty($matches['eventName'])) {
+            $className = $this->nameFetcher->getNameFromFile($fileInfo, $fileContent);
+            foreach ($matches['eventName'] as $eventName) {
+                $eventName = trim($eventName, '"\'');
+                if (strpos($eventName, '_before') === false) {
+                    $eventName = EventSubscriberInterface::EVENT_TYPE_OBSERVER . '.' . $eventName;
+                    $events[$eventName] = $this->eventDataFactory->create([
+                        EventData::EVENT_NAME => $eventName,
+                        EventData::EVENT_CLASS_EMITTER => $className,
+                    ]);
+                }
+            }
+        }
+
+        return $events;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/EventPrefixesCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/EventPrefixesCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/EventPrefixesCollector.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector/EventPrefixesCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,106 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector;
+
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventData;
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventDataFactory;
+use Magento\AdobeCommerceEventsClient\Event\Collector\NameFetcher;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
+use Magento\Framework\App\Utility\ReflectionClassFactory;
+use Magento\Framework\Exception\LocalizedException;
+use Magento\Framework\Model\AbstractModel;
+use ReflectionException;
+use SplFileInfo;
+
+/**
+ * Collects events for classes that contains $_eventPrefix variable.
+ */
+class EventPrefixesCollector
+{
+    /**
+     * Array of events for Magento\Framework\Model\AbstractModel class
+     *
+     * @var array
+     */
+    private array $abstractModelEvents = [
+        '_save_commit_after',
+        '_save_after',
+        '_delete_after',
+        '_delete_commit_after',
+    ];
+
+    /**
+     * @var NameFetcher
+     */
+    private NameFetcher $nameFetcher;
+
+    /**
+     * @var EventDataFactory
+     */
+    private EventDataFactory $eventDataFactory;
+
+    /**
+     * @var ReflectionClassFactory
+     */
+    private ReflectionClassFactory $reflectionClassFactory;
+
+    /**
+     * @param NameFetcher $nameFetcher
+     * @param EventDataFactory $eventDataFactory
+     * @param ReflectionClassFactory $reflectionClassFactory
+     */
+    public function __construct(
+        NameFetcher $nameFetcher,
+        EventDataFactory $eventDataFactory,
+        ReflectionClassFactory $reflectionClassFactory
+    ) {
+        $this->nameFetcher = $nameFetcher;
+        $this->eventDataFactory = $eventDataFactory;
+        $this->reflectionClassFactory = $reflectionClassFactory;
+    }
+
+    /**
+     * Collects events for classes that contains $_eventPrefix variable
+     * and instance of Magento\Framework\Model\AbstractModel.
+     * If the class is not an instance of mentioned above class we can't generate event codes for it.
+     *
+     * @param SplFileInfo $fileInfo
+     * @param string $fileContent
+     * @return array
+     * @throws LocalizedException
+     * @throws ReflectionException
+     */
+    public function fetchEvents(SplFileInfo $fileInfo, string $fileContent): array
+    {
+        $events = [];
+
+        $className = $this->nameFetcher->getNameFromFile($fileInfo, $fileContent);
+        $refClass = $this->reflectionClassFactory->create($className);
+
+        preg_match('/\$_eventPrefix\s=\s(?<eventPrefix>(\'.*?\'|\".*?\"));/im', $fileContent, $matches);
+
+        if (!isset($matches['eventPrefix'])) {
+            throw new LocalizedException(
+                __('Event prefix name cannot be fetched from the file: %1', $fileInfo->getPathname())
+            );
+        }
+
+        $prefix = EventSubscriberInterface::EVENT_TYPE_OBSERVER . '.' . trim($matches['eventPrefix'], '\'"');
+        if ($refClass->isSubclassOf(AbstractModel::class)) {
+            foreach ($this->abstractModelEvents as $eventSuffix) {
+                $eventName = $prefix . $eventSuffix;
+                $events[$eventName] = $this->eventDataFactory->create([
+                    EventData::EVENT_NAME => $eventName,
+                    EventData::EVENT_CLASS_EMITTER => $className,
+                ]);
+            }
+        }
+
+        return $events;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ObserverEventsCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,14 +7,14 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector\DispatchMethodCollector;
+use Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector\EventPrefixesCollector;
 use Magento\AdobeCommerceEventsClient\Util\FileOperator;
-use Magento\Framework\App\Utility\ReflectionClassFactory;
 use Magento\Framework\Exception\FileSystemException;
 use Magento\Framework\Filesystem\DriverInterface;
-use Magento\Framework\Model\AbstractModel;
 use Psr\Log\LoggerInterface;
 use SplFileInfo;
+use Exception;

 /**
  * Collects observer events list
@@ -22,18 +22,6 @@
 class ObserverEventsCollector implements CollectorInterface
 {
     /**
-     * Array of events for Magento\Framework\Model\AbstractModel class
-     *
-     * @var array
-     */
-    private array $abstractModelEvents = [
-        '_save_commit_after',
-        '_save_after',
-        '_delete_after',
-        '_delete_commit_after',
-    ];
-
-    /**
      * @var FileOperator
      */
     private FileOperator $fileOperator;
@@ -44,24 +32,19 @@
     private DriverInterface $filesystem;

     /**
-     * @var NameFetcher
-     */
-    private NameFetcher $nameFetcher;
-
-    /**
-     * @var EventDataFactory
+     * @var LoggerInterface
      */
-    private EventDataFactory $eventDataFactory;
+    private LoggerInterface $logger;

     /**
-     * @var LoggerInterface
+     * @var DispatchMethodCollector
      */
-    private LoggerInterface $logger;
+    private DispatchMethodCollector $dispatchMethodCollector;

     /**
-     * @var ReflectionClassFactory
+     * @var EventPrefixesCollector
      */
-    private ReflectionClassFactory $reflectionClassFactory;
+    private EventPrefixesCollector $eventPrefixesCollector;

     /**
      * @var string
@@ -71,27 +54,24 @@
     /**
      * @param FileOperator $fileOperator
      * @param DriverInterface $filesystem
-     * @param NameFetcher $nameFetcher
-     * @param EventDataFactory $eventDataFactory
      * @param LoggerInterface $logger
-     * @param ReflectionClassFactory $reflectionClassFactory
+     * @param DispatchMethodCollector $dispatchMethodCollector
+     * @param EventPrefixesCollector $eventPrefixesCollector
      * @param string $excludeDirPattern
      */
     public function __construct(
         FileOperator $fileOperator,
         DriverInterface $filesystem,
-        NameFetcher $nameFetcher,
-        EventDataFactory $eventDataFactory,
         LoggerInterface $logger,
-        ReflectionClassFactory $reflectionClassFactory,
+        DispatchMethodCollector $dispatchMethodCollector,
+        EventPrefixesCollector $eventPrefixesCollector,
         string $excludeDirPattern = '/^((?!test|Test|dev).)*$/'
     ) {
         $this->fileOperator = $fileOperator;
         $this->filesystem = $filesystem;
-        $this->nameFetcher = $nameFetcher;
-        $this->eventDataFactory = $eventDataFactory;
         $this->logger = $logger;
-        $this->reflectionClassFactory = $reflectionClassFactory;
+        $this->dispatchMethodCollector = $dispatchMethodCollector;
+        $this->eventPrefixesCollector = $eventPrefixesCollector;
         $this->excludeDirPattern = $excludeDirPattern;
     }

@@ -112,9 +92,17 @@
             try {
                 $fileContent = $this->filesystem->fileGetContents($fileInfo->getPathname());
                 if (strpos($fileContent, '$_eventPrefix') !== false) {
-                    $result = array_merge($result, $this->collectEventsForEventPrefixes($fileInfo, $fileContent));
-                } else if (strpos($fileContent, '->dispatch(') !== false) {
-                    $result = array_merge($result, $this->collectEventsFromDispatchMethod($fileInfo, $fileContent));
+                    // phpcs:ignore Magento2.Performance.ForeachArrayMerge
+                    $result = array_merge(
+                        $result,
+                        $this->eventPrefixesCollector->fetchEvents($fileInfo, $fileContent)
+                    );
+                } elseif (strpos($fileContent, '->dispatch(') !== false) {
+                    // phpcs:ignore Magento2.Performance.ForeachArrayMerge
+                    $result = array_merge(
+                        $result,
+                        $this->dispatchMethodCollector->fetchEvents($fileInfo, $fileContent)
+                    );
                 }
             } catch (FileSystemException $e) {
                 $this->logger->error(sprintf(
@@ -123,7 +111,7 @@
                     $e->getMessage()
                 ));
                 continue;
-            } catch (\Exception $e) {
+            } catch (Exception $e) {
                 $this->logger->error(sprintf(
                     'Unable to collect observer events from the file %s. Error: %s',
                     $fileInfo->getPathname(),
@@ -135,70 +123,4 @@

         return $result;
     }
-
-    /**
-     * Collects events for classes that contains $_eventPrefix variable
-     * and instance of Magento\Framework\Model\AbstractModel.
-     * If the class is not an instance of mentioned above class we can't generate event codes for it.
-     *
-     * @param SplFileInfo $fileInfo
-     * @param string $fileContent
-     * @return array
-     * @throws \Exception
-     */
-    private function collectEventsForEventPrefixes(SplFileInfo $fileInfo, string $fileContent): array
-    {
-        $events = [];
-
-        $className = $this->nameFetcher->getNameFromFile($fileInfo, $fileContent);
-        $refClass = $this->reflectionClassFactory->create($className);
-
-        preg_match('/\$_eventPrefix\s=\s\'(?<eventPrefix>.*?)\';/im', $fileContent, $matches);
-        if (!isset($matches['eventPrefix'])) {
-            throw new \Exception('Event prefix name cannot be fetched from the file: ' . $fileInfo->getPathname());
-        }
-
-        $prefix = EventSubscriber::EVENT_TYPE_OBSERVER . '.' . $matches['eventPrefix'];
-        if ($refClass->isSubclassOf(AbstractModel::class)) {
-            foreach ($this->abstractModelEvents as $eventSuffix) {
-                $eventName = $prefix . $eventSuffix;
-                $events[$eventName] = $this->eventDataFactory->create([
-                    EventData::EVENT_NAME => $eventName,
-                    EventData::EVENT_CLASS_EMITTER => $className,
-                ]);
-            }
-        }
-
-        return $events;
-    }
-
-    /**
-     * Parses and returns array of event names from dispatch methods.
-     *
-     * @param SplFileInfo $fileInfo
-     * @param string $fileContent
-     * @return array
-     * @throws \Exception
-     */
-    private function collectEventsFromDispatchMethod(SplFileInfo $fileInfo, string $fileContent): array
-    {
-        $events = [];
-
-        preg_match_all('/->dispatch\([^\)\.]*?\n?[^\)\.]*?\'(?<eventName>.*?)\'/im', $fileContent, $matches);
-
-        if (!empty($matches['eventName'])) {
-            $className = $this->nameFetcher->getNameFromFile($fileInfo, $fileContent);
-            foreach ($matches['eventName'] as $eventName) {
-                if (strpos($eventName, '_before') === false) {
-                    $eventName = EventSubscriber::EVENT_TYPE_OBSERVER . '.' . $eventName;
-                    $events[$eventName] = $this->eventDataFactory->create([
-                        EventData::EVENT_NAME => $eventName,
-                        EventData::EVENT_CLASS_EMITTER => $className,
-                    ]);
-                }
-            }
-        }
-
-        return $events;
-    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ResourceModelCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ResourceModelCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ResourceModelCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Collector/ResourceModelCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,11 +7,13 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Collector;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Util\FileOperator;
 use Magento\Framework\App\Utility\ReflectionClassFactory;
 use Magento\Framework\Exception\FileSystemException;
 use Magento\Framework\Filesystem\DriverInterface;
 use Magento\Framework\Model\ResourceModel\AbstractResource;
+use SplFileInfo;

 /**
  * Collects Resource model events from the Adobe Commerce module.
@@ -67,7 +69,8 @@
     /**
      * Collects Resource model events from the Adobe Commerce module.
      *
-     * @inheritDoc
+     * @param string $modulePath
+     * @return EventData[]
      */
     public function collect(string $modulePath): array
     {
@@ -85,7 +88,7 @@
         $directoryIterator = $this->fileOperator->getRecursiveFileIterator($realPath, ['/\.php$/']);

         foreach ($directoryIterator as $fileItem) {
-            /** @var $fileItem \SplFileInfo */
+            /** @var $fileItem SplFileInfo */
             if ($fileItem->isDir()) {
                 continue;
             }
@@ -93,14 +96,14 @@
             try {
                 $className = $this->nameFetcher->getNameFromFile($fileItem);
                 $refClass = $this->reflectionClassFactory->create($className);
-            } catch (\Exception $e) {
+            } catch (Exception $e) {
                 continue;
             }

             if (!$refClass->isSubclassOf(AbstractResource::class)) {
                 continue;
             }
-
+            // phpcs:ignore Magento2.Performance.ForeachArrayMerge
             $events = array_merge($events, $this->eventMethodCollector->collect($refClass));
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Config.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Config.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Config.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Config.php	2023-05-25 20:23:12.000000000 +0100
@@ -39,6 +39,8 @@
     }

     /**
+     * Checks if eventing is enabled.
+     *
      * @return bool
      */
     public function isEnabled(): bool
@@ -47,6 +49,8 @@
     }

     /**
+     * Returns instance id.
+     *
      * @return string
      */
     public function getInstanceId(): string
@@ -55,6 +59,8 @@
     }

     /**
+     * Returns endpoint url.
+     *
      * @return string
      */
     public function getEndpointUrl(): string
@@ -67,6 +73,8 @@
     }

     /**
+     * Returns Environment id.
+     *
      * @return string
      */
     public function getEnvironmentId(): string
@@ -75,6 +83,8 @@
     }

     /**
+     * Returns Merchant id.
+     *
      * @return string
      */
     public function getMerchantId(): string
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Converter/EventDataConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Converter/EventDataConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Converter/EventDataConverter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Converter/EventDataConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -5,33 +5,44 @@
  */
 namespace Magento\AdobeCommerceEventsClient\Event\Converter;

+use Exception;
+use Magento\Framework\Data\Collection;
+use Magento\Framework\Exception\LocalizedException;
+
 /**
  * Class for converting data to event suitable format
+ *
+ * @api
+ * @since 1.1.0
  */
 class EventDataConverter
 {
+    private const MAX_DEPTH = 5;
+
     /**
      * Convert object or array of objects to array format
      *
      * @param mixed $objectOrArray
      * @return array
-     * @throws \Exception
+     * @throws Exception
      */
     public function convert($objectOrArray): array
     {
         if (is_object($objectOrArray)) {
             if (method_exists($objectOrArray, 'toArray')) {
-                return $this->cleanData($objectOrArray->toArray());
+                return $this->convertAndCleanData($objectOrArray->toArray());
             }

-            throw new \Exception(sprintf('Object %s can not be converted to array', get_class($objectOrArray)));
+            throw new LocalizedException(
+                __(sprintf('Object %s can not be converted to array', get_class($objectOrArray)))
+            );
         }

         if (is_array($objectOrArray)) {
             return $this->convertArray($objectOrArray);
         }

-        throw new \Exception('Wrong type of input argument');
+        throw new LocalizedException(__('Wrong type of input argument'));
     }

     /**
@@ -44,7 +55,7 @@
     {
         foreach (['data_object', 'collection', 'object'] as $key) {
             if (isset($data[$key]) && method_exists($data[$key], 'toArray')) {
-                return $this->cleanData($data[$key]->toArray());
+                return $this->convertAndCleanData($data[$key]->toArray());
             }
         }

@@ -52,7 +63,7 @@
         foreach ($data as $key => $value) {
             if (is_object($value)) {
                 if (method_exists($value, 'toArray')) {
-                    $result[$key] = $this->cleanData($value->toArray());
+                    $result[$key] = $this->convertAndCleanData($value->toArray());
                 }
             } else {
                 $result[$key] = $value;
@@ -63,12 +74,17 @@
     }

     /**
-     * Clears array from the cached items and objects which can't be converted to the array
+     * Clears array from the cached items.
+     *
+     * Convert objects to array if possible otherwise clean array data from such objects.
+     * If the converted object is instance of Collection returns only it `items` after conversion.
+     * Maximum depth is added to avoid recursion.
      *
      * @param array $data
+     * @param int $depth
      * @return array
      */
-    private function cleanData(array $data): array
+    private function convertAndCleanData(array $data, int $depth = 1): array
     {
         foreach ($data as $key => $value) {
             if (strpos($key, '_cache') === 0) {
@@ -77,11 +93,20 @@

             if (is_object($value)) {
                 if (method_exists($value, 'toArray')) {
-                    $data[$key] = $value->toArray();
+                    $conversionResult = $value->toArray();
+                    if ($value instanceof Collection && isset($conversionResult['items'])) {
+                        $data[$key] = $conversionResult['items'];
+                    } else {
+                        $data[$key] = $conversionResult;
+                    }
                 } else {
                     unset($data[$key]);
                 }
             }
+
+            if (is_array($value) && $depth < self::MAX_DEPTH) {
+                $data[$key] = $this->convertAndCleanData($value, $depth + 1);
+            }
         }

         return $data;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/DataFilterInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/DataFilterInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/DataFilterInterface.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/DataFilterInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -18,6 +18,7 @@
      * @param string $eventCode
      * @param array $eventData
      * @return array
+     * @throws EventInitializationException
      */
     public function filter(string $eventCode, array $eventData): array;
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchGenerator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchGenerator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchGenerator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchGenerator.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,47 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsClient\Event;
-
-/**
- * Class for generating batches of event data.
- */
-class EventBatchGenerator
-{
-    // Maximum number of bytes that can be sent in a batch of messages. Pipeline limits the size of message batches to
-    // 2 MB, and headers will need to be added to each event message. This value leaves 10% of the limit for headers.
-    private const BATCH_SIZE_LIMIT = 2097152 * 0.9;
-
-    // Maximum number of messages that can be sent in a batch.
-    private const MAX_BATCH_SIZE = 100;
-
-    /**
-     * Given an array of event data, generates a batch of events to send containing a number of events that does not
-     * exceed MAX_MATCH_SIZE and a total number of bytes that does not exceed BATCH_SIZE_LIMIT.
-     *
-     * @param array $events
-     * @return array
-     */
-    public function generateBatch(array $events): array
-    {
-        $totalBytes = 0;
-        $eventBatch = [];
-        foreach ($events as $eventId => $event) {
-            $totalBytes += strlen(json_encode($event));
-            if ($totalBytes > self::BATCH_SIZE_LIMIT) {
-                return $eventBatch;
-            }
-
-            $eventBatch[$eventId] = $event;
-            if (count($eventBatch) == self::MAX_BATCH_SIZE) {
-                return $eventBatch;
-            }
-        }
-
-        return $eventBatch;
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchSender.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchSender.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchSender.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventBatchSender.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,19 +7,30 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

-use GuzzleHttp\Exception\GuzzleException;
 use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
-use Magento\AdobeCommerceEventsClient\Model\EventException;
 use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\Exception\LocalizedException;
+use Magento\Framework\Lock\LockManagerInterface;
 use Psr\Log\LoggerInterface;
+use Throwable;

 /**
  * Class for sending event data in batches to the configured events service
  */
 class EventBatchSender
 {
+    private const LOCK_NAME = 'event_batch_sender';
+    private const LOCK_TIMEOUT = 60;
+
     private const CONFIG_PATH_MAX_RETRIES = 'adobe_io_events/eventing/max_retries';

+    private const EVENT_COUNT_PER_ITERATION = 1000;
+
+    /**
+     * @var LockManagerInterface
+     */
+    private LockManagerInterface $lockManager;
+
     /**
      * @var ScopeConfigInterface
      */
@@ -31,128 +42,135 @@
     private Client $client;

     /**
-     * @var EventBatchGenerator
+     * @var EventRetrieverInterface
      */
-    private EventBatchGenerator $batchGenerator;
+    private EventRetrieverInterface $eventRetriever;

     /**
-     * @var EventRetriever
+     * @var EventStatusUpdater
      */
-    private EventRetriever $eventRetriever;
-
-    /**
-     * @var EventStorageWriter
-     */
-    private EventStorageWriter $storageWriter;
-
+    private EventStatusUpdater $statusUpdater;
     /**
      * @var LoggerInterface
      */
     private LoggerInterface $logger;

     /**
+     * @param LockManagerInterface $lockManager
      * @param ScopeConfigInterface $config
      * @param Client $client
-     * @param EventBatchGenerator $batchGenerator
-     * @param EventRetriever $eventRetriever
-     * @param EventStorageWriter $storageWriter
+     * @param EventRetrieverInterface $eventRetriever
+     * @param EventStatusUpdater $statusUpdater
      * @param LoggerInterface $logger
      */
     public function __construct(
+        LockManagerInterface $lockManager,
         ScopeConfigInterface $config,
         Client $client,
-        EventBatchGenerator $batchGenerator,
-        EventRetriever $eventRetriever,
-        EventStorageWriter $storageWriter,
+        EventRetrieverInterface $eventRetriever,
+        EventStatusUpdater $statusUpdater,
         LoggerInterface $logger
     ) {
+        $this->lockManager = $lockManager;
         $this->config = $config;
         $this->client = $client;
-        $this->batchGenerator = $batchGenerator;
         $this->eventRetriever = $eventRetriever;
-        $this->storageWriter = $storageWriter;
+        $this->statusUpdater = $statusUpdater;
         $this->logger = $logger;
     }

     /**
+     * Sends events data in batches.
+     *
      * Reads stored event data waiting to be sent, sends the data in batches to the Events Service, and updates stored
      * events based on the success or failure of sending the data.
+     * Added locking mechanism to avoid the situation when two processes trying to process the same events.
+     * Events are processed in iterations, during each iteration up to self::EVENT_COUNT_PER_ITERATION events
+     * are selected.
      *
      * @return void
-     * @throws EventException
+     * @throws LocalizedException
      */
     public function sendEventDataBatches(): void
     {
-        $waitingEvents = $this->eventRetriever->getWaitingEvents();
-
-        while (count($waitingEvents) != 0) {
-            $eventBatch = $this->batchGenerator->generateBatch($waitingEvents);
-
-            $eventIds = array_keys($eventBatch);
-            $this->storageWriter->updateStatus($eventIds, EventInterface::SENDING_STATUS);
-            $eventData = array_values($eventBatch);
-
+        do {
+            $didLock = false;
+            $waitingEvents = [];
             try {
-                $response = $this->client->sendEventDataBatch($eventData);
+                if (!$this->lockManager->lock(self::LOCK_NAME, self::LOCK_TIMEOUT)) {
+                    return;
+                }

-                if ($response->getStatusCode() == 200) {
-                    $this->logger->info(sprintf(
-                        'Event data batch of %s events was successfully published.',
-                        count($eventData)
-                    ));
-                    $this->storageWriter->updateStatus($eventIds, EventInterface::SUCCESS_STATUS);
-                    $waitingEvents = $this->unsetEvents($waitingEvents, $eventIds);
-                } else {
-                    $this->logger->error(sprintf(
-                        'Publishing of batch of %s events failed. Error code: %d; reason: %s %s',
-                        count($eventBatch),
-                        $response->getStatusCode(),
-                        $response->getReasonPhrase(),
-                        $response->getBody()->getContents()
-                    ));
-                    $failedStatusEvents = $this->setFailure($eventIds);
-                    $waitingEvents = $this->unsetEvents($waitingEvents, $failedStatusEvents);
+                $didLock = true;
+                $waitingEvents = $this->eventRetriever->getEventsWithLimit(self::EVENT_COUNT_PER_ITERATION);
+                $this->statusUpdater->updateStatus(
+                    array_keys($waitingEvents),
+                    EventInterface::SENDING_STATUS
+                );
+            } finally {
+                if ($didLock) {
+                    $this->lockManager->unlock(self::LOCK_NAME);
                 }
-            } catch (GuzzleException $exception) {
-                $this->logger->error(sprintf(
-                    'Publishing of batch of %s events failed: %s',
-                    count($eventBatch),
-                    $exception->getMessage()
-                ));
-                $failedStatusEvents = $this->setFailure($eventIds);
-                $waitingEvents = $this->unsetEvents($waitingEvents, $failedStatusEvents);
-            } catch (InvalidConfigurationException $exception) {
-                $this->logger->error(sprintf(
-                    'Publishing of batch of %s events failed. Configuration is not valid: %s',
-                    count($eventBatch),
-                    $exception->getMessage()
-                ));
-                $failedStatusEvents = $this->setFailure($eventIds);
-                $waitingEvents = $this->unsetEvents($waitingEvents, $failedStatusEvents);
             }
-        }
+
+            $waitingEventsCount = count($waitingEvents);
+            if ($waitingEventsCount) {
+                $this->processEvents($waitingEvents);
+            }
+        } while ($waitingEventsCount === self::EVENT_COUNT_PER_ITERATION);
     }

     /**
-     * @param array $eventIds
-     * @return array
+     * Processes array of events.
+     *
+     * Splits events into batches before sending.
+     *
+     * @param array $waitingEvents
+     * @return void
      */
-    private function setFailure(array $eventIds): array
+    private function processEvents(array $waitingEvents): void
     {
-        $maxRetries = (int)$this->config->getValue(self::CONFIG_PATH_MAX_RETRIES);
-        return $this->storageWriter->updateFailure($eventIds, $maxRetries);
+        $eventIds = array_keys($waitingEvents);
+        $eventData = array_values($waitingEvents);
+
+        try {
+            $response = $this->client->sendEventDataBatch($eventData);
+
+            if ($response->getStatusCode() == 200) {
+                $this->logger->info(sprintf(
+                    'Event data batch of %s events was successfully published.',
+                    count($eventData)
+                ));
+                $this->statusUpdater->updateStatus($eventIds, EventInterface::SUCCESS_STATUS);
+            } else {
+                $errorMessage = sprintf(
+                    'Error code: %d; reason: %s %s',
+                    $response->getStatusCode(),
+                    $response->getReasonPhrase(),
+                    $response->getBody()->getContents()
+                );
+                $this->setFailure($eventIds, $errorMessage);
+            }
+        } catch (Throwable $exception) {
+            $this->setFailure($eventIds, $exception->getMessage());
+        }
     }

     /**
-     * @param array $events
+     * Sets failure status from provided event ids and logs error message.
+     *
      * @param array $eventIds
-     * @return array
+     * @param string $errorMessage
+     * @return void
      */
-    private function unsetEvents(array $events, array $eventIds): array
+    private function setFailure(array $eventIds, string $errorMessage): void
     {
-        foreach ($eventIds as $eventId) {
-            unset($events[$eventId]);
-        }
-        return $events;
+        $maxRetries = (int)$this->config->getValue(self::CONFIG_PATH_MAX_RETRIES);
+        $this->logger->error(sprintf(
+            'Publishing of batch of %s events failed: %s',
+            count($eventIds),
+            $errorMessage
+        ));
+        $this->statusUpdater->updateFailure($eventIds, $maxRetries, 'Event publishing failed: ' . $errorMessage);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo/EventInfoReflection.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo/EventInfoReflection.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo/EventInfoReflection.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo/EventInfoReflection.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,156 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\EventInfo;
+
+use Laminas\Code\Reflection\ClassReflection;
+use Laminas\Code\Reflection\MethodReflection;
+use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventInfo;
+use Magento\AdobeCommerceEventsClient\Util\ClassToArrayConverter;
+use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
+use Magento\AdobeCommerceEventsClient\Util\ReflectionHelper;
+use ReflectionException;
+
+/**
+ * Reflection utility for converting info from event objects to payload
+ */
+class EventInfoReflection
+{
+    /**
+     * @var ReflectionHelper
+     */
+    private ReflectionHelper $reflectionHelper;
+
+    /**
+     * @var ClassToArrayConverter
+     */
+    private ClassToArrayConverter $classToArrayConverter;
+
+    /**
+     * @var EventCodeConverter
+     */
+    private EventCodeConverter $codeConverter;
+
+    /**
+     * @param ReflectionHelper $reflectionHelper
+     * @param ClassToArrayConverter $classToArrayConverter
+     * @param EventCodeConverter $codeConverter
+     */
+    public function __construct(
+        ReflectionHelper $reflectionHelper,
+        ClassToArrayConverter $classToArrayConverter,
+        EventCodeConverter $codeConverter
+    ) {
+        $this->codeConverter = $codeConverter;
+        $this->reflectionHelper = $reflectionHelper;
+        $this->classToArrayConverter = $classToArrayConverter;
+    }
+
+    /**
+     * Returns payload info for given event.
+     *
+     * @param Event $event
+     * @param int $nestedLevel
+     * @return array
+     * @throws ReflectionException
+     */
+    public function getPayloadInfo(Event $event, int $nestedLevel = EventInfo::NESTED_LEVEL): array
+    {
+        $className = $this->getClassNameFromEventName($event->getName());
+        $interfaceReflection = new ClassReflection($className);
+        $methodName = $this->codeConverter->extractMethodName($event->getName());
+        $methodReflection = $interfaceReflection->getMethod($methodName);
+
+        if (strpos($className, 'ResourceModel') !== false) {
+            $returnType = str_replace('\ResourceModel', '', $className);
+        } else {
+            $returnType = $this->reflectionHelper->getReturnType($methodReflection, $interfaceReflection);
+        }
+
+        if ($returnType === 'void') {
+            $result = [];
+        } elseif (in_array($returnType, ['bool', 'boolean'])) {
+            $result = $this->getReturnBasedOnParameters($methodReflection, $nestedLevel);
+        } else {
+            $isArray = $this->reflectionHelper->isArray($returnType);
+            if ($isArray) {
+                $returnType = $this->reflectionHelper->arrayTypeToSingle($returnType);
+            }
+
+            if ($this->reflectionHelper->isSimple($returnType)) {
+                $result[] = $returnType;
+            } else {
+                $result = $this->classToArrayConverter->convert($returnType, $nestedLevel);
+            }
+
+            if ($isArray) {
+                $result = [$result];
+            }
+        }
+
+        return $result;
+    }
+
+    /**
+     * Returns info for observer event type
+     *
+     * @param string $eventClassEmitter
+     * @param int $nestedLevel
+     * @return array
+     */
+    public function getInfoForObserverEvent(
+        string $eventClassEmitter,
+        int $nestedLevel = EventInfo::NESTED_LEVEL
+    ): array {
+        return $this->classToArrayConverter->convert(
+            $eventClassEmitter,
+            $nestedLevel
+        );
+    }
+
+    /**
+     * Returns result based on method parameters in case when plugin method returns bool
+     *
+     * @param MethodReflection $methodReflection
+     * @param int $nestedLevel
+     * @return array
+     */
+    private function getReturnBasedOnParameters(
+        MethodReflection $methodReflection,
+        int $nestedLevel = EventInfo::NESTED_LEVEL
+    ): array {
+        $methodParams = $this->reflectionHelper->getMethodParameters($methodReflection);
+
+        $result = [];
+        foreach ($methodParams as $param) {
+            if ($this->reflectionHelper->isSimple($param['type'])) {
+                $result[$param['name']] = $param['type'];
+            } else {
+                $result[$param['name']] = $this->classToArrayConverter->convert($param['type'], $nestedLevel);
+            }
+        }
+
+        return $result;
+    }
+
+    /**
+     * Add Interface suffix to `api` type plugins
+     *
+     * @param string $eventName
+     * @return string
+     */
+    private function getClassNameFromEventName(string $eventName): string
+    {
+        $className = $this->codeConverter->convertToFqcn($eventName);
+        if (strpos($eventName, 'resource_model') === false && strpos($eventName, '.api.') !== false) {
+            $className .= 'Interface';
+        }
+
+        return $className;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInfo.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,15 +7,14 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

-use Laminas\Code\Reflection\ClassReflection;
 use Magento\AdobeCommerceEventsClient\Event\Collector\AggregatedEventList;
+use Magento\AdobeCommerceEventsClient\Event\EventInfo\EventInfoReflection;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use Magento\AdobeCommerceEventsClient\Model\EventException;
 use Magento\AdobeCommerceEventsClient\Util\ClassToArrayConverter;
-use Magento\AdobeCommerceEventsClient\Util\ReflectionHelper;
-use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
 use Psr\Log\LoggerInterface;
+use ReflectionException;

 /**
  * Returns event info
@@ -30,24 +29,14 @@
     private EventValidatorInterface $eventCodeValidator;

     /**
-     * @var EventCodeConverter
-     */
-    private EventCodeConverter $codeConverter;
-
-    /**
      * @var AggregatedEventList
      */
     private AggregatedEventList $aggregatedEventList;

     /**
-     * @var ReflectionHelper
-     */
-    private ReflectionHelper $reflectionHelper;
-
-    /**
-     * @var ClassToArrayConverter
+     * @var EventInfoReflection
      */
-    private ClassToArrayConverter $classToArrayConverter;
+    private EventInfoReflection $infoReflection;

     /**
      * @var LoggerInterface
@@ -56,25 +45,21 @@

     /**
      * @param EventValidatorInterface $eventCodeValidator
-     * @param EventCodeConverter $codeConverter
+     * @param EventInfoReflection $infoReflection
      * @param AggregatedEventList $aggregatedEventList
-     * @param ReflectionHelper $reflectionHelper
-     * @param ClassToArrayConverter $classToArrayConverter
      * @param LoggerInterface $logger
+     *
+     * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
     public function __construct(
         EventValidatorInterface $eventCodeValidator,
-        EventCodeConverter $codeConverter,
+        EventInfoReflection $infoReflection,
         AggregatedEventList $aggregatedEventList,
-        ReflectionHelper $reflectionHelper,
-        ClassToArrayConverter $classToArrayConverter,
         LoggerInterface $logger
     ) {
         $this->eventCodeValidator = $eventCodeValidator;
-        $this->codeConverter = $codeConverter;
+        $this->infoReflection = $infoReflection;
         $this->aggregatedEventList = $aggregatedEventList;
-        $this->reflectionHelper = $reflectionHelper;
-        $this->classToArrayConverter = $classToArrayConverter;
         $this->logger = $logger;
     }

@@ -91,16 +76,19 @@
     {
         $this->eventCodeValidator->validate($event);

-        if (strpos($event->getName(), EventSubscriber::EVENT_TYPE_OBSERVER) === 0) {
-            return $this->getInfoForObserverEvent($event->getName(), $nestedLevel);
-        }
-
-        $className = $this->getClassNameFromEventName($event->getName());
         try {
-            $interfaceReflection = new ClassReflection($className);
-            $methodName = $this->codeConverter->extractMethodName($event->getName());
-            $methodReflection = $interfaceReflection->getMethod($methodName);
-        } catch (\ReflectionException $e) {
+            if (str_starts_with($event->getName(), EventSubscriberInterface::EVENT_TYPE_OBSERVER)) {
+                $payloadInfo = $this->getInfoForObserverEvent($event->getName(), $nestedLevel);
+            } else {
+                $payloadInfo = $this->infoReflection->getPayloadInfo($event, $nestedLevel);
+            }
+
+            if (isset($payloadInfo['data_model']) && is_array($payloadInfo['data_model'])) {
+                return $payloadInfo['data_model'];
+            }
+
+            return $payloadInfo;
+        } catch (ReflectionException $e) {
             $this->logger->error(sprintf(
                 'Event %s is not defined: %s',
                 $event->getName(),
@@ -108,39 +96,10 @@
             ));
             throw new EventException(__('Cannot get details for event %1', $event->getName()), $e);
         }
-
-        if (strpos($className, 'ResourceModel') !== false) {
-            $returnType = str_replace('\ResourceModel', '', $className);
-        } else {
-            $returnType = $this->reflectionHelper->getReturnType($methodReflection, $interfaceReflection);
-        }
-
-        if ($returnType === 'void') {
-            $result = [];
-        } elseif (in_array($returnType, ['bool', 'boolean'])) {
-            $result = $this->getReturnBasedOnParameters($methodReflection);
-        } else {
-            $isArray = $this->reflectionHelper->isArray($returnType);
-            if ($isArray) {
-                $returnType = $this->reflectionHelper->arrayTypeToSingle($returnType);
-            }
-
-            if ($this->reflectionHelper->isSimple($returnType)) {
-                $result[] = $returnType;
-            } else {
-                $result = $this->classToArrayConverter->convert($returnType, $nestedLevel);
-            }
-
-            if ($isArray) {
-                $result = [$result];
-            }
-        }
-
-        return $result;
     }

     /**
-     * Returns event info in json format
+     * Returns event info in json format.
      *
      * @param Event $event
      * @param int $nestedLevel
@@ -149,23 +108,7 @@
      */
     public function getJsonExample(Event $event, int $nestedLevel = self::NESTED_LEVEL): string
     {
-        return stripslashes(json_encode($this->getInfo($event, $nestedLevel), JSON_PRETTY_PRINT));
-    }
-
-    /**
-     * Add Interface suffix to `api` type plugins
-     *
-     * @param string $eventName
-     * @return string
-     */
-    private function getClassNameFromEventName(string $eventName): string
-    {
-        $className = $this->codeConverter->convertToFqcn($eventName);
-        if (strpos($eventName, 'resource_model') === false && strpos($eventName, '.api.') !== false) {
-            $className .= 'Interface';
-        }
-
-        return $className;
+        return str_replace('\\\\', '\\', json_encode($this->getInfo($event, $nestedLevel), JSON_PRETTY_PRINT));
     }

     /**
@@ -183,32 +126,9 @@
             throw new EventException(__('Cannot get details about event %1', $eventName));
         }

-        return $this->classToArrayConverter->convert(
+        return $this->infoReflection->getInfoForObserverEvent(
             $eventList[$eventName]->getEventClassEmitter(),
             $nestedLevel
         );
     }
-
-    /**
-     * Returns result based on method parameters in case when plugin method returns bool
-     *
-     * @param $methodReflection
-     * @param int $nestedLevel
-     * @return array
-     */
-    public function getReturnBasedOnParameters($methodReflection, int $nestedLevel = self::NESTED_LEVEL): array
-    {
-        $methodParams = $this->reflectionHelper->getMethodParameters($methodReflection);
-
-        $result = [];
-        foreach ($methodParams as $param) {
-            if ($this->reflectionHelper->isSimple($param['type'])) {
-                $result[$param['name']] = $param['type'];
-            } else {
-                $result[$param['name']] = $this->classToArrayConverter->convert($param['type'], $nestedLevel);
-            }
-        }
-
-        return $result;
-    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInitializationException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInitializationException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventInitializationException.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventInitializationException.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,20 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event;
+
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Exception thrown in case an event fails to initialize
+ *
+ * @api
+ * @since 1.1.0
+ */
+class EventInitializationException extends LocalizedException
+{
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventList.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventList.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventList.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventList.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,9 +9,13 @@

 use Magento\AdobeCommerceEventsClient\Config\Reader;
 use Magento\Framework\App\DeploymentConfig;
+use Magento\Framework\Exception\LocalizedException;

 /**
  * Returns list of all subscribed events
+ *
+ * @api
+ * @since 1.1.0
  */
 class EventList
 {
@@ -31,9 +35,9 @@
     private EventFactory $eventFactory;

     /**
-     * @var Event[]
+     * @var Event[]|null
      */
-    private $events;
+    private ?array $events = null;

     /**
      * @param Reader $reader
@@ -48,24 +52,32 @@
     }

     /**
+     * Returns list of all subscribed events.
+     *
      * @return Event[]
-     * @throws InvalidConfigurationException if event configuration is not valid
+     * @throws EventInitializationException
      */
     public function getAll(): array
     {
-        $this->load();
+        if ($this->events === null) {
+            $this->load();
+        }

         return $this->events;
     }

     /**
+     * Returns event object by event name.
+     *
      * @param string $eventName
      * @return Event|null
-     * @throws InvalidConfigurationException if event configuration is not valid
+     * @throws EventInitializationException
      */
     public function get(string $eventName): ?Event
     {
-        $this->load();
+        if ($this->events === null) {
+            $this->load();
+        }

         return $this->events[$this->removeCommercePrefix($eventName)] ?? null;
     }
@@ -75,7 +87,7 @@
      *
      * @param string $eventName
      * @return bool
-     * @throws InvalidConfigurationException if event configuration is not valid
+     * @throws EventInitializationException
      */
     public function isEventEnabled(string $eventName): bool
     {
@@ -91,14 +103,26 @@
     }

     /**
+     * Resets list of loaded events.
+     *
+     * Should be called after subscription or unsubscription to events to load the updated configuration.
+     *
+     * @return void
+     */
+    public function reset(): void
+    {
+        $this->events = null;
+    }
+
+    /**
      * Loads IO events subscription configuration from io_events.xml file and deployment configuration
      *
      * @return void
-     * @throws InvalidConfigurationException if event configuration is not valid
+     * @throws EventInitializationException
      */
     private function load(): void
     {
-        if ($this->events === null) {
+        try {
             $requiredEvents = $this->reader->read();

             $events = [];
@@ -106,7 +130,7 @@
                 $events[$eventData['name']] = $this->eventFactory->create($eventData);
             }

-            $optionalEvents = $this->deploymentConfig->get(EventSubscriber::IO_EVENTS_CONFIG_NAME);
+            $optionalEvents = $this->deploymentConfig->get(EventSubscriberInterface::IO_EVENTS_CONFIG_NAME);
             if (!empty($optionalEvents) && is_array($optionalEvents)) {
                 foreach ($optionalEvents as $eventName => $eventData) {
                     $eventName = strtolower($eventName);
@@ -122,15 +146,23 @@
                         Event::EVENT_FIELDS => $eventData['fields'],
                         Event::EVENT_RULES => $eventData['rules'] ?? [],
                         Event::EVENT_ENABLED => !isset($eventData['enabled']) || $eventData['enabled'] === 1,
+                        Event::EVENT_PRIORITY =>
+                            isset($eventData[Event::EVENT_PRIORITY]) && $eventData[Event::EVENT_PRIORITY] === 1,
                     ]);
                 }
             }

             $this->events = $events;
+        } catch (LocalizedException $e) {
+            throw new EventInitializationException(__($e->getMessage()), $e);
         }
     }

     /**
+     * Validates that $eventData is correctly configured.
+     *
+     * The $eventData must be an array and contain fields parameter.
+     *
      * @param string $eventName
      * @param mixed $eventData
      * @return void
@@ -143,7 +175,7 @@
                 __(
                     'Wrong configuration in "%1" section of app/etc/config.php file for the event "%2". ' .
                     'The configuration must be in array format with at least one field configured.',
-                    EventSubscriber::IO_EVENTS_CONFIG_NAME,
+                    EventSubscriberInterface::IO_EVENTS_CONFIG_NAME,
                     $eventName
                 )
             );
@@ -158,6 +190,6 @@
      */
     public function removeCommercePrefix(string $eventName): string
     {
-        return str_replace(EventSubscriber::EVENT_PREFIX_COMMERCE, '', $eventName);
+        return str_replace(EventSubscriberInterface::EVENT_PREFIX_COMMERCE, '', $eventName);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventMetadataCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventMetadataCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventMetadataCollector.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventMetadataCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -1,26 +1,24 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeCommerceEventsClient\Event;

-use Magento\Framework\App\ProductMetadataInterface;
-use Magento\Framework\Exception\NoSuchEntityException;
-use Magento\Framework\Module\PackageInfo;
-use Magento\Store\Model\StoreManagerInterface;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataException;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataPool;

 /**
- * Generates metadata to send in the message to the event pipeline
+ * Loads and returns metadata to send in the message to the event pipeline
  */
 class EventMetadataCollector
 {
     /**
-     * @var ProductMetadataInterface
+     * @var EventMetadataPool
      */
-    private ProductMetadataInterface $commerceMetadata;
-
-    /**
-     * @var PackageInfo
-     */
-    private PackageInfo $packageInfo;
+    private EventMetadataPool $metadataPool;

     /**
      * @var array
@@ -28,85 +26,32 @@
     private array $metadata = [];

     /**
-     * @var StoreManagerInterface
-     */
-    private StoreManagerInterface $storeManager;
-
-    /**
-     * @param ProductMetadataInterface $commerceMetadata
-     * @param PackageInfo $packageInfo
-     * @param StoreManagerInterface $storeManager
+     * @param EventMetadataPool $metadataPool
      */
     public function __construct(
-        ProductMetadataInterface $commerceMetadata,
-        PackageInfo              $packageInfo,
-        StoreManagerInterface    $storeManager
+        EventMetadataPool $metadataPool
     ) {
-        $this->commerceMetadata = $commerceMetadata;
-        $this->packageInfo = $packageInfo;
-        $this->storeManager = $storeManager;
+        $this->metadataPool = $metadataPool;
     }

     /**
      * Loads and returns metadata to send in the message to the event pipeline
      *
      * @return string[]
+     * @throws EventMetadataException
      */
     public function getMetadata(): array
     {
-        $this->loadMetadata();
-
-        return $this->metadata;
-    }
-
-    /**
-     * Loads and cache metadata into local variable
-     *
-     * @return void
-     */
-    private function loadMetadata(): void
-    {
         if (empty($this->metadata)) {
-            $metadata = [
-                'commerceEdition' => $this->getCommerceEdition(),
-                'commerceVersion' => $this->commerceMetadata->getVersion(),
-                'eventsClientVersion' => $this->packageInfo->getVersion('Magento_AdobeCommerceEventsClient'),
-            ];
-
-            try {
-                $store = $this->storeManager->getStore();
-                $metadata['storeId'] = $store->getId();
-                $metadata['websiteId'] = $store->getWebsiteId();
-                $metadata['storeGroupId'] = $store->getStoreGroupId();
-            } catch (NoSuchEntityException $exception) {
-                $metadata['storeId'] = $metadata['websiteId'] = $metadata['storeGroupId'] = '';
-            }
-
-            $this->metadata = $metadata;
-        }
-    }
+            $metadata = [];

-    /**
-     * Returns commerce edition name
-     *
-     * @return string
-     */
-    private function getCommerceEdition(): string
-    {
-        $commerceEdition = '';
+            foreach ($this->metadataPool->getAll() as $metadataObject) {
+                $metadata[] = $metadataObject->get();
+            }

-        switch ($this->commerceMetadata->getEdition()) {
-            case 'Community':
-                $commerceEdition = 'Open Source';
-                break;
-            case 'Enterprise':
-                $commerceEdition = 'Adobe Commerce';
-                break;
-            case 'B2B':
-                $commerceEdition = 'Adobe Commerce + B2B';
-                break;
+            $this->metadata = array_merge(...$metadata);
         }

-        return $commerceEdition;
+        return $this->metadata;
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Event.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Event.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Event.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Event.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,6 +9,9 @@

 /**
  * Event data object
+ *
+ * @api
+ * @since 1.1.0
  */
 class Event
 {
@@ -18,6 +21,7 @@
     public const EVENT_RULES = 'rules';
     public const EVENT_ENABLED = 'enabled';
     public const EVENT_OPTIONAL = 'optional';
+    public const EVENT_PRIORITY = 'priority';

     /**
      * @var string
@@ -40,7 +44,12 @@
     private bool $enabled;

     /**
-     * @var array
+     * @var boolean
+     */
+    private bool $priority;
+
+    /**
+     * @var string[]
      */
     private array $fields;

@@ -54,7 +63,8 @@
      * @param string|null $parent
      * @param bool $optional
      * @param bool $enabled
-     * @param array $fields
+     * @param bool $priority
+     * @param string[] $fields
      * @param array $rules
      */
     public function __construct(
@@ -62,6 +72,7 @@
         string $parent = null,
         bool $optional = false,
         bool $enabled = true,
+        bool $priority = false,
         array $fields = [],
         array $rules = []
     ) {
@@ -69,11 +80,14 @@
         $this->parent = $parent;
         $this->optional = $optional;
         $this->enabled = $enabled;
+        $this->priority = $priority;
         $this->fields = $fields;
         $this->rules = $rules;
     }

     /**
+     * Returns event name.
+     *
      * @return string
      */
     public function getName(): string
@@ -82,6 +96,8 @@
     }

     /**
+     * Checks if event is optional.
+     *
      * @return bool
      */
     public function isOptional(): bool
@@ -90,6 +106,8 @@
     }

     /**
+     * Checks if event is enabled.
+     *
      * @return bool
      */
     public function isEnabled(): bool
@@ -98,7 +116,19 @@
     }

     /**
-     * @return array
+     * Checks if event has priority.
+     *
+     * @return bool
+     */
+    public function isPriority(): bool
+    {
+        return $this->priority;
+    }
+
+    /**
+     * Returns a list of event fields.
+     *
+     * @return string[]
      */
     public function getFields(): array
     {
@@ -106,6 +136,8 @@
     }

     /**
+     * Returns a list of event rules.
+     *
      * @return array
      */
     public function getRules(): array
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/CollectionToArrayConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/CollectionToArrayConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/CollectionToArrayConverter.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/CollectionToArrayConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,67 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\EventRetriever;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventStatusUpdater;
+use Magento\AdobeCommerceEventsClient\Model\Event;
+use Magento\AdobeCommerceEventsClient\Model\EventException;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\Collection;
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Converts event collection to appropriate array.
+ */
+class CollectionToArrayConverter
+{
+    /**
+     * @var EventStatusUpdater
+     */
+    private EventStatusUpdater $statusUpdater;
+
+    /**
+     * @param EventStatusUpdater $statusUpdater
+     */
+    public function __construct(EventStatusUpdater $statusUpdater)
+    {
+        $this->statusUpdater = $statusUpdater;
+    }
+
+    /**
+     * Converts event collection to appropriate array of events.
+     *
+     * Updates event status to failure in case if not possible to convert event data.
+     *
+     * @param Collection $collection
+     * @return array
+     * @throws LocalizedException
+     */
+    public function convert(Collection $collection): array
+    {
+        $events = [];
+
+        /** @var Event $event */
+        foreach ($collection->getItems() as $event) {
+            try {
+                $events[$event->getId()] = [
+                    'eventCode' => $event->getEventCode(),
+                    'eventData' => $event->getEventData(),
+                    'metadata' => $event->getMetadata()
+                ];
+            } catch (EventException $e) {
+                $this->statusUpdater->updateStatus(
+                    [$event->getId()],
+                    EventInterface::FAILURE_STATUS,
+                    'Failed to process event data: ' . $e->getMessage()
+                );
+            }
+        }
+
+        return $events;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/EventRetryFilter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/EventRetryFilter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/EventRetryFilter.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/EventRetryFilter.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,31 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\EventRetriever;
+
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\Collection;
+
+/**
+ * Adds filters to a Collection based on the retry status of event records.
+ */
+class EventRetryFilter
+{
+    /**
+     * Selects events with incremental delay based on retries_count.
+     *
+     * @param Collection $collection
+     * @return Collection
+     */
+    public function addRetryFilter(Collection $collection): Collection
+    {
+        $collection->getSelect()->where(
+            'retries_count = 0 or ' .
+            'CURRENT_TIMESTAMP() > TIMESTAMPADD(MINUTE, POWER(2, retries_count - 1), updated_at)'
+        );
+        return $collection;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/PriorityWaitingEventRetriever.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/PriorityWaitingEventRetriever.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/PriorityWaitingEventRetriever.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/PriorityWaitingEventRetriever.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,83 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\EventRetriever;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventRetrieverInterface;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\CollectionFactory;
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Class for retrieving stored event data.
+ */
+class PriorityWaitingEventRetriever implements EventRetrieverInterface
+{
+    /**
+     * @var CollectionFactory
+     */
+    private CollectionFactory $collectionFactory;
+
+    /**
+     * @var CollectionToArrayConverter
+     */
+    private CollectionToArrayConverter $arrayConverter;
+
+    /**
+     * @var EventRetryFilter
+     */
+    private EventRetryFilter $eventRetryFilter;
+
+    /**
+     * @param CollectionFactory $collectionFactory
+     * @param CollectionToArrayConverter $arrayConverter
+     * @param EventRetryFilter $eventRetryFilter
+     */
+    public function __construct(
+        CollectionFactory $collectionFactory,
+        CollectionToArrayConverter $arrayConverter,
+        EVentRetryFilter $eventRetryFilter
+    ) {
+        $this->collectionFactory = $collectionFactory;
+        $this->arrayConverter = $arrayConverter;
+        $this->eventRetryFilter = $eventRetryFilter;
+    }
+
+    /**
+     * Returns a collection of events with waiting status and high priority.
+     *
+     * @return array
+     * @throws LocalizedException
+     */
+    public function getEvents(): array
+    {
+        $collection = $this->collectionFactory->create();
+        $collection->addFieldToFilter('status', (string)EventInterface::WAITING_STATUS);
+        $collection->addFieldToFilter('priority', EventInterface::PRIORITY_HIGH);
+
+        return $this->arrayConverter->convert($collection);
+    }
+
+    /**
+     * Returns a collection of events with waiting status and high priority.
+     *
+     * @param int|null $limit
+     * @return array
+     * @throws LocalizedException
+     */
+    public function getEventsWithLimit($limit = null): array
+    {
+        $collection = $this->collectionFactory->create();
+        $collection->addFieldToFilter('status', (string)EventInterface::WAITING_STATUS);
+        $collection->addFieldToFilter('priority', EventInterface::PRIORITY_HIGH);
+        if ($limit) {
+            $collection->setPageSize($limit);
+        }
+        $collection = $this->eventRetryFilter->addRetryFilter($collection);
+        return $this->arrayConverter->convert($collection);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/WaitingEventRetriever.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/WaitingEventRetriever.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/WaitingEventRetriever.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever/WaitingEventRetriever.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,81 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\EventRetriever;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventRetrieverInterface;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\CollectionFactory;
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Class for retrieving stored event data.
+ */
+class WaitingEventRetriever implements EventRetrieverInterface
+{
+    /**
+     * @var CollectionFactory
+     */
+    private CollectionFactory $collectionFactory;
+
+    /**
+     * @var CollectionToArrayConverter
+     */
+    private CollectionToArrayConverter $arrayConverter;
+
+    /**
+     * @var EventRetryFilter
+     */
+    private EventRetryFilter $eventRetryFilter;
+
+    /**
+     * @param CollectionFactory $collectionFactory
+     * @param CollectionToArrayConverter $arrayConverter
+     * @param EventRetryFilter $eventRetryFilter
+     */
+    public function __construct(
+        CollectionFactory $collectionFactory,
+        CollectionToArrayConverter $arrayConverter,
+        EventRetryFilter $eventRetryFilter
+    ) {
+        $this->collectionFactory = $collectionFactory;
+        $this->arrayConverter = $arrayConverter;
+        $this->eventRetryFilter = $eventRetryFilter;
+    }
+
+    /**
+     * Returns a collection of events with waiting status.
+     *
+     * @return array
+     * @throws LocalizedException
+     */
+    public function getEvents(): array
+    {
+        $collection = $this->collectionFactory->create();
+        $collection->addFieldToFilter('status', (string)EventInterface::WAITING_STATUS);
+
+        return $this->arrayConverter->convert($collection);
+    }
+
+    /**
+     * Returns a collection of events with waiting status.
+     *
+     * @param int|null $limit
+     * @return array
+     * @throws LocalizedException
+     */
+    public function getEventsWithLimit(int $limit = null): array
+    {
+        $collection = $this->collectionFactory->create();
+        $collection->addFieldToFilter('status', (string)EventInterface::WAITING_STATUS);
+        if ($limit) {
+            $collection->setPageSize($limit);
+        }
+        $collection = $this->eventRetryFilter->addRetryFilter($collection);
+        return $this->arrayConverter->convert($collection);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetrieverInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetrieverInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetrieverInterface.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetrieverInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,38 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event;
+
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Interface for retrieving list of events.
+ *
+ * @api
+ * @since 1.1.0
+ */
+interface EventRetrieverInterface
+{
+    /**
+     * Retrieves a list of the stored events waiting to be sent.
+     *
+     * @return array
+     * @throws LocalizedException
+     * @deprecated 1.1.1 this method is replaced by a new method with a possibility to provide a limit
+     * @see EventRetrieverInterface::getEventsWithLimit
+     */
+    public function getEvents(): array;
+
+    /**
+     * Retrieves a list of the stored events waiting to be sent.
+     *
+     * @param int|null $limit
+     * @return array
+     * @throws LocalizedException
+     */
+    public function getEventsWithLimit(int $limit = null): array;
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventRetriever.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,56 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsClient\Event;
-
-use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
-use Magento\AdobeCommerceEventsClient\Model\Event;
-use Magento\AdobeCommerceEventsClient\Model\EventException;
-use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\Collection;
-
-/**
- * Class for retrieving stored event data.
- */
-class EventRetriever
-{
-    /**
-     * @var Collection
-     */
-    private Collection $collection;
-
-    /**
-     * @param Collection $collection
-     */
-    public function __construct(
-        Collection $collection
-    ) {
-        $this->collection = $collection;
-    }
-
-    /**
-     * Retrieves a list of the stored events waiting to be sent.
-     *
-     * @return array
-     * @throws EventException
-     */
-    public function getWaitingEvents(): array
-    {
-        $this->collection->addFieldToFilter('status', (string)EventInterface::WAITING_STATUS);
-
-        $events = [];
-        /** @var Event $event */
-        foreach ($this->collection->getItems() as $event) {
-            $events[$event->getId()] = [
-                "eventCode" => $event->getEventCode(),
-                "eventData" => $event->getEventData(),
-                "metadata" => $event->getMetadata()
-            ];
-        }
-
-        return $events;
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStatusUpdater.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStatusUpdater.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStatusUpdater.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStatusUpdater.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,93 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Api\EventRepositoryInterface;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event as EventResourceModel;
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * Updates events statuses.
+ */
+class EventStatusUpdater
+{
+    /**
+     * @var EventRepositoryInterface
+     */
+    private EventRepositoryInterface $eventRepository;
+
+    /**
+     * @var EventResourceModel
+     */
+    private EventResourceModel $eventResourceModel;
+
+    /**
+     * @param EventRepositoryInterface $eventRepository
+     * @param EventResourceModel $eventResourceModel
+     */
+    public function __construct(
+        EventRepositoryInterface $eventRepository,
+        EventResourceModel $eventResourceModel
+    ) {
+        $this->eventRepository = $eventRepository;
+        $this->eventResourceModel = $eventResourceModel;
+    }
+
+    /**
+     * Updates statuses for the stored events with the specified ids to match the specified status code.
+     *
+     * Using resource model for the performance optimization.
+     *
+     * @param array $eventIds
+     * @param int $statusCode
+     * @param string $info
+     * @return void
+     * @throws LocalizedException
+     */
+    public function updateStatus(array $eventIds, int $statusCode, string $info = ''): void
+    {
+        $connection = $this->eventResourceModel->getConnection();
+
+        $connection->update(
+            $this->eventResourceModel->getMainTable(),
+            ['status' => $statusCode, 'info' => $info],
+            ['event_id in (?)' => $eventIds]
+        );
+    }
+
+    /**
+     * Updates stored events with the specified ids to reflect unsuccessful sending of event data by doing one of the
+     * following:
+     * - increments retries_count for an event if the incremented count is not greater than the configured maximum
+     * number of retries
+     * - otherwise sets the stored status for the event to reflect failure
+     *
+     * @param array $eventIds
+     * @param int $maxRetries
+     * @param string $info
+     * @return void
+     */
+    public function updateFailure(array $eventIds, int $maxRetries, string $info = ''): void
+    {
+        foreach ($eventIds as $eventId) {
+            $storedEvent = $this->eventRepository->getById((int)$eventId);
+            $retries = $storedEvent->getRetriesCount() + 1;
+            if ($retries > $maxRetries) {
+                $storedEvent->setStatus(EventInterface::FAILURE_STATUS);
+            } else {
+                $storedEvent->setStatus(EventInterface::WAITING_STATUS);
+                $storedEvent->setRetriesCount($retries);
+            }
+            if (!empty($info)) {
+                $storedEvent->setInfo($info);
+            }
+            $this->eventRepository->save($storedEvent);
+        }
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageCleaner.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageCleaner.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageCleaner.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageCleaner.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event as EventResourceModel;
@@ -74,7 +75,7 @@

         try {
             $this->eventResourceModel->deleteConditionally($deleteConditions);
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             $this->logger->error(
                 sprintf(
                     'Unable to delete events: %s',
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter/CreateEventValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter/CreateEventValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter/CreateEventValidator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter/CreateEventValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -11,13 +11,10 @@
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorException;
 use Magento\AdobeCommerceEventsClient\Event\Rule\RuleChecker;
-use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
-use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

 /**
  * Checks if event can be created
  * - configuration is enabled
- * - event is supported
  * - verification passes for all rules
  */
 class CreateEventValidator
@@ -28,27 +25,19 @@
     private Config $eventConfiguration;

     /**
-     * @var EventCodeSupportedValidator
-     */
-    private EventCodeSupportedValidator $eventCodeSupportedValidator;
-
-    /**
      * @var RuleChecker
      */
     private RuleChecker $ruleChecker;

     /**
      * @param Config $eventConfiguration
-     * @param EventCodeSupportedValidator $eventCodeSupportedValidator
      * @param RuleChecker $ruleChecker
      */
     public function __construct(
         Config $eventConfiguration,
-        EventCodeSupportedValidator $eventCodeSupportedValidator,
         RuleChecker $ruleChecker
     ) {
         $this->eventConfiguration = $eventConfiguration;
-        $this->eventCodeSupportedValidator = $eventCodeSupportedValidator;
         $this->ruleChecker = $ruleChecker;
     }

@@ -58,16 +47,10 @@
      * @param Event $event
      * @param array $eventData
      * @return bool
-     * @throws ValidatorException|OperatorException
+     * @throws OperatorException
      */
     public function validate(Event $event, array $eventData): bool
     {
-        if (!$this->eventConfiguration->isEnabled()) {
-            return false;
-        }
-
-        $this->eventCodeSupportedValidator->validate($event);
-
-        return $this->ruleChecker->verify($event, $eventData);
+        return $this->eventConfiguration->isEnabled() && $this->ruleChecker->verify($event, $eventData);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventStorageWriter.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,19 +7,21 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

-use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\AdobeCommerceEventsClient\Api\EventRepositoryInterface;
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter\CreateEventValidator;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataException;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorException;
-use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
+use Magento\AdobeCommerceEventsClient\Event\Queue\Publisher\EventPublisherFactory;
 use Magento\AdobeCommerceEventsClient\Model\EventException;
 use Magento\AdobeCommerceEventsClient\Model\EventFactory as EventModelFactory;
 use Magento\Framework\Exception\AlreadyExistsException;
 use Psr\Log\LoggerInterface;

 /**
- * Writes new event data to storage and updates the status of existing stored events.
+ * Writes new event data to storage.
  *
+ * @api
+ * @since 1.1.0
  * @SuppressWarnings(PHPMD.CouplingBetweenObjects)
  */
 class EventStorageWriter
@@ -55,6 +57,11 @@
     private CreateEventValidator $createEventValidator;

     /**
+     * @var EventPublisherFactory
+     */
+    private EventPublisherFactory $eventPublisherFactory;
+
+    /**
      * @var LoggerInterface
      */
     private LoggerInterface $logger;
@@ -66,6 +73,7 @@
      * @param EventModelFactory $eventModelFactory
      * @param DataFilterInterface $eventDataFilter
      * @param EventMetadataCollector $metadataCollector
+     * @param EventPublisherFactory $eventPublisherFactory
      * @param LoggerInterface $logger
      */
     public function __construct(
@@ -75,6 +83,7 @@
         EventModelFactory $eventModelFactory,
         DataFilterInterface $eventDataFilter,
         EventMetadataCollector $metadataCollector,
+        EventPublisherFactory $eventPublisherFactory,
         LoggerInterface $logger
     ) {
         $this->eventList = $eventList;
@@ -83,66 +92,20 @@
         $this->eventModelFactory = $eventModelFactory;
         $this->eventDataFilter = $eventDataFilter;
         $this->metadataCollector = $metadataCollector;
+        $this->eventPublisherFactory = $eventPublisherFactory;
         $this->logger = $logger;
     }

     /**
-     * Updates statuses for the stored events with the specified ids to match the specified status code.
-     *
-     * @param array $eventIds
-     * @param int $statusCode
-     * @return void
-     */
-    public function updateStatus(array $eventIds, int $statusCode): void
-    {
-        foreach ($eventIds as $eventId) {
-            $storedEvent = $this->eventRepository->getById($eventId);
-            $storedEvent->setStatus($statusCode);
-            $this->eventRepository->save($storedEvent);
-        }
-    }
-
-    /**
-     * Updates stored events with the specified ids to reflect unsuccessful sending of event data by doing one of the
-     * following:
-     * - increments retries_count for an event if the incremented count is not greater than the configured maximum
-     * number of retries
-     * - otherwise sets the stored status for the event to reflect failure
-     *
-     * Returns an array of eventIds specifying the events whose statuses were updated to failed.
-     *
-     * @param array $eventIds
-     * @param int $maxRetries
-     * @return array
-     */
-    public function updateFailure(array $eventIds, int $maxRetries): array
-    {
-        $failedStatusEvents = [];
-
-        foreach ($eventIds as $eventId) {
-            $storedEvent = $this->eventRepository->getById((int)$eventId);
-            $retries = $storedEvent->getRetriesCount() + 1;
-            if ($retries > $maxRetries) {
-                $storedEvent->setStatus(EventInterface::FAILURE_STATUS);
-                $failedStatusEvents[] = $eventId;
-            } else {
-                $storedEvent->setStatus(EventInterface::WAITING_STATUS);
-                $storedEvent->setRetriesCount($retries);
-            }
-            $this->eventRepository->save($storedEvent);
-        }
-
-        return $failedStatusEvents;
-    }
-
-    /**
      * Checks if there are registered events that depend on this eventCode.
+     *
      * Creates events for all appropriate registration.
      *
      * @param string $eventCode
      * @param array $eventData
      * @return void
-     * @throws EventException|InvalidConfigurationException
+     * @throws EventException
+     * @throws EventInitializationException
      */
     public function createEvent(string $eventCode, array $eventData): void
     {
@@ -161,10 +124,11 @@
      * @param array $eventData
      * @return void
      * @throws EventException
+     * @throws EventInitializationException
      */
     private function saveEvent(Event $event, array $eventData): void
     {
-        $eventCode = EventSubscriber::EVENT_PREFIX_COMMERCE . $event->getName();
+        $eventCode = EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $event->getName();
         try {
             if (!$this->createEventValidator->validate($event, $eventData)) {
                 return;
@@ -174,9 +138,14 @@
             $eventModel->setEventCode($eventCode);
             $eventModel->setEventData($this->eventDataFilter->filter($eventCode, $eventData));
             $eventModel->setMetadata($this->metadataCollector->getMetadata());
+            $eventModel->setPriority((int)$event->isPriority());

             $this->eventRepository->save($eventModel);
-        } catch (AlreadyExistsException|ValidatorException $e) {
+            if ($event->isPriority()) {
+                $publisher = $this->eventPublisherFactory->create();
+                $publisher->execute($eventModel->getId());
+            }
+        } catch (AlreadyExistsException $e) {
             $this->logger->error(sprintf(
                 'Could not create event "%s": %s',
                 $eventCode,
@@ -188,6 +157,12 @@
                 $eventCode,
                 $e->getMessage()
             ));
+        } catch (EventMetadataException $e) {
+            $this->logger->error(sprintf(
+                'Could not collect required metadata for the event "%s", error: %s',
+                $eventCode,
+                $e->getMessage()
+            ));
         }
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriberInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriberInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriberInterface.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriberInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,11 +10,23 @@
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

 /**
- *  Interface for event subscribing/unsubscribing
+ * Interface for event subscribing/unsubscribing
+ *
+ * @api
+ * @since 1.1.0
  */
 interface EventSubscriberInterface
 {
+    public const IO_EVENTS_CONFIG_NAME = 'io_events';
+    public const EVENT_PREFIX_COMMERCE = 'com.adobe.commerce.';
+
+    public const EVENT_TYPE_PLUGIN = 'plugin';
+    public const EVENT_TYPE_OBSERVER = 'observer';
+    public const EVENT_TYPES = [self::EVENT_TYPE_PLUGIN, self::EVENT_TYPE_OBSERVER];
+
     /**
+     * Subscribes to the event.
+     *
      * @param Event $event
      * @param bool $force
      * @return void
@@ -23,6 +35,8 @@
     public function subscribe(Event $event, bool $force = false): void;

     /**
+     * Unsubscribing from the event.
+     *
      * @param Event $event
      * @return void
      * @throws ValidatorException
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriber.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriber.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriber.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/EventSubscriber.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,14 +7,14 @@

 namespace Magento\AdobeCommerceEventsClient\Event;

+use Exception;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
+use Magento\AdobeIoEventsClient\Model\EventMetadataClient;
 use Magento\Framework\App\DeploymentConfig;
 use Magento\Framework\App\DeploymentConfig\Writer;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\Framework\Config\File\ConfigFilePool;
-use Magento\Framework\Exception\NoSuchEntityException;
 use Psr\Log\LoggerInterface;

 /**
@@ -22,13 +22,6 @@
  */
 class EventSubscriber implements EventSubscriberInterface
 {
-    public const EVENT_PREFIX_COMMERCE = 'com.adobe.commerce.';
-    public const IO_EVENTS_CONFIG_NAME = 'io_events';
-
-    public const EVENT_TYPE_PLUGIN = 'plugin';
-    public const EVENT_TYPE_OBSERVER = 'observer';
-    public const EVENT_TYPES = [self::EVENT_TYPE_PLUGIN, self::EVENT_TYPE_OBSERVER];
-
     /**
      * @var Writer
      */
@@ -50,9 +43,9 @@
     private EventValidatorInterface $unsubscribeValidator;

     /**
-     * @var IOEventsAPIClient
+     * @var EventMetadataClient
      */
-    private IOEventsAPIClient $IOEventsAPIClient;
+    private EventMetadataClient $metadataClient;

     /**
      * @var AdobeIoEventMetadataFactory
@@ -65,6 +58,11 @@
     private AdobeIOConfigurationProvider $configurationProvider;

     /**
+     * @var EventList
+     */
+    private EventList $eventList;
+
+    /**
      * @var LoggerInterface
      */
     private LoggerInterface $logger;
@@ -76,7 +74,8 @@
      * @param EventValidatorInterface $unsubscribeValidator
      * @param AdobeIOConfigurationProvider $configurationProvider
      * @param AdobeIoEventMetadataFactory $eventMetadataFactory
-     * @param IOEventsAPIClient $IOEventsAPIClient
+     * @param EventMetadataClient $metadataClient
+     * @param EventList $eventList
      * @param LoggerInterface $logger
      */
     public function __construct(
@@ -86,7 +85,8 @@
         EventValidatorInterface $unsubscribeValidator,
         AdobeIOConfigurationProvider $configurationProvider,
         AdobeIoEventMetadataFactory $eventMetadataFactory,
-        IOEventsAPIClient $IOEventsAPIClient,
+        EventMetadataClient $metadataClient,
+        EventList $eventList,
         LoggerInterface $logger
     ) {
         $this->configWriter = $configWriter;
@@ -95,7 +95,8 @@
         $this->unsubscribeValidator = $unsubscribeValidator;
         $this->configurationProvider = $configurationProvider;
         $this->ioMetadataFactory = $eventMetadataFactory;
-        $this->IOEventsAPIClient = $IOEventsAPIClient;
+        $this->metadataClient = $metadataClient;
+        $this->eventList = $eventList;
         $this->logger = $logger;
     }

@@ -107,8 +108,8 @@
         $this->subscribeValidator->validate($event, $force);

         try {
-            $this->IOEventsAPIClient->createEventMetadata(
-                $this->configurationProvider->retrieveProvider(),
+            $this->metadataClient->createEventMetadata(
+                $this->configurationProvider->getProvider(),
                 $this->ioMetadataFactory->generate(self::EVENT_PREFIX_COMMERCE . $event->getName())
             );

@@ -123,9 +124,10 @@
                 ],
                 true
             );
+            $this->eventList->reset();

             $this->logger->info(sprintf('Event subscription %s was added', $event->getName()));
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             throw new ValidatorException(__($e->getMessage()), $e, $e->getCode());
         }
     }
@@ -138,8 +140,8 @@
         $this->unsubscribeValidator->validate($event);

         try {
-            $this->IOEventsAPIClient->deleteEventMetadata(
-                $this->configurationProvider->retrieveProvider(),
+            $this->metadataClient->deleteEventMetadata(
+                $this->configurationProvider->getProvider(),
                 $this->ioMetadataFactory->generate(self::EVENT_PREFIX_COMMERCE . $event->getName())
             );

@@ -150,9 +152,10 @@
                     ]
                 ]
             ]);
+            $this->eventList->reset();

             $this->logger->info(sprintf('Subscription to event %s was removed', $event->getName()));
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             throw new ValidatorException(__($e->getMessage()), $e, $e->getCode());
         }
     }
@@ -175,6 +178,9 @@
         if (!empty($event->getParent())) {
             $eventData[Event::EVENT_PARENT] = $event->getParent();
         }
+        if ($event->isPriority()) {
+            $eventData[Event::EVENT_PRIORITY] = 1;
+        }

         return $eventData;
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/EventFieldsFilter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/EventFieldsFilter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/EventFieldsFilter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/EventFieldsFilter.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,6 +10,8 @@
 use Magento\AdobeCommerceEventsClient\Event\DataFilterInterface;
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
+use Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter\Field;
+use Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter\FieldConverter;

 /**
  * Filters event payload according to the list of configured fields
@@ -22,18 +24,20 @@
     private EventList $eventList;

     /**
-     * @var NestedArrayOperator
+     * @var FieldConverter
      */
-    private NestedArrayOperator $nestedArrayOperator;
+    private FieldConverter $converter;

     /**
      * @param EventList $eventList
-     * @param NestedArrayOperator $nestedArrayOperator
+     * @param FieldConverter $converter
      */
-    public function __construct(EventList $eventList, NestedArrayOperator $nestedArrayOperator)
-    {
+    public function __construct(
+        EventList $eventList,
+        FieldConverter $converter
+    ) {
         $this->eventList = $eventList;
-        $this->nestedArrayOperator = $nestedArrayOperator;
+        $this->converter = $converter;
     }

     /**
@@ -49,17 +53,72 @@

         $filteredData = [];

-        foreach ($event->getFields() as $field) {
-            if (strpos($field, '.') !== false) {
-                $fieldParts = explode('.', $field);
+        $fields = $this->converter->convert($event->getFields());

-                $value = $this->nestedArrayOperator->getNestedElement($eventData, $fieldParts);
-                $this->nestedArrayOperator->setNestedElement($filteredData, $fieldParts, $value);
-            } else {
-                $filteredData[$field] = $eventData[$field] ?? null;
+        foreach ($fields as $field) {
+            $filteredData = array_replace_recursive(
+                $filteredData,
+                [$field->getName() => $this->processField($field, $eventData)]
+            );
+        }
+
+        return $filteredData;
+    }
+
+    /**
+     * Processes eventData filtering according to given Field.
+     *
+     * @param Field $field
+     * @param array $eventData
+     * @return array|mixed|null
+     */
+    private function processField(Field $field, array $eventData)
+    {
+        $filteredData = [];
+
+        $children = $field->getChildren();
+
+        if (empty($children)) {
+            return $eventData[$field->getName()] ?? null;
+        }
+
+        if ($field->isArray()) {
+            if (!isset($eventData[$field->getName()]) || !is_array($eventData[$field->getName()])) {
+                return [];
+            }
+
+            foreach ($eventData[$field->getName()] as $eventDataItem) {
+                $filteredData[] = $this->processChildren($children, is_array($eventDataItem) ? $eventDataItem : []);
             }
+        } else {
+            $filteredData = array_replace_recursive(
+                $filteredData,
+                $this->processChildren($children, $eventData[$field->getName()] ?? [])
+            );
         }

         return $filteredData;
     }
+
+    /**
+     * Process children field elements
+     *
+     * @param Field[] $children
+     * @param array $eventData
+     * @return array
+     */
+    private function processChildren(array $children, array $eventData): array
+    {
+        $result = [];
+
+        foreach ($children as $child) {
+            if ($child->hasChildren()) {
+                $result[$child->getName()] = $this->processField($child, $eventData);
+            } else {
+                $result[$child->getName()] = $eventData[$child->getName()] ?? null;
+            }
+        }
+
+        return $result;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/FieldConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/FieldConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/FieldConverter.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/FieldConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,76 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter;
+
+/**
+ * Converts event field expressions to aggregated Field objects
+ */
+class FieldConverter
+{
+    /**
+     * @var Field[]
+     */
+    private array $registry;
+
+    /**
+     * Converts a list of fields expression to the list of Field objects.
+     *
+     * Ignore field expression if it is not a string.
+     *
+     * @param string[] $fieldExpressions
+     * @return Field[]
+     */
+    public function convert(array $fieldExpressions): array
+    {
+        $fields = [];
+        $this->registry = [];
+        foreach ($fieldExpressions as $fieldExpression) {
+            if (!is_string($fieldExpression)) {
+                continue;
+            }
+            $fields[] = $this->buildField(explode('.', $fieldExpression));
+        }
+
+        return array_filter($fields);
+    }
+
+    /**
+     * Builds a Field object based on parts of event field expression.
+     *
+     * @param array $fieldParts
+     * @param Field|null $parent
+     * @return Field|null
+     */
+    private function buildField(array $fieldParts, Field $parent = null): ?Field
+    {
+        if (strpos($fieldParts[0], '[]') !== false) {
+            $field = new Field(str_replace('[]', '', $fieldParts[0]), $parent, true);
+        } else {
+            $field = new Field($fieldParts[0], $parent, false);
+        }
+
+        if (isset($this->registry[$field->getPath()])) {
+            $field = $this->registry[$field->getPath()];
+            if (count($fieldParts) > 1) {
+                $child = $this->buildField(array_slice($fieldParts, 1), $field);
+                if ($child) {
+                    $field->addChildren($child);
+                }
+            }
+            return null;
+        }
+
+        $this->registry[$field->getPath()] = $field;
+
+        if (count($fieldParts) > 1) {
+            $field->addChildren($this->buildField(array_slice($fieldParts, 1), $field));
+        }
+
+        return $field;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/Field.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/Field.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/Field.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/FieldFilter/Field.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,133 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter;
+
+/**
+ * Contains information about event fields.
+ */
+class Field
+{
+    /**
+     * @var string
+     */
+    private string $name;
+
+    /**
+     * @var bool
+     */
+    private bool $isArray;
+
+    /**
+     * @var array
+     */
+    private array $children = [];
+
+    /**
+     * @var Field|null
+     */
+    private ?Field $parent;
+
+    /**
+     * @var string|null
+     */
+    private ?string $path = null;
+
+    /**
+     * @param string $name
+     * @param Field|null $parent
+     * @param bool $isArray
+     */
+    public function __construct(string $name, Field $parent = null, bool $isArray = false)
+    {
+        $this->name = $name;
+        $this->parent = $parent;
+        $this->isArray = $isArray;
+    }
+
+    /**
+     * Adds a child Field element.
+     *
+     * @param Field $field
+     * @return void
+     */
+    public function addChildren(Field $field): void
+    {
+        $this->children[] = $field;
+    }
+
+    /**
+     * Returns array of children Field elements.
+     *
+     * @return Field[]
+     */
+    public function getChildren(): array
+    {
+        return $this->children;
+    }
+
+    /**
+     * Checks if the object has children Fields elements.
+     *
+     * @return bool
+     */
+    public function hasChildren(): bool
+    {
+        return !empty($this->children);
+    }
+
+    /**
+     * Checks if the Field is array type.
+     *
+     * It means that in field expression this part is marked as array [].
+     *
+     * @return bool
+     */
+    public function isArray(): bool
+    {
+        return $this->isArray;
+    }
+
+    /**
+     * Returns parent field element.
+     *
+     * @return Field|null
+     */
+    public function getParent(): ?Field
+    {
+        return $this->parent;
+    }
+
+    /**
+     * Returns field name.
+     *
+     * @return string
+     */
+    public function getName(): string
+    {
+        return $this->name;
+    }
+
+    /**
+     * Returns path to the current Field element.
+     *
+     * @return string
+     */
+    public function getPath(): string
+    {
+        if ($this->path === null) {
+            $this->path = $this->getName();
+
+            $parent = $this->getParent();
+            if ($parent !== null) {
+                $this->path = $parent->getPath() . '.' . $this->path;
+            }
+        }
+
+        return $this->path;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/ImageFieldFilter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/ImageFieldFilter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/ImageFieldFilter.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/ImageFieldFilter.php	2023-05-25 20:23:12.000000000 +0100
@@ -18,7 +18,9 @@
     /**
      * Recurses through the input array and unsets any keys equivalent to ImageContentInterface::BASE64_ENCODED_DATA.
      *
-     * {@inheritDoc}
+     * @param string $eventCode
+     * @param array $eventData
+     * @return array
      */
     public function filter(string $eventCode, array $eventData): array
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/NestedArrayOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/NestedArrayOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Filter/NestedArrayOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Filter/NestedArrayOperator.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,59 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsClient\Event\Filter;
-
-/**
- * Operates with nested array elements.
- */
-class NestedArrayOperator
-{
-    /**
-     * Creates a nested element in the original array for a given array of keys and assigns $value to it.
-     *
-     * @param array $original
-     * @param array $keys
-     * @param $value
-     * @return void
-     */
-    public function setNestedElement(array &$original, array $keys, $value): void
-    {
-        $data = &$original;
-
-        foreach ($keys as $key) {
-            if (!isset($data[$key])) {
-                $data[$key] = [];
-            }
-            $data = &$data[$key];
-        }
-
-        $data = $value;
-    }
-
-    /**
-     * Returns nested value by an array of keys. Returns null if the element does not exist.
-     *
-     * @param array $data
-     * @param array $keys
-     * @return mixed
-     */
-    public function getNestedElement(array $data, array $keys)
-    {
-        $size = count($keys);
-
-        for ($i = 0; $i < $size; $i++) {
-            if (!isset($data[$keys[$i]])) {
-                return null;
-            }
-
-            $data = $data[$keys[$i]];
-            if ($i === $size - 1) {
-                return $data;
-            }
-        }
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/InvalidConfigurationException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/InvalidConfigurationException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/InvalidConfigurationException.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/InvalidConfigurationException.php	2023-05-25 20:23:12.000000000 +0100
@@ -11,6 +11,9 @@

 /**
  * Exception thrown in case of not valid eventing configuration
+ *
+ * @api
+ * @since 1.1.0
  */
 class InvalidConfigurationException extends LocalizedException
 {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/ClientVersion.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/ClientVersion.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/ClientVersion.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/ClientVersion.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,41 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+use Magento\Framework\Module\PackageInfo;
+
+/**
+ * Collects and returns version of the Adobe Commerce events client module.
+ */
+class ClientVersion implements EventMetadataInterface
+{
+    /**
+     * @var PackageInfo
+     */
+    private PackageInfo $packageInfo;
+
+    /**
+     * @param PackageInfo $packageInfo
+     */
+    public function __construct(PackageInfo $packageInfo)
+    {
+        $this->packageInfo = $packageInfo;
+    }
+
+    /**
+     * Collects and returns version of the Adobe Commerce events client module.
+     *
+     * @return array
+     */
+    public function get(): array
+    {
+        return [
+            'eventsClientVersion' => $this->packageInfo->getVersion('Magento_AdobeCommerceEventsClient')
+        ];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/CommerceEdition.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/CommerceEdition.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/CommerceEdition.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/CommerceEdition.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,53 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+use Magento\Framework\App\ProductMetadataInterface;
+
+/**
+ * Collects and returns commerce edition and version.
+ */
+class CommerceEdition implements EventMetadataInterface
+{
+    /**
+     * @var ProductMetadataInterface
+     */
+    private ProductMetadataInterface $commerceMetadata;
+
+    /**
+     * @param ProductMetadataInterface $commerceMetadata
+     */
+    public function __construct(ProductMetadataInterface $commerceMetadata)
+    {
+        $this->commerceMetadata = $commerceMetadata;
+    }
+
+    /**
+     * Collects and returns commerce edition and version.
+     *
+     * @return array
+     */
+    public function get(): array
+    {
+        $commerceEdition = 'Adobe Commerce';
+
+        switch ($this->commerceMetadata->getEdition()) {
+            case 'Community':
+                $commerceEdition = 'Open Source';
+                break;
+            case 'B2B':
+                $commerceEdition = 'Adobe Commerce + B2B';
+                break;
+        }
+
+        return [
+            'commerceEdition' => $commerceEdition,
+            'commerceVersion' => $this->commerceMetadata->getVersion()
+        ];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataException.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataException.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,17 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+use Magento\Framework\Exception\LocalizedException;
+
+/**
+ * An exception thrown in case when metadata couldn't be collected.
+ */
+class EventMetadataException extends LocalizedException
+{
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataInterface.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+/**
+ * Interface for event metadata
+ */
+interface EventMetadataInterface
+{
+    /**
+     * Returns array of key values pairs.
+     * For example:
+     * [
+     *    'store_id' => 3,
+     *    'website_id => 2
+     * ]
+     *
+     * @return array
+     * @throws EventMetadataException
+     */
+    public function get(): array;
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataPool.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataPool.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataPool.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/EventMetadataPool.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,54 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+use Magento\Framework\Exception\InvalidArgumentException;
+use Magento\Framework\Phrase;
+
+/**
+ * Pool of event metadata objects
+ */
+class EventMetadataPool
+{
+    /**
+     * @var EventMetadataInterface[]
+     */
+    private array $metadata = [];
+
+    /**
+     * @param EventMetadataInterface[] $metadata
+     * @throws InvalidArgumentException
+     */
+    public function __construct(array $metadata)
+    {
+        foreach ($metadata as $metadataObject) {
+            if (!$metadataObject instanceof EventMetadataInterface) {
+                throw new InvalidArgumentException(
+                    new Phrase(
+                        'Instance of "%1" is expected, got "%2" instead.',
+                        [
+                            EventMetadataInterface::class,
+                            get_class($metadataObject)
+                        ]
+                    )
+                );
+            }
+        }
+        $this->metadata = $metadata;
+    }
+
+    /**
+     * Return a list of registered metadata objects.
+     *
+     * @return EventMetadataInterface[]
+     */
+    public function getAll(): array
+    {
+        return $this->metadata;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/Store.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/Store.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/Store.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Metadata/Store.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,51 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Metadata;
+
+use Magento\Framework\Exception\NoSuchEntityException;
+use Magento\Store\Model\StoreManagerInterface;
+
+/**
+ * Returns info about store.
+ */
+class Store implements EventMetadataInterface
+{
+    /**
+     * @var StoreManagerInterface
+     */
+    private StoreManagerInterface $storeManager;
+
+    /**
+     * @param StoreManagerInterface $storeManager
+     */
+    public function __construct(StoreManagerInterface $storeManager)
+    {
+        $this->storeManager = $storeManager;
+    }
+
+    /**
+     * Returns info about store, website and store group.
+     *
+     * @return array
+     */
+    public function get(): array
+    {
+        $metadata = [];
+
+        try {
+            $store = $this->storeManager->getStore();
+            $metadata['storeId'] = $store->getId();
+            $metadata['websiteId'] = $store->getWebsiteId();
+            $metadata['storeGroupId'] = $store->getStoreGroupId();
+        } catch (NoSuchEntityException $exception) {
+            $metadata['storeId'] = $metadata['websiteId'] = $metadata['storeGroupId'] = '';
+        }
+
+        return $metadata;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/EqualOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/EqualOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/EqualOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/EqualOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -15,14 +15,17 @@
     /**
      * Verifies that event data value is matching value from the rule.
      *
-     * {@inheritDoc}
+     * @param string $ruleValue
+     * @param mixed $fieldValue
+     * @return bool
+     * @throws OperatorException
      */
     public function verify(string $ruleValue, $fieldValue): bool
     {
-        if (is_array($fieldValue) || strval($fieldValue) != $fieldValue) {
+        if (is_array($fieldValue) || (string)$fieldValue != $fieldValue) {
             throw new OperatorException(__('Input data must be in string format or can be converted to string'));
         }

-        return $ruleValue == strval($fieldValue);
+        return $ruleValue == (string)$fieldValue;
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/GreaterOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/GreaterOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/GreaterOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/GreaterOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -15,7 +15,9 @@
     /**
      * Verifies that event data value is greater than the value in the rule.
      *
-     * {@inheritDoc}
+     * @param string $ruleValue
+     * @param mixed $fieldValue
+     * @return bool
      */
     public function verify(string $ruleValue, $fieldValue): bool
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/InOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/InOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/InOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/InOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -15,7 +15,9 @@
     /**
      * Verifies that event data value is in the list of provided values.
      *
-     * {@inheritDoc}
+     * @param string $ruleValue
+     * @param mixed $fieldValue
+     * @return bool
      */
     public function verify(string $ruleValue, $fieldValue): bool
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/LessOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/LessOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/LessOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/LessOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -15,7 +15,9 @@
     /**
      * Verifies that event data value is less than the value in the rule.
      *
-     * {@inheritDoc}
+     * @param string $ruleValue
+     * @param mixed $fieldValue
+     * @return bool
      */
     public function verify(string $ruleValue, $fieldValue): bool
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/OperatorInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/OperatorInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/OperatorInterface.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/OperatorInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,12 +9,17 @@

 /**
  * Interface for operator classes
+ *
+ * @api
+ * @since 1.1.0
  */
 interface OperatorInterface
 {
     /**
+     * Verifies that the field value meets the condition.
+     *
      * @param string $ruleValue
-     * @param $fieldValue
+     * @param mixed $fieldValue
      * @return bool
      * @throws OperatorException
      */
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/RegexOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/RegexOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Operator/RegexOperator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Operator/RegexOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,8 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Operator;

+use Throwable;
+
 /**
  * Verifies that event data value is matching regex pattern from the rule.
  */
@@ -15,17 +17,20 @@
     /**
      * Verifies that event data value is matching regex pattern from the rule.
      *
-     * {@inheritDoc}
+     * @param string $ruleValue
+     * @param mixed $fieldValue
+     * @return bool
+     * @throws OperatorException
      */
     public function verify(string $ruleValue, $fieldValue): bool
     {
-        if (is_array($fieldValue) || strval($fieldValue) != $fieldValue) {
+        if (is_array($fieldValue) || (string)$fieldValue != $fieldValue) {
             throw new OperatorException(__('Input data must be in string format or can be converted to string'));
         }

         try {
-            return preg_match($ruleValue, strval($fieldValue)) === 1;
-        } catch (\Throwable $e) {
+            return preg_match($ruleValue, (string)$fieldValue) === 1;
+        } catch (Throwable $e) {
             throw new OperatorException(__('Regex operation failed: %1', $e->getMessage()));
         }
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Consumer/EventHandler.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Consumer/EventHandler.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Consumer/EventHandler.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Consumer/EventHandler.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,57 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Queue\Consumer;
+
+use Magento\AdobeCommerceEventsClient\Event\EventBatchSender;
+use Magento\Framework\Exception\LocalizedException;
+use Psr\Log\LoggerInterface;
+
+/**
+ * Handler for sending events in batches.
+ */
+class EventHandler
+{
+    /**
+     * @var EventBatchSender
+     */
+    private EventBatchSender $eventBatchSender;
+
+    /**
+     * @var LoggerInterface
+     */
+    private LoggerInterface $logger;
+
+    /**
+     * @param EventBatchSender $eventBatchSender
+     * @param LoggerInterface $logger
+     */
+    public function __construct(EventBatchSender $eventBatchSender, LoggerInterface $logger)
+    {
+        $this->eventBatchSender = $eventBatchSender;
+        $this->logger = $logger;
+    }
+
+    /**
+     * Publishes batch of priority events.
+     *
+     * @param mixed $eventIds
+     * @return void
+     * @throws LocalizedException
+     * @SuppressWarnings(PHPMD.UnusedFormalParameter)
+     */
+    public function execute($eventIds): void
+    {
+        try {
+            $this->eventBatchSender->sendEventDataBatches();
+        } catch (LocalizedException $e) {
+            $this->logger->error('Publishing of batch of events failed: ' . $e->getLogMessage());
+
+            throw $e;
+        }
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/EventBatchConsumer.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/EventBatchConsumer.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/EventBatchConsumer.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/EventBatchConsumer.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,18 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Queue;
+
+use Magento\Framework\MessageQueue\BatchConsumer;
+
+/**
+ * This class is used to override interval setting for the original batch consumer.
+ */
+class EventBatchConsumer extends BatchConsumer
+{
+
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Merger.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Merger.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Merger.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Merger.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,53 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Queue;
+
+use Magento\Framework\MessageQueue\MergerInterface;
+use Magento\Framework\MessageQueue\MergedMessageInterfaceFactory;
+
+/**
+ * Merges messages from the event queue.
+ */
+class Merger implements MergerInterface
+{
+    /**
+     * @var MergedMessageInterfaceFactory
+     */
+    private MergedMessageInterfaceFactory $mergedMessageFactory;
+
+    /**
+     * @param MergedMessageInterfaceFactory $mergedMessageFactory
+     */
+    public function __construct(
+        MergedMessageInterfaceFactory $mergedMessageFactory
+    ) {
+        $this->mergedMessageFactory = $mergedMessageFactory;
+    }
+
+    /**
+     * Merges messages from the queue into single message for priority event batch consumer.
+     *
+     * @param array $messages
+     * @return array
+     */
+    public function merge(array $messages): array
+    {
+        $mergedMessages = [];
+
+        foreach ($messages as $topic => $topicMessages) {
+            $mergedMessages[$topic][] = $this->mergedMessageFactory->create(
+                [
+                    'mergedMessage' => implode(', ', $topicMessages),
+                    'originalMessagesIds' => array_keys($topicMessages)
+                ]
+            );
+        }
+
+        return $mergedMessages;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisherFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisherFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisherFactory.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisherFactory.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,43 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Queue\Publisher;
+
+use Magento\Framework\ObjectManagerInterface;
+
+/**
+ * Factory class for @see EventPublisher
+ */
+class EventPublisherFactory
+{
+    /**
+     * Object Manager instance
+     *
+     * @var ObjectManagerInterface
+     */
+    private ObjectManagerInterface $objectManager;
+
+    /**
+     * Factory constructor
+     *
+     * @param ObjectManagerInterface $objectManager
+     */
+    public function __construct(ObjectManagerInterface $objectManager)
+    {
+        $this->objectManager = $objectManager;
+    }
+
+    /**
+     * Create Event class instance
+     *
+     * @return EventPublisher
+     */
+    public function create(): EventPublisher
+    {
+        return $this->objectManager->get(EventPublisher::class);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisher.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisher.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisher.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Queue/Publisher/EventPublisher.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,44 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Queue\Publisher;
+
+use Magento\Framework\MessageQueue\PublisherInterface;
+
+/**
+ * Adds information to the message queue about publishing event data.
+ */
+class EventPublisher
+{
+    private const TOPIC_EVENTING_PUBLISHER = 'commerce.eventing.event.publish';
+
+    /**
+     * @var PublisherInterface
+     */
+    private PublisherInterface $publisher;
+
+    /**
+     * @param PublisherInterface $publisher
+     */
+    public function __construct(PublisherInterface $publisher)
+    {
+        $this->publisher = $publisher;
+    }
+
+    /**
+     * Adds information to the message queue about publishing event data.
+     *
+     * @param string $event
+     */
+    public function execute(string $event): void
+    {
+        $this->publisher->publish(
+            self::TOPIC_EVENTING_PUBLISHER,
+            $event
+        );
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleChecker.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleChecker.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleChecker.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleChecker.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,10 +8,8 @@
 namespace Magento\AdobeCommerceEventsClient\Event\Rule;

 use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorException;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorFactory;
-use Magento\AdobeCommerceEventsClient\Event\InvalidConfigurationException;

 /**
  * Checks if event data passed a list of rules, do nothing if event does not have configured rules.
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleFactory.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleFactory.php	2023-05-25 20:23:12.000000000 +0100
@@ -35,10 +35,10 @@
      * Create Rule class instance
      *
      * @param array $data
-     * @return Rule
+     * @return RuleInterface
      */
-    public function create(array $data = []): Rule
+    public function create(array $data = []): RuleInterface
     {
-        return $this->objectManager->create(Rule::class, $data);
+        return $this->objectManager->create(RuleInterface::class, $data);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleInterface.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/RuleInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,42 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Event\Rule;
+
+/**
+ * Interface for rule data object
+ *
+ * @api
+ * @since 1.1.0
+ */
+interface RuleInterface
+{
+    public const RULE_FIELD = 'field';
+    public const RULE_OPERATOR = 'operator';
+    public const RULE_VALUE = 'value';
+
+    /**
+     * Returns field name.
+     *
+     * @return string
+     */
+    public function getField(): string;
+
+    /**
+     * Returns operator name.
+     *
+     * @return string
+     */
+    public function getOperator(): string;
+
+    /**
+     * Returns rule value.
+     *
+     * @return string
+     */
+    public function getValue(): string;
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/Rule.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/Rule.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Rule/Rule.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Rule/Rule.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,12 +10,8 @@
 /**
  * Rule data object
  */
-class Rule
+class Rule implements RuleInterface
 {
-    public const RULE_FIELD = 'field';
-    public const RULE_OPERATOR = 'operator';
-    public const RULE_VALUE = 'value';
-
     /**
      * @var string
      */
@@ -44,7 +40,7 @@
     }

     /**
-     * @return string
+     * @inheritDoc
      */
     public function getField(): string
     {
@@ -52,7 +48,7 @@
     }

     /**
-     * @return string
+     * @inheritDoc
      */
     public function getOperator(): string
     {
@@ -60,7 +56,7 @@
     }

     /**
-     * @return string
+     * @inheritDoc
      */
     public function getValue(): string
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Synchronizer/AdobeIoEventMetadataSynchronizer.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Synchronizer/AdobeIoEventMetadataSynchronizer.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Synchronizer/AdobeIoEventMetadataSynchronizer.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Synchronizer/AdobeIoEventMetadataSynchronizer.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,12 +7,14 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Synchronizer;

+use Exception;
+use Magento\AdobeCommerceEventsClient\Event\EventInitializationException;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
 use Magento\AdobeCommerceEventsClient\Event\AdobeIoEventMetadataFactory;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeIoEventsClient\Console\CreateEventProvider;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
+use Magento\AdobeIoEventsClient\Model\EventMetadataClient;

 /**
  * Register events metadata in Adobe I/O.
@@ -25,9 +27,9 @@
     private AdobeIOConfigurationProvider $configurationProvider;

     /**
-     * @var IOEventsAPIClient
+     * @var EventMetadataClient
      */
-    private IOEventsAPIClient $IOEventsAPIClient;
+    private EventMetadataClient $metadataClient;

     /**
      * @var EventList
@@ -41,18 +43,18 @@

     /**
      * @param AdobeIOConfigurationProvider $configurationProvider
-     * @param IOEventsAPIClient $IOEventsAPIClient
+     * @param EventMetadataClient $metadataClient
      * @param EventList $eventList
      * @param AdobeIoEventMetadataFactory $metadataFactory
      */
     public function __construct(
         AdobeIOConfigurationProvider $configurationProvider,
-        IOEventsAPIClient $IOEventsAPIClient,
+        EventMetadataClient $metadataClient,
         EventList $eventList,
         AdobeIoEventMetadataFactory $metadataFactory
     ) {
         $this->configurationProvider = $configurationProvider;
-        $this->IOEventsAPIClient = $IOEventsAPIClient;
+        $this->metadataClient = $metadataClient;
         $this->eventList = $eventList;
         $this->ioMetadataFactory = $metadataFactory;
     }
@@ -60,7 +62,8 @@
     /**
      * Register events metadata in Adobe I/O.
      *
-     * @returns array list of messages
+     * @return array
+     * @throws EventInitializationException
      * @throws SynchronizerException
      */
     public function run(): array
@@ -70,8 +73,8 @@
             return [];
         }

-        $provider = $this->configurationProvider->retrieveProvider();
-        if (is_null($provider)) {
+        $provider = $this->configurationProvider->getProvider();
+        if ($provider === null) {
             throw new SynchronizerException(__(
                 sprintf(
                     'Cannot register events metadata during setup:upgrade. ' .
@@ -82,12 +85,12 @@
         }

         try {
-            $registeredEventMetadata = $this->IOEventsAPIClient->listRegisteredEventMetadata($provider);
+            $registeredEventMetadata = $this->metadataClient->listRegisteredEventMetadata($provider);
             $registeredEvents = [];
             foreach ($registeredEventMetadata as $eventMetadata) {
                 $registeredEvents[] = $eventMetadata->getEventCode();
             }
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             throw new SynchronizerException(__(
                 sprintf(
                     'Cannot register events metadata during setup:upgrade. ' .
@@ -101,13 +104,13 @@
             $messages = [];

             foreach ($events as $event) {
-                $eventCode = EventSubscriber::EVENT_PREFIX_COMMERCE . $event->getName();
+                $eventCode = EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $event->getName();

                 if (in_array($eventCode, $registeredEvents)) {
                     continue;
                 }

-                $this->IOEventsAPIClient->createEventMetadata(
+                $this->metadataClient->createEventMetadata(
                     $provider,
                     $this->ioMetadataFactory->generate($eventCode)
                 );
@@ -118,7 +121,7 @@
             }

             return $messages;
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             throw new SynchronizerException(__(
                 sprintf(
                     'An error occurred while registering metadata for event %s. Error: %s',
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/CompositeEventValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/CompositeEventValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/CompositeEventValidator.php	2023-05-30 09:55:07.580891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/CompositeEventValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -19,6 +19,9 @@
      */
     private array $validators;

+    /**
+     * @param array $validators
+     */
     public function __construct(array $validators)
     {
         $this->validators = $validators;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/EventCodeSupportedValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/EventCodeSupportedValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/EventCodeSupportedValidator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/EventCodeSupportedValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,7 +9,7 @@

 use Magento\AdobeCommerceEventsClient\Event\Collector\AggregatedEventList;
 use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

@@ -33,8 +33,12 @@

     /**
      * Validates that event code exists in the list of supported events.
+     *
      * Only applies for the plugin-type events.
      *
+     * @param Event $event
+     * @param bool $force
+     *
      * {@inheritDoc}
      */
     public function validate(Event $event, bool $force = false): void
@@ -42,11 +46,11 @@
         $eventCode = $event->getParent() ?? $event->getName();
         $events = $this->aggregatedEventList->getList();

-        $eventCode = str_replace(EventSubscriber::EVENT_PREFIX_COMMERCE, '', $eventCode);
+        $eventCode = str_replace(EventSubscriberInterface::EVENT_PREFIX_COMMERCE, '', $eventCode);

         $eventCodeParts = explode('.', $eventCode, 2);

-        if ($eventCodeParts[0] !== EventSubscriber::EVENT_TYPE_PLUGIN) {
+        if ($eventCodeParts[0] !== EventSubscriberInterface::EVENT_TYPE_PLUGIN) {
             return;
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/PrefixValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/PrefixValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/PrefixValidator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/PrefixValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,7 +8,7 @@
 namespace Magento\AdobeCommerceEventsClient\Event\Validator\EventCode;

 use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

@@ -43,18 +43,18 @@
                 __(
                     'Event code must consist of a type label and an event code separated by a dot: '
                     . '"<type>.<event_code>". Valid types: %1',
-                    implode(', ', EventSubscriber::EVENT_TYPES)
+                    implode(', ', EventSubscriberInterface::EVENT_TYPES)
                 )
             );
         }

         $prefix = $eventCodeParts[0];
-        if (!in_array($prefix, EventSubscriber::EVENT_TYPES)) {
+        if (!in_array($prefix, EventSubscriberInterface::EVENT_TYPES)) {
             throw new ValidatorException(
                 __(
                     'Invalid event type "%1". Valid types: %2',
                     $prefix,
-                    implode(', ', EventSubscriber::EVENT_TYPES)
+                    implode(', ', EventSubscriberInterface::EVENT_TYPES)
                 )
             );
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/SubscribeValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/SubscribeValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/SubscribeValidator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/SubscribeValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,8 +9,9 @@

 use Magento\AdobeCommerceEventsClient\Event\Collector\AggregatedEventList;
 use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventInitializationException;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

@@ -31,6 +32,7 @@
     private EventList $eventList;

     /**
+     * @param AggregatedEventList $aggregatedEventList
      * @param EventList $eventList
      */
     public function __construct(AggregatedEventList $aggregatedEventList, EventList $eventList)
@@ -41,6 +43,11 @@

     /**
      * @inheritDoc
+     *
+     * @param Event $event
+     * @param bool $force
+     * @throws EventInitializationException
+     * @throws ValidatorException
      */
     public function validate(Event $event, bool $force = false): void
     {
@@ -57,7 +64,7 @@
         $eventCode = $event->getParent() ?? $event->getName();
         $eventCodeParts = explode('.', $eventCode, 2);

-        if ($eventCodeParts[0] !== EventSubscriber::EVENT_TYPE_PLUGIN) {
+        if ($eventCodeParts[0] !== EventSubscriberInterface::EVENT_TYPE_PLUGIN) {
             return;
         }

@@ -70,7 +77,7 @@
                     __('Event is already subscribed "%1" ', $eventCode)
                 );
             }
-        } else if (!$force) {
+        } elseif (!$force) {
             throw new ValidatorException(
                 __(
                     'Could not register event "%1" because the required ' .
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/UnsubscribeValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/UnsubscribeValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/UnsubscribeValidator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventCode/UnsubscribeValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,11 +8,14 @@
 namespace Magento\AdobeCommerceEventsClient\Event\Validator\EventCode;

 use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventInitializationException;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use Magento\Framework\App\DeploymentConfig;
+use Magento\Framework\Exception\FileSystemException;
+use Magento\Framework\Exception\RuntimeException;

 /**
  * Validates that event can be unsubscribed.
@@ -42,21 +45,31 @@
     }

     /**
+     * Validates that event can be unsubscribed.
+     *
      * It's possible to unsubscribe only from events that are registered in `io_events`
      * section in the app/etc/config.php file.
      *
+     * @param Event $event
+     * @param bool $force
+     *
      * {@inheritDoc}
+     *
+     * @throws EventInitializationException
+     * @throws ValidatorException
+     * @throws FileSystemException
+     * @throws RuntimeException
      */
     public function validate(Event $event, bool $force = false): void
     {
-        $optionalIoEvents = $this->config->get(EventSubscriber::IO_EVENTS_CONFIG_NAME);
+        $optionalIoEvents = $this->config->get(EventSubscriberInterface::IO_EVENTS_CONFIG_NAME);

         $eventCode = $event->getName();
         if (!isset($optionalIoEvents[$eventCode])) {
             throw new ValidatorException(__(
                 'Cannot unsubscribe "%1" because it is not registered in the "%2" section of the config.php file.',
                 $eventCode,
-                EventSubscriber::IO_EVENTS_CONFIG_NAME
+                EventSubscriberInterface::IO_EVENTS_CONFIG_NAME
             ));
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventValidatorInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventValidatorInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventValidatorInterface.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/EventValidatorInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,11 +10,13 @@
 use Magento\AdobeCommerceEventsClient\Event\Event;

 /**
- * Validator interface for event code
+ * Interface for event validators.
  */
 interface EventValidatorInterface
 {
     /**
+     * Validates event.
+     *
      * @param Event $event
      * @param bool $force
      * @return void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/Rule/EventRuleValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/Rule/EventRuleValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/Rule/EventRuleValidator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/Rule/EventRuleValidator.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,7 +9,7 @@

 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorFactory;
-use Magento\AdobeCommerceEventsClient\Event\Rule\Rule;
+use Magento\AdobeCommerceEventsClient\Event\Rule\RuleInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;

@@ -23,7 +23,6 @@
      */
     private OperatorFactory $operatorFactory;

-
     /**
      * @param OperatorFactory $operatorFactory
      */
@@ -35,16 +34,20 @@
     /**
      * Validates that all rules for an input event are defined using valid operator names.
      *
-     * {@inheritDoc}
+     * @param Event $event
+     * @param bool $force
+     * @return void
+     * @throws ValidatorException
+     * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
     public function validate(Event $event, bool $force = false): void
     {
         $validOperators = $this->operatorFactory->getOperatorNames();

         foreach ($event->getRules() as $rule) {
-            if (!in_array($rule[Rule::RULE_OPERATOR], $validOperators)) {
+            if (!in_array($rule[RuleInterface::RULE_OPERATOR], $validOperators)) {
                 throw new ValidatorException(
-                    __('"%1" is an invalid event rule operator name', $rule[Rule::RULE_OPERATOR])
+                    __('"%1" is an invalid event rule operator name', $rule[RuleInterface::RULE_OPERATOR])
                 );
             }
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/ValidatorException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/ValidatorException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Event/Validator/ValidatorException.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Event/Validator/ValidatorException.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,9 +7,14 @@

 namespace Magento\AdobeCommerceEventsClient\Event\Validator;

+use Magento\Framework\Exception\LocalizedException;
+
 /**
  * Exception thrown due to events validation errors
+ *
+ * @api
+ * @since 1.1.0
  */
-class ValidatorException extends \Magento\Framework\Exception\LocalizedException
+class ValidatorException extends LocalizedException
 {
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/EventException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/EventException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/EventException.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/EventException.php	2023-05-25 20:23:12.000000000 +0100
@@ -11,6 +11,9 @@

 /**
  * Exception thrown during operation with events.
+ *
+ * @api
+ * @since 1.1.0
  */
 class EventException extends LocalizedException
 {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/Event.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/Event.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/Event.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/Event.php	2023-05-25 20:23:12.000000000 +0100
@@ -26,7 +26,7 @@
     protected $_cacheTag = self::CACHE_TAG;

     /**
-     * @return void
+     * @inheritDoc
      */
     protected function _construct()
     {
@@ -34,7 +34,7 @@
     }

     /**
-     * @return array|string[]
+     * @inheritDoc
      */
     public function getIdentities(): array
     {
@@ -154,4 +154,40 @@

         return $this;
     }
+
+    /**
+     * @inheritDoc
+     */
+    public function getInfo(): string
+    {
+        return $this->getData(self::FIELD_INFO);
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function setInfo(string $info): EventInterface
+    {
+        $this->setData(self::FIELD_INFO, $info);
+
+        return $this;
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getPriority(): int
+    {
+        return (int)$this->getData(self::FIELD_PRIORITY);
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function setPriority(int $priority): EventInterface
+    {
+        $this->setData(self::FIELD_PRIORITY, $priority);
+
+        return $this;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/ResourceModel/Event.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/ResourceModel/Event.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Model/ResourceModel/Event.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Model/ResourceModel/Event.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Model\ResourceModel;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\Framework\Model\ResourceModel\Db\AbstractDb;

@@ -15,6 +16,9 @@
  */
 class Event extends AbstractDb
 {
+    /**
+     * @inheritDoc
+     */
     protected function _construct()
     {
         $this->_init('event_data', EventInterface::FIELD_ID);
@@ -25,7 +29,7 @@
      *
      * @param array $where
      * @return void
-     * @throws \Exception
+     * @throws Exception
      */
     public function deleteConditionally(array $where): void
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Setup/RecurringData.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Setup/RecurringData.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Setup/RecurringData.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Setup/RecurringData.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Setup;

+use Magento\AdobeCommerceEventsClient\Event\EventInitializationException;
 use Magento\AdobeCommerceEventsClient\Event\Synchronizer\AdobeIoEventMetadataSynchronizer;
 use Magento\AdobeCommerceEventsClient\Event\Synchronizer\SynchronizerException;
 use Magento\Framework\Setup\InstallDataInterface;
@@ -28,7 +29,7 @@
      * @var LoggerInterface
      */
     private LoggerInterface $logger;
-
+
     /**
      * @param AdobeIoEventMetadataSynchronizer $eventMetadataSynchronizer
      * @param LoggerInterface $logger
@@ -45,7 +46,8 @@
      * Register events metadata in Adobe I/O.
      *
      * @param ModuleDataSetupInterface $setup
-     * @param ModuleContextInterface   $context
+     * @param ModuleContextInterface $context
+     * @throws EventInitializationException
      * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
     public function install(ModuleDataSetupInterface $setup, ModuleContextInterface $context)
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/static/phpstan.neon /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/static/phpstan.neon
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/static/phpstan.neon	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/static/phpstan.neon	2023-05-25 20:23:12.000000000 +0100
@@ -13,3 +13,5 @@
         - '#Call to method .*? on an unknown class .*?Factory.#'
         - message: "#Parameter .* of method .*#"
           path: ../../Model/EventRepository.php
+        - message: '#Parameter .*? \$excludedMethods of class.*#'
+          path: ../Unit/Event/Collector/MethodFilterTest.php
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/static/ruleset/phpcs.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/static/ruleset/phpcs.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/static/ruleset/phpcs.xml	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/static/ruleset/phpcs.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,27 +0,0 @@
-<?xml version="1.0"?>
-<!--
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
--->
-<ruleset name="Magento">
-    <rule ref="PSR2"/>
-
-    <rule ref="Generic.Functions.CallTimePassByReference"/>
-    <rule ref="Generic.PHP.DeprecatedFunctions"/>
-    <rule ref="Generic.Files.LineLength">
-        <properties>
-            <property name="lineLimit" value="120"/>
-            <property name="absoluteLineLimit" value="120"/>
-        </properties>
-    </rule>
-
-    <rule ref="Squiz.Commenting.DocCommentAlignment"/>
-    <rule ref="Squiz.Functions.GlobalFunction"/>
-    <rule ref="Squiz.WhiteSpace.LogicalOperatorSpacing"/>
-    <rule ref="Squiz.Commenting.VariableComment" />
-    <rule ref="Squiz.Commenting.ClassComment">
-        <exclude-pattern>Test</exclude-pattern>
-    </rule>
-</ruleset>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/AbstractCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/AbstractCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/AbstractCollectorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/AbstractCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,6 +9,8 @@

 use PHPUnit\Framework\MockObject\MockObject;
 use PHPUnit\Framework\TestCase;
+use SplFileInfo;
+use stdClass;

 /**
  * Abstract class to store reusable methods
@@ -24,7 +26,7 @@
      */
     protected function createFileInfoMock(string $extension = 'php', bool $isDir = false): MockObject
     {
-        $fileMockOne = $this->createMock(\SplFileInfo::class);
+        $fileMockOne = $this->createMock(SplFileInfo::class);
         $fileMockOne->expects(self::once())
             ->method('isDir')
             ->willReturn($isDir);
@@ -44,7 +46,7 @@
      */
     protected function mockIterator(MockObject $iteratorMock, array $items): MockObject
     {
-        $iteratorData = new \stdClass();
+        $iteratorData = new stdClass();
         $iteratorData->array = $items;
         $iteratorData->position = 0;

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ApiServiceCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ApiServiceCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ApiServiceCollectorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ApiServiceCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Collector;

+use DirectoryIterator;
 use Magento\AdobeCommerceEventsClient\Event\Collector\ApiServiceCollector;
 use Magento\AdobeCommerceEventsClient\Event\Collector\EventMethodCollector;
 use Magento\AdobeCommerceEventsClient\Event\Collector\NameFetcher;
@@ -14,6 +15,7 @@
 use Magento\Framework\App\Utility\ReflectionClassFactory;
 use Magento\Framework\Filesystem\DriverInterface;
 use PHPUnit\Framework\MockObject\MockObject;
+use ReflectionClass;

 /**
  * Tests for the ApiServiceCollector class.
@@ -95,7 +97,7 @@
             ->method('isDirectory')
             ->with('/realpath/to/dir')
             ->willReturn(true);
-        $directoryIteratorMock = $this->createMock(\DirectoryIterator::class);
+        $directoryIteratorMock = $this->createMock(DirectoryIterator::class);
         $this->fileOperatorMock->expects(self::once())
             ->method('getDirectoryIterator')
             ->willReturn($this->mockIterator($directoryIteratorMock, [$fileMockOne, $fileMockTwo]));
@@ -103,7 +105,7 @@
             ->method('getNameFromFile')
             ->with($fileMockOne)
             ->willReturn('Class\Name');
-        $reflectionClassMock = $this->createMock(\ReflectionClass::class);
+        $reflectionClassMock = $this->createMock(ReflectionClass::class);
         $this->reflectionClassFactoryMock->expects(self::once())
             ->method('create')
             ->with('Class\Name')
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/EventMethodCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/EventMethodCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/EventMethodCollectorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/EventMethodCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -14,6 +14,8 @@
 use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
 use PHPUnit\Framework\TestCase;
 use PHPUnit\Framework\MockObject\MockObject;
+use ReflectionClass;
+use ReflectionMethod;

 /**
  * Tests for EventMethodCollector class
@@ -60,7 +62,7 @@
      */
     public function testCollect(): void
     {
-        $reflectionClassMock = $this->createMock(\ReflectionClass::class);
+        $reflectionClassMock = $this->createMock(ReflectionClass::class);
         $reflectionClassMock->expects(self::once())
             ->method('getName')
             ->willReturn('Some\Class\Name');
@@ -127,7 +129,7 @@
      */
     private function createReflectionMethodMock(string $name): MockObject
     {
-        $reflectionMethodMock = $this->createMock(\ReflectionMethod::class);
+        $reflectionMethodMock = $this->createMock(ReflectionMethod::class);
         $reflectionMethodMock->expects(self::once())
             ->method('getName')
             ->willReturn($name);
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/MethodFilterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/MethodFilterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/MethodFilterTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/MethodFilterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,19 +8,23 @@
 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Collector;

 use Magento\AdobeCommerceEventsClient\Event\Collector\MethodFilter;
+use Magento\Framework\Exception\InvalidArgumentException;
 use PHPUnit\Framework\TestCase;

 /**
- * Tests for the MethodFilter Class
+ * Tests for the @see MethodFilter Class
  */
 class MethodFilterTest extends TestCase
 {
+    /**
+     * @throws InvalidArgumentException
+     */
     public function testIsExclude(): void
     {
         $methodFilter = new MethodFilter([
             'method1',
             'method2',
-            '/^get.*/'
+            '/^get.*/',
         ]);

         self::assertTrue($methodFilter->isExcluded('method1'));
@@ -30,4 +34,14 @@
         self::assertFalse($methodFilter->isExcluded('method'));
         self::assertFalse($methodFilter->isExcluded('method3'));
     }
+
+    public function testIsExcludeWrongExcludeMethods(): void
+    {
+        self::expectException(InvalidArgumentException::class);
+        $methodFilter = new MethodFilter([
+            ['wrong_type_of_method_parameter']
+        ]);
+
+        self::assertTrue($methodFilter->isExcluded('method1'));
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/DispatchMethodCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/DispatchMethodCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/DispatchMethodCollectorTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/DispatchMethodCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,66 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Collector\ObserverEventsCollector;
+
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventDataFactory;
+use Magento\AdobeCommerceEventsClient\Event\Collector\NameFetcher;
+use Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector\DispatchMethodCollector;
+use Magento\Framework\Exception\LocalizedException;
+use PHPUnit\Framework\TestCase;
+use PHPUnit\Framework\MockObject\MockObject;
+use SplFileInfo;
+
+/**
+ * Tests for the @see DispatchMethodCollector Class
+ */
+class DispatchMethodCollectorTest extends TestCase
+{
+    /**
+     * @var NameFetcher|MockObject
+     */
+    private $nameFetcherMock;
+
+    /**
+     * @var EventDataFactory|MockObject
+     */
+    private $eventDataFactoryMock;
+
+    /**
+     * @var DispatchMethodCollector
+     */
+    private DispatchMethodCollector $dispatchMethodCollector;
+
+    protected function setUp(): void
+    {
+        $this->nameFetcherMock = $this->createMock(NameFetcher::class);
+        $this->eventDataFactoryMock = $this->createMock(EventDataFactory::class);
+
+        $this->dispatchMethodCollector = new DispatchMethodCollector(
+            $this->nameFetcherMock,
+            $this->eventDataFactoryMock
+        );
+    }
+
+    /**
+     * @throws LocalizedException
+     */
+    public function testEventFetcher(): void
+    {
+        $fileContent = file_get_contents(__DIR__ . '/_files/sample_code_method_dispatch.php');
+
+        $events = $this->dispatchMethodCollector->fetchEvents($this->createMock(SplFileInfo::class), $fileContent);
+
+        self::assertEquals(4, count($events));
+        self::assertArrayNotHasKey('event_single_quotes_dynamic_', $events);
+        self::assertArrayNotHasKey('event_single_quotes_dynamic_multiple_lines_', $events);
+        self::assertArrayHasKey('observer.event_single_quotes', $events);
+        self::assertArrayHasKey('observer.event_double_quotes', $events);
+        self::assertArrayHasKey('observer.event_single_quotes_multiple_lines', $events);
+        self::assertArrayHasKey('observer.event_double_quotes_multiple_lines', $events);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/EventPrefixesCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/EventPrefixesCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/EventPrefixesCollectorTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/EventPrefixesCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,119 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Collector\ObserverEventsCollector;
+
+use ReflectionClass;
+use Magento\AdobeCommerceEventsClient\Event\Collector\EventDataFactory;
+use Magento\AdobeCommerceEventsClient\Event\Collector\NameFetcher;
+use Magento\AdobeCommerceEventsClient\Event\Collector\ObserverEventsCollector\EventPrefixesCollector;
+use Magento\Framework\App\Utility\ReflectionClassFactory;
+use PHPUnit\Framework\TestCase;
+use PHPUnit\Framework\MockObject\MockObject;
+use SplFileInfo;
+use Exception;
+
+/**
+ * Tests for the @see EventPrefixesCollector Class
+ */
+class EventPrefixesCollectorTest extends TestCase
+{
+    /**
+     * @var EventDataFactory|MockObject
+     */
+    private $eventDataFactoryMock;
+
+    /**
+     * @var ReflectionClassFactory|MockObject
+     */
+    private $reflectionClassFactoryMock;
+
+    /**
+     * @var EventPrefixesCollector
+     */
+    private EventPrefixesCollector $eventPrefixesCollector;
+
+    protected function setUp(): void
+    {
+        $this->eventDataFactoryMock = $this->createMock(EventDataFactory::class);
+        $this->reflectionClassFactoryMock = $this->createMock(ReflectionClassFactory::class);
+
+        $this->eventPrefixesCollector = new EventPrefixesCollector(
+            new NameFetcher(),
+            $this->eventDataFactoryMock,
+            $this->reflectionClassFactoryMock
+        );
+    }
+
+    /**
+     * @dataProvider eventFetcherDataProvider
+     * @throws Exception
+     */
+    public function testEventFetcher(string $filename, string $className): void
+    {
+        $fileContent = file_get_contents(__DIR__ . '/_files/' . $filename);
+
+        $refClassMock = $this->createMock(ReflectionClass::class);
+        $refClassMock->expects(self::once())
+            ->method('isSubclassOf')
+            ->willReturn(true);
+        $this->reflectionClassFactoryMock->expects(self::once())
+            ->method('create')
+            ->with($className)
+            ->willReturn($refClassMock);
+        $this->eventDataFactoryMock->expects(self::exactly(4))
+            ->method('create');
+
+        $events = $this->eventPrefixesCollector->fetchEvents($this->createMock(SplFileInfo::class), $fileContent);
+
+        self::assertEquals(4, count($events));
+        self::assertArrayHasKey('observer.sample_class_save_commit_after', $events);
+        self::assertArrayHasKey('observer.sample_class_save_after', $events);
+        self::assertArrayHasKey('observer.sample_class_delete_after', $events);
+        self::assertArrayHasKey('observer.sample_class_delete_commit_after', $events);
+    }
+
+    /**
+     * @return array
+     */
+    public function eventFetcherDataProvider(): array
+    {
+        return [
+            [
+                'sample_code_event_prefixes.php',
+                'Magento\Framework\Module\SampleClass'
+            ],
+            [
+                'sample_code_event_prefixes_double_quotes.php',
+                'Magento\Framework\Module\SampleClassDoubleQuotes'
+            ],
+        ];
+    }
+
+    /**
+     * @throws Exception
+     */
+    public function testEventFetcherNotSubclassOfAbstractModel(): void
+    {
+        $fileContent = file_get_contents(__DIR__ . '/_files/sample_code_event_prefixes.php');
+
+        $refClassMock = $this->createMock(ReflectionClass::class);
+        $refClassMock->expects(self::once())
+            ->method('isSubclassOf')
+            ->willReturn(false);
+        $this->reflectionClassFactoryMock->expects(self::once())
+            ->method('create')
+            ->with('Magento\Framework\Module\SampleClass')
+            ->willReturn($refClassMock);
+        $this->eventDataFactoryMock->expects(self::never())
+            ->method('create');
+
+        $events = $this->eventPrefixesCollector->fetchEvents($this->createMock(SplFileInfo::class), $fileContent);
+
+        self::assertEquals(0, count($events));
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes_double_quotes.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes_double_quotes.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes_double_quotes.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes_double_quotes.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,18 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\Framework\Module;
+
+use Magento\Framework\Model\AbstractModel;
+
+class SampleClassDoubleQuotes extends AbstractModel
+{
+    /**
+     * @var string
+     */
+    protected $_eventPrefix = "sample_class";
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_event_prefixes.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,18 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\Framework\Module;
+
+use Magento\Framework\Model\AbstractModel;
+
+class SampleClass extends AbstractModel
+{
+    /**
+     * @var string
+     */
+    protected $_eventPrefix = 'sample_class';
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_method_dispatch.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_method_dispatch.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_method_dispatch.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ObserverEventsCollector/_files/sample_code_method_dispatch.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,68 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\Framework\Module;
+
+use Magento\Framework\Event\ManagerInterface;
+
+/**
+ * Custom class with different
+ */
+class CustomClass
+{
+    /** @var ManagerInterface  */
+    private ManagerInterface $eventManager;
+
+    /**
+     * @param ManagerInterface $eventManager
+     */
+    public function __construct(ManagerInterface $eventManager)
+    {
+        $this->eventManager = $eventManager;
+    }
+
+    public function dispatchSingleQuotesSingleLine()
+    {
+        $this->eventManager->dispatch('event_single_quotes', []);
+    }
+
+    public function dispatchDoubleQuotesSingleLine()
+    {
+        $this->eventManager->dispatch("event_double_quotes", []);
+    }
+
+    public function dispatchSingleQuotesMultipleLine()
+    {
+        $this->eventManager->dispatch(
+            'event_single_quotes_multiple_lines',
+            []
+        );
+    }
+
+    public function dispatchDoubleQuotesMultipleLine()
+    {
+        $this->eventManager->dispatch(
+            "event_double_quotes_multiple_lines",
+            []
+        );
+    }
+
+    public function dispatchSingleDynamicEvent()
+    {
+        $value = 'test';
+        $this->eventManager->dispatch('event_single_quotes_dynamic_' . $value, []);
+    }
+
+    public function dispatchSingleDynamicEventMultipleLine()
+    {
+        $value = 'test';
+        $this->eventManager->dispatch(
+            'event_single_quotes_dynamic_multiple_lines_' . $value,
+            []
+        );
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ResourceModelCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ResourceModelCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ResourceModelCollectorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Collector/ResourceModelCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -15,6 +15,8 @@
 use Magento\Framework\Filesystem\DriverInterface;
 use Magento\Framework\Model\ResourceModel\AbstractResource;
 use PHPUnit\Framework\MockObject\MockObject;
+use ReflectionClass;
+use RegexIterator;

 /**
  * Tests for the ApiServiceCollector class.
@@ -96,7 +98,7 @@
             ->method('isDirectory')
             ->with('/realpath/to/dir')
             ->willReturn(true);
-        $regexIteratorMock = $this->createMock(\RegexIterator::class);
+        $regexIteratorMock = $this->createMock(RegexIterator::class);
         $this->fileOperatorMock->expects(self::once())
             ->method('getRecursiveFileIterator')
             ->willReturn($this->mockIterator($regexIteratorMock, [$fileMockOne, $fileMockTwo]));
@@ -104,7 +106,7 @@
             ->method('getNameFromFile')
             ->with($fileMockOne)
             ->willReturn('Class\Name');
-        $reflectionClassMock = $this->createMock(\ReflectionClass::class);
+        $reflectionClassMock = $this->createMock(ReflectionClass::class);
         $reflectionClassMock->expects(self::once())
             ->method('isSubclassOf')
             ->with(AbstractResource::class)
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Converter/EventDataConverterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Converter/EventDataConverterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Converter/EventDataConverterTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Converter/EventDataConverterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,6 +8,8 @@
 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Converter;

 use Magento\AdobeCommerceEventsClient\Event\Converter\EventDataConverter;
+use Magento\Framework\Data\Collection;
+use Magento\Framework\DataObject;
 use PHPUnit\Framework\TestCase;

 /**
@@ -51,6 +53,40 @@
         );
     }

+    public function testObjectWithNestedCollection()
+    {
+        $collectionMock = $this->createMock(Collection::class);
+        $collectionMock->expects(self::once())
+            ->method('toArray')
+            ->willReturn([
+                'totalRecords' => 5,
+                'items' => [
+                    'item1',
+                    'item2',
+                    'item3'
+                ]
+            ]);
+        $dataObjectMock = $this->createMock(DataObject::class);
+        $dataObjectMock->expects(self::once())
+            ->method('toArray')
+            ->willReturn([
+                'items' => $collectionMock,
+                'entity_id' => 5
+            ]);
+
+        self::assertEquals(
+            [
+                'entity_id' => 5,
+                'items' => [
+                    'item1',
+                    'item2',
+                    'item3'
+                ]
+            ],
+            $this->eventDataConverter->convert(['data_object' => $dataObjectMock])
+        );
+    }
+
     public function testOnlyObjectReturned()
     {
         $data = [
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventBatchSenderTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventBatchSenderTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventBatchSenderTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventBatchSenderTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -12,11 +12,11 @@
 use GuzzleHttp\Psr7\Response;
 use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\AdobeCommerceEventsClient\Event\Client;
-use Magento\AdobeCommerceEventsClient\Event\EventBatchGenerator;
 use Magento\AdobeCommerceEventsClient\Event\EventBatchSender;
-use Magento\AdobeCommerceEventsClient\Event\EventRetriever;
-use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter;
+use Magento\AdobeCommerceEventsClient\Event\EventRetrieverInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventStatusUpdater;
 use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\Lock\LockManagerInterface;
 use PHPUnit\Framework\TestCase;
 use Psr\Log\LoggerInterface;
 use PHPUnit\Framework\MockObject\MockObject;
@@ -42,58 +42,69 @@
     private $clientMock;

     /**
-     * @var EventBatchGenerator|MockObject
-     */
-    private $eventBatchGeneratorMock;
-
-    /**
-     * @var EventRetriever|MockObject
+     * @var EventRetrieverInterface|MockObject
      */
     private $eventRetrieverMock;

     /**
-     * @var EventStorageWriter|MockObject
+     * @var EventStatusUpdater|MockObject
      */
-    private $eventStorageWriterMock;
+    private $eventStatusUpdaterMock;

     /**
-     * @var LoggerInterface|MockObject
+     * @var LockManagerInterface|MockObject
      */
-    private $loggerMock;
+    private $lockManagerMock;

     /**
      * @var array
      */
-    private $events = [
+    private array $events = [
         '1' => ['data' => 'dataOne', 'eventCode' => 'codeOne'],
         '2' => ['data' => 'dataTwo', 'eventCode' => 'codeTwo']
     ];

     /**
-     * @var integer
+     * @var int
      */
-    private $maxRetries = 5;
+    private int $maxRetries = 5;

     protected function setUp(): void
     {
+        $this->lockManagerMock = $this->getMockForAbstractClass(LockManagerInterface::class);
         $this->scopeConfigMock = $this->getMockForAbstractClass(ScopeConfigInterface::class);
         $this->clientMock = $this->createMock(Client::class);
-        $this->eventBatchGeneratorMock = $this->createMock(EventBatchGenerator::class);
-        $this->eventRetrieverMock = $this->createMock(EventRetriever::class);
-        $this->eventStorageWriterMock = $this->createMock(EventStorageWriter::class);
-        $this->loggerMock = $this->getMockForAbstractClass(LoggerInterface::class);
+        $this->eventRetrieverMock = $this->getMockForAbstractClass(EventRetrieverInterface::class);
+        $this->eventStatusUpdaterMock = $this->createMock(EventStatusUpdater::class);
+        $loggerMock = $this->getMockForAbstractClass(LoggerInterface::class);

         $this->batchSender = new EventBatchSender(
+            $this->lockManagerMock,
             $this->scopeConfigMock,
             $this->clientMock,
-            $this->eventBatchGeneratorMock,
             $this->eventRetrieverMock,
-            $this->eventStorageWriterMock,
-            $this->loggerMock
+            $this->eventStatusUpdaterMock,
+            $loggerMock
         );
     }

     /**
+     * Tests that batch send are not running if the process is locked.
+     *
+     * @return void
+     */
+    public function testEventBatchSendingIsLocked()
+    {
+        $this->lockManagerMock->expects(self::once())
+            ->method('lock')
+            ->willReturn(false);
+        $this->eventRetrieverMock->expects(self::never())
+            ->method('getEventsWithLimit');
+
+        $this->batchSender->sendEventDataBatches();
+    }
+
+    /**
      * Tests successful sending of a batch of event data.
      *
      * @return void
@@ -101,14 +112,15 @@
     public function testSendEventDataBatchSuccess()
     {
         $eventIds = [1, 2];
+        $this->lockManagerMock->expects(self::once())
+            ->method('lock')
+            ->willReturn(true);
+        $this->eventRetrieverMock->expects(self::never())
+            ->method('getEvents');
         $this->eventRetrieverMock->expects(self::once())
-            ->method('getWaitingEvents')
+            ->method('getEventsWithLimit')
             ->willReturn($this->events);
-        $this->eventBatchGeneratorMock->expects(self::once())
-            ->method('generateBatch')
-            ->with($this->events)
-            ->willReturn($this->events);
-        $this->eventStorageWriterMock->expects(self::exactly(2))
+        $this->eventStatusUpdaterMock->expects(self::exactly(2))
             ->method('updateStatus')
             ->withConsecutive([$eventIds, EventInterface::SENDING_STATUS], [$eventIds, EventInterface::SUCCESS_STATUS]);
         $this->scopeConfigMock->expects(self::never())
@@ -117,41 +129,39 @@
             ->method('sendEventDataBatch')
             ->with(array_values($this->events))
             ->willReturn(new Response(200));
-        $this->eventStorageWriterMock->expects(self::never())
+        $this->eventStatusUpdaterMock->expects(self::never())
             ->method('updateFailure');

         $this->batchSender->sendEventDataBatches();
     }

     /**
-     * Tests failed sending of a batch of event data that leads to resending of only some of the events.
+     * Tests failed sending of a batch of event data.
      *
      * @return void
      */
     public function testSendEventDataBatchFailure()
     {
         $eventIds = [1, 2];
+        $this->lockManagerMock->expects(self::once())
+            ->method('lock')
+            ->willReturn(true);
         $this->eventRetrieverMock->expects(self::once())
-            ->method('getWaitingEvents')
+            ->method('getEventsWithLimit')
             ->willReturn($this->events);
-        $this->eventBatchGeneratorMock->expects(self::exactly(2))
-            ->method('generateBatch')
-            ->withConsecutive([$this->events], [[1 => $this->events[1]]])
-            ->willReturnOnConsecutiveCalls($this->events, [1 => $this->events[1]]);
-        $this->eventStorageWriterMock->expects(self::exactly(2))
+        $this->eventStatusUpdaterMock->expects(self::once())
             ->method('updateStatus')
-            ->withConsecutive([$eventIds, EventInterface::SENDING_STATUS], [[1], EventInterface::SENDING_STATUS]);
-        $this->scopeConfigMock->expects(self::exactly(2))
+            ->with($eventIds, EventInterface::SENDING_STATUS);
+        $this->scopeConfigMock->expects(self::once())
             ->method('getValue')
             ->willReturn($this->maxRetries);
-        $this->clientMock->expects(self::exactly(2))
+        $this->clientMock->expects(self::once())
             ->method('sendEventDataBatch')
-            ->withConsecutive([array_values($this->events)], [[0 => $this->events[1]]])
+            ->with(array_values($this->events))
             ->willReturn(new Response(400, [], '{"message": "msg"}'));
-        $this->eventStorageWriterMock->expects(self::exactly(2))
+        $this->eventStatusUpdaterMock->expects(self::once())
             ->method('updateFailure')
-            ->withConsecutive([$eventIds, $this->maxRetries], [[1], $this->maxRetries])
-            ->willReturnOnConsecutiveCalls([2], [1]);
+            ->with($eventIds, $this->maxRetries);

         $this->batchSender->sendEventDataBatches();
     }
@@ -164,14 +174,13 @@
     public function testSendEventDataBatchConnectionFailure()
     {
         $eventIds = [1, 2];
+        $this->lockManagerMock->expects(self::once())
+            ->method('lock')
+            ->willReturn(true);
         $this->eventRetrieverMock->expects(self::once())
-            ->method('getWaitingEvents')
-            ->willReturn($this->events);
-        $this->eventBatchGeneratorMock->expects(self::once())
-            ->method('generateBatch')
-            ->with($this->events)
+            ->method('getEventsWithLimit')
             ->willReturn($this->events);
-        $this->eventStorageWriterMock->expects(self::once())
+        $this->eventStatusUpdaterMock->expects(self::once())
             ->method('updateStatus')
             ->with($eventIds, EventInterface::SENDING_STATUS);
         $this->scopeConfigMock->expects(self::once())
@@ -179,11 +188,10 @@
             ->willReturn($this->maxRetries);
         $this->clientMock->expects(self::once())
             ->method('sendEventDataBatch')
-            ->willThrowException(new ConnectException("", new Request("POST", "")));
-        $this->eventStorageWriterMock->expects(self::once())
+            ->willThrowException(new ConnectException("some error", new Request("POST", "")));
+        $this->eventStatusUpdaterMock->expects(self::once())
             ->method('updateFailure')
-            ->with($eventIds, $this->maxRetries)
-            ->willReturn([1, 2]);
+            ->with($eventIds, $this->maxRetries, "Event publishing failed: some error");

         $this->batchSender->sendEventDataBatches();
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfo/EventInfoReflectionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfo/EventInfoReflectionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfo/EventInfoReflectionTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfo/EventInfoReflectionTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,102 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\EventInfo;
+
+use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventInfo\EventInfoReflection;
+use Magento\AdobeCommerceEventsClient\Util\ClassToArrayConverter;
+use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
+use Magento\AdobeCommerceEventsClient\Util\ReflectionHelper;
+use PHPUnit\Framework\MockObject\MockObject;
+use PHPUnit\Framework\TestCase;
+use ReflectionException;
+
+class EventInfoReflectionTest extends TestCase
+{
+    /**
+     * @var Event|MockObject
+     */
+    private $eventMock;
+
+    /**
+     * @var ReflectionHelper|MockObject
+     */
+    private $reflectionHelperMock;
+
+    /**
+     * @var ClassToArrayConverter|MockObject
+     */
+    private $classToArrayConverterMock;
+
+    /**
+     * @var EventInfoReflection
+     */
+    private EventInfoReflection $eventInfoReflection;
+
+    protected function setUp(): void
+    {
+        $this->eventMock = $this->createMock(Event::class);
+        $this->reflectionHelperMock = $this->createMock(ReflectionHelper::class);
+        $this->classToArrayConverterMock = $this->createMock(ClassToArrayConverter::class);
+
+        $this->eventInfoReflection = new EventInfoReflection(
+            $this->reflectionHelperMock,
+            $this->classToArrayConverterMock,
+            new EventCodeConverter()
+        );
+    }
+
+    public function testObserverEventInfo(): void
+    {
+        $eventClassEmitter = 'Path\To\Some\Class';
+        $this->classToArrayConverterMock->expects(self::once())
+            ->method('convert')
+            ->with($eventClassEmitter)
+            ->willReturn(['id' => 1]);
+
+        self::assertEquals(
+            ['id' => 1],
+            $this->eventInfoReflection->getInfoForObserverEvent($eventClassEmitter)
+        );
+    }
+
+    public function testPluginEventInfoNotFound(): void
+    {
+        $this->eventMock->expects(self::any())
+            ->method('getName')
+            ->willReturn('magento.catalog.model.resource_model.categor.save');
+        $this->expectException(ReflectionException::class);
+
+        $this->eventInfoReflection->getPayloadInfo($this->eventMock);
+    }
+
+    public function testPayloadInfo(): void
+    {
+        $this->eventMock->expects(self::any())
+            ->method('getName')
+            ->willReturn('plugin.magento.adobe_commerce_events_client.api.event_repository.save');
+        $returnType = 'Magento\AdobeCommerceEventsClient\Api\Data\EventInterface';
+        $this->reflectionHelperMock->expects(self::once())
+            ->method('getReturnType')
+            ->willReturn($returnType);
+        $this->classToArrayConverterMock->expects(self::once())
+            ->method('convert')
+            ->with($returnType, 3)
+            ->willReturn([
+                'id' => '1',
+                'event_data' => 'test',
+                'event_code' => 'test',
+            ]);
+
+        $info = $this->eventInfoReflection->getPayloadInfo($this->eventMock, 3);
+
+        self::assertArrayHasKey('id', $info);
+        self::assertArrayHasKey('event_data', $info);
+        self::assertArrayHasKey('event_code', $info);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfoTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfoTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfoTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventInfoTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,14 +10,11 @@
 use Magento\AdobeCommerceEventsClient\Event\Collector\AggregatedEventList;
 use Magento\AdobeCommerceEventsClient\Event\Collector\EventData;
 use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventFactory;
 use Magento\AdobeCommerceEventsClient\Event\EventInfo;
+use Magento\AdobeCommerceEventsClient\Event\EventInfo\EventInfoReflection;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use Magento\AdobeCommerceEventsClient\Model\EventException;
-use Magento\AdobeCommerceEventsClient\Util\ClassToArrayConverter;
-use Magento\AdobeCommerceEventsClient\Util\EventCodeConverter;
-use Magento\AdobeCommerceEventsClient\Util\ReflectionHelper;
 use PHPUnit\Framework\MockObject\MockObject;
 use PHPUnit\Framework\TestCase;
 use Psr\Log\LoggerInterface;
@@ -48,15 +45,11 @@
     private $aggregatedEventList;

     /**
-     * @var ReflectionHelper|MockObject
+     * @var EventInfoReflection|MockObject
      */
-    private $reflectionHelperMock;
+    private $infoReflectionMock;

     /**
-     * @var ClassToArrayConverter|MockObject
-     */
-    private $classToArrayConverterMock;
-    /**
      * @var LoggerInterface|MockObject
      */
     private $loggerMock;
@@ -66,16 +59,13 @@
         $this->eventMock = $this->createMock(Event::class);
         $this->eventCodeValidatorMock = $this->getMockForAbstractClass(EventValidatorInterface::class);
         $this->aggregatedEventList = $this->createMock(AggregatedEventList::class);
-        $this->reflectionHelperMock = $this->createMock(ReflectionHelper::class);
-        $this->classToArrayConverterMock = $this->createMock(ClassToArrayConverter::class);
         $this->loggerMock = $this->getMockForAbstractClass(LoggerInterface::class);
+        $this->infoReflectionMock = $this->createMock(EventInfoReflection::class);

         $this->eventInfo = new EventInfo(
             $this->eventCodeValidatorMock,
-            new EventCodeConverter(),
+            $this->infoReflectionMock,
             $this->aggregatedEventList,
-            $this->reflectionHelperMock,
-            $this->classToArrayConverterMock,
             $this->loggerMock
         );
     }
@@ -112,20 +102,20 @@
             ->method('getName')
             ->willReturn('observer.some_event_code');
         $eventDataMock = $this->createMock(EventData::class);
+
+        $emitterClass = 'Path\To\Some\Class';
         $eventDataMock->expects(self::once())
             ->method('getEventClassEmitter')
-            ->willReturn('Path\To\Some\Class');
+            ->willReturn($emitterClass);
         $this->aggregatedEventList->expects(self::once())
             ->method('getList')
             ->willReturn([
                 'observer.some_event_code' => $eventDataMock
             ]);
-        $this->classToArrayConverterMock->expects(self::once())
-            ->method('convert')
-            ->with('Path\To\Some\Class')
+        $this->infoReflectionMock->expects(self::once())
+            ->method('getInfoForObserverEvent')
+            ->with($emitterClass, EventInfo::NESTED_LEVEL)
             ->willReturn(['id' => 1]);
-        $this->reflectionHelperMock->expects(self::never())
-            ->method('getReturnType');

         self::assertEquals(
             ['id' => 1],
@@ -133,6 +123,44 @@
         );
     }

+    public function testObserverEventInfoWithGetDataModelMethod(): void
+    {
+        $this->eventMock->expects(self::any())
+            ->method('getName')
+            ->willReturn('observer.some_event_code');
+        $eventDataMock = $this->createMock(EventData::class);
+
+        $emitterClass = 'Path\To\Some\Class';
+        $eventDataMock->expects(self::once())
+            ->method('getEventClassEmitter')
+            ->willReturn($emitterClass);
+        $this->aggregatedEventList->expects(self::once())
+            ->method('getList')
+            ->willReturn([
+                'observer.some_event_code' => $eventDataMock
+            ]);
+        $this->infoReflectionMock->expects(self::once())
+            ->method('getInfoForObserverEvent')
+            ->with($emitterClass, EventInfo::NESTED_LEVEL)
+            ->willReturn([
+                'some_field' => 1,
+                'data_model' => [
+                    'entity_id' => 1,
+                    'value' => 2,
+                    'value2' => 3
+                ]
+            ]);
+
+        self::assertEquals(
+            [
+                'entity_id' => 1,
+                'value' => 2,
+                'value2' => 3
+            ],
+            $this->eventInfo->getInfo($this->eventMock)
+        );
+    }
+
     public function testPluginEventInfoNotFound(): void
     {
         $this->eventMock->expects(self::any())
@@ -141,6 +169,11 @@
         $this->expectException(EventException::class);
         $this->expectExceptionMessage('Cannot get details for event');

+        $this->infoReflectionMock->expects(self::once())
+            ->method('getPayloadInfo')
+            ->with($this->eventMock, EventInfo::NESTED_LEVEL)
+            ->willThrowException(new \ReflectionException("Error doing reflection"));
+
         $this->loggerMock->expects(self::once())
             ->method('error');
         $this->eventInfo->getInfo($this->eventMock);
@@ -148,26 +181,51 @@

     public function testCategoryPluginEventInfo(): void
     {
+        $eventName = 'plugin.magento.adobe_commerce_events_client.api.event_repository.save';
+        $nestedLevel = 3;
         $this->eventMock->expects(self::any())
             ->method('getName')
-            ->willReturn('plugin.magento.adobe_commerce_events_client.api.event_repository.save');
-        $returnType = 'Magento\AdobeCommerceEventsClient\Api\Data\EventInterface';
-        $this->reflectionHelperMock->expects(self::once())
-            ->method('getReturnType')
-            ->willReturn($returnType);
-        $this->classToArrayConverterMock->expects(self::once())
-            ->method('convert')
-            ->with($returnType, 3)
+            ->willReturn($eventName);
+        $this->infoReflectionMock->expects(self::once())
+            ->method('getPayloadInfo')
+            ->with($this->eventMock, $nestedLevel)
             ->willReturn([
                 'id' => '1',
                 'event_data' => 'test',
-                'event_code' => 'test',
+                'event_code' => 'test'
             ]);

-        $info = $this->eventInfo->getInfo($this->eventMock, 3);
+        $info = $this->eventInfo->getInfo($this->eventMock, $nestedLevel);

         self::assertArrayHasKey('id', $info);
         self::assertArrayHasKey('event_data', $info);
         self::assertArrayHasKey('event_code', $info);
     }
+
+    public function testCategoryPluginEventInfoWithDataModel(): void
+    {
+        $eventName = 'plugin.magento.adobe_commerce_events_client.api.event_repository.save';
+        $nestedLevel = 3;
+        $this->eventMock->expects(self::any())
+            ->method('getName')
+            ->willReturn($eventName);
+        $this->infoReflectionMock->expects(self::once())
+            ->method('getPayloadInfo')
+            ->with($this->eventMock, $nestedLevel)
+            ->willReturn([
+                'some_field' => 1,
+                'data_model' => [
+                    'entity_id' => 1,
+                    'value' => 2,
+                    'value2' => 3
+                ]
+            ]);
+
+        $info = $this->eventInfo->getInfo($this->eventMock, $nestedLevel);
+
+        self::assertArrayNotHasKey('some_field', $info);
+        self::assertArrayHasKey('entity_id', $info);
+        self::assertArrayHasKey('value', $info);
+        self::assertArrayHasKey('value2', $info);
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventListTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventListTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventListTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventListTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,7 +10,7 @@
 use Magento\AdobeCommerceEventsClient\Config\Reader;
 use Magento\AdobeCommerceEventsClient\Event\EventFactory;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\Framework\App\DeploymentConfig;
 use PHPUnit\Framework\TestCase;
@@ -64,7 +64,7 @@
             ]);
         $this->deploymentConfigMock->expects(self::once())
             ->method('get')
-            ->with(EventSubscriber::IO_EVENTS_CONFIG_NAME)
+            ->with(EventSubscriberInterface::IO_EVENTS_CONFIG_NAME)
             ->willReturn(null);
         $this->eventFactoryMock->expects(self::exactly(2))
             ->method('create')
@@ -124,7 +124,7 @@
             ]);
         $this->deploymentConfigMock->expects(self::once())
             ->method('get')
-            ->with(EventSubscriber::IO_EVENTS_CONFIG_NAME)
+            ->with(EventSubscriberInterface::IO_EVENTS_CONFIG_NAME)
             ->willReturn([
                 'config_php_event1' => [
                     'fields' => ['id'],
@@ -132,7 +132,8 @@
                 ],
                 'config_php_event2' => [
                     'fields' => ['name'],
-                    'enabled' => 0
+                    'enabled' => 0,
+                    'priority' => 1
                 ],
             ]);
         $this->eventFactoryMock->expects(self::exactly(4))
@@ -146,7 +147,8 @@
                     'optional' => true,
                     'enabled' => true,
                     'fields' => ['id'],
-                    'rules' => []
+                    'rules' => [],
+                    'priority' => 0
                 ]],
                 [[
                     'name' => 'config_php_event2',
@@ -154,7 +156,8 @@
                     'optional' => true,
                     'enabled' => false,
                     'fields' => ['name'],
-                    'rules' => []
+                    'rules' => [],
+                    'priority' => 1
                 ]],
             )
             ->willReturn(
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventMetadataCollectorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventMetadataCollectorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventMetadataCollectorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventMetadataCollectorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,11 +8,9 @@
 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event;

 use Magento\AdobeCommerceEventsClient\Event\EventMetadataCollector;
-use Magento\Framework\App\ProductMetadataInterface;
-use Magento\Framework\Exception\NoSuchEntityException;
-use Magento\Framework\Module\PackageInfo;
-use Magento\Store\Api\Data\StoreInterface;
-use Magento\Store\Model\StoreManagerInterface;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataException;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataInterface;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataPool;
 use PHPUnit\Framework\MockObject\MockObject;
 use PHPUnit\Framework\TestCase;

@@ -27,115 +25,48 @@
     private EventMetadataCollector $metadataCollector;

     /**
-     * @var ProductMetadataInterface|MockObject
+     * @var EventMetadataPool|MockObject
      */
-    private $commerceMetadataMock;
-
-    /**
-     * @var PackageInfo|MockObject
-     */
-    private $packageInfoMock;
-    /**
-     * @var StoreManagerInterface|MockObject
-     */
-    private $storeManagerMock;
+    private $eventMetadataPoolMock;

     protected function setUp(): void
     {
-        $this->commerceMetadataMock = $this->getMockForAbstractClass(ProductMetadataInterface::class);
-        $this->packageInfoMock = $this->createMock(PackageInfo::class);
-        $this->storeManagerMock = $this->getMockForAbstractClass(StoreManagerInterface::class);
+        $this->eventMetadataPoolMock = $this->createMock(EventMetadataPool::class);

         $this->metadataCollector = new EventMetadataCollector(
-            $this->commerceMetadataMock,
-            $this->packageInfoMock,
-            $this->storeManagerMock
+            $this->eventMetadataPoolMock
         );
     }

     /**
-     * Test field existence, loading methods are only called once, and appropriate data transformations are applied
+     * Test loading methods are only called once, and appropriate data transformations are applied
      *
-     * @param string $productEdition
-     * @param string $expectedEdition
      * @return void
-     * @dataProvider getMetadataDataProvider
+     * @throws EventMetadataException
      */
-    public function testGetMetadata(string $productEdition, string $expectedEdition): void
+    public function testGetMetadata(): void
     {
-        $storeMock = $this->getMockForAbstractClass(StoreInterface::class);
-        $storeMock->expects(self::once())
-            ->method('getId')
-            ->willReturn(1);
-        $storeMock->expects(self::once())
-            ->method('getWebsiteId')
-            ->willReturn(1);
-        $storeMock->expects(self::once())
-            ->method('getStoreGroupId')
-            ->willReturn(1);
-        $this->packageInfoMock->expects(self::once())
-            ->method('getVersion')
-            ->with('Magento_AdobeCommerceEventsClient')
-            ->willReturn('100.0.0');
-        $this->commerceMetadataMock->expects(self::once())
-            ->method('getEdition')
-            ->willReturn($productEdition);
-        $this->commerceMetadataMock->expects(self::once())
-            ->method('getVersion')
-            ->willReturn('2.4.5');
-        $this->storeManagerMock->expects(self::once())
-            ->method('getStore')
-            ->willReturn($storeMock);
+        $metadataMockOne = $this->getMockForAbstractClass(EventMetadataInterface::class);
+        $metadataMockOne->expects(self::once())
+            ->method('get')
+            ->willReturn(['key1' => 'value1']);
+        $metadataMockTwo = $this->getMockForAbstractClass(EventMetadataInterface::class);
+        $metadataMockTwo->expects(self::once())
+            ->method('get')
+            ->willReturn(['key2' => 'value2']);
+        $this->eventMetadataPoolMock->expects(self::once())
+            ->method('getAll')
+            ->willReturn([
+                $metadataMockOne,
+                $metadataMockTwo,
+            ]);

         for ($i = 0; $i < 2; $i++) {
             $metadata = $this->metadataCollector->getMetadata();
-            $this->assertArrayHasKey('commerceEdition', $metadata);
-            $this->assertArrayHasKey('commerceVersion', $metadata);
-            $this->assertArrayHasKey('eventsClientVersion', $metadata);
-            $this->assertEquals($expectedEdition, $metadata['commerceEdition']);
-            $this->assertEquals('2.4.5', $metadata['commerceVersion']);
-            $this->assertEquals('100.0.0', $metadata['eventsClientVersion']);
-            $this->assertEquals(1, $metadata['storeId']);
-            $this->assertEquals(1, $metadata['websiteId']);
-            $this->assertEquals(1, $metadata['storeGroupId']);
+            $this->assertArrayHasKey('key1', $metadata);
+            $this->assertArrayHasKey('key2', $metadata);
+            $this->assertEquals('value1', $metadata['key1']);
+            $this->assertEquals('value2', $metadata['key2']);
         }
     }
-
-    /**
-     * @return string[][]
-     */
-    public function getMetadataDataProvider(): array
-    {
-        return [['Community', 'Open Source'], ['Enterprise', 'Adobe Commerce'], ['B2B', 'Adobe Commerce + B2B']];
-    }
-
-    /**
-     * Tests that getMetadata method returns expected data in case of exception while retrieving a store
-     *
-     * @return void
-     */
-    public function testExceptionWhileRetrievingStore()
-    {
-        $this->storeManagerMock->expects(self::once())
-            ->method('getStore')
-            ->willThrowException(new NoSuchEntityException(__('store not found')));
-        $this->packageInfoMock->expects(self::once())
-            ->method('getVersion')
-            ->with('Magento_AdobeCommerceEventsClient')
-            ->willReturn('100.0.0');
-        $this->commerceMetadataMock->expects(self::once())
-            ->method('getEdition')
-            ->willReturn('Enterprise');
-        $this->commerceMetadataMock->expects(self::once())
-            ->method('getVersion')
-            ->willReturn('2.4.5');
-
-        $metadata = $this->metadataCollector->getMetadata();
-        $this->assertEquals('Adobe Commerce', $metadata['commerceEdition']);
-        $this->assertEquals('2.4.5', $metadata['commerceVersion']);
-        $this->assertEquals('100.0.0', $metadata['eventsClientVersion']);
-        $this->assertEquals('', $metadata['storeId']);
-        $this->assertEquals('', $metadata['websiteId']);
-        $this->assertEquals('', $metadata['storeGroupId']);
-    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetriever/CollectionToArrayConverterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetriever/CollectionToArrayConverterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetriever/CollectionToArrayConverterTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetriever/CollectionToArrayConverterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,119 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\EventRetriever;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventRetriever\CollectionToArrayConverter;
+use Magento\AdobeCommerceEventsClient\Event\EventStatusUpdater;
+use Magento\AdobeCommerceEventsClient\Model\Event;
+use Magento\AdobeCommerceEventsClient\Model\EventException;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\Collection;
+use PHPUnit\Framework\MockObject\MockObject;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see CollectionToArrayConverter class
+ */
+class CollectionToArrayConverterTest extends TestCase
+{
+    /**
+     * @var CollectionToArrayConverter
+     */
+    private CollectionToArrayConverter $arrayConverter;
+
+    /**
+     * @var EventStatusUpdater|MockObject
+     */
+    private $eventStatusUpdaterMock;
+
+    /**
+     * @var Collection|MockObject
+     */
+    private $collectionMock;
+
+    protected function setUp(): void
+    {
+        $this->eventStatusUpdaterMock = $this->createMock(EventStatusUpdater::class);
+        $this->collectionMock = $this->createMock(Collection::class);
+
+        $this->arrayConverter = new CollectionToArrayConverter($this->eventStatusUpdaterMock);
+    }
+
+    /**
+     * Tests the converting of collection items to the array.
+     *
+     * @return void
+     */
+    public function testConvert()
+    {
+        $eventOneData = ['key' => 'test1'];
+        $eventCodeOne = 'code1';
+        $eventOneMetadata = [
+            'commerceEdition' => 'Adobe Commerce',
+            'commerceVersion' => '2.4.5',
+            'eventsClientVersion' => '100.0.0'
+        ];
+        $eventOne = $this->createMock(Event::class);
+        $eventOne->expects(self::once())
+            ->method('getId')
+            ->willReturn('1');
+        $eventOne->expects(self::once())
+            ->method('getEventData')
+            ->willReturn($eventOneData);
+        $eventOne->expects(self::once())
+            ->method('getEventCode')
+            ->willReturn($eventCodeOne);
+        $eventOne->expects(self::once())
+            ->method('getMetadata')
+            ->willReturn($eventOneMetadata);
+
+        $eventCodeTwo = 'code2';
+        $eventTwoData = ['key' => 'test1'];
+        $eventTwoMetadata = [
+            'commerceEdition' => 'Adobe Commerce + B2B',
+            'commerceVersion' => '2.4.5-p2',
+            'eventsClientVersion' => '100.0.1'
+        ];
+        $eventTwo = $this->createMock(Event::class);
+        $eventTwo->expects(self::once())
+            ->method('getId')
+            ->willReturn('2');
+        $eventTwo->expects(self::once())
+            ->method('getEventData')
+            ->willReturn($eventTwoData);
+        $eventTwo->expects(self::once())
+            ->method('getEventCode')
+            ->willReturn($eventCodeTwo);
+        $eventTwo->expects(self::once())
+            ->method('getMetadata')
+            ->willReturn($eventTwoMetadata);
+        $eventCodeThree = $this->createMock(Event::class);
+        $eventCodeThree->expects(self::exactly(2))
+            ->method('getId')
+            ->willReturn('3');
+        $eventCodeThree->expects(self::once())
+            ->method('getEventData')
+            ->willThrowException(new EventException(__('Failed to convert data')));
+        $this->eventStatusUpdaterMock->expects(self::once())
+            ->method('updateStatus')
+            ->with(['3'], EventInterface::FAILURE_STATUS, 'Failed to process event data: Failed to convert data');
+
+        $this->collectionMock->expects(self::once())
+            ->method('getItems')
+            ->willReturn([$eventOne, $eventTwo, $eventCodeThree]);
+
+        $events = $this->arrayConverter->convert($this->collectionMock);
+        $this->assertEquals(
+            [
+                '1' => ['eventCode' => $eventCodeOne, 'eventData' => $eventOneData, 'metadata' => $eventOneMetadata],
+                '2' => ['eventCode' => $eventCodeTwo, 'eventData' => $eventTwoData, 'metadata' => $eventTwoMetadata]
+            ],
+            $events
+        );
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetrieverTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetrieverTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetrieverTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventRetrieverTest.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,103 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event;
-
-use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
-use Magento\AdobeCommerceEventsClient\Event\EventRetriever;
-use Magento\AdobeCommerceEventsClient\Model\Event;
-use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event\Collection;
-use PHPUnit\Framework\MockObject\MockObject;
-use PHPUnit\Framework\TestCase;
-
-/**
- * Tests for EventRetriever class
- */
-class EventRetrieverTest extends TestCase
-{
-    /**
-     * @var EventRetriever
-     */
-    private EventRetriever $eventRetriever;
-
-    /**
-     * @var Collection|MockObject
-     */
-    private $collectionMock;
-
-    protected function setUp(): void
-    {
-        $this->collectionMock = $this->createMock(Collection::class);
-        $this->eventRetriever = new EventRetriever($this->collectionMock);
-    }
-
-    /**
-     * Checks the retrieval and returning of stored event data.
-     *
-     * @return void
-     */
-    public function testGetBatch()
-    {
-        $eventOneData = ['key' => 'test1'];
-        $eventCodeOne = 'code1';
-        $eventOneMetadata = [
-            'commerceEdition' => 'Adobe Commerce',
-            'commerceVersion' => '2.4.5',
-            'eventsClientVersion' => '100.0.0'
-        ];
-        $eventOne = $this->createMock(Event::class);
-        $eventOne->expects(self::once())
-            ->method('getId')
-            ->willReturn('1');
-        $eventOne->expects(self::once())
-            ->method('getEventData')
-            ->willReturn($eventOneData);
-        $eventOne->expects(self::once())
-            ->method('getEventCode')
-            ->willReturn($eventCodeOne);
-        $eventOne->expects(self::once())
-            ->method('getMetadata')
-            ->willReturn($eventOneMetadata);
-
-        $eventCodeTwo = 'code2';
-        $eventTwoData = ['key' => 'test1'];
-        $eventTwoMetadata = [
-            'commerceEdition' => 'Adobe Commerce + B2B',
-            'commerceVersion' => '2.4.5-p2',
-            'eventsClientVersion' => '100.0.1'
-        ];
-        $eventTwo = $this->createMock(Event::class);
-        $eventTwo->expects(self::once())
-            ->method('getId')
-            ->willReturn('2');
-        $eventTwo->expects(self::once())
-            ->method('getEventData')
-            ->willReturn($eventTwoData);
-        $eventTwo->expects(self::once())
-            ->method('getEventCode')
-            ->willReturn($eventCodeTwo);
-        $eventTwo->expects(self::once())
-            ->method('getMetadata')
-            ->willReturn($eventTwoMetadata);
-
-        $this->collectionMock->expects(self::once())
-            ->method('addFieldToFilter')
-            ->with('status', EventInterface::WAITING_STATUS);
-        $this->collectionMock->expects(self::once())
-            ->method('getItems')
-            ->willReturn([$eventOne, $eventTwo]);
-
-        $events = $this->eventRetriever->getWaitingEvents();
-        $this->assertEquals(
-            [
-                '1' => ['eventCode' => $eventCodeOne, 'eventData' => $eventOneData, 'metadata' => $eventOneMetadata],
-                '2' => ['eventCode' => $eventCodeTwo, 'eventData' => $eventTwoData, 'metadata' => $eventTwoMetadata]
-            ],
-            $events
-        );
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStatusUpdaterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStatusUpdaterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStatusUpdaterTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStatusUpdaterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,116 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event;
+
+use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
+use Magento\AdobeCommerceEventsClient\Api\EventRepositoryInterface;
+use Magento\AdobeCommerceEventsClient\Event\EventStatusUpdater;
+use Magento\AdobeCommerceEventsClient\Model\Event as EventModel;
+use Magento\AdobeCommerceEventsClient\Model\ResourceModel\Event as EventResourceModel;
+use Magento\Framework\DB\Adapter\AdapterInterface;
+use PHPUnit\Framework\MockObject\MockObject;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see EventStatusUpdater class
+ */
+class EventStatusUpdaterTest extends TestCase
+{
+    /**
+     * @var EventStatusUpdater
+     */
+    private EventStatusUpdater $statusUpdater;
+
+    /**
+     * @var EventRepositoryInterface|MockObject
+     */
+    private $eventRepositoryMock;
+
+    /**
+     * @var EventResourceModel|MockObject
+     */
+    private $eventResourceModelMock;
+
+    protected function setUp(): void
+    {
+        $this->eventRepositoryMock = $this->getMockForAbstractClass(EventRepositoryInterface::class);
+        $this->eventResourceModelMock = $this->createMock(EventResourceModel::class);
+
+        $this->statusUpdater = new EventStatusUpdater(
+            $this->eventRepositoryMock,
+            $this->eventResourceModelMock
+        );
+    }
+
+    /**
+     * Checks the updating of events with a success status.
+     *
+     * @return void
+     */
+    public function testUpdateStatus()
+    {
+        $connectionMock = $this->getMockForAbstractClass(AdapterInterface::class);
+        $connectionMock->expects(self::once())
+            ->method('update')
+            ->with(
+                'event_data',
+                [
+                    'status' => EventInterface::SUCCESS_STATUS,
+                    'info' => 'test'
+                ],
+                ['event_id in (?)' => [1,2]]
+            );
+        $this->eventResourceModelMock->expects(self::once())
+            ->method('getMainTable')
+            ->willReturn('event_data');
+        $this->eventResourceModelMock->expects(self::once())
+            ->method('getConnection')
+            ->willReturn($connectionMock);
+
+        $this->statusUpdater->updateStatus([1, 2], EventInterface::SUCCESS_STATUS, 'test');
+    }
+
+    /**
+     * Checks the updating of events after a failure to send event data.
+     *
+     * @return void
+     */
+    public function testUpdateFailure()
+    {
+        $maxRetries = 5;
+        $eventModelOne = $this->createMock(EventModel::class);
+        $eventModelOne->expects(self::once())
+            ->method('getRetriesCount')
+            ->willReturn($maxRetries);
+        $eventModelOne->expects(self::once())
+            ->method('setStatus')
+            ->with(EventInterface::FAILURE_STATUS);
+        $eventModelOne->expects(self::never())
+            ->method('setRetriesCount');
+
+        $eventModelTwo = $this->createMock(EventModel::class);
+        $eventModelTwo->expects(self::once())
+            ->method('getRetriesCount')
+            ->willReturn(0);
+        $eventModelTwo->expects(self::once())
+            ->method('setRetriesCount')
+            ->with(1);
+        $eventModelTwo->expects(self::once())
+            ->method('setStatus')
+            ->with(EventInterface::WAITING_STATUS);
+
+        $this->eventRepositoryMock->expects(self::exactly(2))
+            ->method('getById')
+            ->willReturnOnConsecutiveCalls($eventModelOne, $eventModelTwo);
+
+        $this->eventRepositoryMock->expects(self::exactly(2))
+            ->method('save')
+            ->withConsecutive([$eventModelOne], [$eventModelTwo]);
+        $this->statusUpdater->updateFailure([1, 2], $maxRetries);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriter/CreateEventValidatorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriter/CreateEventValidatorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriter/CreateEventValidatorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriter/CreateEventValidatorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -12,8 +12,6 @@
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter\CreateEventValidator;
 use Magento\AdobeCommerceEventsClient\Event\Operator\OperatorException;
 use Magento\AdobeCommerceEventsClient\Event\Rule\RuleChecker;
-use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
-use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use PHPUnit\Framework\MockObject\MockObject;
 use PHPUnit\Framework\TestCase;

@@ -33,11 +31,6 @@
     private $eventConfigurationMock;

     /**
-     * @var EventCodeSupportedValidator|MockObject
-     */
-    private $eventCodeSupportedValidatorMock;
-
-    /**
      * @var RuleChecker|MockObject
      */
     private $ruleCheckerMock;
@@ -51,11 +44,9 @@
     {
         $this->eventMock = $this->createMock(Event::class);
         $this->eventConfigurationMock = $this->createMock(Config::class);
-        $this->eventCodeSupportedValidatorMock = $this->createMock(EventCodeSupportedValidator::class);
         $this->ruleCheckerMock = $this->createMock(RuleChecker::class);
         $this->createEventValidator = new CreateEventValidator(
             $this->eventConfigurationMock,
-            $this->eventCodeSupportedValidatorMock,
             $this->ruleCheckerMock,
         );
     }
@@ -65,23 +56,6 @@
         $this->eventConfigurationMock->expects(self::once())
             ->method('isEnabled')
             ->willReturn(false);
-        $this->eventCodeSupportedValidatorMock->expects(self::never())
-            ->method('validate');
-
-        self::assertFalse($this->createEventValidator->validate($this->eventMock, ['some_data']));
-    }
-
-    public function testEventIsNotSupported(): void
-    {
-        $this->expectException(ValidatorException::class);
-        $this->expectExceptionMessage('error happened');
-
-        $this->eventConfigurationMock->expects(self::once())
-            ->method('isEnabled')
-            ->willReturn(true);
-        $this->eventCodeSupportedValidatorMock->expects(self::once())
-            ->method('validate')
-            ->willThrowException(new ValidatorException(__('error happened')));
         $this->ruleCheckerMock->expects(self::never())
             ->method('verify');

@@ -96,8 +70,6 @@
         $this->eventConfigurationMock->expects(self::once())
             ->method('isEnabled')
             ->willReturn(true);
-        $this->eventCodeSupportedValidatorMock->expects(self::once())
-            ->method('validate');
         $this->ruleCheckerMock->expects(self::once())
             ->method('verify')
             ->with($this->eventMock, ['some_data'])
@@ -111,8 +83,6 @@
         $this->eventConfigurationMock->expects(self::once())
             ->method('isEnabled')
             ->willReturn(true);
-        $this->eventCodeSupportedValidatorMock->expects(self::once())
-            ->method('validate');
         $this->ruleCheckerMock->expects(self::once())
             ->method('verify')
             ->with($this->eventMock, ['some_data'])
@@ -126,8 +96,6 @@
         $this->eventConfigurationMock->expects(self::once())
             ->method('isEnabled')
             ->willReturn(true);
-        $this->eventCodeSupportedValidatorMock->expects(self::once())
-            ->method('validate');
         $this->ruleCheckerMock->expects(self::once())
             ->method('verify')
             ->with($this->eventMock, ['some_data'])
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriterTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventStorageWriterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,14 +7,15 @@

 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event;

-use Magento\AdobeCommerceEventsClient\Api\Data\EventInterface;
 use Magento\AdobeCommerceEventsClient\Api\EventRepositoryInterface;
 use Magento\AdobeCommerceEventsClient\Event\DataFilterInterface;
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\EventMetadataCollector;
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
+use Magento\AdobeCommerceEventsClient\Event\Queue\Publisher\EventPublisher;
+use Magento\AdobeCommerceEventsClient\Event\Queue\Publisher\EventPublisherFactory;
 use Magento\AdobeCommerceEventsClient\Model\Event as EventModel;
 use Magento\AdobeCommerceEventsClient\Model\EventFactory as EventModelFactory;
 use PHPUnit\Framework\MockObject\MockObject;
@@ -22,7 +23,7 @@
 use Psr\Log\LoggerInterface;

 /**
- * Tests for EventStorageWriter class
+ * Tests for @see EventStorageWriter class
  *
  * @SuppressWarnings(PHPMD.CouplingBetweenObjects)
  */
@@ -64,6 +65,11 @@
     private $metadataCollectorMock;

     /**
+     * @var EventPublisherFactory|MockObject
+     */
+    private $eventPublisherFactoryMock;
+
+    /**
      * @var LoggerInterface|MockObject
      */
     private $loggerMock;
@@ -76,6 +82,7 @@
         $this->eventModelFactoryMock = $this->createMock(EventModelFactory::class);
         $this->dataFilterMock = $this->getMockForAbstractClass(DataFilterInterface::class);
         $this->metadataCollectorMock = $this->createMock(EventMetadataCollector::class);
+        $this->eventPublisherFactoryMock = $this->createMock(EventPublisherFactory::class);
         $this->loggerMock = $this->getMockForAbstractClass(LoggerInterface::class);

         $this->storageWriter = new EventStorageWriter(
@@ -85,77 +92,12 @@
             $this->eventModelFactoryMock,
             $this->dataFilterMock,
             $this->metadataCollectorMock,
+            $this->eventPublisherFactoryMock,
             $this->loggerMock
         );
     }

     /**
-     * Checks the updating of events with a success status.
-     *
-     * @return void
-     */
-    public function testUpdateStatus()
-    {
-        $eventModelOne = $this->createMock(EventModel::class);
-        $eventModelOne->expects(self::once())
-            ->method("setStatus")
-            ->with(EventInterface::SUCCESS_STATUS);
-
-        $eventModelTwo = $this->createMock(EventModel::class);
-        $eventModelTwo->expects(self::once())
-            ->method('setStatus')
-            ->with(EventInterface::SUCCESS_STATUS);
-
-        $this->eventRepositoryMock->expects(self::exactly(2))
-            ->method('getById')
-            ->willReturnOnConsecutiveCalls($eventModelOne, $eventModelTwo);
-
-        $this->eventRepositoryMock->expects(self::exactly(2))
-            ->method('save')
-            ->withConsecutive([$eventModelOne], [$eventModelTwo]);
-        $this->storageWriter->updateStatus([1, 2], EventInterface::SUCCESS_STATUS);
-    }
-
-    /**
-     * Checks the updating of events after a failure to send event data.
-     *
-     * @return void
-     */
-    public function testUpdateFailure()
-    {
-        $maxRetries = 5;
-        $eventModelOne = $this->createMock(EventModel::class);
-        $eventModelOne->expects(self::once())
-            ->method('getRetriesCount')
-            ->willReturn($maxRetries);
-        $eventModelOne->expects(self::once())
-            ->method('setStatus')
-            ->with(EventInterface::FAILURE_STATUS);
-        $eventModelOne->expects(self::never())
-            ->method('setRetriesCount');
-
-        $eventModelTwo = $this->createMock(EventModel::class);
-        $eventModelTwo->expects(self::once())
-            ->method('getRetriesCount')
-            ->willReturn(0);
-        $eventModelTwo->expects(self::once())
-            ->method('setRetriesCount')
-            ->with(1);
-        $eventModelTwo->expects(self::once())
-            ->method('setStatus')
-            ->with(EventInterface::WAITING_STATUS);
-
-        $this->eventRepositoryMock->expects(self::exactly(2))
-            ->method('getById')
-            ->willReturnOnConsecutiveCalls($eventModelOne, $eventModelTwo);
-
-        $this->eventRepositoryMock->expects(self::exactly(2))
-            ->method('save')
-            ->withConsecutive([$eventModelOne], [$eventModelTwo]);
-        $this->storageWriter->updateFailure([1, 2], $maxRetries);
-    }
-
-    /**
      * Tests that event is not saved in the case when validation failed.
      *
      * @return void
@@ -190,7 +132,7 @@
     public function testCreateEvent()
     {
         $eventCode = "test.code";
-        $eventCodeWithCommerce = EventSubscriber::EVENT_PREFIX_COMMERCE . "test.code";
+        $eventCodeWithCommerce = EventSubscriberInterface::EVENT_PREFIX_COMMERCE . "test.code";
         $eventData = [
             "images" => [
                 [
@@ -208,6 +150,9 @@
         $eventMock->expects(self::once())
             ->method('getName')
             ->willReturn($eventCode);
+        $eventMock->expects(self::exactly(2))
+            ->method('isPriority')
+            ->willReturn(false);
         $this->eventListMock->expects(self::once())
             ->method('getAll')
             ->willReturn([$eventMock]);
@@ -225,6 +170,9 @@
         $eventModelMock->expects(self::once())
             ->method('setEventData')
             ->with($eventData);
+        $eventModelMock->expects(self::once())
+            ->method('setPriority')
+            ->with(0);
         $this->dataFilterMock->expects(self::once())
             ->method('filter')
             ->with($eventCodeWithCommerce, $eventData)
@@ -234,6 +182,8 @@
             ->with($eventModelMock);
         $this->loggerMock->expects(self::never())
             ->method('error');
+        $this->eventPublisherFactoryMock->expects(self::never())
+            ->method('create');

         $this->metadataCollectorMock->expects(self::once())
             ->method('getMetadata')
@@ -248,13 +198,14 @@

     /**
      * Tests the saving of new event data in the case that the event data contains a key to be ignored.
+     * Tests that published is called for priority-type event.
      *
      * @return void
      */
-    public function testCreateEventWithFilteredData()
+    public function testCreateEventWithFilteredDataAndPriority()
     {
         $eventCode = "test.code";
-        $eventCodeWithCommerce = EventSubscriber::EVENT_PREFIX_COMMERCE . "test.code";
+        $eventCodeWithCommerce = EventSubscriberInterface::EVENT_PREFIX_COMMERCE . "test.code";
         $inputEventData = [
             'key1' => 'value1',
             'key2' => 'value1',
@@ -267,6 +218,9 @@
         $eventMock->expects(self::once())
             ->method('getName')
             ->willReturn($eventCode);
+        $eventMock->expects(self::exactly(2))
+            ->method('isPriority')
+            ->willReturn(true);
         $this->eventListMock->expects(self::once())
             ->method('getAll')
             ->willReturn([$eventMock]);
@@ -284,6 +238,9 @@
         $eventModelMock->expects(self::once())
             ->method('setEventData')
             ->with($filteredEventData);
+        $eventModelMock->expects(self::once())
+            ->method('getId')
+            ->willReturn('123');
         $this->eventRepositoryMock->expects(self::once())
             ->method('save')
             ->with($eventModelMock);
@@ -291,6 +248,13 @@
             ->method('filter')
             ->with($eventCodeWithCommerce, $inputEventData)
             ->willReturn($filteredEventData);
+        $eventPublisherMock = $this->createMock(EventPublisher::class);
+        $this->eventPublisherFactoryMock->expects(self::once())
+            ->method('create')
+            ->willReturn($eventPublisherMock);
+        $eventPublisherMock->expects(self::once())
+            ->method('execute')
+            ->with('123');
         $this->metadataCollectorMock->expects(self::once())
             ->method('getMetadata')
             ->willReturn([
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventSubscriberTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventSubscriberTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventSubscriberTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/EventSubscriberTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,13 +9,15 @@

 use Magento\AdobeCommerceEventsClient\Event\AdobeIoEventMetadataFactory;
 use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventValidatorInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
+use Magento\AdobeIoEventsClient\Api\EventMetadataInterface;
+use Magento\AdobeIoEventsClient\Api\EventProviderInterface;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
-use Magento\AdobeIoEventsClient\Model\Data\EventMetadata;
-use Magento\AdobeIoEventsClient\Model\Data\EventProvider;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
+use Magento\AdobeIoEventsClient\Model\EventMetadataClient;
 use Magento\Framework\App\DeploymentConfig;
 use Magento\Framework\App\DeploymentConfig\Writer;
 use Magento\Framework\Config\File\ConfigFilePool;
@@ -66,9 +68,14 @@
     private $eventMetadataFactoryMock;

     /**
-     * @var IOEventsAPIClient|MockObject
+     * @var EventMetadataClient|MockObject
      */
-    private $IOEventsAPIClientMock;
+    private $metadataClientMock;
+
+    /**
+     * @var EventList|MockObject
+     */
+    private $eventListMock;

     /**
      * @var MockObject|LoggerInterface
@@ -89,7 +96,8 @@
         $this->unsubscribeValidatorMock = $this->getMockForAbstractClass(EventValidatorInterface::class);
         $this->configurationProviderMock = $this->createMock(AdobeIOConfigurationProvider::class);
         $this->eventMetadataFactoryMock = $this->createMock(AdobeIoEventMetadataFactory::class);
-        $this->IOEventsAPIClientMock = $this->createMock(IOEventsAPIClient::class);
+        $this->metadataClientMock = $this->createMock(EventMetadataClient::class);
+        $this->eventListMock = $this->createMock(EventList::class);
         $this->loggerMock = $this->getMockForAbstractClass(LoggerInterface::class);

         $this->eventSubscriber = new EventSubscriber(
@@ -99,7 +107,8 @@
             $this->unsubscribeValidatorMock,
             $this->configurationProviderMock,
             $this->eventMetadataFactoryMock,
-            $this->IOEventsAPIClientMock,
+            $this->metadataClientMock,
+            $this->eventListMock,
             $this->loggerMock
         );
     }
@@ -125,13 +134,15 @@
         $this->expectExceptionMessage('validation error');

         $this->configurationProviderMock->expects(self::once())
-            ->method('retrieveProvider')
+            ->method('getProvider')
             ->willThrowException(new \Exception('validation error'));
-        $this->IOEventsAPIClientMock->expects(self::never())
+        $this->metadataClientMock->expects(self::never())
             ->method('createEventMetadata');
         $this->subscribeValidatorMock->expects(self::once())
             ->method('validate')
             ->with($this->eventMock);
+        $this->eventListMock->expects(self::never())
+            ->method('reset');
         $this->configWriterMock->expects(self::never())
             ->method('saveConfig');

@@ -141,8 +152,8 @@
     public function testSubscribe(): void
     {
         $eventName = 'observer.event.test';
-        $providerMock = $this->createMock(EventProvider::class);
-        $eventMetadataMock = $this->createMock(EventMetadata::class);
+        $providerMock = $this->createMock(EventProviderInterface::class);
+        $eventMetadataMock = $this->createMock(EventMetadataInterface::class);

         $this->eventMock->expects(self::any())
             ->method('getName')
@@ -154,18 +165,18 @@
             ->method('validate')
             ->with($this->eventMock);
         $this->configurationProviderMock->expects(self::once())
-            ->method('retrieveProvider')
+            ->method('getProvider')
             ->willReturn($providerMock);
         $this->eventMetadataFactoryMock->expects(self::once())
             ->method('generate')
-            ->with(EventSubscriber::EVENT_PREFIX_COMMERCE . $eventName)
+            ->with(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $eventName)
             ->willReturn($eventMetadataMock);
-        $this->IOEventsAPIClientMock->expects(self::once())
+        $this->metadataClientMock->expects(self::once())
             ->method('createEventMetadata')
             ->with($providerMock, $eventMetadataMock);
         $this->deploymentConfigMock->expects(self::once())
             ->method('get')
-            ->with(EventSubscriber::IO_EVENTS_CONFIG_NAME, [])
+            ->with(EventSubscriberInterface::IO_EVENTS_CONFIG_NAME, [])
             ->willReturn([
                 'observer.event.test' => [
                     'fields' => [
@@ -187,7 +198,7 @@
             ->with(
                 [
                     ConfigFilePool::APP_CONFIG => [
-                        EventSubscriber::IO_EVENTS_CONFIG_NAME => [
+                        EventSubscriberInterface::IO_EVENTS_CONFIG_NAME => [
                             'observer.event.test' => [
                                 'fields' => [
                                     'field_one',
@@ -206,6 +217,8 @@
                 ],
                 true
             );
+        $this->eventListMock->expects(self::once())
+            ->method('reset');
         $this->loggerMock->expects(self::once())
             ->method('info');

@@ -215,8 +228,8 @@
     public function testUnsubscribe():void
     {
         $eventName = 'observer.event.test';
-        $providerMock = $this->createMock(EventProvider::class);
-        $eventMetadataMock = $this->createMock(EventMetadata::class);
+        $providerMock = $this->createMock(EventProviderInterface::class);
+        $eventMetadataMock = $this->createMock(EventMetadataInterface::class);

         $this->eventMock->expects(self::any())
             ->method('getName')
@@ -225,13 +238,13 @@
             ->method('validate')
             ->with($this->eventMock);
         $this->configurationProviderMock->expects(self::once())
-            ->method('retrieveProvider')
+            ->method('getProvider')
             ->willReturn($providerMock);
         $this->eventMetadataFactoryMock->expects(self::once())
             ->method('generate')
-            ->with(EventSubscriber::EVENT_PREFIX_COMMERCE . $eventName)
+            ->with(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $eventName)
             ->willReturn($eventMetadataMock);
-        $this->IOEventsAPIClientMock->expects(self::once())
+        $this->metadataClientMock->expects(self::once())
             ->method('deleteEventMetadata')
             ->with($providerMock, $eventMetadataMock);
         $this->configWriterMock->expects(self::once())
@@ -239,7 +252,7 @@
             ->with(
                 [
                     ConfigFilePool::APP_CONFIG => [
-                        EventSubscriber::IO_EVENTS_CONFIG_NAME => [
+                        EventSubscriberInterface::IO_EVENTS_CONFIG_NAME => [
                             $eventName => [
                                 'enabled' => 0
                             ],
@@ -247,6 +260,8 @@
                     ],
                 ]
             );
+        $this->eventListMock->expects(self::once())
+            ->method('reset');
         $this->loggerMock->expects(self::once())
             ->method('info');

@@ -259,12 +274,14 @@
         $this->expectExceptionMessage('validation error');

         $this->configurationProviderMock->expects(self::once())
-            ->method('retrieveProvider')
+            ->method('getProvider')
             ->willThrowException(new \Exception('validation error'));
-        $this->IOEventsAPIClientMock->expects(self::never())
+        $this->metadataClientMock->expects(self::never())
             ->method('createEventMetadata');
         $this->configWriterMock->expects(self::never())
             ->method('saveConfig');
+        $this->eventListMock->expects(self::never())
+            ->method('reset');

         $this->eventSubscriber->unsubscribe($this->eventMock);
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/EventFieldsFilterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/EventFieldsFilterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/EventFieldsFilterTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/EventFieldsFilterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -8,9 +8,10 @@
 namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Filter;

 use Magento\AdobeCommerceEventsClient\Event\Event;
+use Magento\AdobeCommerceEventsClient\Event\EventInitializationException;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\Filter\EventFieldsFilter;
-use Magento\AdobeCommerceEventsClient\Event\Filter\NestedArrayOperator;
+use Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter\FieldConverter;
 use PHPUnit\Framework\MockObject\MockObject;
 use PHPUnit\Framework\TestCase;

@@ -38,115 +39,335 @@
     {
         $this->eventListMock = $this->createMock(EventList::class);
         $this->eventMock = $this->createMock(Event::class);
-        $this->filter = new EventFieldsFilter($this->eventListMock, new NestedArrayOperator());
+        $this->filter = new EventFieldsFilter($this->eventListMock, new FieldConverter());
     }

-    public function testDataFiltered(): void
+    /**
+     * @dataProvider dataFilteredDataProvider
+     * @param array $eventData
+     * @param array $fields
+     * @param array $expectedData
+     * @return void
+     * @throws EventInitializationException
+     */
+    public function testDataFiltered(array $eventData, array $fields, array $expectedData): void
     {
-        $eventData = [
-            'key1' => 'value1',
-            'key2' => 'value2',
-            'key3' => [
-                'key3_1' => 'value3_1',
-                'key3_2' => 'value3_2',
-            ],
-            'key4' => 'value4'
-        ];
-
         $this->eventListMock->expects(self::once())
             ->method('get')
             ->with('some.event')
             ->willReturn($this->eventMock);
         $this->eventMock->expects(self::exactly(2))
             ->method('getFields')
-            ->willReturn(['key1', 'key3', 'key5']);
-
-        self::assertEquals(
-            [
-                'key1' => 'value1',
-                'key3' => [
-                    'key3_1' => 'value3_1',
-                    'key3_2' => 'value3_2',
-                ],
-                'key5' => null
-            ],
-            $this->filter->filter('some.event', $eventData)
-        );
-    }
-
-    public function testDataNotFilteredIfEventNotExists(): void
-    {
-        $eventData = ['key' => 'value'];
-
-        $this->eventListMock->expects(self::once())
-            ->method('get')
-            ->with('some.event')
-            ->willReturn(null);
+            ->willReturn($fields);

         self::assertEquals(
-            $eventData,
+            $expectedData,
             $this->filter->filter('some.event', $eventData)
         );
     }

-    public function testNestedFieldsFilter(): void
+    /**
+     * @return array[]
+     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)
+     */
+    public function dataFilteredDataProvider(): array
     {
-        $eventData = [
-            'key1' => 'value1',
-            'key2' => 'value2',
-            'key3' => [
-                'key3_1' => 'value3_1',
-                'key3_2' => [
-                    'key3_2_1' => 'value3_2_1',
-                    'key3_2_2' => [
-                        'key3_2_2_1' => 'value3_2_2_1',
-                        'key3_2_2_2' => 'value3_2_2_2',
-                    ]
+        return [
+            'simple fields' => [
+                'eventData' => [
+                    'key1' => 'value1',
+                    'key2' => 'value2',
+                    'key3' => [
+                        'key3_1' => 'value3_1',
+                        'key3_2' => 'value3_2',
+                    ],
+                    'key4' => 'value4'
+                ],
+                'fields' => [
+                    'key1',
+                    'key3',
+                    'key5'
+                ],
+                'expectedData' => [
+                    'key1' => 'value1',
+                    'key3' => [
+                        'key3_1' => 'value3_1',
+                        'key3_2' => 'value3_2',
+                    ],
+                    'key5' => null
                 ]
             ],
-            'key4' => [
-                'key4_1' => 'value4_1'
-            ]
-        ];
-
-        $this->eventListMock->expects(self::once())
-            ->method('get')
-            ->with('some.event')
-            ->willReturn($this->eventMock);
-        $this->eventMock->expects(self::exactly(2))
-            ->method('getFields')
-            ->willReturn([
-                'key1',
-                'key3.key3_2.key3_2_2.key3_2_2_2',
-                'key3.key3_2.key3_2_2.key_not_exists',
-                'key3.key3_1',
-                'key_not_exists.key_not_exists.key_not_exists.key_not_exists.key_not_exists.key_not_exists'
-            ]);
-
-        self::assertEquals(
-            [
-                'key1' => 'value1',
-                'key3' => [
-                    'key3_1' => 'value3_1',
-                    'key3_2' => [
-                        'key3_2_2' => [
-                            'key3_2_2_2' => 'value3_2_2_2',
-                            'key_not_exists' => null,
+            'simple nested fields' => [
+                'eventData' => [
+                    'key1' => 'value1',
+                    'key2' => 'value2',
+                    'key3' => [
+                        'key3_1' => 'value3_1',
+                        'key3_2' => [
+                            'key3_2_1' => 'value3_2_1',
+                            'key3_2_2' => [
+                                'key3_2_2_1' => 'value3_2_2_1',
+                                'key3_2_2_2' => 'value3_2_2_2',
+                            ]
                         ]
+                    ],
+                    'key4' => [
+                        'key4_1' => 'value4_1'
                     ]
                 ],
-                'key_not_exists' => [
+                'fields' => [
+                    'key1',
+                    'key3.key3_2.key3_2_2.key3_2_2_2',
+                    'key3.key3_2.key3_2_2.key_not_exists',
+                    'key3.key3_1',
+                    'key_not_exists.key_not_exists.key_not_exists.key_not_exists.key_not_exists.key_not_exists'
+                ],
+                'expectedData' => [
+                    'key1' => 'value1',
+                    'key3' => [
+                        'key3_1' => 'value3_1',
+                        'key3_2' => [
+                            'key3_2_2' => [
+                                'key3_2_2_2' => 'value3_2_2_2',
+                                'key_not_exists' => null,
+                            ]
+                        ]
+                    ],
                     'key_not_exists' => [
                         'key_not_exists' => [
                             'key_not_exists' => [
                                 'key_not_exists' => [
-                                    'key_not_exists' => null
+                                    'key_not_exists' => [
+                                        'key_not_exists' => null
+                                    ]
                                 ]
                             ]
                         ]
                     ]
-                ]
+                ],
+            ],
+            'array fields' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                    'items' => [
+                        'items_1' => [
+                            'sku' => 'sku1',
+                            'qty' => '10',
+                            'entity_id' => '1',
+                        ],
+                        'items_2' => [
+                            'sku' => 'sku2',
+                            'qty' => '20',
+                            'entity_id' => '2',
+                        ],
+                    ],
+                ],
+                'fields' => [
+                    'entity_id',
+                    'items[].sku',
+                    'items[].qty',
+                    'items[].not_exists',
+                    'not_exists[]'
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'items' => [
+                        [
+                            'sku' => 'sku1',
+                            'qty' => '10',
+                            'not_exists' => null,
+                        ],
+                        [
+                            'sku' => 'sku2',
+                            'qty' => '20',
+                            'not_exists' => null,
+                        ],
+                    ],
+                    'not_exists' => null
+                ],
+            ],
+            'array nested fields' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                    'items' => [
+                        'items_1' => [
+                            'product' => [
+                                'name' => 'test',
+                                'price' => 100
+                            ],
+                            'qty' => 11,
+                            'entity_id' => '1',
+                        ],
+                        'items_2' => [
+                            'product' => [
+                                'name' => 'test2',
+                                'price' => 200
+                            ],
+                            'qty' => 22,
+                            'entity_id' => '2',
+                        ],
+                    ],
+                ],
+                'fields' => [
+                    'entity_id',
+                    'items[].product.name',
+                    'items[].qty',
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'items' => [
+                        [
+                            'product' => [
+                                'name' => 'test'
+                            ],
+                            'qty' => 11,
+                        ],
+                        [
+                            'product' => [
+                                'name' => 'test2'
+                            ],
+                            'qty' => 22,
+                        ],
+                    ],
+                ],
+            ],
+            'array nested fields not exists' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                ],
+                'fields' => [
+                    'entity_id',
+                    'items[].product.name',
+                    'items[].qty',
+                    'items2[].id',
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'items' => [],
+                    'items2' => [],
+                ],
+            ],
+            'nested fields with array fields' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [
+                            'items_1' => [
+                                'product' => [
+                                    'name' => 'test',
+                                    'price' => 100
+                                ],
+                                'qty' => 11,
+                                'entity_id' => '1',
+                            ],
+                            'items_2' => [
+                                'product' => [
+                                    'name' => 'test2',
+                                    'price' => 200
+                                ],
+                                'qty' => 22,
+                                'entity_id' => '2',
+                            ],
+                        ],
+                    ],
+                ],
+                'fields' => [
+                    'entity_id',
+                    'products.items[].product.name',
+                    'products.items[].qty',
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [
+                            [
+                                'product' => [
+                                    'name' => 'test'
+                                ],
+                                'qty' => 11,
+                            ],
+                            [
+                                'product' => [
+                                    'name' => 'test2'
+                                ],
+                                'qty' => 22,
+                            ],
+                        ],
+                    ],
+                ],
+            ],
+            'nested fields with array fields not exists' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [],
+                    ],
+                ],
+                'fields' => [
+                    'entity_id',
+                    'products.items[].product.name',
+                    'products.items[].qty',
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [],
+                    ],
+                ],
             ],
+            'nested array fields with not array event data fields' => [
+                'eventData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [
+                            'items_1' => 'item_1',
+                            'items_2' => 'item_2',
+                        ],
+                    ],
+                ],
+                'fields' => [
+                    'entity_id',
+                    'products.items[].product.name',
+                    'products.items[].qty',
+                ],
+                'expectedData' => [
+                    'entity_id' => 'value1',
+                    'products' => [
+                        'items' => [
+                            [
+                                'product' => [
+                                    'name' => null
+                                ],
+                                'qty' => null,
+                            ],
+                            [
+                                'product' => [
+                                    'name' => null
+                                ],
+                                'qty' => null,
+                            ],
+                        ],
+                    ],
+                ],
+            ],
+        ];
+    }
+
+    /**
+     * @return void
+     * @throws EventInitializationException
+     */
+    public function testDataNotFilteredIfEventNotExists(): void
+    {
+        $eventData = ['key' => 'value'];
+
+        $this->eventListMock->expects(self::once())
+            ->method('get')
+            ->with('some.event')
+            ->willReturn(null);
+
+        self::assertEquals(
+            $eventData,
             $this->filter->filter('some.event', $eventData)
         );
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldConverterTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldConverterTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldConverterTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldConverterTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,63 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Filter\FieldFilter;
+
+use Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter\FieldConverter;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see FieldConverter class
+ */
+class FieldConverterTest extends TestCase
+{
+    /**
+     * @var FieldConverter
+     */
+    private FieldConverter $fieldConvertor;
+
+    protected function setUp(): void
+    {
+        $this->fieldConvertor = new FieldConverter();
+    }
+
+    /**
+     * @return void
+     */
+    public function testConvert()
+    {
+        $fields = $this->fieldConvertor->convert([
+            'entity_id',
+            'product.sku',
+            'product.qty',
+        ]);
+
+        self::assertEquals(2, count($fields));
+        self::assertEquals('entity_id', $fields[0]->getName());
+        self::assertEquals('product', $fields[1]->getName());
+        self::assertFalse($fields[1]->isArray());
+        self::assertEquals(2, count($fields[1]->getChildren()));
+    }
+
+    /**
+     * @return void
+     */
+    public function testConvertArrayFields()
+    {
+        $fields = $this->fieldConvertor->convert([
+            ['test'],
+            'product[].sku',
+            'product[].qty',
+            'product[].name',
+        ]);
+
+        self::assertEquals(1, count($fields));
+        self::assertEquals('product', $fields[0]->getName());
+        self::assertTrue($fields[0]->isArray());
+        self::assertEquals(3, count($fields[0]->getChildren()));
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/FieldFilter/FieldTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,49 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Filter\FieldFilter;
+
+use Magento\AdobeCommerceEventsClient\Event\Filter\FieldFilter\Field;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see Field class
+ */
+class FieldTest extends TestCase
+{
+    /**
+     * @return void
+     */
+    public function testGetPath()
+    {
+        $parentMock = $this->createMock(Field::class);
+        $parentMock->expects(self::once())
+            ->method('getPath')
+            ->willReturn('parent');
+        $child = new Field('test', $parentMock);
+
+        self::assertEquals('parent.test', $child->getPath());
+        self::assertEquals('parent.test', $child->getPath());
+        self::assertEquals('parent.test', $child->getPath());
+    }
+
+    /**
+     * @return void
+     */
+    public function testGetPathOfNestedParent()
+    {
+        $root = new Field('root');
+        $level1 = new Field('level1', $root);
+        $level2 = new Field('level2', $level1);
+        $level3 = new Field('level3', $level2);
+
+        self::assertEquals('root', $root->getPath());
+        self::assertEquals('root.level1', $level1->getPath());
+        self::assertEquals('root.level1.level2', $level2->getPath());
+        self::assertEquals('root.level1.level2.level3', $level3->getPath());
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/NestedArrayOperatorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/NestedArrayOperatorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/NestedArrayOperatorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Filter/NestedArrayOperatorTest.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,137 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Filter;
-
-use Magento\AdobeCommerceEventsClient\Event\Filter\NestedArrayOperator;
-use PHPUnit\Framework\MockObject\MockObject;
-use PHPUnit\Framework\TestCase;
-
-/**
- * Tests for @see NestedArrayOperator class
- */
-class NestedArrayOperatorTest extends TestCase
-{
-    /**
-     * @param mixed $expected
-     * @param array $original
-     * @param array $keys
-     * @dataProvider getNestedElementDataProvider
-     */
-    public function testGetNestedElement($expected, array $original, array $keys): void
-    {
-        $this->assertSame($expected, (new NestedArrayOperator())->getNestedElement($original, $keys));
-    }
-
-    /**
-     * @return array
-     */
-    public function getNestedElementDataProvider(): array
-    {
-        return [
-            'simple' => [
-                'one',
-                ['test' => 'one'],
-                ['test'],
-            ],
-            'nested' => [
-                'one',
-                ['test' => ['test2' => 'one']],
-                ['test', 'test2'],
-            ],
-            'nested deep' => [
-                'one',
-                [
-                    'test_old' => 'two',
-                    'test' => [
-                        'test2' => [
-                            'test3' => [
-                                'test4' => [
-                                    'test5' => 'one'
-                                ]
-                            ]
-                        ]
-                    ]
-                ],
-                ['test', 'test2', 'test3', 'test4', 'test5'],
-            ],
-            'nested deep not exts' => [
-                null,
-                [
-                    'test_old' => 'two',
-                    'test' => [
-                        'test2' => [
-                            'test3' => [
-                                'test4' => [
-                                    'test5' => 'one'
-                                ]
-                            ]
-                        ]
-                    ]
-                ],
-                ['test', 'test2', 'test3', 'test4', 'test5', 'test6'],
-            ],
-        ];
-    }
-
-    /**
-     * @param array $expected
-     * @param array $original
-     * @param array $keys
-     * @param mixed $val
-     * @dataProvider setNestedElementDataProvider
-     */
-    public function testSetNestedElement(array $expected, array $original, array $keys, $val): void
-    {
-        (new NestedArrayOperator())->setNestedElement($original, $keys, $val);
-        $this->assertSame($expected, $original);
-    }
-
-    /**
-     * @return array
-     */
-    public function setNestedElementDataProvider(): array
-    {
-        return [
-            'simple' => [
-                ['test' => 'one'],
-                [],
-                ['test'],
-                'one',
-            ],
-            'multiple' => [
-                ['test' => ['test2' => 'one']],
-                [],
-                ['test', 'test2'],
-                'one',
-            ],
-            'appending' => [
-                ['test_old' => 'two', 'test' => ['test2' => 'one']],
-                ['test_old' => 'two'],
-                ['test', 'test2'],
-                'one',
-            ],
-            'appending deep' => [
-                [
-                    'test_old' => 'two',
-                    'test' => [
-                        'test2' => [
-                            'test3' => [
-                                'test4' => [
-                                    'test5' => 'one'
-                                ]
-                            ]
-                        ]
-                    ]
-                ],
-                ['test_old' => 'two'],
-                ['test', 'test2', 'test3', 'test4', 'test5'],
-                'one',
-            ],
-        ];
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/ClientVersionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/ClientVersionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/ClientVersionTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/ClientVersionTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,32 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Metadata;
+
+use Magento\AdobeCommerceEventsClient\Event\Metadata\ClientVersion;
+use Magento\Framework\Module\PackageInfo;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see ClientVersion class
+ */
+class ClientVersionTest extends TestCase
+{
+    public function testGet()
+    {
+        $packageInfoMock = $this->createMock(PackageInfo::class);
+        $packageInfoMock->expects(self::once())
+            ->method('getVersion')
+            ->with('Magento_AdobeCommerceEventsClient')
+            ->willReturn('1.0.0');
+
+        $metadata = (new ClientVersion($packageInfoMock))->get();
+
+        self::assertEquals(1, count($metadata));
+        self::assertEquals('1.0.0', $metadata['eventsClientVersion']);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/CommerceEditionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/CommerceEditionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/CommerceEditionTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/CommerceEditionTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,57 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Metadata;
+
+use Magento\AdobeCommerceEventsClient\Event\Metadata\CommerceEdition;
+use Magento\Framework\App\ProductMetadataInterface;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see CommerceEdition class
+ */
+class CommerceEditionTest extends TestCase
+{
+    /**
+     * @return void
+     * @dataProvider getDataProvider
+     */
+    public function testGet(string $edition, string $expectedEdition)
+    {
+        $commerceMetadataMock = $this->getMockForAbstractClass(ProductMetadataInterface::class);
+        $commerceMetadataMock->expects(self::once())
+            ->method('getEdition')
+            ->willReturn($edition);
+        $commerceMetadataMock->expects(self::once())
+            ->method('getVersion')
+            ->willReturn('2.4.6');
+
+        $metadata = (new CommerceEdition($commerceMetadataMock))->get();
+
+        self::assertEquals(2, count($metadata));
+        self::assertEquals($expectedEdition, $metadata['commerceEdition']);
+        self::assertEquals('2.4.6', $metadata['commerceVersion']);
+    }
+
+    public function getDataProvider(): array
+    {
+        return [
+            [
+                'Commerce',
+                'Adobe Commerce',
+            ],
+            [
+                'Community',
+                'Open Source',
+            ],
+            [
+                'B2B',
+                'Adobe Commerce + B2B',
+            ],
+        ];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/EventMetadataPoolTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/EventMetadataPoolTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/EventMetadataPoolTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/EventMetadataPoolTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,42 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Metadata;
+
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataInterface;
+use Magento\AdobeCommerceEventsClient\Event\Metadata\EventMetadataPool;
+use Magento\Framework\Exception\InvalidArgumentException;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for @see EventMetadataPool class
+ */
+class EventMetadataPoolTest extends TestCase
+{
+    public function testWrongInstanceGiven()
+    {
+        $this->expectException(InvalidArgumentException::class);
+
+        new EventMetadataPool([
+            $this->createMock(EventMetadataInterface::class),
+            $this->createMock(EventMetadataPool::class)
+        ]);
+    }
+
+    /**
+     * @throws InvalidArgumentException
+     */
+    public function testGetAll()
+    {
+        $eventMetadataPool = new EventMetadataPool([
+            $this->createMock(EventMetadataInterface::class),
+            $this->createMock(EventMetadataInterface::class),
+        ]);
+
+        self::assertEquals(2, count($eventMetadataPool->getAll()));
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/StoreTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/StoreTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/StoreTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Metadata/StoreTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,77 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Event\Metadata;
+
+use Magento\AdobeCommerceEventsClient\Event\Metadata\Store;
+use Magento\Framework\Exception\NoSuchEntityException;
+use Magento\Framework\Phrase;
+use Magento\Store\Api\Data\StoreInterface;
+use Magento\Store\Model\StoreManagerInterface;
+use PHPUnit\Framework\TestCase;
+use PHPUnit\Framework\MockObject\MockObject;
+
+/**
+ * Tests for @see Store class
+ */
+class StoreTest extends TestCase
+{
+    /**
+     * @var Store
+     */
+    private Store $storeMetadata;
+
+    /**
+     * @var StoreManagerInterface|MockObject
+     */
+    private StoreManagerInterface|MockObject $storeManagerMock;
+
+    protected function setUp(): void
+    {
+        $this->storeManagerMock = $this->getMockForAbstractClass(StoreManagerInterface::class);
+
+        $this->storeMetadata = new Store($this->storeManagerMock);
+    }
+
+    public function testGet()
+    {
+        $storeMock = $this->getMockForAbstractClass(StoreInterface::class);
+        $storeMock->expects(self::once())
+            ->method('getId')
+            ->willReturn(1);
+        $storeMock->expects(self::once())
+            ->method('getWebsiteId')
+            ->willReturn(1);
+        $storeMock->expects(self::once())
+            ->method('getStoreGroupId')
+            ->willReturn(1);
+        $this->storeManagerMock->expects(self::once())
+            ->method('getStore')
+            ->willReturn($storeMock);
+
+        $metadata = $this->storeMetadata->get();
+
+        self::assertEquals(3, count($metadata));
+        self::assertEquals(1, $metadata['storeId']);
+        self::assertEquals(1, $metadata['websiteId']);
+        self::assertEquals(1, $metadata['storeGroupId']);
+    }
+
+    public function testGetWithException()
+    {
+        $this->storeManagerMock->expects(self::once())
+            ->method('getStore')
+            ->willThrowException(new NoSuchEntityException(new Phrase('some error')));
+
+        $metadata = $this->storeMetadata->get();
+
+        self::assertEquals(3, count($metadata));
+        self::assertEquals('', $metadata['storeId']);
+        self::assertEquals('', $metadata['websiteId']);
+        self::assertEquals('', $metadata['storeGroupId']);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Validator/EventCode/EventCodeSupportedValidatorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Validator/EventCode/EventCodeSupportedValidatorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Validator/EventCode/EventCodeSupportedValidatorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Event/Validator/EventCode/EventCodeSupportedValidatorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,7 +9,7 @@

 use Magento\AdobeCommerceEventsClient\Event\Collector\AggregatedEventList;
 use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use PHPUnit\Framework\MockObject\MockObject;
@@ -106,7 +106,7 @@
             ->willReturn(null);
         $this->eventMock->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE. 'plugin.some_event_code');
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE. 'plugin.some_event_code');
         $this->aggregatedEventListMock->expects(self::once())
             ->method('getList')
             ->willReturn([
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleClass.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleClass.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleClass.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleClass.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,43 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Util\_files;
+
+use Magento\Framework\DataObject;
+
+class SampleClass extends DataObject
+{
+    public function isAvailable(): bool
+    {
+        return $this->_getData('available');
+    }
+
+    public function getItemName(): string
+    {
+        return $this->getData('item_name');
+    }
+
+    public function getCount($index): mixed
+    {
+        return $this->data['count'][$index];
+    }
+
+    public function resetName(): void
+    {
+        $this->data['item_name'] = '';
+    }
+
+    public function getQuantity(): int
+    {
+        return $this->data['quantity'];
+    }
+
+    public function getPrice(): float
+    {
+        return $this->_data['price'];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleInterface.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/_files/SampleInterface.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,21 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Util\_files;
+
+interface SampleInterface
+{
+    public function getId(): int;
+
+    public function setName($name): string;
+
+    public function getAttributeSetId(): int;
+
+    public function isAvailable(): bool;
+
+    public function resetName(): void;
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/ReflectionHelperTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/ReflectionHelperTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/ReflectionHelperTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Test/Unit/Util/ReflectionHelperTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -0,0 +1,146 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeCommerceEventsClient\Test\Unit\Util;
+
+use Magento\AdobeCommerceEventsClient\Util\ReflectionHelper;
+use Magento\Framework\Reflection\FieldNamer;
+use Magento\Framework\Reflection\TypeProcessor;
+use PHPUnit\Framework\MockObject\MockObject;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Tests for the @see ReflectionHelper Class
+ */
+class ReflectionHelperTest extends TestCase
+{
+    /**
+     * @var TypeProcessor|MockObject
+     */
+    private $typeProcessorMock;
+
+    /**
+     * @var ReflectionHelper
+     */
+    private ReflectionHelper $reflectionHelper;
+
+    public function setUp(): void
+    {
+        $this->typeProcessorMock = $this->createMock(TypeProcessor::class);
+        $this->reflectionHelper = new ReflectionHelper(new FieldNamer(), $this->typeProcessorMock);
+    }
+
+    /**
+     * Tests collection of properties from 'Magento\AdobeCommerceEventsClient\Test\Unit\Util\SampleClass'.
+     *
+     * @return void
+     */
+    public function testGetDataRelatedObjectPropertiesFromClass(): void
+    {
+        $this->typeProcessorMock->expects(self::exactly(3))
+            ->method('getGetterReturnType')
+            ->withConsecutive(
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'isAvailable'
+                    )
+                ],
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'getItemName'
+                    )
+                ],
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'getPrice'
+                    )
+                ]
+            )
+            ->willReturnOnConsecutiveCalls(
+                ['type' => 'bool'],
+                ['type' => 'string'],
+                ['type' => 'float']
+            );
+
+        $objectProperties = $this->reflectionHelper->getObjectProperties(
+            'Magento\AdobeCommerceEventsClient\Test\Unit\Util\_files\SampleClass'
+        );
+
+        $this->assertEquals(
+            [
+                [
+                    'type' => 'bool',
+                    'name' => 'available'
+                ],
+                [
+                    'type' => 'string',
+                    'name' => 'item_name'
+                ],
+                [
+                    'type' => 'float',
+                    'name' => 'price'
+                ]
+            ],
+            $objectProperties
+        );
+    }
+
+    /**
+     * Tests collection of properties from 'Magento\AdobeCommerceEventsClient\Test\Unit\Util\_files\SampleInterface'.
+     *
+     * @return void
+     */
+    public function testGetDataRelatedObjectPropertiesFromInterface(): void
+    {
+        $this->typeProcessorMock->expects(self::exactly(3))
+            ->method('getGetterReturnType')
+            ->withConsecutive(
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'getId'
+                    )
+                ],
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'getAttributeSetId'
+                    )
+                ],
+                [
+                    $this->callback(
+                        fn($method) => $method->getName() == 'isAvailable'
+                    )
+                ]
+            )
+            ->willReturnOnConsecutiveCalls(
+                ['type' => 'int'],
+                ['type' => 'int'],
+                ['type' => 'bool']
+            );
+
+        $objectProperties = $this->reflectionHelper->getObjectProperties(
+            'Magento\AdobeCommerceEventsClient\Test\Unit\Util\_files\SampleInterface'
+        );
+
+        $this->assertEquals(
+            [
+                [
+                    'type' => 'int',
+                    'name' => 'id'
+                ],
+                [
+                    'type' => 'int',
+                    'name' => 'attribute_set_id'
+                ],
+                [
+                    'type' => 'bool',
+                    'name' => 'available'
+                ]
+            ],
+            $objectProperties
+        );
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/ClassToArrayConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/ClassToArrayConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/ClassToArrayConverter.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/ClassToArrayConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,8 @@

 namespace Magento\AdobeCommerceEventsClient\Util;

+use ReflectionException;
+
 /**
  * Converts class to the array by converting getter methods to appropriate values
  */
@@ -41,7 +43,7 @@

         try {
             $objectProperties = $this->reflectionHelper->getObjectProperties($className);
-        } catch (\ReflectionException $e) {
+        } catch (ReflectionException $e) {
             return [$className];
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/EventCodeConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/EventCodeConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/EventCodeConverter.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/EventCodeConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,6 +9,9 @@

 /**
  * Converts event codes to FQCN class
+ *
+ * @api
+ * @since 1.1.0
  */
 class EventCodeConverter
 {
@@ -36,6 +39,8 @@
     }

     /**
+     * Converts class name to the event name.
+     *
      * @param string $className
      * @param string $methodName
      * @return string
@@ -77,6 +82,7 @@

     /**
      * Convert camel case to lowercase with underscores.
+     *
      * CamelCaseFormat => camel_case_format
      *
      * @param string $string
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/FileOperator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/FileOperator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/FileOperator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/FileOperator.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,11 @@

 namespace Magento\AdobeCommerceEventsClient\Util;

+use DirectoryIterator;
+use RecursiveDirectoryIterator;
+use RecursiveIteratorIterator;
+use RegexIterator;
+
 /**
  * Helper class for filesystem operations
  */
@@ -17,17 +22,17 @@
      *
      * @param string $dir
      * @param array $regexPatterns List of regex file pattern to find
-     * @return \RegexIterator
+     * @return RegexIterator
      */
     public function getRecursiveFileIterator(
         string $dir,
         array $regexPatterns
-    ): \RegexIterator {
-        $dirIterator = new \RecursiveDirectoryIterator($dir);
-        $recursiveDirIterator = new \RecursiveIteratorIterator($dirIterator);
+    ): RegexIterator {
+        $dirIterator = new RecursiveDirectoryIterator($dir);
+        $recursiveDirIterator = new RecursiveIteratorIterator($dirIterator);
         foreach ($regexPatterns as $pattern) {
             if (!empty($pattern)) {
-                $recursiveDirIterator = new \RegexIterator($recursiveDirIterator, $pattern, \RegexIterator::MATCH);
+                $recursiveDirIterator = new RegexIterator($recursiveDirIterator, $pattern, RegexIterator::MATCH);
             }
         }

@@ -38,10 +43,10 @@
      * Factory method for creating DirectoryIterator object
      *
      * @param string $dir
-     * @return \DirectoryIterator
+     * @return DirectoryIterator
      */
-    public function getDirectoryIterator(string $dir): \DirectoryIterator
+    public function getDirectoryIterator(string $dir): DirectoryIterator
     {
-        return new \DirectoryIterator($dir);
+        return new DirectoryIterator($dir);
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/ReflectionHelper.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/ReflectionHelper.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/Util/ReflectionHelper.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/Util/ReflectionHelper.php	2023-05-25 20:23:12.000000000 +0100
@@ -9,14 +9,19 @@

 use Laminas\Code\Reflection\ClassReflection;
 use Laminas\Code\Reflection\MethodReflection;
+use Magento\Framework\DataObject;
+use Magento\Framework\Reflection\FieldNamer;
 use Magento\Framework\Reflection\TypeProcessor;
 use ReflectionException;
-use ReflectionType;
+use Throwable;

 class ReflectionHelper
 {
     public const TYPE_VOID = 'void';

+    /**
+     * @var string[]
+     */
     private array $simpleTypes = [
         'bool',
         'boolean',
@@ -32,15 +37,24 @@
     ];

     /**
+     * @var FieldNamer
+     */
+    private FieldNamer $fieldNamer;
+
+    /**
      * @var TypeProcessor
      */
     private TypeProcessor $typeProcessor;

     /**
+     * @param FieldNamer $fieldNamer
      * @param TypeProcessor $typeProcessor
      */
-    public function __construct(TypeProcessor $typeProcessor)
-    {
+    public function __construct(
+        FieldNamer $fieldNamer,
+        TypeProcessor $typeProcessor
+    ) {
+        $this->fieldNamer = $fieldNamer;
         $this->typeProcessor = $typeProcessor;
     }

@@ -55,7 +69,7 @@
     {
         try {
             $returnType = $this->typeProcessor->getGetterReturnType($methodReflection)['type'];
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             return 'mixed';
         }

@@ -86,7 +100,10 @@
     }

     /**
-     * Retrieves all objects properties by a class name in [type, name] format.
+     * Retrieves objects properties by a class name in [type, name] format based on get*, is*, and has* methods.
+     *
+     * For classes extending Magento\Framework\DataObject, returns object properties based only on the get*, is*, or
+     * has* methods that access _data.
      *
      * @param string $fqcn
      * @return array
@@ -102,12 +119,20 @@
             if ($method->class != $refClass->getName()) {
                 continue;
             }
-            $name = $this->getPropertyName($method->getName());
-            if ($name === null) {
+
+            if ($method->getNumberOfParameters() != 0) {
+                continue;
+            }
+
+            $propName = $this->fieldNamer->getFieldNameForMethodName($method->getName());
+            if ($propName === null) {
+                continue;
+            }
+
+            if (is_a($fqcn, DataObject::class, true) && !$this->hasDataAccess($method)) {
                 continue;
             }

-            $propName = $this->pascalCase2SnakeCase($name);
             $result[] = [
                 'type' => str_replace('|null', '', $this->getReturnType($method, $refClass)),
                 'name' => $propName
@@ -118,33 +143,17 @@
     }

     /**
-     * Checks if a method name is a getter or is.
+     * Checks if input method's body accesses the _data variable directly or through the getData or _getData methods
      *
-     * @param string $methodName
-     * @return string|null
-     */
-    private function getPropertyName(string $methodName): ?string
-    {
-        if (strpos($methodName, 'get') === 0) {
-            return substr($methodName, 3);
-        }
-
-        if (strpos($methodName, 'is') === 0) {
-            return substr($methodName, 2);
-        }
-
-        return null;
-    }
-
-    /**
-     * Converts Pascal Case to Snake Case.
-     *
-     * @param string $input
-     * @return string
+     * @param MethodReflection $method
+     * @return bool
      */
-    public function pascalCase2SnakeCase(string $input): string
+    private function hasDataAccess(MethodReflection $method): bool
     {
-        return ltrim(strtolower(preg_replace('/[A-Z]([A-Z](?![a-z]))*/', '_$0', $input)), '_');
+        $body = $method->getBody();
+        return strpos($body, '$this->_data') !== false ||
+            strpos($body, '$this->getData(') !== false ||
+            strpos($body, '$this->_getData(') !== false;
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/view/adminhtml/web/css/events.css /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/view/adminhtml/web/css/events.css
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-client/view/adminhtml/web/css/events.css	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-client/view/adminhtml/web/css/events.css	2023-05-25 20:23:12.000000000 +0100
@@ -1,3 +1,7 @@
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
 .admin__page-nav-title.title {
     overflow:hidden;
     text-overflow:ellipsis;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/composer.json	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/composer.json	2023-05-25 20:23:16.000000000 +0100
@@ -9,12 +9,12 @@
     "config": {
         "sort-packages": true
     },
-    "version": "1.0.1",
+    "version": "1.2.0",
     "require": {
-        "php": "~7.4.0||~8.1.0||~8.2.0",
+        "php": "~8.1.0||~8.2.0",
         "ext-json": "*",
         "magento/framework": ">=103.0.5",
-        "magento/module-adobe-commerce-events-client": "^1.0"
+        "magento/module-adobe-commerce-events-client": "^1.1"
     },
     "autoload": {
         "files": [
@@ -29,7 +29,8 @@
         "phpmd/phpmd": "^2.12.0",
         "phpstan/phpstan": "^1.6.8",
         "phpunit/phpunit": "~9.5.20",
-        "squizlabs/php_codesniffer": "~3.6.0"
+        "squizlabs/php_codesniffer": "~3.6.0",
+        "magento/magento-coding-standard": "*"
     },
     "scripts": {
         "test:all": [
@@ -38,7 +39,11 @@
             "@test:phpmd",
             "@test:unit"
         ],
-        "test:phpcs": "phpcs Console/ Generator/ Test/ --standard=Test/static/ruleset/phpcs.xml -p -n",
+        "test:phpcs": [
+            "phpcs --config-set installed_paths vendor/phpcompatibility/php-compatibility/PHPCompatibility",
+            "phpcs * --standard=vendor/magento/magento-coding-standard/Magento2 --ignore=vendor,*.phtml",
+            "phpcs * --standard=vendor/magento/magento-coding-standard/Magento2Framework --ignore=vendor,*.phtml"
+        ],
         "test:phpmd": "phpmd Console,Generator xml Test/static/ruleset/phpmd.xml",
         "test:phpstan": "phpstan analyse -c Test/static/phpstan.neon",
         "test:unit": "phpunit --configuration Test/Unit/phpunit.xml.dist"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModule/Generator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModule/Generator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModule/Generator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModule/Generator.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,8 +7,9 @@

 namespace Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModule;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
 use Magento\AdobeCommerceEventsClient\Event\Validator\ValidatorException;
 use Magento\AdobeCommerceEventsGenerator\Generator\Collector\ApiServiceCollector;
@@ -19,6 +20,7 @@
 use Magento\AdobeCommerceEventsGenerator\Generator\ModuleGenerator;
 use Magento\AdobeCommerceEventsGenerator\Generator\PluginConverter;
 use Magento\Framework\ObjectManagerInterface;
+use Magento\Framework\Event\ManagerInterface;

 /**
  * Generates Adobe Commerce module with plugins for subscribed event codes
@@ -27,7 +29,7 @@
  */
 class Generator
 {
-    public const OBSERVER_EVENT_INTERFACE = "Magento\Framework\Event\ManagerInterface";
+    public const OBSERVER_EVENT_INTERFACE = ManagerInterface::class;
     public const OBSERVER_EVENT_METHOD = "dispatch";

     /**
@@ -66,9 +68,9 @@
     private ObjectManagerInterface $objectManager;

     /**
-     * @var EventCodeSupportedValidator
+     * @var EventCodeSupportedValidator|null
      */
-    private $eventCodeSupportedValidator;
+    private ?EventCodeSupportedValidator $eventCodeSupportedValidator = null;

     /**
      * @param EventList $eventList
@@ -77,6 +79,7 @@
      * @param ResourceModelCollector $resourceModelCollector
      * @param PluginConverter $pluginConverter
      * @param ModuleCollector $moduleCollector
+     * @param ObjectManagerInterface $objectManager
      */
     public function __construct(
         EventList $eventList,
@@ -97,8 +100,10 @@
     }

     /**
+     * Runs the module generating.
+     *
      * @param string $outputDir
-     * @throws \Exception
+     * @throws Exception
      */
     public function run(string $outputDir)
     {
@@ -115,7 +120,7 @@
                     continue;
                 }
                 $eventNameParts = explode('.', $eventName);
-                if ($eventNameParts[0] === EventSubscriber::EVENT_TYPE_PLUGIN) {
+                if ($eventNameParts[0] === EventSubscriberInterface::EVENT_TYPE_PLUGIN) {
                     if (strpos($eventName, 'resource_model') !== false) {
                         $resourceModels = array_merge_recursive(
                             $resourceModels,
@@ -127,14 +132,14 @@
                             $this->apiServiceCollector->collect($eventName)
                         );
                     }
-                } elseif ($eventNameParts[0] === EventSubscriber::EVENT_TYPE_OBSERVER) {
+                } elseif ($eventNameParts[0] === EventSubscriberInterface::EVENT_TYPE_OBSERVER) {
                     $observerEvents[$eventName] = $eventName;
                 } else {
                     $errors[] = sprintf(
                         'The specified event, has an invalid prefix: "%s". The prefix must be %s or %s.',
                         $eventNameParts[0],
-                        EventSubscriber::EVENT_TYPE_PLUGIN,
-                        EventSubscriber::EVENT_TYPE_OBSERVER
+                        EventSubscriberInterface::EVENT_TYPE_PLUGIN,
+                        EventSubscriberInterface::EVENT_TYPE_OBSERVER
                     );
                 }
                 $visitedEvents[] = $eventName;
@@ -144,7 +149,7 @@
         }

         if (!empty($errors)) {
-            throw new \Exception(
+            throw new Exception(
                 'Can not execute generation for some event codes:' . PHP_EOL . implode(PHP_EOL, $errors)
             );
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModuleCommand.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModuleCommand.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModuleCommand.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/Command/GenerateModuleCommand.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,6 +7,7 @@

 namespace Magento\AdobeCommerceEventsGenerator\Console\Command;

+use Exception;
 use Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModule\Generator;
 use Magento\Framework\App\Filesystem\DirectoryList;
 use Magento\Framework\Console\Cli;
@@ -58,13 +59,15 @@
     }

     /**
+     * Runs the module generating.
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
      * @return int
      *
      * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      */
-    protected function execute(InputInterface $input, OutputInterface $output)
+    protected function execute(InputInterface $input, OutputInterface $output): int
     {
         try {
             $appCodeDirectory = $this->directoryList->getPath(DirectoryList::APP) . '/code';
@@ -74,7 +77,7 @@
             $output->writeln('Module was generated in the app/code/Magento directory');

             return Cli::RETURN_SUCCESS;
-        } catch (\Exception $e) {
+        } catch (Exception $e) {
             $output->writeln($e->getMessage());

             return Cli::RETURN_FAILURE;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/CommandList.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/CommandList.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Console/CommandList.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Console/CommandList.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,22 +7,23 @@

 namespace Magento\AdobeCommerceEventsGenerator\Console;

+use Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModuleCommand;
+use Magento\Framework\Console\CommandListInterface;
+use Magento\Framework\Exception\LocalizedException;
 use Magento\Framework\ObjectManagerInterface;

 /**
  * Provides list of commands to be available for uninstalled application
  */
-class CommandList implements \Magento\Framework\Console\CommandListInterface
+class CommandList implements CommandListInterface
 {
     /**
-     * Object Manager
-     *
      * @var ObjectManagerInterface
      */
-    private $objectManager;
+    private ObjectManagerInterface $objectManager;

     /**
-     * @param ObjectManagerInterface $objectManager Object Manager
+     * @param ObjectManagerInterface $objectManager
      */
     public function __construct(ObjectManagerInterface $objectManager)
     {
@@ -34,24 +35,26 @@
      *
      * @return string[]
      */
-    private function getCommandsClasses()
+    private function getCommandsClasses(): array
     {
         return [
-            \Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModuleCommand::class,
+            GenerateModuleCommand::class,
         ];
     }

     /**
-     * @inheritdoc
+     * @inheritDoc
+     *
+     * @throws LocalizedException
      */
-    public function getCommands()
+    public function getCommands(): array
     {
         $commands = [];
         foreach ($this->getCommandsClasses() as $class) {
             if (class_exists($class)) {
                 $commands[] = $this->objectManager->get($class);
             } else {
-                throw new \Exception('Class ' . $class . ' does not exist');
+                throw new LocalizedException(__('Class ' . $class . ' does not exist'));
             }
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ApiServiceCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ApiServiceCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ApiServiceCollector.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ApiServiceCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -14,7 +14,7 @@
 use ReflectionException;

 /**
- * Collects Api interfaces from Magento modules
+ * Collects Api interface plugin information by event code.
  */
 class ApiServiceCollector implements CollectorInterface
 {
@@ -49,6 +49,8 @@
     }

     /**
+     * Collects Api interface plugin information by event code.
+     *
      * @param string $eventCode
      * @return array
      * @throws CollectorException
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/CollectorException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/CollectorException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/CollectorException.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/CollectorException.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,9 +7,11 @@

 namespace Magento\AdobeCommerceEventsGenerator\Generator\Collector;

+use Exception;
+
 /**
  * Collectors exception
  */
-class CollectorException extends \Exception
+class CollectorException extends Exception
 {
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ModuleCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ModuleCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ModuleCollector.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ModuleCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -10,9 +10,10 @@
 use Magento\Framework\Exception\FileSystemException;
 use Magento\Framework\Filesystem\Driver\File;
 use ReflectionClass;
+use Throwable;

 /**
- * Collects and store modules for registered plugins
+ * Collects and store module for the provided classes.
  */
 class ModuleCollector
 {
@@ -37,6 +38,8 @@
     private array $modules = [];

     /**
+     * Collects and store module for the provided class.
+     *
      * @param ReflectionClass $class
      * @return void
      */
@@ -75,6 +78,8 @@
     }

     /**
+     * Returns list of collected modules.
+     *
      * @return array
      */
     public function getModules(): array
@@ -84,7 +89,8 @@

     /**
      * Parses module name from `etc/module.xml` file.
-     * In case of error returns an empty string
+     *
+     * In case of error returns an empty string.
      *
      * @param string $moduleXmlPath
      * @return string
@@ -95,7 +101,7 @@
             $moduleXmlContent = simplexml_load_string($this->file->fileGetContents($moduleXmlPath));

             return (string)$moduleXmlContent->module->attributes()->name ?: '';
-        } catch (\Throwable $e) {
+        } catch (Throwable $e) {
             return '';
         }
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/Reflection/MethodParametersCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/Reflection/MethodParametersCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/Reflection/MethodParametersCollector.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/Reflection/MethodParametersCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -45,7 +45,7 @@
     /**
      * Convert default value to appropriate string format
      *
-     * @param $defaultValue
+     * @param mixed $defaultValue
      * @return string
      */
     private function formatDefaultValue($defaultValue): string
@@ -58,7 +58,7 @@
             return '[' . implode(', ', $defaultValue) . ']';
         }

-        if (is_null($defaultValue)) {
+        if ($defaultValue === null) {
             return 'null';
         }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ResourceModelCollector.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ResourceModelCollector.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ResourceModelCollector.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Collector/ResourceModelCollector.php	2023-05-25 20:23:12.000000000 +0100
@@ -14,7 +14,7 @@
 use ReflectionException;

 /**
- * Collects Resource models classes from Magento modules
+ * Collects resource model plugin information by event code.
  */
 class ResourceModelCollector implements CollectorInterface
 {
@@ -49,6 +49,8 @@
     }

     /**
+     * Collects resource model plugin information by event code.
+     *
      * @param string $eventCode
      * @return array
      * @throws CollectorException
@@ -79,7 +81,6 @@
             ));
         }

-
         $this->moduleCollector->collect($resourceModelReflection);

         return [
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleBlock.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleBlock.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleBlock.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleBlock.php	2023-05-25 20:23:12.000000000 +0100
@@ -38,9 +38,9 @@
     }

     /**
-     * @return string
+     * @inheritDoc
      */
-    public function toHtml()
+    public function toHtml(): string
     {
         return '';
     }
@@ -76,6 +76,8 @@
     }

     /**
+     * Returns Module object.
+     *
      * @return Module
      */
     public function getModule(): Module
@@ -84,6 +86,8 @@
     }

     /**
+     * Renders list of parameters for the given method.
+     *
      * @param array $method
      * @return string
      */
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleGenerator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleGenerator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleGenerator.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/ModuleGenerator.php	2023-05-25 20:23:12.000000000 +0100
@@ -151,6 +151,7 @@
      * @param array $dependencies
      * @param string|null $version
      * @return void
+     * @throws FileSystemException
      */
     private function generateComposer(
         string $vendor,
@@ -205,6 +206,7 @@
      *
      * @param ModuleBlock $moduleBlock
      * @return void
+     * @throws FileSystemException
      */
     private function generatePlugins(ModuleBlock $moduleBlock): void
     {
@@ -228,6 +230,7 @@
      *
      * @param ModuleBlock $moduleBlock
      * @return void
+     * @throws FileSystemException
      */
     private function generateObserverEventPlugin(ModuleBlock $moduleBlock): void
     {
@@ -250,6 +253,7 @@
      *
      * @param ModuleBlock $moduleBlock
      * @return void
+     * @throws FileSystemException
      */
     private function generatePluginList(ModuleBlock $moduleBlock): void
     {
@@ -269,6 +273,7 @@
      *
      * @param ModuleBlock $moduleBlock
      * @return void
+     * @throws FileSystemException
      */
     private function generateObserverList(ModuleBlock $moduleBlock): void
     {
@@ -288,6 +293,8 @@
     }

     /**
+     * Sets output directory where the module will be generated.
+     *
      * @param string $outputDir
      * @return void
      */
@@ -319,10 +326,11 @@
      * @param string $path
      * @param string $content
      * @return void
+     * @throws FileSystemException
      */
     private function createFile(string $path, string $content): void
     {
-        $dir = dirname($path);
+        $dir = $this->file->getParentDirectory($path);

         $this->file->createDirectory($dir);

@@ -339,6 +347,7 @@
      * @param string $filePath
      * @param array $dictionary
      * @return void
+     * @throws FileSystemException
      */
     private function createFileFromTemplate(
         BlockInterface $block,
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Module.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Module.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/Module.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/Module.php	2023-05-25 20:23:12.000000000 +0100
@@ -53,6 +53,8 @@
     }

     /**
+     * Sets list of plugins.
+     *
      * @param array $plugins
      * @return void
      */
@@ -62,6 +64,8 @@
     }

     /**
+     * Sets observer event plugin.
+     *
      * @param array $observerEventPlugin
      * @return void
      */
@@ -71,6 +75,8 @@
     }

     /**
+     * Returns module name.
+     *
      * @return string
      */
     public function getName(): string
@@ -79,6 +85,8 @@
     }

     /**
+     * Returns module vendor.
+     *
      * @return string
      */
     public function getVendor(): string
@@ -87,6 +95,8 @@
     }

     /**
+     * Returns list of plugins.
+     *
      * @return array
      */
     public function getPlugins(): array
@@ -95,6 +105,8 @@
     }

     /**
+     * Returns observer event plugin.
+     *
      * @return array
      */
     public function getObserverEventPlugin(): array
@@ -103,6 +115,8 @@
     }

     /**
+     * Sets list of observer events.
+     *
      * @param array $observerEvents
      * @return void
      */
@@ -122,6 +136,8 @@
     }

     /**
+     * Sets list of dependencies.
+     *
      * @param array $dependencies
      * @return void
      */
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/PluginConverter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/PluginConverter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Generator/PluginConverter.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Generator/PluginConverter.php	2023-05-25 20:23:12.000000000 +0100
@@ -114,6 +114,7 @@

     /**
      * Convert camel case to lowercase with underscores.
+     *
      * CamelCaseFormat => camel_case_format
      *
      * @param string $string
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/observerEventPlugin.phtml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/observerEventPlugin.phtml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/observerEventPlugin.phtml	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/observerEventPlugin.phtml	2023-05-25 20:23:12.000000000 +0100
@@ -16,7 +16,7 @@
 use Magento\AdobeCommerceEventsClient\Event\Converter\EventDataConverter;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\Framework\Event\ManagerInterface;
 use Psr\Log\LoggerInterface;

@@ -79,8 +79,8 @@
     {
         try {
             if ($eventName != $this->ignoredEvent) {
-                $eventCode = EventSubscriber::EVENT_PREFIX_COMMERCE .
-                    EventSubscriber::EVENT_TYPE_OBSERVER . '.' . $eventName;
+                $eventCode = EventSubscriberInterface::EVENT_PREFIX_COMMERCE .
+                    EventSubscriberInterface::EVENT_TYPE_OBSERVER . '.' . $eventName;

                 if ($this->eventList->isEventEnabled($eventCode)) {
                     $this->storageWriter->createEvent($eventCode, $this->eventDataConverter->convert($data));
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/pluginApiInterface.phtml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/pluginApiInterface.phtml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/pluginApiInterface.phtml	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/pluginApiInterface.phtml	2023-05-25 20:23:12.000000000 +0100
@@ -19,7 +19,7 @@
 use Magento\AdobeCommerceEventsClient\Event\Converter\EventDataConverter;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Psr\Log\LoggerInterface;
 use Magento\Framework\Webapi\ServiceOutputProcessor;
 use <?=$interface ?>;
@@ -92,8 +92,8 @@
     public function after<?=$method['name'] ?>(<?=$interfaceShort ?> $subject, $result<?=$block->renderParametersForMethod($method); ?>)
     {
         try {
-            $eventCode = EventSubscriber::EVENT_PREFIX_COMMERCE .
-                EventSubscriber::EVENT_TYPE_PLUGIN . '.<?=$method['eventCode'] ?>';
+            $eventCode = EventSubscriberInterface::EVENT_PREFIX_COMMERCE .
+                EventSubscriberInterface::EVENT_TYPE_PLUGIN . '.<?=$method['eventCode'] ?>';

             if (!$this->eventList->isEventEnabled($eventCode)) {
                 return $result;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/pluginResourceModel.phtml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/pluginResourceModel.phtml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/templates/pluginResourceModel.phtml	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/templates/pluginResourceModel.phtml	2023-05-25 20:23:12.000000000 +0100
@@ -19,7 +19,7 @@
 use Magento\AdobeCommerceEventsClient\Event\Converter\EventDataConverter;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
 use Magento\AdobeCommerceEventsClient\Event\EventStorageWriter;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use <?=$interface ?>;
 use Psr\Log\LoggerInterface;

@@ -81,7 +81,7 @@
     public function after<?=$method['name'] ?>(<?=$interfaceShort ?> $subject, $result<?=$block->renderParametersForMethod($method); ?>)
     {
         try {
-            $eventCode = EventSubscriber::EVENT_PREFIX_COMMERCE . EventSubscriber::EVENT_TYPE_PLUGIN
+            $eventCode = EventSubscriberInterface::EVENT_PREFIX_COMMERCE . EventSubscriberInterface::EVENT_TYPE_PLUGIN
                 . '.<?=$method['eventCode'] ?>';
             $data = [
 <?php foreach ($method['params'] as $param): ?>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/Integration/Generator/GenerateModuleCommandTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/Integration/Generator/GenerateModuleCommandTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/Integration/Generator/GenerateModuleCommandTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/Integration/Generator/GenerateModuleCommandTest.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,238 +0,0 @@
-<?php
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
-declare(strict_types=1);
-
-namespace Magento\AdobeCommerceEventsGenerator\Test\Integration\Generator;
-
-use Magento\AdobeCommerceEventsClient\Event\Event;
-use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
-use Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModule\Generator;
-use Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModuleCommand;
-use Magento\Framework\App\Filesystem\DirectoryList;
-use Magento\Framework\ObjectManagerInterface;
-use Magento\TestFramework\Helper\Bootstrap;
-use PHPUnit\Framework\MockObject\MockObject;
-use PHPUnit\Framework\TestCase;
-use Symfony\Component\Console\Tester\CommandTester;
-use Symfony\Component\Filesystem\Filesystem;
-
-/**
- * Checks that GenerateModuleCommand command generates plugins based on the event list
- */
-class GenerateModuleCommandTest extends TestCase
-{
-    /**
-     * @var string
-     */
-    private $outputDir;
-
-    /**
-     * @var Filesystem
-     */
-    private $filesystem;
-
-    /**
-     * @var ObjectManagerInterface
-     */
-    private $objectManager;
-
-    /**
-     * @var EventList|MockObject
-     */
-    private $eventListMock;
-
-    /**
-     * @var EventCodeSupportedValidator|MockObject
-     */
-    private $validatorMock;
-
-    /**
-     * @var DirectoryList|MockObject
-     */
-    private $directoryListMock;
-
-    /**
-     * @inheritDoc
-     */
-    protected function setUp(): void
-    {
-        $this->outputDir = __DIR__ . '/../../_generated';
-        $this->filesystem = new Filesystem();
-        $this->filesystem->mkdir($this->outputDir);
-
-        $this->objectManager = Bootstrap::getObjectManager();
-        $this->directoryListMock = $this->createMock(DirectoryList::class);
-        $this->eventListMock = $this->createPartialMock(EventList::class, ['getAll']);
-        $this->validatorMock = $this->createMock(EventCodeSupportedValidator::class);
-        $this->directoryListMock->expects(self::once())
-            ->method('getPath')
-            ->willReturn($this->outputDir);
-    }
-
-    /**
-     * @inheritDoc
-     */
-    protected function tearDown(): void
-    {
-        $this->filesystem->remove($this->outputDir);
-    }
-
-    /**
-     * Checks that command returns an error when event is not in the list of supported events
-     *
-     * @return void
-     * @throws \Exception
-     */
-    public function testGeneratePluginEventIsNotSupported(): void
-    {
-        $this->eventListMock->expects(self::once())
-            ->method('getAll')
-            ->willReturn([
-                new Event('plugin.magento.catalog.model.resource_model.product.validate'),
-                new Event('observer.magento.catalog.model.resource_model.product.validate'),
-            ]);
-
-        $commandTester = new CommandTester($this->getGenerateCommand(false));
-        $commandTester->execute([]);
-
-        self::assertNotEquals(0, $commandTester->getStatusCode());
-        self::assertStringContainsString(
-            'Event "plugin.magento.catalog.model.resource_model.product.validate"' .
-            ' is not defined in the list of supported events',
-            $commandTester->getDisplay()
-        );
-    }
-
-    /**
-     * Checks that command returns an error when class for event code can not be found
-     *
-     * @return void
-     * @throws \Exception
-     */
-    public function testGeneratePluginResourceModelClassNotExists(): void
-    {
-        $this->eventListMock->expects(self::once())
-            ->method('getAll')
-            ->willReturn([
-                new Event('plugin.magento.theme.model.resource_model.class_not_exist.save'),
-            ]);
-
-        $commandTester = new CommandTester($this->getGenerateCommand());
-        $commandTester->execute([]);
-
-        self::assertNotEquals(0, $commandTester->getStatusCode());
-        self::assertStringContainsString(
-            'Event "plugin.magento.theme.model.resource_model.class_not_exist.save" is not defined',
-            $commandTester->getDisplay()
-        );
-    }
-
-    /**
-     * Checks that command returns an error when api interface for event code can not be found
-     *
-     * @return void
-     * @throws \Exception
-     */
-    public function testGeneratePluginApiInterfaceNotExists(): void
-    {
-        $this->eventListMock->expects(self::once())
-            ->method('getAll')
-            ->willReturn([
-                new Event('plugin.magento.theme.api.interface_not_exists.save'),
-            ]);
-
-        $commandTester = new CommandTester($this->getGenerateCommand());
-        $commandTester->execute([]);
-
-        self::assertNotEquals(0, $commandTester->getStatusCode());
-        self::assertStringContainsString(
-            'Event "plugin.magento.theme.api.interface_not_exists.save" is not defined',
-            $commandTester->getDisplay()
-        );
-    }
-
-    /**
-     * Checks module generation
-     *
-     * @return void
-     * @throws \Exception
-     */
-    public function testGenerate(): void
-    {
-        $this->eventListMock->expects(self::once())
-            ->method('getAll')
-            ->willReturn([
-                new Event('plugin.magento.customer.api.customer_repository.save'),
-                new Event('plugin.magento.customer.model.resource_model.group.save'),
-                new Event('plugin.magento.user.model.resource_model.user.save'),
-                new Event('observer.catalog_product_save_after'),
-            ]);
-
-        $commandTester = new CommandTester($this->getGenerateCommand(false));
-        $commandTester->execute([]);
-
-        self::assertEquals(0, $commandTester->getStatusCode());
-
-        $moduleBaseDir = $this->outputDir . '/code/Magento/AdobeCommerceEvents';
-        $this->moduleRunBaseAssertions($moduleBaseDir);
-
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/Plugin/Customer/Api'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/Plugin/Customer/ResourceModel'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/Plugin/User/ResourceModel'));
-        self::assertEquals(4, substr_count(file_get_contents($moduleBaseDir . '/etc/di.xml'), '<plugin'));
-
-        $pluginEventCodeList = file_get_contents($moduleBaseDir . '/EventCode/Plugin.php');
-
-        self::assertEquals(3, substr_count($pluginEventCodeList, "' => '"));
-        self::assertStringContainsString('magento.customer.api.customer_repository.save', $pluginEventCodeList);
-        self::assertStringContainsString('magento.customer.model.resource_model.group.save', $pluginEventCodeList);
-        self::assertStringContainsString('magento.user.model.resource_model.user.save', $pluginEventCodeList);
-    }
-
-    /**
-     * Runs list of assertions to check that module was generated correctly
-     *
-     * @param string $moduleBaseDir
-     * @return void
-     */
-    private function moduleRunBaseAssertions(string $moduleBaseDir): void
-    {
-        self::assertTrue($this->filesystem->exists($moduleBaseDir));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/Plugin'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/Plugin/Framework'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/etc/di.xml'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/etc/module.xml'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/composer.json'));
-
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/EventCode/Plugin.php'));
-        self::assertTrue($this->filesystem->exists($moduleBaseDir . '/EventCode/Observer.php'));
-
-        $observerEventCodeList = file_get_contents($moduleBaseDir . '/EventCode/Observer.php');
-        self::assertStringContainsString('observer.catalog_product_save_after', $observerEventCodeList);
-    }
-
-    /**
-     * Returns generate command
-     *
-     * @param bool $mockValidator
-     * @return GenerateModuleCommand
-     */
-    private function getGenerateCommand(bool $mockValidator = true): GenerateModuleCommand
-    {
-        $arguments = ['eventList' => $this->eventListMock];
-        if ($mockValidator) {
-            $arguments['eventCodeSupportedValidator'] = $this->validatorMock;
-        }
-
-        $generator = $this->objectManager->create(Generator::class, $arguments);
-
-        return $this->objectManager->create(GenerateModuleCommand::class, [
-            'generator' => $generator,
-            'directoryList' => $this->directoryListMock
-        ]);
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/static/ruleset/phpcs.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/static/ruleset/phpcs.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/static/ruleset/phpcs.xml	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/static/ruleset/phpcs.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,27 +0,0 @@
-<?xml version="1.0"?>
-<!--
-/**
- * Copyright © Magento, Inc. All rights reserved.
- * See COPYING.txt for license details.
- */
--->
-<ruleset name="Magento">
-    <rule ref="PSR2"/>
-
-    <rule ref="Generic.Functions.CallTimePassByReference"/>
-    <rule ref="Generic.PHP.DeprecatedFunctions"/>
-    <rule ref="Generic.Files.LineLength">
-        <properties>
-            <property name="lineLimit" value="100"/>
-            <property name="absoluteLineLimit" value="120"/>
-        </properties>
-    </rule>
-
-    <rule ref="Squiz.Commenting.DocCommentAlignment"/>
-    <rule ref="Squiz.Functions.GlobalFunction"/>
-    <rule ref="Squiz.WhiteSpace.LogicalOperatorSpacing"/>
-    <rule ref="Squiz.Commenting.VariableComment" />
-    <rule ref="Squiz.Commenting.ClassComment">
-        <exclude-pattern>Test</exclude-pattern>
-    </rule>
-</ruleset>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/Unit/Console/Command/GenerateModule/GeneratorTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/Unit/Console/Command/GenerateModule/GeneratorTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-commerce-events-generator/Test/Unit/Console/Command/GenerateModule/GeneratorTest.php	2023-05-30 09:55:07.584891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-commerce-events-generator/Test/Unit/Console/Command/GenerateModule/GeneratorTest.php	2023-05-25 20:23:12.000000000 +0100
@@ -7,9 +7,10 @@

 namespace Magento\AdobeCommerceEventsGenerator\Test\Unit\Console\Command\GenerateModule;

+use Exception;
 use Magento\AdobeCommerceEventsClient\Event\Event;
 use Magento\AdobeCommerceEventsClient\Event\EventList;
-use Magento\AdobeCommerceEventsClient\Event\EventSubscriber;
+use Magento\AdobeCommerceEventsClient\Event\EventSubscriberInterface;
 use Magento\AdobeCommerceEventsClient\Event\Validator\EventCode\EventCodeSupportedValidator;
 use Magento\AdobeCommerceEventsGenerator\Console\Command\GenerateModule\Generator;
 use Magento\AdobeCommerceEventsGenerator\Generator\Collector\ApiServiceCollector;
@@ -130,21 +131,21 @@
         $resourceModelEventMock = $this->createMock(Event::class);
         $resourceModelEventMock->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . $resourceModelEventName);
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $resourceModelEventName);
         $apiEventMock = $this->createMock(Event::class);
         $apiEventMock->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . $apiEventName);
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $apiEventName);
         $observerEventMock = $this->createMock(Event::class);
         $observerEventMock->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . $observerEventName);
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $observerEventName);
         $this->eventListMock->expects(self::exactly(3))
             ->method('removeCommercePrefix')
             ->withConsecutive(
-                [EventSubscriber::EVENT_PREFIX_COMMERCE . $resourceModelEventName],
-                [EventSubscriber::EVENT_PREFIX_COMMERCE . $apiEventName],
-                [EventSubscriber::EVENT_PREFIX_COMMERCE . $observerEventName],
+                [EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $resourceModelEventName],
+                [EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $apiEventName],
+                [EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $observerEventName],
             )
             ->willReturnOnConsecutiveCalls(
                 $resourceModelEventName,
@@ -231,18 +232,18 @@
             ->method('getName');
         $eventMockOne->expects(self::once())
             ->method('getParent')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . $parentEventName);
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $parentEventName);
         $eventMockTwo = $this->createMock(Event::class);
         $eventMockTwo->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . $parentEventName);
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $parentEventName);
         $eventMockTwo->expects(self::once())
             ->method('getParent')
             ->willReturn(null);

         $this->eventListMock->expects(self::exactly(2))
             ->method('removeCommercePrefix')
-            ->with(EventSubscriber::EVENT_PREFIX_COMMERCE . $parentEventName)
+            ->with(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . $parentEventName)
             ->willReturn($parentEventName);
         $this->eventCodeSupportedValidatorMock->expects(self::exactly(2))
             ->method('validate')
@@ -273,16 +274,16 @@
      */
     public function testRunInvalidEventCode(): void
     {
-        $this->expectException(\Exception::class);
+        $this->expectException(Exception::class);
         $this->expectExceptionMessage('The specified event, has an invalid prefix: "unknown"');

         $eventMock = $this->createMock(Event::class);
         $eventMock->expects(self::once())
             ->method('getName')
-            ->willReturn(EventSubscriber::EVENT_PREFIX_COMMERCE . 'unknown.event');
+            ->willReturn(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . 'unknown.event');
         $this->eventListMock->expects(self::once())
             ->method('removeCommercePrefix')
-            ->with(EventSubscriber::EVENT_PREFIX_COMMERCE . 'unknown.event')
+            ->with(EventSubscriberInterface::EVENT_PREFIX_COMMERCE . 'unknown.event')
             ->willReturn('unknown.event');
         $this->eventListMock->expects(self::once())
             ->method('getAll')
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/AccessTokenProviderInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/AccessTokenProviderInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/AccessTokenProviderInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/AccessTokenProviderInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,10 +1,21 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

 use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
 use Magento\Framework\Exception\AuthorizationException;

+/**
+ * Get access token from JWT
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface AccessTokenProviderInterface
 {
     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,11 +1,24 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

+/**
+ * Configuration validator
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface ConfigurationCheckInterface
 {
     /**
+     * Checks configuration and returns success/failure results for each component
+     *
      * @return \Magento\AdobeIoEventsClient\Api\ConfigurationCheckResultInterface
      */
-    public function checkConfiguration(): ConfigurationCheckResultInterface;
+    public function checkConfiguration(): \Magento\AdobeIoEventsClient\Api\ConfigurationCheckResultInterface;
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckResultInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckResultInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckResultInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/ConfigurationCheckResultInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,36 +1,57 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

+/**
+ * Contains configuration status for each necessary config setting
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface ConfigurationCheckResultInterface
 {
-    const STATUS = 'status';
-    const TECHNICAL_SERVICE_ACCOUNT_CONFIGURED = 'technical_service_account_configured';
-    const TECHNICAL_SERVICE_ACCOUNT_CAN_CONNECT = 'technical_service_account_can_connect';
-    const PROVIDER_ID_CONFIGURED = 'provider_id_configured';
-    const PROVIDER_ID_VALID = 'provider_id_valid';
+    public const STATUS = 'status';
+    public const TECHNICAL_SERVICE_ACCOUNT_CONFIGURED = 'technical_service_account_configured';
+    public const TECHNICAL_SERVICE_ACCOUNT_CAN_CONNECT = 'technical_service_account_can_connect';
+    public const PROVIDER_ID_CONFIGURED = 'provider_id_configured';
+    public const PROVIDER_ID_VALID = 'provider_id_valid';

     /**
+     * Overall ok/error status of the configuration
+     *
      * @return string
      */
     public function getStatus(): string;

     /**
+     * Whether the technical service account is configured
+     *
      * @return bool
      */
     public function getTechnicalServiceAccountConfigured(): bool;

     /**
+     * Whether providers are configured to allow the service account to connect
+     *
      * @return bool
      */
     public function getTechnicalServiceAccountCanConnectToIoEvents(): bool;

     /**
+     * Get the provider id if configured
+     *
      * @return string
      */
     public function getProviderIdConfigured(): string;

     /**
+     * Whether a configured provider id is valid
+     *
      * @return bool
      */
     public function getProviderIdValid(): bool;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventMetadataInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventMetadataInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventMetadataInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventMetadataInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,27 +1,44 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

+/**
+ * Contains basic metadata about an event
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface EventMetadataInterface
 {
     /**
+     * Serialize the metadata
+     *
      * @return string[]
      */
     public function jsonSerialize(): array;

     /**
+     * Return Event Code
+     *
      * @return string
      */
     public function getEventCode(): string;

-
     /**
+     * Return Description
+     *
      * @return string
      */
     public function getDescription(): string;

-
     /**
+     * Return Label
+     *
      * @return string
      */
     public function getLabel(): string;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventMetadataRegistryInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventMetadataRegistryInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventMetadataRegistryInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventMetadataRegistryInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,15 +1,30 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

+/**
+ * Provides access to the metadata configuration
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface EventMetadataRegistryInterface
 {
     /**
+     * Return set of configured metadata
+     *
      * @return EventMetadataInterface[]
      */
     public function getDeclaredEventMetadataList(): array;

     /**
+     * Return the configured provider
+     *
      * @return EventProviderInterface
      */
     public function getDeclaredEventProvider(): EventProviderInterface;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventProviderInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventProviderInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Api/EventProviderInterface.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Api/EventProviderInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,30 +1,51 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Api;

+/**
+ * Interface for the event provider data object
+ *
+ * @api
+ * @since 1.1.0
+ */
 interface EventProviderInterface
 {
     /**
+     * Return ID
+     *
      * @return string
      */
     public function getId(): string;

     /**
+     * Return Label
+     *
      * @return string
      */
     public function getLabel(): string;

     /**
+     * Return Description
+     *
      * @return string
      */
     public function getDescription(): string;

     /**
+     * Return Source
+     *
      * @return string
      */
     public function getSource(): string;

     /**
+     * Return Publisher
+     *
      * @return string
      */
     public function getPublisher(): string;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Block/Adminhtml/System/Config/Fieldset/AuthorizationTypeSwitch.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Block/Adminhtml/System/Config/Fieldset/AuthorizationTypeSwitch.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Block/Adminhtml/System/Config/Fieldset/AuthorizationTypeSwitch.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Block/Adminhtml/System/Config/Fieldset/AuthorizationTypeSwitch.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,35 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Block\Adminhtml\System\Config\Fieldset;
+
+use Magento\Config\Block\System\Config\Form\Fieldset;
+
+/**
+ * Adds a javascript for clearing workspace configuration field when authorization type is changed.
+ */
+class AuthorizationTypeSwitch extends Fieldset
+{
+    /**
+     * @inheritDoc
+     */
+    protected function _getExtraJs($element)
+    {
+        $comment = '<p class="note"><span>Update configuration with new authorization value found in ' .
+            '&lt;workspace-name&gt;.json file.</span></p>';
+        $id = $element->getId();
+        $script = "require(['jquery'], function($){
+            $('#{$id}_authorization_type').on('change', function() {
+                  $('#{$id}_workspace_configuration').val('');
+                  $('#{$id}_workspace_configuration').parent().find('p.note').remove();
+                  $('#{$id}_workspace_configuration').parent().append('{$comment}')
+            });
+        });";
+
+        return $this->_jsHelper->getScript($script);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/composer.json	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/composer.json	2023-05-25 20:23:48.000000000 +0100
@@ -6,14 +6,13 @@
         "OSL-3.0",
         "AFL-3.0"
     ],
-    "version": "1.0.0",
+    "version": "1.2.0",
     "require": {
-        "php": "~7.4.0||~8.1.0||~8.2.0",
+        "php": "~8.1.0||~8.2.0",
         "magento/framework": ">=103.0.5",
         "magento/module-config": ">=101.2.5",
         "magento/module-store": ">=101.1.5",
         "magento/module-jwt-framework-adapter": ">=100.4.1",
-        "magento/module-adobe-ims": "^2.1.0",
         "magento/module-adobe-ims-api": "^2.1.0"
     },
     "autoload": {
@@ -25,7 +24,8 @@
         }
     },
     "conflict": {
-        "magento/module-adobe-io-events": "*"
+        "magento/module-adobe-io-events": "*",
+        "magento/module-adobe-commerce-events-client": "<=1.0.1"
     }
 }

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Console/CreateEventProvider.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Console/CreateEventProvider.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Console/CreateEventProvider.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Console/CreateEventProvider.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,4 +1,9 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Console;

@@ -6,12 +11,7 @@
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
 use Magento\AdobeIoEventsClient\Model\Data\EventProviderFactory;
 use Magento\AdobeIoEventsClient\Model\EventMetadataRegistry;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
-use Magento\Framework\Console\Cli;
-use Magento\Framework\Exception\AlreadyExistsException;
-use Magento\Framework\Exception\AuthenticationException;
-use Magento\Framework\Exception\AuthorizationException;
-use Magento\Framework\Exception\InputException;
+use Magento\AdobeIoEventsClient\Model\EventProviderClient;
 use Magento\Framework\Exception\LocalizedException;
 use Magento\Framework\Exception\NotFoundException;
 use Symfony\Component\Console\Command\Command;
@@ -19,6 +19,9 @@
 use Symfony\Component\Console\Input\InputOption;
 use Symfony\Component\Console\Output\OutputInterface;

+/**
+ * CLI command to create an event provider
+ */
 class CreateEventProvider extends Command
 {
     public const COMMAND_NAME = 'events:create-event-provider';
@@ -26,6 +29,9 @@
     public const OPTION_PROVIDER_LABEL = 'label';
     public const OPTION_PROVIDER_DESCRIPTION = 'description';

+    private const RETURN_SUCCESS = 0;
+    private const RETURN_FAILURE = 1;
+
     /**
      * @var AdobeIOConfigurationProvider
      */
@@ -37,9 +43,9 @@
     private EventMetadataRegistry $eventMetadataRegistry;

     /**
-     * @var IOEventsAPIClient
+     * @var EventProviderClient
      */
-    private IOEventsAPIClient $IOEventsAPIClient;
+    private EventProviderClient $eventProviderClient;

     /**
      * @var EventProviderFactory
@@ -49,23 +55,26 @@
     /**
      * @param AdobeIOConfigurationProvider $configurationProvider
      * @param EventMetadataRegistry $eventMetadataRegistry
-     * @param IOEventsAPIClient $IOEventsAPIClient
+     * @param EventProviderClient $eventProviderClient
      * @param EventProviderFactory $eventProviderFactory
      */
     public function __construct(
         AdobeIOConfigurationProvider $configurationProvider,
         EventMetadataRegistry $eventMetadataRegistry,
-        IOEventsAPIClient $IOEventsAPIClient,
+        EventProviderClient $eventProviderClient,
         EventProviderFactory $eventProviderFactory
     ) {
         $this->configurationProvider = $configurationProvider;
         $this->eventMetadataRegistry = $eventMetadataRegistry;
-        $this->IOEventsAPIClient = $IOEventsAPIClient;
+        $this->eventProviderClient = $eventProviderClient;
         $this->eventProviderFactory = $eventProviderFactory;

         parent::__construct();
     }

+    /**
+     * @inheritDoc
+     */
     protected function configure()
     {
         $this->setName(self::COMMAND_NAME);
@@ -92,45 +101,43 @@
     }

     /**
+     * @inheritDoc
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
-     * @return void|null
-     * @throws AlreadyExistsException
-     * @throws AuthorizationException
-     * @throws InputException
-     * @throws AuthenticationException
+     * @return int
      * @throws NotFoundException
      */
     protected function execute(InputInterface $input, OutputInterface $output)
     {
-        $provider = $this->configurationProvider->retrieveProvider();
+        $provider = $this->configurationProvider->getProvider();
         $instanceId = $this->configurationProvider->retrieveInstanceId();

         if ($provider !== null) {
             $output->writeln("Already found an event provider configured with ID " . $provider->getId());
-            return Cli::RETURN_FAILURE;
+            return self::RETURN_FAILURE;
         }

         $output->writeln("No event provider found, a new event provider will be created");

         try {
-            $provider = $this->IOEventsAPIClient->createEventProvider(
+            $provider = $this->eventProviderFactory->create(['data' => $this->eventProviderClient->createEventProvider(
                 $instanceId,
                 $this->getProvider($input)
-            );
+            )]);
         } catch (LocalizedException $exception) {
             $output->writeln(sprintf(
                 '<error>%s</error>',
                 $exception->getMessage()
             ));

-            return Cli::RETURN_FAILURE;
+            return self::RETURN_FAILURE;
         }

         $this->configurationProvider->saveProvider($provider);
         $output->writeln("A new event provider has been created with ID " . $provider->getId());

-        return Cli::RETURN_SUCCESS;
+        return self::RETURN_SUCCESS;
     }

     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Console/SynchronizeEventMetadata.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Console/SynchronizeEventMetadata.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Console/SynchronizeEventMetadata.php	2023-05-30 09:55:07.588891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Console/SynchronizeEventMetadata.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,21 +1,33 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Console;

 use Magento\AdobeIoEventsClient\Api\EventMetadataRegistryInterface;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
-use Magento\Framework\Console\Cli;
+use Magento\AdobeIoEventsClient\Model\EventMetadataClient;
 use Magento\Framework\Exception\AuthenticationException;
 use Magento\Framework\Exception\AuthorizationException;
 use Magento\Framework\Exception\InputException;
+use Magento\Framework\Exception\NotFoundException;
 use Symfony\Component\Console\Command\Command;
 use Symfony\Component\Console\Input\InputInterface;
 use Symfony\Component\Console\Input\InputOption;
 use Symfony\Component\Console\Output\OutputInterface;

+/**
+ * CLI command to synchronize event metadata
+ */
 class SynchronizeEventMetadata extends Command
 {
+    private const RETURN_SUCCESS = 0;
+    private const RETURN_FAILURE = 1;
+
     /**
      * @var EventMetadataRegistryInterface
      */
@@ -27,27 +39,30 @@
     private AdobeIOConfigurationProvider $configurationProvider;

     /**
-     * @var IOEventsAPIClient
+     * @var EventMetadataClient
      */
-    private IOEventsAPIClient $IOEventsAPIClient;
+    private EventMetadataClient $eventMetadataClient;

     /**
      * @param EventMetadataRegistryInterface $eventRegistry
      * @param AdobeIOConfigurationProvider $configurationProvider
-     * @param IOEventsAPIClient $IOEventsAPIClient
+     * @param EventMetadataClient $eventMetadataClient
      */
     public function __construct(
         EventMetadataRegistryInterface $eventRegistry,
         AdobeIOConfigurationProvider $configurationProvider,
-        IOEventsAPIClient $IOEventsAPIClient
+        EventMetadataClient $eventMetadataClient
     ) {
         $this->eventRegistry = $eventRegistry;
         $this->configurationProvider = $configurationProvider;
-        $this->IOEventsAPIClient = $IOEventsAPIClient;
+        $this->eventMetadataClient = $eventMetadataClient;

         parent::__construct();
     }

+    /**
+     * @inheritDoc
+     */
     protected function configure()
     {
         $this->setName("events:sync-events-metadata");
@@ -64,24 +79,28 @@
     }

     /**
+     * @inheritDoc
+     *
      * @param InputInterface $input
      * @param OutputInterface $output
-     * @return void
+     * @return int
      * @throws AuthorizationException
      * @throws AuthenticationException
      * @throws InputException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
      */
     protected function execute(InputInterface $input, OutputInterface $output)
     {
-        $provider = $this->configurationProvider->retrieveProvider();
-        if (is_null($provider)) {
+        $provider = $this->configurationProvider->getProvider();
+        if ($provider === null) {
             $output->writeln(
                 sprintf(
                     "<error>No event provider is configured, please run bin/magento %s</error>",
                     CreateEventProvider::COMMAND_NAME
                 )
             );
-            return Cli::RETURN_FAILURE;
+            return self::RETURN_FAILURE;
         }

         $output->writeln(
@@ -97,13 +116,13 @@
             $output->writeln("- $eventMetadata");
         }

-        $registeredEventMetadata = $this->IOEventsAPIClient->listRegisteredEventMetadata($provider);
+        $registeredEventMetadata = $this->eventMetadataClient->listRegisteredEventMetadata($provider);

         $eventTypeToDelete = array_diff($registeredEventMetadata, $declaredEventMetadata);

         $output->writeln("<info>Updating event types:</info>");
         foreach ($declaredEventMetadata as $eventType) {
-            $this->IOEventsAPIClient->createEventMetadata($provider, $eventType);
+            $this->eventMetadataClient->createEventMetadata($provider, $eventType);
             $output->writeln("- <info>[UPDATED]</info> $eventType");
         }

@@ -111,7 +130,7 @@
             if ($input->getOption("delete")) {
                 $output->writeln("<info>Delete the following event metedata:</info>");
                 foreach ($eventTypeToDelete as $eventType) {
-                    $deleted = $this->IOEventsAPIClient->deleteEventMetadata(
+                    $deleted = $this->eventMetadataClient->deleteEventMetadata(
                         $provider,
                         $eventType
                     );
@@ -131,6 +150,6 @@
             }
         }

-        return Cli::RETURN_SUCCESS;
+        return self::RETURN_SUCCESS;
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/dev/tests/static/testsuite/Magento/Test/Integrity/_files/blacklist/composer_root_modules_io_events_client.txt /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/dev/tests/static/testsuite/Magento/Test/Integrity/_files/blacklist/composer_root_modules_io_events_client.txt
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/dev/tests/static/testsuite/Magento/Test/Integrity/_files/blacklist/composer_root_modules_io_events_client.txt	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/dev/tests/static/testsuite/Magento/Test/Integrity/_files/blacklist/composer_root_modules_io_events_client.txt	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1 @@
+magento/module-adobe-io-events-client
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/adminhtml/system.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/adminhtml/system.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/adminhtml/system.xml	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/adminhtml/system.xml	2023-05-25 20:23:48.000000000 +0100
@@ -1,4 +1,10 @@
 <?xml version="1.0" ?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
 <config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Config:etc/system_file.xsd">
     <system>
         <tab id="adobe_services" translate="label" sortOrder="1000">
@@ -10,26 +16,36 @@
             <class>separator-top</class>
             <resource>Magento_AdobeIoEventsClient::config</resource>
             <group id="integration" translate="label" showInDefault="1" showInWebsite="0" showInStore="0">
+                <fieldset_css>active</fieldset_css>
                 <label>General configuration</label>
-                <field id="private_key" translate="label" type="obscure" showInDefault="1" showInWebsite="0" showInStore="0">
+                <frontend_model>Magento\AdobeIoEventsClient\Block\Adminhtml\System\Config\Fieldset\AuthorizationTypeSwitch</frontend_model>
+                <field id="authorization_type" translate="authorization type" type="select" sortOrder="10" showInDefault="1" showInWebsite="0" showInStore="0">
+                    <label>Adobe I/O Authorization Type</label>
+                    <comment>The selected type must match the server-to-server authentication type defined in your App Builder project.</comment>
+                    <source_model>Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType</source_model>
+                </field>
+                <field id="private_key" translate="label" type="obscure" sortOrder="20" showInDefault="1" showInWebsite="0" showInStore="0">
                     <label>Service Account Private Key</label>
                     <backend_model>Magento\Config\Model\Config\Backend\Encrypted</backend_model>
+                    <depends>
+                        <field id="authorization_type">jwt</field>
+                    </depends>
                 </field>
-                <field id="workspace_configuration" translate="label" type="obscure" showInDefault="1" showInWebsite="0" showInStore="0">
+                <field id="workspace_configuration" translate="label" type="obscure" sortOrder="30" showInDefault="1" showInWebsite="0" showInStore="0">
                     <label>Adobe I/O Workspace Configuration</label>
                     <backend_model>Magento\Config\Model\Config\Backend\Encrypted</backend_model>
                 </field>
-                <field id="instance_id" translate="label" type="text" showInDefault="1" showInWebsite="0" showInStore="0">
+                <field id="instance_id" translate="label" type="text" sortOrder="50" showInDefault="1" showInWebsite="0" showInStore="0">
                     <label>Adobe Commerce Instance ID</label>
                     <validate>validate-instance-id</validate>
                 </field>
-                <field id="provider_id" translate="label" type="text" showInDefault="1" showInWebsite="0" showInStore="0">
+                <field id="provider_id" translate="label" type="text" sortOrder="60" showInDefault="1" showInWebsite="0" showInStore="0">
                     <label>Adobe I/O Event Provider ID</label>
                 </field>
-                <field id="adobe_io_event_provider_metadata" translate="label" type="text" showInDefault="1" showInWebsite="0" showInStore="0" canRestore="1">
+                <field id="adobe_io_event_provider_metadata" translate="label" type="text" sortOrder="70" showInDefault="1" showInWebsite="0" showInStore="0" canRestore="1">
                     <label>Adobe I/O Event Provider Metadata</label>
                 </field>
-                <field id="adobe_io_environment" translate="label" type="text" showInDefault="0" showInWebsite="0" showInStore="0" canRestore="1">
+                <field id="adobe_io_environment" translate="label" type="text" sortOrder="80" showInDefault="0" showInWebsite="0" showInStore="0" canRestore="1">
                     <label>Adobe I/O Environment</label>
                 </field>
             </group>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/config.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/config.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/config.xml	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/config.xml	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,15 @@
+<?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
 <config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Store:etc/config.xsd">
     <default>
         <adobe_io_events>
             <integration>
+                <authorization_type></authorization_type>
                 <adobe_io_environment>production</adobe_io_environment>
                 <private_key backend_model="Magento\Config\Model\Config\Backend\Encrypted"/>
                 <workspace_configuration backend_model="Magento\Config\Model\Config\Backend\Encrypted"/>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/di.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/di.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/etc/di.xml	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/etc/di.xml	2023-05-25 20:23:48.000000000 +0100
@@ -1,6 +1,13 @@
 <?xml version="1.0"?>
+<!--
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+-->
 <config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
+    <preference for="Magento\AdobeImsApi\Api\Data\TokenResponseInterface" type="Magento\AdobeIoEventsClient\Model\Auth\TokenResponse" />
     <preference for="Magento\AdobeIoEventsClient\Api\EventMetadataRegistryInterface" type="Magento\AdobeIoEventsClient\Model\EventMetadataRegistry" />
     <preference for="Magento\AdobeIoEventsClient\Api\AccessTokenProviderInterface" type="Magento\AdobeIoEventsClient\Model\TechnicalAccountAccessTokenProvider" />
     <preference for="Magento\AdobeIoEventsClient\Api\ConfigurationCheckInterface" type="Magento\AdobeIoEventsClient\Model\Api\ConfigurationCheck" />
@@ -25,4 +32,26 @@
             </argument>
         </arguments>
     </type>
+    <type name="Magento\AdobeIoEventsClient\Model\Credentials\CredentialsFactory">
+        <arguments>
+            <argument name="credentials" xsi:type="array">
+                <item name="jwt" xsi:type="string">Magento\AdobeIoEventsClient\Model\Credentials\JWT</item>
+                <item name="oauth" xsi:type="string">Magento\AdobeIoEventsClient\Model\Credentials\OAuth</item>
+            </argument>
+        </arguments>
+    </type>
+    <type name="Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType">
+        <arguments>
+            <argument name="authorizationTypes" xsi:type="array">
+                <item name="oauth" xsi:type="array">
+                    <item name="value" xsi:type="const">Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType::OAUTH</item>
+                    <item name="label" xsi:type="string">OAuth (Recommended)</item>
+                </item>
+                <item name="jwt" xsi:type="array">
+                    <item name="value" xsi:type="const">Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType::JWT</item>
+                    <item name="label" xsi:type="string">JWT (Deprecated)</item>
+                </item>
+            </argument>
+        </arguments>
+    </type>
 </config>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/InvalidConfigurationException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/InvalidConfigurationException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/InvalidConfigurationException.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/InvalidConfigurationException.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,10 +1,17 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Exception;

 use Magento\Framework\Exception\LocalizedException;
-use Magento\Framework\Phrase;

+/**
+ * Exception thrown when a configuration is invalid or not fetchable
+ */
 class InvalidConfigurationException extends LocalizedException
 {
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/NoRegistrationException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/NoRegistrationException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/NoRegistrationException.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/NoRegistrationException.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,14 +1,24 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Exception;

 use Magento\Framework\Exception\LocalizedException;
-use Magento\Framework\Phrase;

+/**
+ * Exception thrown when a registration isn't found
+ */
 class NoRegistrationException extends LocalizedException
 {
-    public function __construct()
+    /**
+     * @param string $message
+     */
+    public function __construct(string $message = "No registration found for this event code")
     {
-        parent::__construct(new Phrase("No registration found for this event code"));
+        parent::__construct(__($message));
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/RequestThrottledException.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/RequestThrottledException.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Exception/RequestThrottledException.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Exception/RequestThrottledException.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,14 +1,24 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Exception;

 use Magento\Framework\Exception\LocalizedException;
-use Magento\Framework\Phrase;

+/**
+ * Exception thrown when a request fails due to throttling
+ */
 class RequestThrottledException extends LocalizedException
 {
-    public function __construct()
+    /**
+     * @param string $message
+     */
+    public function __construct(string $message = "Request was throttled")
     {
-        parent::__construct(new Phrase("Request was throttled"));
+        parent::__construct(__($message));
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/.github/pull_request_template.md /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/.github/pull_request_template.md
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/.github/pull_request_template.md	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/.github/pull_request_template.md	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,10 @@
+
+### Description
+<!---
+    Please provide a link to the ticket and a description of the changes proposed in the pull request.
+    Letting us know what has changed and why it needed changing will help us review this pull request.
+-->
+
+### Related Pull Requests
+<!-- replace only this line with links to any related PRs, leaving the header and below placeholder comment intact -->
+<!-- related pull request placeholder -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/.github/workflows/jenkins_tests.yml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/.github/workflows/jenkins_tests.yml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/.github/workflows/jenkins_tests.yml	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/.github/workflows/jenkins_tests.yml	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,32 @@
+name: Jenkins Tests
+
+on:
+  pull_request:
+    paths-ignore:
+      - "*.md"
+
+permissions:
+  contents: read
+  pull-requests: read
+
+jobs:
+  TriggerBuild:
+    runs-on: ubuntu-latest
+    steps:
+      - name: Trigger the app to kick off Jenkins builds
+        run: |
+          response="$(curl -X POST -i \
+            -H "Accept: application/vnd.github+json" \
+            -H "Authorization: Bearer ${{ secrets.GH_TOKEN }}" \
+            -H "X-GitHub-Api-Version: 2022-11-28" \
+            https://api.github.com/repos/magento-commerce/module-adobe-io-events-client/dispatches \
+            -d '{"event_type":"run_tests","client_payload":{"pr_number":${{ github.event.number }},"tests":["Semantic Version Checker", "Static Tests", "Unit Tests"]}}')"
+          echo "$response"
+          code="$(echo "$response" | grep "^HTTP\/" | sed -E 's/.* ([0-9]+).*/\1/')"
+          echo "RESPONSE_CODE=$code" >> $GITHUB_ENV
+
+      - name: Check curl response code
+        if: ${{ env.RESPONSE_CODE != '204' }}
+        run: |
+          echo "Failed: curl returned response code ${{ env.RESPONSE_CODE }}"
+          exit 1
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/AdobeIOConfigurationProvider.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/AdobeIOConfigurationProvider.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/AdobeIOConfigurationProvider.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/AdobeIOConfigurationProvider.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,27 +1,55 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model;

+use InvalidArgumentException;
+use Magento\AdobeIoEventsClient\Api\EventProviderInterface;
 use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
 use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\AdobeConsoleConfiguration;
 use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\ConfigurationFactory;
-use Magento\AdobeIoEventsClient\Model\Data\EventProvider;
 use Magento\AdobeIoEventsClient\Model\Data\EventProviderFactory;
 use Magento\AdobeIoEventsClient\Model\Data\PrivateKey;
 use Magento\AdobeIoEventsClient\Model\Data\PrivateKeyFactory;
 use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\Framework\App\Config\Storage\WriterInterface;
 use Magento\Framework\Exception\NotFoundException;
-use Magento\Framework\Phrase;
 use Magento\Framework\Serialize\Serializer\Json;
+use Magento\Store\Model\ScopeInterface;

+/**
+ * Provider for the Adobe IO configuration data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class AdobeIOConfigurationProvider
 {
     private const XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID = "adobe_io_events/integration/provider_id";
     private const XML_PATH_ADOBE_IO_EVENT_INSTANCE_ID = "adobe_io_events/integration/instance_id";
     private const XML_PATH_ADOBE_IO_SERVICE_ACCOUNT_PRIVATE_KEY = "adobe_io_events/integration/private_key";
     private const XML_PATH_ADOBE_IO_EVENT_CONSOLE_CONFIGURATION = "adobe_io_events/integration/workspace_configuration";
-    private const XML_PATH_ADOBE_IO_EVENT_PROVIDER_METADATA = "adobe_io_events/integration/adobe_io_event_provider_metadata";
+    private const XML_PATH_ADOBE_IO_EVENT_PROVIDER_METADATA =
+        "adobe_io_events/integration/adobe_io_event_provider_metadata";
+    public const XML_PATH_ADOBE_IO_AUTHORIZATION_TYPE = "adobe_io_events/integration/authorization_type";
+    public const XML_PATH_ADOBE_IO_PROVIDER_URL = 'adobe_io_events/integration/adobe_io_provider_url';
+    public const XML_PATH_ADOBE_IO_PROVIDER_LIST_URL = 'adobe_io_events/integration/adobe_io_provider_list_url';
+    public const XML_PATH_ADOBE_IO_EVENTS_CREATION_URL = 'adobe_io_events/integration/adobe_io_event_creation_url';
+    public const XML_PATH_ADOBE_IO_EVENTS_TYPE_LIST_URL = 'adobe_io_events/integration/adobe_io_event_type_list_url';
+    public const XML_PATH_ADOBE_IO_EVENTS_TYPE_DELETE_URL =
+        'adobe_io_events/integration/adobe_io_event_type_delete_url';
+    public const XML_ADOBE_IO_PATH_ENVIRONMENT = 'adobe_io_events/integration/adobe_io_environment';
+    public const XML_PATH_IMS_JWT_EXPIRATION_INTERVAL = "adobe_io_events/integration/ims_jwt_expiration_interval";
+
+    public const SCOPE_STORE = ScopeInterface::SCOPE_STORE;
+    public const ENV_STAGING = 'staging';
+
+    private const API_URL_PROD = 'https://api.adobe.io';
+    private const API_URL_STAGE = 'https://api-stage.adobe.io';

     /**
      * @var EventProviderFactory
@@ -90,29 +118,23 @@
      */
     public function retrieveInstanceId(): string
     {
-        $instanceId = $this->scopeConfig->getValue(
-            self::XML_PATH_ADOBE_IO_EVENT_INSTANCE_ID,
-            ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-        );
+        $instanceId = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_EVENT_INSTANCE_ID);

         if (is_array($instanceId) || !$instanceId) {
-            throw new NotFoundException(new Phrase("Instance ID not found in configuration"));
+            throw new NotFoundException(__("Instance ID not found in configuration"));
         }

         return $instanceId;
     }

     /**
-     * Retrieve Event Provider ID
+     * Retrieve Event Provider from the scope
      *
-     * @return EventProvider|null
+     * @return EventProviderInterface|null
      */
-    public function retrieveProvider(): ?EventProvider
+    public function getProvider(): ?EventProviderInterface
     {
-        $providerId = $this->scopeConfig->getValue(
-            self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID,
-            ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-        );
+        $providerId = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID);

         if (is_array($providerId) || !$providerId) {
             return null;
@@ -122,16 +144,32 @@
     }

     /**
+     * Takes event metadata from the Adobe IO API, filters it by configured providers, and converts to provider objects
+     *
+     * @param array $eventMetadata
+     * @return EventProviderInterface[]
+     */
+    public function listProvidersFromApiMetadata(array $eventMetadata): array
+    {
+        $providers = [];
+        $eventProviderMetadata = $this->getEventProviderMetadata();
+        foreach ($eventMetadata as $eventMetadataData) {
+            if (!$eventProviderMetadata || $eventProviderMetadata == $eventMetadataData["provider_metadata"]) {
+                $providers[] = $this->eventProviderFactory->create(["data" => $eventMetadataData]);
+            }
+        }
+
+        return $providers;
+    }
+
+    /**
      * Helper function to check if a provider has been configured at all
      *
      * @return bool
      */
     public function isConfigured(): bool
     {
-        $providerId = $this->scopeConfig->getValue(
-            self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID,
-            ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-        );
+        $providerId = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID);

         if (is_array($providerId) || !$providerId) {
             return false;
@@ -140,18 +178,17 @@
     }

     /**
+     * Get service account private key
+     *
      * @return PrivateKey
      * @throws NotFoundException
      */
     public function getPrivateKey(): PrivateKey
     {
-        $privateKeyData = $this->scopeConfig->getValue(
-            self::XML_PATH_ADOBE_IO_SERVICE_ACCOUNT_PRIVATE_KEY,
-            ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-        );
+        $privateKeyData = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_SERVICE_ACCOUNT_PRIVATE_KEY);

         if (is_array($privateKeyData) || !$privateKeyData) {
-            throw new NotFoundException(new Phrase("Private Key not found in configuration"));
+            throw new NotFoundException(__("Private Key not found in configuration"));
         }

         $privateKey = $this->privateKeyFactory->create();
@@ -161,6 +198,8 @@
     }

     /**
+     * Get populated configuration object
+     *
      * @return AdobeConsoleConfiguration
      * @throws NotFoundException
      * @throws InvalidConfigurationException
@@ -168,18 +207,15 @@
     public function getConfiguration(): AdobeConsoleConfiguration
     {
         if ($this->configuration === null) {
-            $configuration = $this->scopeConfig->getValue(
-                self::XML_PATH_ADOBE_IO_EVENT_CONSOLE_CONFIGURATION,
-                ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-            );
+            $configuration = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_EVENT_CONSOLE_CONFIGURATION);

             if (is_array($configuration) || !$configuration) {
-                throw new NotFoundException(new Phrase("Could not find Adobe I/O Workspace Configuration information"));
+                throw new NotFoundException(__("Could not find Adobe I/O Workspace Configuration information"));
             }

             try {
                 $data = $this->json->unserialize($configuration);
-            } catch (\InvalidArgumentException $exception) {
+            } catch (InvalidArgumentException $exception) {
                 throw new InvalidConfigurationException(
                     __('Could not fetch Adobe I/O Workspace Configuration: %1', $exception->getMessage())
                 );
@@ -191,10 +227,12 @@
     }

     /**
-     * @param EventProvider $eventProvider
+     * Update the stored provider configuration
+     *
+     * @param EventProviderInterface $eventProvider
      * @return void
      */
-    public function saveProvider(EventProvider $eventProvider)
+    public function saveProvider(EventProviderInterface $eventProvider)
     {
         $this->writer->save(
             self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_ID,
@@ -203,14 +241,13 @@
     }

     /**
+     * Get the provider metadata config setting
+     *
      * @return string
      */
     public function getEventProviderMetadata(): ?string
     {
-        $value = $this->scopeConfig->getValue(
-            self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_METADATA,
-            ScopeConfigInterface::SCOPE_TYPE_DEFAULT
-        );
+        $value = $this->getScopeConfig(self::XML_PATH_ADOBE_IO_EVENT_PROVIDER_METADATA);

         if (is_array($value) || !$value) {
             return null;
@@ -218,4 +255,28 @@

         return $value;
     }
+
+    /**
+     * Get the base url for the current environment
+     *
+     * @return string
+     */
+    public function getApiUrl(): string
+    {
+        return $this->getScopeConfig(self::XML_ADOBE_IO_PATH_ENVIRONMENT) === self::ENV_STAGING
+            ? self::API_URL_STAGE
+            : self::API_URL_PROD;
+    }
+
+    /**
+     * Fetches a value from the scope config
+     *
+     * @param string $path
+     * @param string $scope
+     * @return mixed
+     */
+    public function getScopeConfig(string $path, string $scope = ScopeConfigInterface::SCOPE_TYPE_DEFAULT)
+    {
+        return $this->scopeConfig->getValue($path, $scope);
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheck.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheck.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheck.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheck.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,20 +1,27 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Api;

+use Exception;
 use Magento\AdobeIoEventsClient\Api\ConfigurationCheckInterface;
 use Magento\AdobeIoEventsClient\Api\ConfigurationCheckResultInterface;
 use Magento\AdobeIoEventsClient\Api\ConfigurationCheckResultInterfaceFactory;
 use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
-use Magento\AdobeIoEventsClient\Model\IOEventsAPIClient;
+use Magento\AdobeIoEventsClient\Model\EventMetadataClient;
+use Magento\AdobeIoEventsClient\Model\IOEventsApi\ApiRequestExecutor;
 use Magento\Framework\Exception\NotFoundException;

+/**
+ * Validates required elements of the configuration
+ */
 class ConfigurationCheck implements ConfigurationCheckInterface
 {
-    /**
-     * @var IOEventsAPIClient
-     */
-    private IOEventsAPIClient $APIClient;
+    private const XML_PATH_PROVIDER_LIST_URL = AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_PROVIDER_LIST_URL;

     /**
      * @var AdobeIOConfigurationProvider
@@ -27,22 +34,35 @@
     private ConfigurationCheckResultInterfaceFactory $configurationCheckResultFactory;

     /**
-     * @param IOEventsAPIClient $APIClient
+     * @var EventMetadataClient
+     */
+    private EventMetadataClient $eventMetadataClient;
+
+    /**
+     * @var ApiRequestExecutor
+     */
+    private ApiRequestExecutor $requestExecutor;
+
+    /**
      * @param AdobeIOConfigurationProvider $configurationProvider
      * @param ConfigurationCheckResultInterfaceFactory $configurationCheckResultFactory
+     * @param EventMetadataClient $eventMetadataClient
+     * @param ApiRequestExecutor $requestExecutor
      */
     public function __construct(
-        IOEventsAPIClient $APIClient,
         AdobeIOConfigurationProvider $configurationProvider,
-        ConfigurationCheckResultInterfaceFactory $configurationCheckResultFactory
+        ConfigurationCheckResultInterfaceFactory $configurationCheckResultFactory,
+        EventMetadataClient $eventMetadataClient,
+        ApiRequestExecutor $requestExecutor
     ) {
-        $this->APIClient = $APIClient;
         $this->configurationProvider = $configurationProvider;
         $this->configurationCheckResultFactory = $configurationCheckResultFactory;
+        $this->eventMetadataClient = $eventMetadataClient;
+        $this->requestExecutor = $requestExecutor;
     }

     /**
-     * @return ConfigurationCheckResultInterface
+     * @inheritDoc
      */
     public function checkConfiguration(): ConfigurationCheckResultInterface
     {
@@ -57,27 +77,26 @@
             $status = 'error';
         }

-        try {
-            $providers =  $this->APIClient->listEventProvider();
+        if ($this->canServiceAccountConnect()) {
             $data[ConfigurationCheckResultInterface::TECHNICAL_SERVICE_ACCOUNT_CAN_CONNECT] = true;
-        } catch (\Exception $e) {
+        } else {
             $data[ConfigurationCheckResultInterface::TECHNICAL_SERVICE_ACCOUNT_CAN_CONNECT] = false;
             $status = 'error';
         }

-        $providerId = $this->configurationProvider->retrieveProvider();
+        $eventProvider = $this->configurationProvider->getProvider();

-        if (is_null($providerId)) {
+        if ($eventProvider === null) {
             $status = 'error';
             $data[ConfigurationCheckResultInterface::PROVIDER_ID_CONFIGURED] = '';
             $data[ConfigurationCheckResultInterface::PROVIDER_ID_VALID] = false;
         } else {
-            $data[ConfigurationCheckResultInterface::PROVIDER_ID_CONFIGURED] = $providerId->getId();
+            $data[ConfigurationCheckResultInterface::PROVIDER_ID_CONFIGURED] = $eventProvider->getId();

             try {
-                $events = $this->APIClient->listRegisteredEventMetadata($providerId);
+                $this->eventMetadataClient->listRegisteredEventMetadata($eventProvider);
                 $data[ConfigurationCheckResultInterface::PROVIDER_ID_VALID] = true;
-            } catch (\Exception $e) {
+            } catch (Exception $e) {
                 $data[ConfigurationCheckResultInterface::PROVIDER_ID_VALID] = false;
                 $status = 'error';
             }
@@ -87,4 +106,35 @@

         return $this->configurationCheckResultFactory->create(['data' => $data ]);
     }
+
+    /**
+     * Checks if the technical service account can connect to the provider endpoint
+     *
+     * @return bool
+     */
+    private function canServiceAccountConnect(): bool
+    {
+        try {
+            $configuration = $this->configurationProvider->getConfiguration();
+
+            $uri = str_replace(
+                ["#{ims_org_id}"],
+                [
+                    $configuration->getProject()->getOrganization()->getId(),
+                ],
+                $this->configurationProvider->getScopeConfig(self::XML_PATH_PROVIDER_LIST_URL)
+            );
+            $uri = $this->configurationProvider->getApiUrl() . '/' . $uri;
+
+            $response = $this->requestExecutor->executeRequest(ApiRequestExecutor::GET, $uri);
+
+            if ($response->getStatusCode() != 200) {
+                return false;
+            }
+        } catch (Exception $e) {
+            return false;
+        }
+
+        return true;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheckResult.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheckResult.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheckResult.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Api/ConfigurationCheckResult.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,10 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Api;

 use Magento\AdobeIoEventsClient\Api\ConfigurationCheckResultInterface;
 use Magento\Framework\DataObject;

+/**
+ * Contains the results of the configuration validation for each setting
+ */
 class ConfigurationCheckResult extends DataObject implements ConfigurationCheckResultInterface
 {
     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Auth/TokenResponse.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Auth/TokenResponse.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Auth/TokenResponse.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Auth/TokenResponse.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,97 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Auth;
+
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
+use Magento\Framework\DataObject;
+
+/**
+ * Service data response object
+ */
+class TokenResponse extends DataObject implements TokenResponseInterface
+{
+    /**
+     * @inheritDoc
+     */
+    public function getAccessToken(): string
+    {
+        return (string)$this->getData('access_token');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getRefreshToken(): string
+    {
+        return (string)$this->getData('refresh_token');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getSub(): string
+    {
+        return (string)$this->getData('sub');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getName(): string
+    {
+        return (string)$this->getData('name');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getTokenType(): string
+    {
+        return (string)$this->getData('token_type');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getGivenName(): string
+    {
+        return (string)$this->getData('given_name');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getExpiresIn(): int
+    {
+        return (int)$this->getData('expires_in');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getFamilyName(): string
+    {
+        return (string)$this->getData('family_name');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getEmail(): string
+    {
+        return (string)$this->getData('email');
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getError(): string
+    {
+        return (string)$this->getData('error');
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Config/Source/AuthorizationType.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Config/Source/AuthorizationType.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Config/Source/AuthorizationType.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Config/Source/AuthorizationType.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,36 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Config\Source;
+
+use Magento\Framework\Data\OptionSourceInterface;
+
+/**
+ * Authorization type options.
+ */
+class AuthorizationType implements OptionSourceInterface
+{
+    public const JWT = 'jwt';
+    public const OAUTH = 'oauth';
+
+    /**
+     * @param array $authorizationTypes
+     */
+    public function __construct(private array $authorizationTypes)
+    {
+    }
+
+    /**
+     * Returns a list of Authorization type options.
+     *
+     * @return array
+     */
+    public function toOptionArray()
+    {
+        return $this->authorizationTypes;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsFactory.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsFactory.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,43 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials;
+
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\ObjectManagerInterface;
+
+/**
+ * Creates credentials object based on a given authorization type.
+ */
+class CredentialsFactory
+{
+    /**
+     * @param array $credentials
+     * @param ObjectManagerInterface $objectManager
+     */
+    public function __construct(
+        private array $credentials,
+        private ObjectManagerInterface $objectManager
+    ) {
+    }
+
+    /**
+     * Creates credentials object based on a given authorization type.
+     *
+     * @param string $type
+     * @return CredentialsInterface
+     * @throws NotFoundException
+     */
+    public function create(string $type): CredentialsInterface
+    {
+        if (!isset($this->credentials[$type])) {
+            throw new NotFoundException(__('Credentials with type %1 are not registered', $type));
+        }
+
+        return $this->objectManager->create($this->credentials[$type]);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsInterface.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/CredentialsInterface.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,43 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials;
+
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\Framework\Exception\AuthorizationException;
+
+/**
+ * Interface for api credentials based on Authorization type
+ */
+interface CredentialsInterface
+{
+    /**
+     * Returns client id.
+     *
+     * @return string
+     * @throws InvalidConfigurationException
+     */
+    public function getClientId(): string;
+
+    /**
+     * Returns IMS organization id.
+     *
+     * @return string
+     * @throws InvalidConfigurationException
+     */
+    public function getImsOrgId(): string;
+
+    /**
+     * Returns token response.
+     *
+     * @return TokenResponseInterface
+     * @throws InvalidConfigurationException
+     * @throws AuthorizationException
+     */
+    public function getToken(): TokenResponseInterface;
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/JWT.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/JWT.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/JWT.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/JWT.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,91 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials;
+
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
+use Magento\AdobeIoEventsClient\Api\AccessTokenProviderInterface;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\AdobeConsoleConfiguration;
+use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\JWT as JwtCredentials;
+use Magento\Framework\Exception\NotFoundException;
+
+/**
+ * JWT based credentials.
+ */
+class JWT implements CredentialsInterface
+{
+    /**
+     * @param AccessTokenProviderInterface $accessTokenProvider
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     */
+    public function __construct(
+        private AccessTokenProviderInterface $accessTokenProvider,
+        private AdobeIOConfigurationProvider $configurationProvider,
+    ) {
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getClientId(): string
+    {
+        return $this->getJwtCredentials()->getClientId();
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getImsOrgId(): string
+    {
+        $configuration = $this->getConfiguration();
+
+        return $configuration->getProject()->getOrganization()->getImsOrgId();
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getToken(): TokenResponseInterface
+    {
+        return $this->accessTokenProvider->getAccessToken();
+    }
+
+    /**
+     * Returns JWT credentials.
+     *
+     * @return JwtCredentials
+     * @throws InvalidConfigurationException
+     */
+    private function getJwtCredentials(): JwtCredentials
+    {
+        $credentials = $this->getConfiguration()->getFirstCredential();
+        if (!$credentials->getJwt() instanceof JwtCredentials) {
+            throw new InvalidConfigurationException(
+                __('Jwt credentials is not found in the Adobe I/O Workspace Configuration')
+            );
+        }
+
+        return $credentials->getJwt();
+    }
+
+    /**
+     * Returns console configuration.
+     *
+     * @return AdobeConsoleConfiguration
+     * @throws InvalidConfigurationException
+     */
+    private function getConfiguration(): AdobeConsoleConfiguration
+    {
+        try {
+            return $this->configurationProvider->getConfiguration();
+        } catch (NotFoundException $exception) {
+            throw new InvalidConfigurationException(__($exception->getMessage()));
+        }
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/Oauth/ApiUrlResolver.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/Oauth/ApiUrlResolver.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/Oauth/ApiUrlResolver.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/Oauth/ApiUrlResolver.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,38 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials\Oauth;
+
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+
+/**
+ * Resolves url to API endpoint
+ */
+class ApiUrlResolver
+{
+    /**
+     * @param ScopeConfigInterface $scopeConfig
+     */
+    public function __construct(
+        private ScopeConfigInterface $scopeConfig
+    ) {
+    }
+
+    /**
+     * Returns url to api endpoint based on environment.
+     *
+     * @return string
+     */
+    public function get(): string
+    {
+        $environment = $this->scopeConfig->getValue(AdobeIOConfigurationProvider::XML_ADOBE_IO_PATH_ENVIRONMENT);
+        return $environment === AdobeIOConfigurationProvider::ENV_STAGING
+            ? 'https://ims-na1-stg1.adobelogin.com/ims/token/v2'
+            : 'https://ims-na1.adobelogin.com/ims/token/v2';
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/OAuth.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/OAuth.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/OAuth.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/OAuth.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,130 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials;
+
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterfaceFactory;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\AdobeIoEventsClient\Model\Credentials\Oauth\ApiUrlResolver;
+use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\AdobeConsoleConfiguration;
+use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\OAuth as OAuthCredentials;
+use Magento\Framework\Exception\AuthorizationException;
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\HTTP\Client\Curl;
+use Magento\Framework\HTTP\Client\CurlFactory;
+use Magento\Framework\Serialize\Serializer\Json;
+
+/**
+ * Oauth based credentials
+ */
+class OAuth implements CredentialsInterface
+{
+    /**
+     * @var TokenResponseInterface|null
+     */
+    private ?TokenResponseInterface $token = null;
+
+    /**
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param TokenResponseInterfaceFactory $tokenResponseFactory
+     * @param CurlFactory $curlFactory
+     * @param Json $json
+     * @param ApiUrlResolver $apiUrlResolver
+     */
+    public function __construct(
+        private AdobeIOConfigurationProvider $configurationProvider,
+        private TokenResponseInterfaceFactory $tokenResponseFactory,
+        private CurlFactory $curlFactory,
+        private Json $json,
+        private ApiUrlResolver $apiUrlResolver,
+    ) {
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getClientId(): string
+    {
+        return $this->getOAuthCredentials()->getClientId();
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getImsOrgId(): string
+    {
+        $configuration = $this->getConfiguration();
+
+        return $configuration->getProject()->getOrganization()->getImsOrgId();
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getToken(): TokenResponseInterface
+    {
+        if ($this->token === null) {
+            /** @var Curl $curl */
+            $curl = $this->curlFactory->create();
+            $curl->addHeader('cache-control', 'no-cache');
+            $curl->post(
+                $this->apiUrlResolver->get(),
+                [
+                    'grant_type' => 'client_credentials',
+                    'client_id' => $this->getClientId(),
+                    'client_secret' => $this->getOAuthCredentials()->getClientSecret(),
+                    'scope' => implode(',', $this->getOAuthCredentials()->getScopes())
+                ]
+            );
+
+            $response = $this->json->unserialize($curl->getBody());
+
+            if (!is_array($response) || empty($response['access_token'])) {
+                throw new AuthorizationException(__('Could not login to Adobe IMS.'));
+            }
+
+            $this->token = $this->tokenResponseFactory->create(['data' => $response]);
+        }
+
+        return $this->token;
+    }
+
+    /**
+     * Returns OAuth credentials.
+     *
+     * @return OAuthCredentials
+     * @throws InvalidConfigurationException
+     */
+    private function getOAuthCredentials(): OAuthCredentials
+    {
+        $credentials = $this->getConfiguration()->getFirstCredential();
+        if (!$credentials->getOAuth() instanceof OAuthCredentials) {
+            throw new InvalidConfigurationException(
+                __('OAuth credentials is not found in the Adobe I/O Workspace Configuration')
+            );
+        }
+
+        return $credentials->getOAuth();
+    }
+
+    /**
+     * Returns console configuration.
+     *
+     * @return AdobeConsoleConfiguration
+     * @throws InvalidConfigurationException
+     */
+    private function getConfiguration(): AdobeConsoleConfiguration
+    {
+        try {
+            return $this->configurationProvider->getConfiguration();
+        } catch (NotFoundException $exception) {
+            throw new InvalidConfigurationException(__($exception->getMessage()));
+        }
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/ScopeConfigCredentialsFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/ScopeConfigCredentialsFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Credentials/ScopeConfigCredentialsFactory.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Credentials/ScopeConfigCredentialsFactory.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,45 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Credentials;
+
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\Exception\NotFoundException;
+
+/**
+ * Creates credentials object based on configured auth type.
+ */
+class ScopeConfigCredentialsFactory
+{
+    /**
+     * @param ScopeConfigInterface $scopeConfig
+     * @param CredentialsFactory $credentialsFactory
+     */
+    public function __construct(
+        private ScopeConfigInterface $scopeConfig,
+        private CredentialsFactory $credentialsFactory
+    ) {
+    }
+
+    /**
+     * Creates credentials object based on configured auth type.
+     *
+     * If Authorization Type value is not saved in the configuration uses JWT as default for backward compatibility.
+     *
+     * @return CredentialsInterface
+     * @throws NotFoundException
+     */
+    public function create(): CredentialsInterface
+    {
+        $authType = $this->scopeConfig->getValue(AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_AUTHORIZATION_TYPE)
+            ?? AuthorizationType::JWT;
+
+        return $this->credentialsFactory->create($authType);
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/AdobeConsoleConfiguration.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/AdobeConsoleConfiguration.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/AdobeConsoleConfiguration.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/AdobeConsoleConfiguration.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,11 +1,25 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

 use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;

+/**
+ * Data for the Adobe Console config
+ *
+ * @api
+ * @since 1.1.0
+ */
 class AdobeConsoleConfiguration
 {
+    /**
+     * @var Project
+     */
     private Project $project;

     /**
@@ -39,10 +53,10 @@
         $credentials = $this->project->getWorkspace()->getDetails()->getCredentials();
         if (!array_key_exists(0, $credentials)) {
             throw new InvalidConfigurationException(
-                __("Adobe I/O Workspace Configuration does not contain credentials for Service Account (JWT)")
+                __("Adobe I/O Workspace Configuration does not contain credentials")
             );
         }
-
+
         return $credentials[0];
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/ConfigurationFactory.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/ConfigurationFactory.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/ConfigurationFactory.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/ConfigurationFactory.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,15 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Factory for Adobe Console configuration object
+ */
 class ConfigurationFactory
 {
     /**
@@ -17,7 +25,12 @@
     /**
      * @var JWTFactory
      */
-    private JWTFactory $JWTFactory;
+    private JWTFactory $jwtFactory;
+
+    /**
+     * @var OAuthFactory
+     */
+    private OAuthFactory $oauthFactory;

     /**
      * @var OrganizationFactory
@@ -30,16 +43,6 @@
     private ProjectFactory $projectFactory;

     /**
-     * @var RuntimeFactory
-     */
-    private RuntimeFactory $runtimeFactory;
-
-    /**
-     * @var RuntimeNamespaceFactory
-     */
-    private RuntimeNamespaceFactory $runtimeNamespaceFactory;
-
-    /**
      * @var WorkspaceFactory
      */
     private WorkspaceFactory $workspaceFactory;
@@ -52,32 +55,29 @@
     /**
      * @param AdobeConsoleConfigurationFactory $adobeConsoleConfigurationFactory
      * @param CredentialsFactory $credentialsFactory
-     * @param JWTFactory $JWTFactory
+     * @param JWTFactory $jwtFactory
+     * @param OAuthFactory $oauthFactory
      * @param OrganizationFactory $organizationFactory
      * @param ProjectFactory $projectFactory
-     * @param RuntimeFactory $runtimeFactory
-     * @param RuntimeNamespaceFactory $runtimeNamespaceFactory
      * @param WorkspaceFactory $workspaceFactory
      * @param WorkspaceDetailsFactory $workspaceDetailsFactory
      */
     public function __construct(
         AdobeConsoleConfigurationFactory $adobeConsoleConfigurationFactory,
         CredentialsFactory $credentialsFactory,
-        JWTFactory $JWTFactory,
+        JWTFactory $jwtFactory,
+        OAuthFactory $oauthFactory,
         OrganizationFactory $organizationFactory,
         ProjectFactory $projectFactory,
-        RuntimeFactory $runtimeFactory,
-        RuntimeNamespaceFactory $runtimeNamespaceFactory,
         WorkspaceFactory $workspaceFactory,
         WorkspaceDetailsFactory $workspaceDetailsFactory
     ) {
         $this->adobeConsoleConfigurationFactory = $adobeConsoleConfigurationFactory;
         $this->credentialsFactory = $credentialsFactory;
-        $this->JWTFactory = $JWTFactory;
+        $this->jwtFactory = $jwtFactory;
+        $this->oauthFactory = $oauthFactory;
         $this->organizationFactory = $organizationFactory;
         $this->projectFactory = $projectFactory;
-        $this->runtimeFactory = $runtimeFactory;
-        $this->runtimeNamespaceFactory = $runtimeNamespaceFactory;
         $this->workspaceFactory = $workspaceFactory;
         $this->workspaceDetailsFactory = $workspaceDetailsFactory;
     }
@@ -122,23 +122,22 @@

         $credentialsArray = [];
         foreach ($detailsData["credentials"] as $credentialData) {
-            if (!isset($credentialData["jwt"])) {
+            if (!isset($credentialData["jwt"]) && !isset($credentialData['oauth_server_to_server'])) {
                 continue;
             }
-
+            /** @var Credentials $credentials */
             $credentials = $this->credentialsFactory->create();
             $credentials->setId($credentialData["id"]);
             $credentials->setName($credentialData["name"]);
             $credentials->setIntegrationType($credentialData["integration_type"]);

-            $jwtData = $credentialData["jwt"];
-            $jwt = $this->JWTFactory->create();
-            $jwt->setClientId($jwtData["client_id"]);
-            $jwt->setClientSecret($jwtData["client_secret"]);
-            $jwt->setTechnicalAccountEmail($jwtData["technical_account_email"]);
-            $jwt->setTechnicalAccountId($jwtData["technical_account_id"]);
-            $jwt->setMetaScopes($jwtData["meta_scopes"]);
-            $credentials->setJwt($jwt);
+            if (isset($credentialData["jwt"])) {
+                $jwt = $this->createJWT($credentialData["jwt"]);
+                $credentials->setJwt($jwt);
+            } elseif (isset($credentialData["oauth_server_to_server"])) {
+                $oauth = $this->createOauth($credentialData["oauth_server_to_server"]);
+                $credentials->setOAuth($oauth);
+            }

             $credentialsArray[] = $credentials;
         }
@@ -146,4 +145,42 @@

         return $configuration;
     }
+
+    /**
+     * Creates JWT credentials from given data.
+     *
+     * @param array $data
+     * @return JWT
+     */
+    private function createJWT(array $data): JWT
+    {
+        /** @var JWT $jwt */
+        $jwt = $this->jwtFactory->create();
+        $jwt->setClientId($data["client_id"]);
+        $jwt->setClientSecret($data["client_secret"]);
+        $jwt->setTechnicalAccountEmail($data["technical_account_email"]);
+        $jwt->setTechnicalAccountId($data["technical_account_id"]);
+        $jwt->setMetaScopes($data["meta_scopes"]);
+
+        return $jwt;
+    }
+
+    /**
+     * Creates OAuth credentials from given data.
+     *
+     * @param array $data
+     * @return OAuth
+     */
+    private function createOauth(array $data): OAuth
+    {
+        /** @var OAuth $oauth */
+        $oauth = $this->oauthFactory->create();
+        $oauth->setClientId($data["client_id"]);
+        $oauth->setClientSecrets($data["client_secrets"]);
+        $oauth->setTechnicalAccountEmail($data["technical_account_email"]);
+        $oauth->setTechnicalAccountId($data["technical_account_id"]);
+        $oauth->setScopes($data["scopes"]);
+
+        return $oauth;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Credentials.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Credentials.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Credentials.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Credentials.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe Console credentials data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class Credentials
 {
     /**
@@ -20,9 +31,14 @@
     private string $integrationType;

     /**
-     * @var JWT
+     * @var JWT|null
      */
-    private JWT $jwt;
+    private ?JWT $jwt = null;
+
+    /**
+     * @var OAuth|null
+     */
+    private ?OAuth $oauth = null;

     /**
      * Return ID
@@ -87,9 +103,9 @@
     /**
      * Return JWT
      *
-     * @return JWT
+     * @return JWT|null
      */
-    public function getJwt(): JWT
+    public function getJwt(): ?JWT
     {
         return $this->jwt;
     }
@@ -103,4 +119,24 @@
     {
         $this->jwt = $jwt;
     }
+
+    /**
+     * Return OAuth
+     *
+     * @return OAuth|null
+     */
+    public function getOAuth(): ?OAuth
+    {
+        return $this->oauth;
+    }
+
+    /**
+     * Set OAuth
+     *
+     * @param OAuth $oauth
+     */
+    public function setOAuth(OAuth $oauth): void
+    {
+        $this->oauth = $oauth;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/JWT.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/JWT.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/JWT.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/JWT.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Technical account JWT data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class JWT
 {
     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/OAuth.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/OAuth.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/OAuth.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/OAuth.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,151 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;
+
+/**
+ * Oauth data
+ *
+ * @api
+ */
+class OAuth
+{
+    /**
+     * @var string
+     */
+    private string $clientId;
+
+    /**
+     * @var array
+     */
+    private array $clientSecrets;
+
+    /**
+     * @var string
+     */
+    private string $technicalAccountEmail;
+
+    /**
+     * @var string
+     */
+    private string $technicalAccountId;
+
+    /**
+     * @var array
+     */
+    private array $scopes;
+
+    /**
+     * Return Client ID
+     *
+     * @return string
+     */
+    public function getClientId(): string
+    {
+        return $this->clientId;
+    }
+
+    /**
+     * Set Client ID
+     *
+     * @param string $clientId
+     */
+    public function setClientId(string $clientId): void
+    {
+        $this->clientId = $clientId;
+    }
+
+    /**
+     * Return Client Secret
+     *
+     * @return string
+     */
+    public function getClientSecret(): string
+    {
+        return reset($this->clientSecrets);
+    }
+
+    /**
+     * Return Client Secrets
+     *
+     * @return array
+     */
+    public function getClientSecrets(): array
+    {
+        return $this->clientSecrets;
+    }
+
+    /**
+     * Set Client Secrets
+     *
+     * @param array $clientSecrets
+     */
+    public function setClientSecrets(array $clientSecrets): void
+    {
+        $this->clientSecrets = $clientSecrets;
+    }
+
+    /**
+     * Return Technical Account Email
+     *
+     * @return string
+     */
+    public function getTechnicalAccountEmail(): string
+    {
+        return $this->technicalAccountEmail;
+    }
+
+    /**
+     * Set Technical Account Email
+     *
+     * @param string $technicalAccountEmail
+     */
+    public function setTechnicalAccountEmail(string $technicalAccountEmail): void
+    {
+        $this->technicalAccountEmail = $technicalAccountEmail;
+    }
+
+    /**
+     * Return Technical Account ID
+     *
+     * @return string
+     */
+    public function getTechnicalAccountId(): string
+    {
+        return $this->technicalAccountId;
+    }
+
+    /**
+     * Set Technical Account ID
+     *
+     * @param string $technicalAccountId
+     */
+    public function setTechnicalAccountId(string $technicalAccountId): void
+    {
+        $this->technicalAccountId = $technicalAccountId;
+    }
+
+    /**
+     * Return scopes
+     *
+     * @return array
+     */
+    public function getScopes(): array
+    {
+        return $this->scopes;
+    }
+
+    /**
+     * Set scopes
+     *
+     * @param array $scopes
+     */
+    public function setScopes(array $scopes): void
+    {
+        $this->scopes = $scopes;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Organization.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Organization.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Organization.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Organization.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * IMS Org data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class Organization
 {
     /**
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Project.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Project.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Project.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Project.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe console project data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class Project
 {
     /**
@@ -30,6 +41,8 @@
     private Workspace $workspace;

     /**
+     * Get the project ID
+     *
      * @return string
      */
     public function getId(): string
@@ -38,6 +51,8 @@
     }

     /**
+     * Set the project ID
+     *
      * @param string $id
      */
     public function setId(string $id): void
@@ -46,6 +61,8 @@
     }

     /**
+     * Get the project name
+     *
      * @return string
      */
     public function getName(): string
@@ -54,6 +71,8 @@
     }

     /**
+     * Set the project name
+     *
      * @param string $name
      */
     public function setName(string $name): void
@@ -62,6 +81,8 @@
     }

     /**
+     * Get the project title
+     *
      * @return string
      */
     public function getTitle(): string
@@ -70,6 +91,8 @@
     }

     /**
+     * Set the project title
+     *
      * @param string $title
      */
     public function setTitle(string $title): void
@@ -78,6 +101,8 @@
     }

     /**
+     * Get the IMS org
+     *
      * @return Organization
      */
     public function getOrganization(): Organization
@@ -86,6 +111,8 @@
     }

     /**
+     * Set the IMS org
+     *
      * @param Organization $organization
      */
     public function setOrganization(Organization $organization): void
@@ -94,6 +121,8 @@
     }

     /**
+     * Get the project workspace
+     *
      * @return Workspace
      */
     public function getWorkspace(): Workspace
@@ -102,6 +131,8 @@
     }

     /**
+     * Set the project workspace
+     *
      * @param Workspace $workspace
      */
     public function setWorkspace(Workspace $workspace): void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/RuntimeNamespace.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/RuntimeNamespace.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/RuntimeNamespace.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/RuntimeNamespace.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe console workspace runtime namespace data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class RuntimeNamespace
 {
     /**
@@ -15,6 +26,8 @@
     private string $auth;

     /**
+     * Get namespace name
+     *
      * @return string
      */
     public function getName(): string
@@ -23,6 +36,8 @@
     }

     /**
+     * Set namespace name
+     *
      * @param string $name
      */
     public function setName(string $name): void
@@ -31,6 +46,8 @@
     }

     /**
+     * Get runtime auth
+     *
      * @return string
      */
     public function getAuth(): string
@@ -39,6 +56,8 @@
     }

     /**
+     * Set runtime auth
+     *
      * @param string $auth
      */
     public function setAuth(string $auth): void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Runtime.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Runtime.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Runtime.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Runtime.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe console workspace runtime data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class Runtime
 {
     /**
@@ -10,6 +21,8 @@
     private array $namespaces;

     /**
+     * Get the runtime namespace
+     *
      * @return RuntimeNamespace[]
      */
     public function getNamespaces(): array
@@ -18,6 +31,8 @@
     }

     /**
+     * Set the project namespace
+     *
      * @param RuntimeNamespace[] $namespaces
      */
     public function setNamespaces(array $namespaces): void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/WorkspaceDetails.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/WorkspaceDetails.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/WorkspaceDetails.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/WorkspaceDetails.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe console workspace details data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class WorkspaceDetails
 {
     /**
@@ -15,6 +26,8 @@
     private Runtime $runtime;

     /**
+     * Get workspace creds
+     *
      * @return Credentials[]
      */
     public function getCredentials(): array
@@ -23,6 +36,8 @@
     }

     /**
+     * Set workspace creds
+     *
      * @param Credentials[] $credentials
      */
     public function setCredentials(array $credentials): void
@@ -31,6 +46,8 @@
     }

     /**
+     * Get workspace runtime
+     *
      * @return Runtime
      */
     public function getRuntime(): Runtime
@@ -39,6 +56,8 @@
     }

     /**
+     * Get workspace runtime
+     *
      * @param Runtime $runtime
      */
     public function setRuntime(Runtime $runtime): void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Workspace.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Workspace.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Workspace.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/AdobeConsoleConfiguration/Workspace.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration;

+/**
+ * Adobe console workspace data
+ *
+ * @api
+ * @since 1.1.0
+ */
 class Workspace
 {
     /**
@@ -35,6 +46,8 @@
     private WorkspaceDetails $details;

     /**
+     * Get workspace ID
+     *
      * @return string
      */
     public function getId(): string
@@ -43,6 +56,8 @@
     }

     /**
+     * Set workspace ID
+     *
      * @param string $id
      */
     public function setId(string $id): void
@@ -51,6 +66,8 @@
     }

     /**
+     * Get workspace name
+     *
      * @return string
      */
     public function getName(): string
@@ -59,6 +76,8 @@
     }

     /**
+     * Set workspace name
+     *
      * @param string $name
      */
     public function setName(string $name): void
@@ -67,6 +86,8 @@
     }

     /**
+     * Get workspace title
+     *
      * @return string
      */
     public function getTitle(): string
@@ -75,6 +96,8 @@
     }

     /**
+     * Set workspace title
+     *
      * @param string $title
      */
     public function setTitle(string $title): void
@@ -83,6 +106,8 @@
     }

     /**
+     * Get workspace's action url
+     *
      * @return string
      */
     public function getActionUrl(): string
@@ -91,6 +116,8 @@
     }

     /**
+     * Set workspace's action url
+     *
      * @param string $actionUrl
      */
     public function setActionUrl(string $actionUrl): void
@@ -99,6 +126,8 @@
     }

     /**
+     * Get workspace's app url
+     *
      * @return string
      */
     public function getAppUrl(): string
@@ -107,6 +136,8 @@
     }

     /**
+     * Set workspace's app url
+     *
      * @param string $appUrl
      */
     public function setAppUrl(string $appUrl): void
@@ -115,6 +146,8 @@
     }

     /**
+     * Get workspace details object
+     *
      * @return WorkspaceDetails
      */
     public function getDetails(): WorkspaceDetails
@@ -123,6 +156,8 @@
     }

     /**
+     * Set workspace details object
+     *
      * @param WorkspaceDetails $details
      */
     public function setDetails(WorkspaceDetails $details): void
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/EventMetadata.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/EventMetadata.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/EventMetadata.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/EventMetadata.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,4 +1,9 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data;

@@ -6,6 +11,12 @@
 use Magento\AdobeIoEventsClient\Api\EventMetadataInterface;
 use Magento\Framework\DataObject;

+/**
+ * Event metadata data object
+ *
+ * @api
+ * @since 1.1.0
+ */
 class EventMetadata extends DataObject implements JsonSerializable, EventMetadataInterface
 {
     private const EVENT_CODE = "event_code";
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/EventProvider.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/EventProvider.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/EventProvider.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/EventProvider.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,10 +1,21 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data;

 use Magento\AdobeIoEventsClient\Api\EventProviderInterface;
 use Magento\Framework\DataObject;

+/**
+ * Event provider data object
+ *
+ * @api
+ * @since 1.1.0
+ */
 class EventProvider extends DataObject implements EventProviderInterface
 {
     private const ID = 'id';
@@ -64,6 +75,11 @@
         return (string)$this->getData(self::PUBLISHER);
     }

+    /**
+     * Get the provider's instance id
+     *
+     * @return string
+     */
     public function getInstanceId(): string
     {
         return (string)$this->getData(self::INSTANCE_ID);
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/PrivateKey.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/PrivateKey.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/Data/PrivateKey.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/Data/PrivateKey.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,7 +1,18 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model\Data;

+/**
+ * Private key definition
+ *
+ * @api
+ * @since 1.1.0
+ */
 class PrivateKey
 {
     private const BEGIN_PRIVATE_KEY = "-----BEGIN PRIVATE KEY-----";
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventMetadataClient.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventMetadataClient.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventMetadataClient.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventMetadataClient.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,250 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model;
+
+use Magento\AdobeIoEventsClient\Api\EventMetadataInterface;
+use Magento\AdobeIoEventsClient\Api\EventProviderInterface;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\AdobeConsoleConfiguration;
+use Magento\AdobeIoEventsClient\Model\Data\EventMetadataFactory;
+use Magento\AdobeIoEventsClient\Model\IOEventsApi\ApiRequestExecutor;
+use Magento\Framework\Exception\AuthenticationException;
+use Magento\Framework\Exception\AuthorizationException;
+use Magento\Framework\Exception\InputException;
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\Serialize\Serializer\Json;
+
+/**
+ * Interaction with Event Metadata on the IO Events API
+ *
+ * @api
+ * @since 1.1.0
+ */
+class EventMetadataClient
+{
+    private const XML_PATH_EVENTS_CREATION_URL = AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_EVENTS_CREATION_URL;
+    private const XML_PATH_EVENTS_TYPE_LIST_URL = AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_EVENTS_TYPE_LIST_URL;
+    private const XML_PATH_EVENTS_TYPE_DELETE_URL =
+        AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_EVENTS_TYPE_DELETE_URL;
+
+    /**
+     * @var AdobeIOConfigurationProvider
+     */
+    private AdobeIOConfigurationProvider $configurationProvider;
+
+    /**
+     * @var ApiRequestExecutor
+     */
+    private ApiRequestExecutor $requestExecutor;
+
+    /**
+     * @var EventMetadataFactory
+     */
+    private EventMetadataFactory $eventMetadataFactory;
+
+    /**
+     * @var Json
+     */
+    private Json $json;
+
+    /**
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param ApiRequestExecutor $requestExecutor
+     * @param EventMetadataFactory $eventMetadataFactory
+     * @param Json $json
+     */
+    public function __construct(
+        AdobeIOConfigurationProvider $configurationProvider,
+        ApiRequestExecutor $requestExecutor,
+        EventMetadataFactory $eventMetadataFactory,
+        Json $json
+    ) {
+        $this->configurationProvider = $configurationProvider;
+        $this->requestExecutor = $requestExecutor;
+        $this->eventMetadataFactory = $eventMetadataFactory;
+        $this->json = $json;
+    }
+
+    /**
+     * Calls the api to create event metadata
+     *
+     * @param EventProviderInterface $provider
+     * @param EventMetadataInterface $eventMetadata
+     * @return void
+     * @throws AuthenticationException
+     * @throws AuthorizationException
+     * @throws InputException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
+     */
+    public function createEventMetadata(
+        EventProviderInterface $provider,
+        EventMetadataInterface $eventMetadata
+    ) {
+        $configuration = $this->configurationProvider->getConfiguration();
+
+        $uri = $this->getEventMetadataCreationUri($configuration, $provider);
+
+        $params = [
+            'json' => $eventMetadata->jsonSerialize()
+        ];
+
+        $response = $this->requestExecutor->executeRequest(
+            ApiRequestExecutor::POST,
+            $uri,
+            $params
+        );
+
+        if ($response->getStatusCode() == 401) {
+            throw new AuthenticationException(__("Access Token is not valid anymore"));
+        }
+
+        if ($response->getStatusCode() != 201) {
+            throw new InputException(__($response->getReasonPhrase()));
+        }
+    }
+
+    /**
+     * Retrieves metadata for registered events
+     *
+     * @param EventProviderInterface $provider
+     * @return array
+     * @throws AuthorizationException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
+     */
+    public function listRegisteredEventMetadata(EventProviderInterface $provider): array
+    {
+        $configuration = $this->configurationProvider->getConfiguration();
+
+        $uri = $this->getEventMetadataListUri($configuration, $provider);
+
+        $response = $this->requestExecutor->executeRequest(ApiRequestExecutor::GET, $uri);
+
+        if ($response->getStatusCode() == 404) {
+            throw new NotFoundException(__("EventMetadata list was not found"));
+        }
+
+        $data = $this->json->unserialize($response->getBody()->getContents());
+        $eventMetadataList = [];
+        foreach ($data["_embedded"]["eventmetadata"] as $eventMetadataData) {
+            $eventType = $this->eventMetadataFactory->create(["data" => $eventMetadataData]);
+
+            $eventMetadataList[] = $eventType;
+        }
+
+        return $eventMetadataList;
+    }
+
+    /**
+     * Calls the API to delete the specified event metadata
+     *
+     * @param EventProviderInterface $provider
+     * @param EventMetadataInterface $eventType
+     * @return bool
+     * @throws AuthorizationException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
+     */
+    public function deleteEventMetadata(
+        EventProviderInterface $provider,
+        EventMetadataInterface $eventType
+    ): bool {
+        $configuration = $this->configurationProvider->getConfiguration();
+
+        $uri = $this->getEventMetadataDeleteUri($configuration, $provider, $eventType->getEventCode());
+
+        $response = $this->requestExecutor->executeRequest(ApiRequestExecutor::DELETE, $uri);
+
+        return $response->getStatusCode() == 204;
+    }
+
+    /**
+     * Compute Event Metadata Delete URI
+     *
+     * @param AdobeConsoleConfiguration $configuration
+     * @param EventProviderInterface $provider
+     * @param string $eventCode
+     * @return string
+     */
+    private function getEventMetadataDeleteUri(
+        AdobeConsoleConfiguration $configuration,
+        EventProviderInterface $provider,
+        string $eventCode
+    ): string {
+        return str_replace(
+            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}", "#{event_code}"],
+            [
+                $configuration->getProject()->getOrganization()->getId(),
+                $configuration->getProject()->getId(),
+                $configuration->getProject()->getWorkspace()->getId(),
+                $provider->getId(),
+                $eventCode
+            ],
+            $this->configurationProvider->getApiUrl() . '/' .
+                $this->configurationProvider->getScopeConfig(
+                    self::XML_PATH_EVENTS_TYPE_DELETE_URL,
+                    AdobeIOConfigurationProvider::SCOPE_STORE
+                )
+        );
+    }
+
+    /**
+     * Compute Event Metadata List URI
+     *
+     * @param AdobeConsoleConfiguration $configuration
+     * @param EventProviderInterface $provider
+     * @return string
+     */
+    private function getEventMetadataListUri(
+        AdobeConsoleConfiguration $configuration,
+        EventProviderInterface $provider
+    ): string {
+        return str_replace(
+            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}"],
+            [
+                $configuration->getProject()->getOrganization()->getId(),
+                $configuration->getProject()->getId(),
+                $configuration->getProject()->getWorkspace()->getId(),
+                $provider->getId()
+            ],
+            $this->configurationProvider->getApiUrl() . '/' .
+                $this->configurationProvider->getScopeConfig(
+                    self::XML_PATH_EVENTS_TYPE_LIST_URL,
+                    AdobeIOConfigurationProvider::SCOPE_STORE
+                )
+        );
+    }
+
+    /**
+     * Compute Event Metadata Creation URI
+     *
+     * @param AdobeConsoleConfiguration $configuration
+     * @param EventProviderInterface $provider
+     * @return string
+     */
+    private function getEventMetadataCreationUri(
+        AdobeConsoleConfiguration $configuration,
+        EventProviderInterface $provider
+    ): string {
+        return str_replace(
+            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}"],
+            [
+                $configuration->getProject()->getOrganization()->getId(),
+                $configuration->getProject()->getId(),
+                $configuration->getProject()->getWorkspace()->getId(),
+                $provider->getId()
+            ],
+            $this->configurationProvider->getApiUrl() . '/' .
+                $this->configurationProvider->getScopeConfig(
+                    self::XML_PATH_EVENTS_CREATION_URL,
+                    AdobeIOConfigurationProvider::SCOPE_STORE
+                )
+        );
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventMetadataRegistry.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventMetadataRegistry.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventMetadataRegistry.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventMetadataRegistry.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,4 +1,9 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model;

@@ -10,6 +15,9 @@
 use Magento\Framework\Filesystem\File\ReadFactory;
 use Magento\Framework\Serialize\Serializer\Json;

+/**
+ * Provides access to the metadata configuration
+ */
 class EventMetadataRegistry implements EventMetadataRegistryInterface
 {
     public const PATH_TO_IO_EVENTS_DECLARATION = "app/etc/event-types.json";
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventProviderClient.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventProviderClient.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/EventProviderClient.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/EventProviderClient.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,118 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model;
+
+use Magento\AdobeIoEventsClient\Api\EventProviderInterface;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\IOEventsApi\ApiRequestExecutor;
+use Magento\Framework\Exception\AlreadyExistsException;
+use Magento\Framework\Exception\AuthenticationException;
+use Magento\Framework\Exception\AuthorizationException;
+use Magento\Framework\Exception\InputException;
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\Serialize\Serializer\Json;
+
+/**
+ * Interaction with Event Providers on the IO Events API
+ */
+class EventProviderClient
+{
+    /**
+     * @var AdobeIOConfigurationProvider
+     */
+    private AdobeIOConfigurationProvider $configurationProvider;
+
+    /**
+     * @var ApiRequestExecutor
+     */
+    private ApiRequestExecutor $requestExecutor;
+
+    /**
+     * @var Json
+     */
+    private Json $json;
+
+    /**
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param ApiRequestExecutor $requestExecutor
+     * @param Json $json
+     */
+    public function __construct(
+        AdobeIOConfigurationProvider $configurationProvider,
+        ApiRequestExecutor $requestExecutor,
+        Json $json
+    ) {
+        $this->configurationProvider = $configurationProvider;
+        $this->requestExecutor = $requestExecutor;
+        $this->json = $json;
+    }
+
+    /**
+     * Call the API to create an event provider
+     *
+     * @param string $instanceId
+     * @param EventProviderInterface $provider
+     * @return array|bool|float|int|mixed|string|null
+     * @throws AlreadyExistsException
+     * @throws AuthenticationException
+     * @throws AuthorizationException
+     * @throws InputException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
+     */
+    public function createEventProvider(
+        string $instanceId,
+        EventProviderInterface $provider
+    ) {
+        $configuration = $this->configurationProvider->getConfiguration();
+
+        $uri = str_replace(
+            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}"],
+            [
+                $configuration->getProject()->getOrganization()->getId(),
+                $configuration->getProject()->getId(),
+                $configuration->getProject()->getWorkspace()->getId()
+            ],
+            $this->configurationProvider->getScopeConfig(AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_PROVIDER_URL)
+        );
+        $uri = $this->configurationProvider->getApiUrl() . '/' . $uri;
+
+        $params = [
+            "json" => [
+                "instance_id" => $instanceId,
+                "label" => $provider->getLabel(),
+                "description" => sprintf("%s (Instance %s)", $provider->getDescription(), $instanceId)
+            ]
+        ];
+
+        $eventProviderMetadata = $this->configurationProvider->getEventProviderMetadata();
+        if ($eventProviderMetadata) {
+            $params['json']['provider_metadata'] = $eventProviderMetadata;
+        }
+
+        $response = $this->requestExecutor->executeRequest(
+            ApiRequestExecutor::POST,
+            $uri,
+            $params
+        );
+
+        if ($response->getStatusCode() == 409) {
+            throw new AlreadyExistsException(__("An event provider with the same instance ID already exists."));
+        }
+
+        if ($response->getStatusCode() == 401) {
+            throw new AuthenticationException(__("Access Token is not valid anymore"));
+        }
+
+        if ($response->getStatusCode() != 201) {
+            throw new InputException(__($response->getReasonPhrase()));
+        }
+
+        return $this->json->unserialize($response->getBody()->getContents());
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/ImsJwtApi/JwtClient.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/ImsJwtApi/JwtClient.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/ImsJwtApi/JwtClient.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/ImsJwtApi/JwtClient.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,175 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\ImsJwtApi;
+
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\HTTP\Client\CurlFactory;
+use Magento\Framework\Jwt\JwkFactory;
+use Magento\Framework\Jwt\Jws\JwsSignatureJwks;
+use Magento\Framework\Jwt\JwtManagerInterface;
+use Magento\Framework\Serialize\Serializer\Json;
+use Magento\Framework\Stdlib\DateTime\DateTime;
+use Magento\JwtFrameworkAdapter\Model\JwsFactory;
+use Magento\Store\Model\ScopeInterface;
+use Throwable;
+
+/**
+ * Interaction with the Adobe IMS JWT API
+ */
+class JwtClient
+{
+    private const XML_PATH_IMS_JWT_EXPIRATION_INTERVAL =
+        AdobeIOConfigurationProvider::XML_PATH_IMS_JWT_EXPIRATION_INTERVAL;
+    private const XML_ADOBE_IO_PATH_ENVIRONMENT = AdobeIOConfigurationProvider::XML_ADOBE_IO_PATH_ENVIRONMENT;
+
+    private const ENV_STAGING = AdobeIOConfigurationProvider::ENV_STAGING;
+
+    private const IMS_JWT_URL_PROD = 'https://adobeid-na1.services.adobe.com/ims/exchange/jwt';
+    private const IMS_JWT_URL_STAGE = 'https://adobeid-na1-stg1.services.adobe.com/ims/exchange/jwt';
+    private const IMS_BASE_URL_JWT_TOKEN_PROD = 'https://ims-na1.adobelogin.com';
+    private const IMS_BASE_URL_JWT_TOKEN_STAGE = 'https://ims-na1-stg1.adobelogin.com';
+
+    /**
+     * @var JwtManagerInterface
+     */
+    private JwtManagerInterface $jwtManager;
+
+    /**
+     * @var JwkFactory
+     */
+    private JwkFactory $jwkFactory;
+
+    /**
+     * @var JwsFactory
+     */
+    private JwsFactory $jwsFactory;
+
+    /**
+     * @var CurlFactory
+     */
+    private CurlFactory $curlFactory;
+
+    /**
+     * @var Json
+     */
+    private Json $json;
+
+    /**
+     * @var AdobeIOConfigurationProvider
+     */
+    private AdobeIOConfigurationProvider $configurationProvider;
+
+    /**
+     * @var DateTime
+     */
+    private DateTime $dateTime;
+
+    /**
+     * @param JwtManagerInterface $jwtManager
+     * @param JwkFactory $jwkFactory
+     * @param JwsFactory $jwsFactory
+     * @param CurlFactory $curlFactory
+     * @param Json $json
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param DateTime $dateTime
+     */
+    public function __construct(
+        JwtManagerInterface $jwtManager,
+        JwkFactory $jwkFactory,
+        JwsFactory $jwsFactory,
+        CurlFactory $curlFactory,
+        Json $json,
+        AdobeIOConfigurationProvider $configurationProvider,
+        DateTime $dateTime
+    ) {
+        $this->jwtManager = $jwtManager;
+        $this->jwkFactory = $jwkFactory;
+        $this->jwsFactory = $jwsFactory;
+        $this->curlFactory = $curlFactory;
+        $this->json = $json;
+        $this->configurationProvider = $configurationProvider;
+        $this->dateTime = $dateTime;
+    }
+
+    /**
+     * Fetches the JWT token from the Adobe IMS API
+     *
+     * @return array|bool|float|int|mixed|string|null
+     * @throws InvalidConfigurationException
+     */
+    public function fetchJwtTokenResponse()
+    {
+        try {
+            $privateKey = $this->configurationProvider->getPrivateKey();
+            $configuration = $this->configurationProvider->getConfiguration();
+        } catch (NotFoundException $e) {
+            throw new InvalidConfigurationException(__($e->getMessage()), $e);
+        }
+        $firstCredentials = $configuration->getFirstCredential();
+        $imsOrgId = $configuration->getProject()->getOrganization()->getImsOrgId();
+        $scopeEnv = $this->configurationProvider->getScopeConfig(self::XML_ADOBE_IO_PATH_ENVIRONMENT);
+        $jwtUrl = $scopeEnv === self::ENV_STAGING
+            ? self::IMS_JWT_URL_STAGE
+            : self::IMS_JWT_URL_PROD;
+        $baseTokenUrl = $scopeEnv === self::ENV_STAGING
+            ? self::IMS_BASE_URL_JWT_TOKEN_STAGE
+            : self::IMS_BASE_URL_JWT_TOKEN_PROD;
+
+        $expirationTimestamp = $this->dateTime->timestamp() + $this->configurationProvider->getScopeConfig(
+            self::XML_PATH_IMS_JWT_EXPIRATION_INTERVAL,
+            ScopeInterface::SCOPE_STORE
+        );
+        try {
+            $jwk = $this->jwkFactory->createSignRs256($privateKey->getData(), null);
+        } catch (Throwable $e) {
+            throw new InvalidConfigurationException(
+                __('Service Account Private Key is invalid. Error: %1', $e->getMessage())
+            );
+        }
+        $encSettings = new JwsSignatureJwks($jwk);
+
+        $payload = [
+            "exp" => $expirationTimestamp,
+            "iss" => $imsOrgId,
+            "sub" => $firstCredentials->getJwt()->getTechnicalAccountId(),
+            "aud" => $baseTokenUrl . "/c/" . $firstCredentials->getJwt()->getClientId()
+        ];
+
+        foreach ($firstCredentials->getJwt()->getMetaScopes() as $metaScope) {
+            $payload[$baseTokenUrl . "/s/" . $metaScope] = true;
+        }
+
+        $jws = $this->jwsFactory->create(
+            [
+                "alg" => "RS256",
+            ],
+            $this->json->serialize($payload),
+            null
+        );
+
+        $token = $this->jwtManager->create($jws, $encSettings);
+
+        $curl = $this->curlFactory->create();
+
+        $curl->addHeader('Content-Type', 'application/x-www-form-urlencoded');
+        $curl->addHeader('cache-control', 'no-cache');
+
+        $curl->post(
+            $jwtUrl,
+            [
+                'client_id' => $firstCredentials->getJwt()->getClientId(),
+                'client_secret' => $firstCredentials->getJwt()->getClientSecret(),
+                'jwt_token' => $token
+            ]
+        );
+
+        return $this->json->unserialize($curl->getBody());
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/IOEventsApi/ApiRequestExecutor.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/IOEventsApi/ApiRequestExecutor.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/IOEventsApi/ApiRequestExecutor.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/IOEventsApi/ApiRequestExecutor.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,102 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Model\IOEventsApi;
+
+use GuzzleHttp\ClientFactory;
+use GuzzleHttp\Exception\GuzzleException;
+use GuzzleHttp\Psr7\Response;
+use GuzzleHttp\Psr7\ResponseFactory;
+use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
+use Magento\AdobeIoEventsClient\Model\Credentials\ScopeConfigCredentialsFactory;
+use Magento\Framework\Exception\AuthorizationException;
+use Magento\Framework\Exception\NotFoundException;
+use Magento\Framework\Webapi\Rest\Request;
+
+/**
+ * Executes a request to the IOEventsApiClient including credentials
+ */
+class ApiRequestExecutor
+{
+    public const GET = Request::HTTP_METHOD_GET;
+    public const POST = Request::HTTP_METHOD_POST;
+    public const DELETE = Request::HTTP_METHOD_DELETE;
+
+    /**
+     * @var ResponseFactory
+     */
+    private ResponseFactory $responseFactory;
+
+    /**
+     * @var ClientFactory
+     */
+    private ClientFactory $clientFactory;
+
+    /**
+     * @var ScopeConfigCredentialsFactory
+     */
+    private ScopeConfigCredentialsFactory $credentialsFactory;
+
+    /**
+     * @param ResponseFactory $responseFactory
+     * @param ClientFactory $clientFactory
+     * @param ScopeConfigCredentialsFactory $credentialsFactory
+     */
+    public function __construct(
+        ResponseFactory $responseFactory,
+        ClientFactory $clientFactory,
+        ScopeConfigCredentialsFactory $credentialsFactory
+    ) {
+        $this->responseFactory = $responseFactory;
+        $this->clientFactory = $clientFactory;
+        $this->credentialsFactory = $credentialsFactory;
+    }
+
+    /**
+     * Executes a call to an API endpoint
+     *
+     * @param string $method
+     * @param string $uri
+     * @param array $params
+     * @return Response
+     * @throws AuthorizationException
+     * @throws InvalidConfigurationException
+     * @throws NotFoundException
+     */
+    public function executeRequest(
+        string $method,
+        string $uri,
+        array $params = []
+    ): Response {
+        $client = $this->clientFactory->create();
+        $credentials = $this->credentialsFactory->create();
+
+        if (!array_key_exists('headers', $params)) {
+            $params['headers'] = [];
+        }
+
+        $params['headers']['x-api-key'] = $credentials->getClientId();
+        $params['headers']['Authorization'] = 'Bearer ' . $credentials->getToken()->getAccessToken();
+
+        try {
+            $response = $client->request($method, $uri, $params);
+        } catch (GuzzleException $exception) {
+            $response = $this->responseFactory->create([
+                'status' => $exception->getCode(),
+                'reason' => sprintf(
+                    'Unsuccessful request: `%s %s` resulted in a `%s %s` response:',
+                    $method,
+                    $uri,
+                    $exception->getResponse()->getStatusCode(),
+                    $exception->getResponse()->getReasonPhrase()
+                ) . PHP_EOL . $exception->getResponse()->getBody()->getContents()
+            ]);
+        }
+
+        return $response;
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/IOEventsAPIClient.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/IOEventsAPIClient.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/IOEventsAPIClient.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/IOEventsAPIClient.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,505 +0,0 @@
-<?php
-
-namespace Magento\AdobeIoEventsClient\Model;
-
-use GuzzleHttp\ClientFactory;
-use GuzzleHttp\Exception\GuzzleException;
-use GuzzleHttp\Psr7\Response;
-use GuzzleHttp\Psr7\ResponseFactory;
-use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
-use Magento\AdobeIoEventsClient\Api\AccessTokenProviderInterface;
-use Magento\AdobeIoEventsClient\Exception\NoRegistrationException;
-use Magento\AdobeIoEventsClient\Exception\RequestThrottledException;
-use Magento\AdobeIoEventsClient\Model\Data\AdobeConsoleConfiguration\AdobeConsoleConfiguration;
-use Magento\AdobeIoEventsClient\Model\Data\EventMetadata;
-use Magento\AdobeIoEventsClient\Model\Data\EventMetadataFactory;
-use Magento\AdobeIoEventsClient\Model\Data\EventProvider;
-use Magento\AdobeIoEventsClient\Model\Data\EventProviderFactory;
-use Magento\Framework\App\Config\ScopeConfigInterface;
-use Magento\Framework\Exception\AlreadyExistsException;
-use Magento\Framework\Exception\AuthenticationException;
-use Magento\Framework\Exception\AuthorizationException;
-use Magento\Framework\Exception\InputException;
-use Magento\Framework\Exception\LocalizedException;
-use Magento\Framework\Exception\NotFoundException;
-use Magento\Framework\Exception\RemoteServiceUnavailableException;
-use Magento\Framework\Math\Random;
-use Magento\Framework\Phrase;
-use Magento\Framework\Serialize\Serializer\Json;
-use Magento\Framework\Webapi\Rest\Request;
-use Magento\Store\Model\ScopeInterface;
-
-class IOEventsAPIClient
-{
-    private const XML_PATH_ADOBE_IO_PROVIDER_URL = 'adobe_io_events/integration/adobe_io_provider_url';
-    private const XML_PATH_ADOBE_IO_PROVIDER_LIST_URL = 'adobe_io_events/integration/adobe_io_provider_list_url';
-    private const XML_PATH_ADOBE_IO_EVENTS_CREATION_URL = 'adobe_io_events/integration/adobe_io_event_creation_url';
-    private const XML_PATH_ADOBE_IO_EVENTS_TYPE_LIST_URL = 'adobe_io_events/integration/adobe_io_event_type_list_url';
-    private const XML_PATH_ADOBE_IO_EVENTS_TYPE_DELETE_URL = 'adobe_io_events/integration/adobe_io_event_type_delete_url';
-    private const XML_ADOBE_IO_PATH_ENVIRONMENT = 'adobe_io_events/integration/adobe_io_environment';
-
-    private const EVENT_INGRESS_URL_PROD = 'https://eventsingress.adobe.io';
-    private const EVENT_INGRESS_URL_STAGE = 'https://eventsingress-stage.adobe.io';
-
-    private const API_URL_PROD = 'https://api.adobe.io';
-    private const API_URL_STAGE = 'https://api-stage.adobe.io';
-
-    public const ENV_STAGING = 'staging';
-
-    /**
-     * @var ResponseFactory
-     */
-    private ResponseFactory $responseFactory;
-
-    /**
-     * @var ClientFactory
-     */
-    private ClientFactory $clientFactory;
-
-    /**
-     * @var ScopeConfigInterface
-     */
-    private ScopeConfigInterface $scopeConfig;
-
-    /**
-     * @var Random
-     */
-    private Random $mathRandom;
-
-    /**
-     * @var Json
-     */
-    private Json $json;
-
-    /**
-     * @var EventProviderFactory
-     */
-    private EventProviderFactory $eventProviderFactory;
-
-    /**
-     * @var AdobeIOConfigurationProvider
-     */
-    private AdobeIOConfigurationProvider $configurationProvider;
-
-    /**
-     * @var EventMetadataFactory
-     */
-    private EventMetadataFactory $eventMetadataFactory;
-
-    /**
-     * @var AccessTokenProviderInterface
-     */
-    private AccessTokenProviderInterface $accessTokenProvider;
-
-    /**
-     * @param ResponseFactory $responseFactory
-     * @param ClientFactory $clientFactory
-     * @param ScopeConfigInterface $scopeConfig
-     * @param Random $mathRandom
-     * @param Json $json
-     * @param EventProviderFactory $eventProviderFactory
-     * @param AdobeIOConfigurationProvider $configurationProvider
-     * @param EventMetadataFactory $eventMetadataFactory
-     * @param AccessTokenProviderInterface $accessTokenProvider
-     */
-    public function __construct(
-        ResponseFactory $responseFactory,
-        ClientFactory $clientFactory,
-        ScopeConfigInterface $scopeConfig,
-        Random $mathRandom,
-        Json $json,
-        EventProviderFactory $eventProviderFactory,
-        AdobeIOConfigurationProvider $configurationProvider,
-        EventMetadataFactory $eventMetadataFactory,
-        AccessTokenProviderInterface $accessTokenProvider
-    ) {
-        $this->responseFactory = $responseFactory;
-        $this->clientFactory = $clientFactory;
-        $this->scopeConfig = $scopeConfig;
-        $this->mathRandom = $mathRandom;
-        $this->json = $json;
-        $this->eventProviderFactory = $eventProviderFactory;
-        $this->configurationProvider = $configurationProvider;
-        $this->eventMetadataFactory = $eventMetadataFactory;
-        $this->accessTokenProvider = $accessTokenProvider;
-    }
-
-    /**
-     * @param string $eventCode
-     * @param array $payload
-     * @return void
-     * @throws AuthenticationException
-     * @throws NoRegistrationException
-     * @throws RemoteServiceUnavailableException
-     * @throws RequestThrottledException
-     * @throws AuthorizationException
-     * @throws LocalizedException
-     */
-    public function publishEvent(
-        string $eventCode,
-        array $payload
-    ) {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $provider = $this->configurationProvider->retrieveProvider();
-        $uri = $this->scopeConfig->getValue(self::XML_ADOBE_IO_PATH_ENVIRONMENT) === self::ENV_STAGING
-            ? self::EVENT_INGRESS_URL_STAGE
-            : self::EVENT_INGRESS_URL_PROD;
-
-        $params = [
-            "json" => [
-                "datacontenttype" => "application/json",
-                "specversion" => "1.0",
-                "source" => "urn:uuid:" . $provider->getId(),
-                "type" => "$eventCode",
-                "id" => $this->mathRandom->getUniqueHash("$eventCode"),
-                "data" => $payload
-            ],
-            "headers" => [
-                "x-adobe-event-code" => "$eventCode",
-                "x-adobe-event-provider-id" => $provider->getId(),
-            ]
-        ];
-
-        $response = $this->doRequest(Request::HTTP_METHOD_POST, $uri, $accessToken, $configuration, $params);
-
-        if ($response->getStatusCode() == 204) {
-            throw new NoRegistrationException();
-        }
-
-        if ($response->getStatusCode() == 429) {
-            throw new RequestThrottledException();
-        }
-
-        if ($response->getStatusCode() == 401) {
-            throw new AuthenticationException(new Phrase("Access Token is not valid anymore"));
-        }
-
-        if ($response->getStatusCode() != 200) {
-            throw new RemoteServiceUnavailableException(new Phrase("Request failed"));
-        }
-    }
-
-    /**
-     * @param string $instanceId
-     * @param EventProvider $provider
-     * @return EventProvider
-     * @throws AlreadyExistsException
-     * @throws AuthenticationException
-     * @throws AuthorizationException
-     * @throws InputException
-     */
-    public function createEventProvider(
-        string $instanceId,
-        EventProvider $provider
-    ): EventProvider {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $uri = $this->withApiURI(
-            str_replace(
-                ["#{ims_org_id}", "#{project_id}", "#{workspace_id}"],
-                [
-                    $configuration->getProject()->getOrganization()->getId(),
-                    $configuration->getProject()->getId(),
-                    $configuration->getProject()->getWorkspace()->getId()
-                ],
-                $this->scopeConfig->getValue(self::XML_PATH_ADOBE_IO_PROVIDER_URL)
-            )
-        );
-
-        $params = [
-            "json" => [
-                "instance_id" => $instanceId,
-                "label" => $provider->getLabel(),
-                "description" => sprintf("%s (Instance %s)", $provider->getDescription(), $instanceId)
-            ]
-        ];
-
-        $eventProviderMetadata = $this->configurationProvider->getEventProviderMetadata();
-        if ($eventProviderMetadata) {
-            $params['json']['provider_metadata'] = $eventProviderMetadata;
-        }
-
-        $response = $this->doRequest(Request::HTTP_METHOD_POST, $uri, $accessToken, $configuration, $params);
-
-        if ($response->getStatusCode() == 409) {
-            throw new AlreadyExistsException(new Phrase("An event provider with the same instance ID already exists."));
-        }
-
-        if ($response->getStatusCode() == 401) {
-            throw new AuthenticationException(new Phrase("Access Token is not valid anymore"));
-        }
-
-        if ($response->getStatusCode() != 201) {
-            throw new InputException(new Phrase($response->getReasonPhrase()));
-        }
-
-        $body = $response->getBody()->getContents();
-        $data = $this->json->unserialize($body);
-
-        return $this->eventProviderFactory->create(["data" => $data]);
-    }
-
-    /**
-     * @param EventProvider $provider
-     * @param EventMetadata $eventMetadata
-     * @return void
-     * @throws AuthenticationException
-     * @throws AuthorizationException
-     * @throws InputException
-     */
-    public function createEventMetadata(
-        EventProvider $provider,
-        EventMetadata $eventMetadata
-    ) {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $uri = $this->getEventMetadataCreationUri($configuration, $provider);
-
-        $params = [
-            'json' => $eventMetadata->jsonSerialize()
-        ];
-
-        $response = $this->doRequest(Request::HTTP_METHOD_POST, $uri, $accessToken, $configuration, $params);
-
-        if ($response->getStatusCode() == 401) {
-            throw new AuthenticationException(new Phrase("Access Token is not valid anymore"));
-        }
-
-        if ($response->getStatusCode() != 201) {
-            throw new InputException(new Phrase($response->getReasonPhrase()));
-        }
-    }
-
-    /**
-     * @param EventProvider $provider
-     * @return array
-     * @throws AuthorizationException|NotFoundException
-     */
-    public function listRegisteredEventMetadata(
-        EventProvider $provider
-    ): array {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $uri = $this->getEventMetadataListUri($configuration, $provider);
-
-        $response = $this->doRequest(Request::HTTP_METHOD_GET, $uri, $accessToken, $configuration);
-
-        if ($response->getStatusCode() == 404) {
-            throw new NotFoundException(new Phrase("EventMetadata list was not found"));
-        }
-
-        $data = $this->json->unserialize($response->getBody()->getContents());
-        $eventMetadataList = [];
-        foreach ($data["_embedded"]["eventmetadata"] as $eventMetadataData) {
-            $eventType = $this->eventMetadataFactory->create(["data" => $eventMetadataData]);
-
-            $eventMetadataList[] = $eventType;
-        }
-
-        return $eventMetadataList;
-    }
-
-    /**
-     * @return EventProvider[]
-     * @throws AuthenticationException
-     * @throws AuthorizationException
-     * @throws InputException
-     * @throws NotFoundException
-     */
-    public function listEventProvider(): array
-    {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $uri = $this->withApiURI(
-            str_replace(
-                ["#{ims_org_id}"],
-                [
-                    $configuration->getProject()->getOrganization()->getId(),
-                ],
-                $this->scopeConfig->getValue(self::XML_PATH_ADOBE_IO_PROVIDER_LIST_URL)
-            )
-        );
-
-        $response = $this->doRequest(Request::HTTP_METHOD_GET, $uri, $accessToken, $configuration);
-
-        if ($response->getStatusCode() == 401) {
-            throw new AuthenticationException(new Phrase("Access Token is not valid anymore"));
-        }
-
-        if ($response->getStatusCode() != 200) {
-            throw new InputException(new Phrase($response->getReasonPhrase()));
-        }
-
-        $data = $this->json->unserialize($response->getBody()->getContents());
-        $providers = [];
-        $eventProviderMetadata = $this->configurationProvider->getEventProviderMetadata();
-        foreach ($data["_embedded"]["providers"] as $eventMetadataData) {
-            if (!$eventProviderMetadata || $eventProviderMetadata == $eventMetadataData["provider_metadata"]) {
-                $eventType = $this->eventProviderFactory->create(["data" => $eventMetadataData]);
-
-                $providers[] = $eventType;
-            }
-        }
-
-        return $providers;
-    }
-
-    /**
-     * @param EventProvider $provider
-     * @param EventMetadata $eventType
-     * @return bool
-     * @throws AuthorizationException
-     */
-    public function deleteEventMetadata(
-        EventProvider $provider,
-        EventMetadata $eventType
-    ): bool {
-        $accessToken = $this->accessTokenProvider->getAccessToken();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        $uri = $this->getEventMetadataDeleteUri($configuration, $provider, $eventType->getEventCode());
-
-        $response = $this->doRequest(Request::HTTP_METHOD_DELETE, $uri, $accessToken, $configuration);
-
-        return $response->getStatusCode() == 204;
-    }
-
-    private function doRequest(
-        string $method,
-        string $uri,
-        TokenResponseInterface $token,
-        AdobeConsoleConfiguration $configuration,
-        array $params = []
-    ): Response {
-        $client = $this->clientFactory->create();
-        $credentials = $configuration->getFirstCredential();
-
-        if (!array_key_exists('headers', $params)) {
-            $params['headers'] = [];
-        }
-
-        $params['headers']['x-api-key'] = $credentials->getJwt()->getClientId();
-        $params['headers']['Authorization'] = 'Bearer ' . $token->getAccessToken();
-
-        try {
-            $response = $client->request($method, $uri, $params);
-        } catch (GuzzleException $exception) {
-            $response = $this->responseFactory->create([
-                'status' => $exception->getCode(),
-                'reason' => sprintf(
-                    'Unsuccessful request: `%s %s` resulted in a `%s %s` response:',
-                    $method,
-                    $uri,
-                    $exception->getResponse()->getStatusCode(),
-                    $exception->getResponse()->getReasonPhrase()
-                ) . PHP_EOL . $exception->getResponse()->getBody()->getContents()
-            ]);
-        }
-
-        return $response;
-    }
-
-    /**
-     * Adds a base URI to the path
-     *
-     * @param string $uri
-     * @return string
-     */
-    private function withApiURI(string $uri): string
-    {
-        $apiURL = $this->scopeConfig->getValue(self::XML_ADOBE_IO_PATH_ENVIRONMENT) === self::ENV_STAGING
-            ? self::API_URL_STAGE
-            : self::API_URL_PROD;
-
-        return $apiURL . '/' . $uri;
-    }
-
-    /**
-     * Compute Event Metadata Delete URI
-     *
-     * @param AdobeConsoleConfiguration $configuration
-     * @param EventProvider $provider
-     * @param string $eventCode
-     * @return string
-     */
-    private function getEventMetadataDeleteUri(
-        AdobeConsoleConfiguration $configuration,
-        EventProvider $provider,
-        string $eventCode
-    ): string {
-        return str_replace(
-            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}", "#{event_code}"],
-            [
-                $configuration->getProject()->getOrganization()->getId(),
-                $configuration->getProject()->getId(),
-                $configuration->getProject()->getWorkspace()->getId(),
-                $provider->getId(),
-                $eventCode
-            ],
-            $this->withApiURI(
-                $this->scopeConfig->getValue(
-                    self::XML_PATH_ADOBE_IO_EVENTS_TYPE_DELETE_URL,
-                    ScopeInterface::SCOPE_STORE
-                )
-            )
-        );
-    }
-
-    /**
-     * Compute Event Metadata List URI
-     *
-     * @param AdobeConsoleConfiguration $configuration
-     * @param EventProvider $provider
-     * @return string
-     */
-    private function getEventMetadataListUri(AdobeConsoleConfiguration $configuration, EventProvider $provider): string
-    {
-        return str_replace(
-            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}"],
-            [
-                $configuration->getProject()->getOrganization()->getId(),
-                $configuration->getProject()->getId(),
-                $configuration->getProject()->getWorkspace()->getId(),
-                $provider->getId()
-            ],
-            $this->withApiURI(
-                $this->scopeConfig->getValue(
-                    self::XML_PATH_ADOBE_IO_EVENTS_TYPE_LIST_URL,
-                    ScopeInterface::SCOPE_STORE
-                )
-            )
-        );
-    }
-
-    /**
-     * Compute Event Metadata Creation URI
-     *
-     * @param AdobeConsoleConfiguration $configuration
-     * @param EventProvider $provider
-     * @return string
-     */
-    private function getEventMetadataCreationUri(AdobeConsoleConfiguration $configuration, EventProvider $provider): string
-    {
-        return str_replace(
-            ["#{ims_org_id}", "#{project_id}", "#{workspace_id}", "#{provider_id}"],
-            [
-                $configuration->getProject()->getOrganization()->getId(),
-                $configuration->getProject()->getId(),
-                $configuration->getProject()->getWorkspace()->getId(),
-                $provider->getId()
-            ],
-            $this->withApiURI(
-                $this->scopeConfig->getValue(
-                    self::XML_PATH_ADOBE_IO_EVENTS_CREATION_URL,
-                    ScopeInterface::SCOPE_STORE
-                )
-            )
-        );
-    }
-}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/TechnicalAccountAccessTokenProvider.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/TechnicalAccountAccessTokenProvider.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Model/TechnicalAccountAccessTokenProvider.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Model/TechnicalAccountAccessTokenProvider.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,224 +1,72 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 namespace Magento\AdobeIoEventsClient\Model;

-use Magento\AdobeIms\Model\OAuth\TokenResponse;
+use Magento\AdobeImsApi\Api\Data\TokenResponseInterface;
 use Magento\AdobeImsApi\Api\Data\TokenResponseInterfaceFactory;
 use Magento\AdobeIoEventsClient\Api\AccessTokenProviderInterface;
 use Magento\AdobeIoEventsClient\Exception\InvalidConfigurationException;
-use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\AdobeIoEventsClient\Model\ImsJwtApi\JwtClient;
 use Magento\Framework\Exception\AuthorizationException;
-use Magento\Framework\HTTP\Client\CurlFactory;
-use Magento\Framework\Jwt\JwkFactory;
-use Magento\Framework\Jwt\Jws\JwsSignatureJwks;
-use Magento\Framework\Jwt\JwtManagerInterface;
-use Magento\Framework\Serialize\Serializer\Json;
-use Magento\Framework\Stdlib\DateTime\DateTime;
-use Magento\JwtFrameworkAdapter\Model\JwsFactory;
-use Magento\Store\Model\ScopeInterface;

+/**
+ * Get the access token from the technical account JWT
+ */
 class TechnicalAccountAccessTokenProvider implements AccessTokenProviderInterface
 {
-    public const XML_PATH_IMS_JWT_EXPIRATION_INTERVAL = "adobe_io_events/integration/ims_jwt_expiration_interval";
-    public const XML_ADOBE_IO_PATH_ENVIRONMENT = 'adobe_io_events/integration/adobe_io_environment';
-
-    public const ENV_STAGING = 'staging';
-
-    private const IMS_JWT_URL_PROD = 'https://adobeid-na1.services.adobe.com/ims/exchange/jwt';
-    private const IMS_JWT_URL_STAGE = 'https://adobeid-na1-stg1.services.adobe.com/ims/exchange/jwt';
-
-    private const IMS_BASE_URL_JWT_TOKEN_PROD = 'https://ims-na1.adobelogin.com';
-    private const IMS_BASE_URL_JWT_TOKEN_STAGE = 'https://ims-na1-stg1.adobelogin.com';
-
-    /**
-     * @var JwtManagerInterface
-     */
-    private JwtManagerInterface $jwtManager;
-
-    /**
-     * @var JwkFactory
-     */
-    private JwkFactory $jwkFactory;
-
-    /**
-     * @var JwsFactory
-     */
-    private JwsFactory $jwsFactory;
-
-    /**
-     * @var CurlFactory
-     */
-    private CurlFactory $curlFactory;
-
-    /**
-     * @var Json
-     */
-    private Json $json;
-
     /**
      * @var TokenResponseInterfaceFactory
      */
     private TokenResponseInterfaceFactory $tokenResponseFactory;

     /**
-     * @var ScopeConfigInterface
-     */
-    private ScopeConfigInterface $scopeConfig;
-
-    /**
-     * @var DateTime
-     */
-    private DateTime $dateTime;
-
-    /**
-     * @var AdobeIOConfigurationProvider
+     * @var TokenResponseInterface|null
      */
-    private AdobeIOConfigurationProvider $configurationProvider;
+    private ?TokenResponseInterface $lastToken = null;

     /**
-     * @var TokenResponse|null
+     * @var JwtClient
      */
-    private ?TokenResponse $lastToken = null;
+    private JwtClient $jwtClient;

     /**
-     * @param JwtManagerInterface $jwtManager
-     * @param JwkFactory $jwkFactory
-     * @param JwsFactory $jwsFactory
-     * @param CurlFactory $curlFactory
-     * @param Json $json
      * @param TokenResponseInterfaceFactory $tokenResponseFactory
-     * @param ScopeConfigInterface $scopeConfig
-     * @param DateTime $dateTime
-     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param JwtClient $jwtClient
      */
     public function __construct(
-        JwtManagerInterface $jwtManager,
-        JwkFactory $jwkFactory,
-        JwsFactory $jwsFactory,
-        CurlFactory $curlFactory,
-        Json $json,
         TokenResponseInterfaceFactory $tokenResponseFactory,
-        ScopeConfigInterface $scopeConfig,
-        DateTime $dateTime,
-        AdobeIOConfigurationProvider $configurationProvider
+        JwtClient $jwtClient
     ) {
-        $this->jwtManager = $jwtManager;
-        $this->jwkFactory = $jwkFactory;
-        $this->jwsFactory = $jwsFactory;
-        $this->curlFactory = $curlFactory;
-        $this->json = $json;
         $this->tokenResponseFactory = $tokenResponseFactory;
-        $this->scopeConfig = $scopeConfig;
-        $this->dateTime = $dateTime;
-        $this->configurationProvider = $configurationProvider;
+        $this->jwtClient = $jwtClient;
     }

     /**
      * Call IMS to fetch Access Token from Technical Account JWT
      *
-     * @return TokenResponse
-     * @throws AuthorizationException|InvalidConfigurationException
+     * @return TokenResponseInterface
+     * @throws AuthorizationException
+     * @throws InvalidConfigurationException
      */
-    public function getAccessToken(): TokenResponse
+    public function getAccessToken(): TokenResponseInterface
     {
         if ($this->lastToken != null) {
             return $this->lastToken;
         }

-        $privateKey = $this->configurationProvider->getPrivateKey();
-        $configuration = $this->configurationProvider->getConfiguration();
-
-        try {
-            $jwk = $this->jwkFactory->createSignRs256($privateKey->getData(), null);
-        } catch (\Throwable $e) {
-            throw new InvalidConfigurationException(
-                __('Service Account Private Key is invalid. Error: %1', $e->getMessage())
-            );
-        }
-        $EncSettings = new JwsSignatureJwks($jwk);
-
-        $firstCredentials = $configuration->getFirstCredential();
-
-        $payload = [
-            "exp" => $this->getExpirationTimestamp(),
-            "iss" => $configuration->getProject()->getOrganization()->getImsOrgId(),
-            "sub" => $firstCredentials->getJwt()->getTechnicalAccountId(),
-            "aud" => $this->getImsBaseUrlJwtToken() . "/c/" . $firstCredentials->getJwt()->getClientId()
-        ];
-
-        foreach ($firstCredentials->getJwt()->getMetaScopes() as $metaScope) {
-            $payload[$this->getImsBaseUrlJwtToken() . "/s/" . $metaScope] = true;
-        }
-
-        $jws = $this->jwsFactory->create(
-            [
-                "alg" => "RS256",
-            ],
-            $this->json->serialize($payload),
-            null
-        );
-
-        $token = $this->jwtManager->create($jws, $EncSettings);
-
-        $curl = $this->curlFactory->create();
-
-        $curl->addHeader('Content-Type', 'application/x-www-form-urlencoded');
-        $curl->addHeader('cache-control', 'no-cache');
-
-        $curl->post(
-            $this->getImsJwtUrl(),
-            [
-                'client_id' => $firstCredentials->getJwt()->getClientId(),
-                'client_secret' => $firstCredentials->getJwt()->getClientSecret(),
-                'jwt_token' => $token
-            ]
-        );
-
-        $response = $this->json->unserialize($curl->getBody());
+        $response = $this->jwtClient->fetchJwtTokenResponse();

         if (!is_array($response) || empty($response['access_token'])) {
             throw new AuthorizationException(__('Could not login to Adobe IMS.'));
         }

-        $this->lastToken =  $this->tokenResponseFactory->create(['data' => $response]);
+        $this->lastToken = $this->tokenResponseFactory->create(['data' => $response]);

         return $this->lastToken;
     }
-
-    /**
-     * Compute expiration timestamp
-     *
-     * @return int
-     */
-    protected function getExpirationTimestamp(): int
-    {
-        return $this->dateTime->timestamp() + $this->scopeConfig->getValue(
-            self::XML_PATH_IMS_JWT_EXPIRATION_INTERVAL,
-            ScopeInterface::SCOPE_STORE
-        );
-    }
-
-    /**
-     * Retrieve IMS Base URL
-     *
-     * @return string
-     */
-    private function getImsBaseUrlJwtToken(): string
-    {
-        return $this->scopeConfig->getValue(self::XML_ADOBE_IO_PATH_ENVIRONMENT) === self::ENV_STAGING
-            ? self::IMS_BASE_URL_JWT_TOKEN_STAGE
-            : self::IMS_BASE_URL_JWT_TOKEN_PROD;
-    }
-
-    /**
-     * Retrieve IMS JWT Exchange URL
-     *
-     * @return string
-     */
-    private function getImsJwtUrl(): string
-    {
-        return $this->scopeConfig->getValue(self::XML_ADOBE_IO_PATH_ENVIRONMENT) === self::ENV_STAGING
-            ? self::IMS_JWT_URL_STAGE
-            : self::IMS_JWT_URL_PROD;
-    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/README.md /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/README.md
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/README.md	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/README.md	2023-05-25 20:23:48.000000000 +0100
@@ -13,15 +13,31 @@

 ## Configure Adobe Commerce for IO Events

+Depending on credential type complete steps for `OAuth Server-to-Server` or `Service Account (JWT) DEPRECATED`
+
+### OAuth Server-to-Server
+
+1. In the Adobe Developer Console, download your Adobe IO Console workspace configuration.
+2. In the Commerce admin panel, navigate to Stores > Settings > Configuration > Adobe Services > Adobe I/O Events > General configuration and make the following changes:
+    - Select `OAuth (recommended)` as  `Adobe I/O Authorization Type`
+    - Populate the `Adobe I/O Workspace Configuration` fields
+    - Enter a unique ID  in the `Adobe Commerce Instance ID` field
+
+### Service Account (JWT) DEPRECATED
+
 1. In the Adobe Developer Console, download your Adobe IO Console workspace configuration and its associated Service Account private key.
 2. In the Commerce admin panel, navigate to Stores > Settings > Configuration > Adobe Services > Adobe I/O Events > General configuration and make the following changes:
+    - Select `JWT` as  `Adobe I/O Authorization Type`
     - Populate the `Service Account Private Key` and `Adobe I/O Workspace Configuration` fields
     - Enter a unique ID  in the `Adobe Commerce Instance ID` field
-4. Run the following command to create an event provider
+
+### Create Event Provider
+
+1. Run the following command to create an event provider
 ```bash
 bin/magento events:create-event-provider --label "<unique_provider_label>" --description "<provider description>"
 ````
-5. Enter the Event Provider ID output by the command in the `Adobe I/O Event Provider ID` field
+2. Enter the Event Provider ID output by the command in the `Adobe I/O Event Provider ID` field

 # Update Events Metadata
 Events Metadata in the following format can optionally be stored in `app/etc/event-types.json`:
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/registration.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/registration.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/registration.php	2023-05-30 09:55:07.592891000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/registration.php	2023-05-25 20:23:48.000000000 +0100
@@ -1,4 +1,9 @@
 <?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);

 use Magento\Framework\Component\ComponentRegistrar;

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Setup/Patch/Data/SetAuthorizationType.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Setup/Patch/Data/SetAuthorizationType.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-adobe-io-events-client/Setup/Patch/Data/SetAuthorizationType.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-adobe-io-events-client/Setup/Patch/Data/SetAuthorizationType.php	2023-05-25 20:23:48.000000000 +0100
@@ -0,0 +1,82 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+declare(strict_types=1);
+
+namespace Magento\AdobeIoEventsClient\Setup\Patch\Data;
+
+use Magento\AdobeIoEventsClient\Model\AdobeIOConfigurationProvider;
+use Magento\AdobeIoEventsClient\Model\Config\Source\AuthorizationType;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\Config\Storage\WriterInterface;
+use Magento\Framework\Exception\LocalizedException;
+use Magento\Framework\Setup\Patch\DataPatchInterface;
+use Psr\Log\LoggerInterface;
+
+/**
+ * Sets authorization type if configuration was already set before the module upgrade.
+ */
+class SetAuthorizationType implements DataPatchInterface
+{
+    /**
+     * @param ScopeConfigInterface $scopeConfig
+     * @param WriterInterface $writer
+     * @param AdobeIOConfigurationProvider $configurationProvider
+     * @param LoggerInterface $logger
+     */
+    public function __construct(
+        private ScopeConfigInterface $scopeConfig,
+        private WriterInterface $writer,
+        private AdobeIOConfigurationProvider $configurationProvider,
+        private LoggerInterface $logger
+    ) {
+    }
+
+    /**
+     * Sets authorization type as JWT if configuration was already set before the module upgrade.
+     *
+     * Does nothing if the authorization type was already set.
+     *
+     * {@inheritDoc}
+     */
+    public function apply()
+    {
+        try {
+            $authType = $this->scopeConfig->getValue(
+                AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_AUTHORIZATION_TYPE
+            );
+            if (empty($authType)) {
+                $this->configurationProvider->getConfiguration();
+                $this->configurationProvider->getPrivateKey();
+                $this->writer->save(
+                    AdobeIOConfigurationProvider::XML_PATH_ADOBE_IO_AUTHORIZATION_TYPE,
+                    AuthorizationType::JWT
+                );
+            }
+        } catch (LocalizedException $exception) {
+            $this->logger->error(
+                'Failed to update authorization type to Adobe I/O events: ' . $exception->getMessage()
+            );
+        }
+
+        return $this;
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public static function getDependencies()
+    {
+        return [];
+    }
+
+    /**
+     * @inheritDoc
+     */
+    public function getAliases()
+    {
+        return [];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/composer.json	2023-05-30 09:55:07.648892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/composer.json	2023-05-16 15:31:48.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.2",
+    "version": "100.4.2-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontAsyncCheckoutWithBackordersTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontAsyncCheckoutWithBackordersTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontAsyncCheckoutWithBackordersTest.xml	2023-05-30 09:55:07.648892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontAsyncCheckoutWithBackordersTest.xml	2023-05-16 15:30:50.000000000 +0100
@@ -19,6 +19,7 @@
             <group value="async_checkout"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <comment userInput="BIC workaround" stepKey="enableAsyncCheckout"/>
             <magentoCLI command="config:set cataloginventory/item_options/backorders 1" stepKey="EnableBackorders"/>
             <createData entity="_defaultCategory" stepKey="createCategory"/>
@@ -36,6 +37,7 @@
             </actionGroup>
             <actionGroup ref="ResetAdminDataGridToDefaultViewActionGroup" stepKey="resetGrid"/>
             <actionGroup ref="AdminLogoutActionGroup" stepKey="adminLogout"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Guest Checkout Process-->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontGuestAsyncCheckoutWithVirtualProductAndRegistrationTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontGuestAsyncCheckoutWithVirtualProductAndRegistrationTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontGuestAsyncCheckoutWithVirtualProductAndRegistrationTest.xml	2023-05-30 09:55:07.648892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-async-order/Test/Mftf/Test/StorefrontGuestAsyncCheckoutWithVirtualProductAndRegistrationTest.xml	2023-05-16 15:30:50.000000000 +0100
@@ -19,6 +19,7 @@
             <group value="async_checkout"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <comment userInput="BIC workaround" stepKey="enableAsyncCheckout"/>
             <createData entity="_defaultCategory" stepKey="createCategory"/>
             <createData entity="defaultVirtualProduct" stepKey="createVirtualProduct">
@@ -35,6 +36,7 @@
             </actionGroup>
             <actionGroup ref="ResetAdminDataGridToDefaultViewActionGroup" stepKey="resetGrid"/>
             <actionGroup ref="AdminLogoutActionGroup" stepKey="adminLogout"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Guest Checkout Process -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-bundle/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-bundle/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-bundle/composer.json	2023-05-30 09:55:07.732892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-bundle/composer.json	2023-05-16 15:26:58.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.0.6",
+    "version": "101.0.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-bundle/view/frontend/templates/catalog/product/view/type/bundle/option/radio.phtml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-bundle/view/frontend/templates/catalog/product/view/type/bundle/option/radio.phtml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-bundle/view/frontend/templates/catalog/product/view/type/bundle/option/radio.phtml	2023-05-30 09:55:07.736892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-bundle/view/frontend/templates/catalog/product/view/type/bundle/option/radio.phtml	2023-05-16 15:24:32.000000000 +0100
@@ -4,6 +4,8 @@
  * See COPYING.txt for license details.
  */
 use Magento\Bundle\ViewModel\ValidateQuantity;
+
+// phpcs:disable Generic.Files.LineLength.TooLong
 ?>
 <?php /* @var $block \Magento\Bundle\Block\Catalog\Product\View\Type\Bundle\Option\Radio */ ?>
 <?php $_option = $block->getOption(); ?>
@@ -20,42 +22,45 @@
     </label>
     <div class="control">
         <div class="nested options-list">
-            <?php if ($block->showSingle()) : ?>
+            <?php if ($block->showSingle()): ?>
                 <?= /* @noEscape */ $block->getSelectionTitlePrice($_selections[0]) ?>
                 <?= /* @noEscape */ $block->getTierPriceRenderer()->renderTierPrice($_selections[0]) ?>
                 <input type="hidden"
-                    class="bundle-option-<?= (int)$_option->getId() ?>  product bundle option"
-                    name="bundle_option[<?= (int)$_option->getId() ?>]"
-                    value="<?= (int)$_selections[0]->getSelectionId() ?>"
-                    id="bundle-option-<?= (int)$_option->getId() ?>-<?= (int)$_selections[0]->getSelectionId() ?>"
-                    checked="checked"
+                       class="bundle-option-<?= (int)$_option->getId() ?>  product bundle option"
+                       name="bundle_option[<?= (int)$_option->getId() ?>]"
+                       value="<?= (int)$_selections[0]->getSelectionId() ?>"
+                       id="bundle-option-<?= (int)$_option->getId() ?>-<?= (int)$_selections[0]->getSelectionId() ?>"
+                       checked="checked"
                 />
-            <?php else :?>
-                <?php if (!$_option->getRequired()) : ?>
+            <?php else: ?>
+                <?php if (!$_option->getRequired()): ?>
                     <div class="field choice">
                         <input type="radio"
                                class="radio product bundle option"
                                id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>"
                                name="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                                data-selector="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
-                               <?= ($_default && $_default->isSalable())?'':' checked="checked" ' ?>
+                            <?= ($_default && $_default->isSalable())?'':' checked="checked" ' ?>
                                value=""/>
                         <label class="label" for="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>">
                             <span><?= $block->escapeHtml(__('None')) ?></span>
                         </label>
                     </div>
                 <?php endif; ?>
-                <?php foreach ($_selections as $_selection) : ?>
+                <?php foreach ($_selections as $_selection): ?>
                     <div class="field choice">
                         <input type="radio"
                                class="radio product bundle option change-container-classname"
                                id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-<?= $block->escapeHtmlAttr($_selection->getSelectionId()) ?>"
-                               <?php if ($_option->getRequired()) { echo 'data-validate="{\'validate-one-required-by-name\':true}"'; }?>
+                            <?php if ($_option->getRequired()) {
+                                echo 'data-validate="{\'validate-one-required-by-name\':true}"';
+                            } ?>
                                name="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                                data-selector="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
-                               <?php if ($block->isSelected($_selection)) { echo ' checked="checked"'; } ?>
-                               <?php if (!$_selection->isSaleable()) { echo ' disabled="disabled"'; } ?>
-                               value="<?= $block->escapeHtmlAttr($_selection->getSelectionId()) ?>"/>
+                            <?php if ($block->isSelected($_selection)) { echo ' checked="checked"'; } ?>
+                            <?php if (!$_selection->isSaleable()) { echo ' disabled="disabled"'; } ?>
+                               value="<?= $block->escapeHtmlAttr($_selection->getSelectionId()) ?>"
+                               data-errors-message-box="#validation-message-box-radio"/>
                         <label class="label"
                                for="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-<?= $block->escapeHtmlAttr($_selection->getSelectionId()) ?>">
                             <span><?= /* @noEscape */ $block->getSelectionTitlePrice($_selection) ?></span>
@@ -65,6 +70,7 @@
                     </div>
                 <?php endforeach; ?>
                 <div id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-container"></div>
+                <div id="validation-message-box-radio"></div>
             <?php endif; ?>
             <div class="field qty qty-holder">
                 <label class="label" for="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-qty-input">
@@ -72,14 +78,14 @@
                 </label>
                 <div class="control">
                     <input <?php if (!$_canChangeQty) { echo ' disabled="disabled"'; } ?>
-                           id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-qty-input"
-                           class="input-text qty<?php if (!$_canChangeQty) { echo ' qty-disabled'; } ?>"
-                           type="number"
-                           min="0"
-                           data-validate="<?= $block->escapeHtmlAttr($viewModel->getQuantityValidators()) ?>"
-                           name="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
-                           data-selector="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
-                           value="<?= $block->escapeHtmlAttr($_defaultQty) ?>"/>
+                        id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-qty-input"
+                        class="input-text qty<?php if (!$_canChangeQty) { echo ' qty-disabled'; } ?>"
+                        type="number"
+                        min="0"
+                        data-validate="<?= $block->escapeHtmlAttr($viewModel->getQuantityValidators()) ?>"
+                        name="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
+                        data-selector="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
+                        value="<?= $block->escapeHtmlAttr($_defaultQty) ?>"/>
                 </div>
             </div>
         </div>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-captcha/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-captcha/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-captcha/composer.json	2023-05-30 09:55:07.744892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-captcha/composer.json	2023-05-16 15:27:00.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-captcha/Test/Mftf/Test/StorefrontCaptchaOnOnepageCheckoutPyamentTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-captcha/Test/Mftf/Test/StorefrontCaptchaOnOnepageCheckoutPyamentTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-captcha/Test/Mftf/Test/StorefrontCaptchaOnOnepageCheckoutPyamentTest.xml	2023-05-30 09:55:07.740892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-captcha/Test/Mftf/Test/StorefrontCaptchaOnOnepageCheckoutPyamentTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -21,6 +21,7 @@
             <group value="storefront_captcha_enabled"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">20</field>
@@ -62,6 +63,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Reindex and flush cache -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/composer.json	2023-05-30 09:55:07.932893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/composer.json	2023-05-16 15:27:00.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "104.0.6",
+    "version": "104.0.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Controller/Adminhtml/Product/NewAction.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Controller/Adminhtml/Product/NewAction.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Controller/Adminhtml/Product/NewAction.php	2023-05-30 09:55:07.844892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Controller/Adminhtml/Product/NewAction.php	2023-05-16 15:24:32.000000000 +0100
@@ -4,18 +4,21 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+declare(strict_types=1);
+
 namespace Magento\Catalog\Controller\Adminhtml\Product;

-use Magento\Framework\App\Action\HttpGetActionInterface as HttpGetActionInterface;
-use Magento\Backend\App\Action;
 use Magento\Catalog\Controller\Adminhtml\Product;
+use Magento\Framework\App\Action\HttpGetActionInterface as HttpGetActionInterface;
 use Magento\Framework\App\ObjectManager;
+use Magento\Framework\RegexValidator;

 class NewAction extends \Magento\Catalog\Controller\Adminhtml\Product implements HttpGetActionInterface
 {
     /**
      * @var Initialization\StockDataFilter
      * @deprecated 101.0.0
+     * @see Initialization\StockDataFilter
      */
     protected $stockFilter;

@@ -30,23 +33,32 @@
     protected $resultForwardFactory;

     /**
-     * @param Action\Context $context
+     * @var RegexValidator
+     */
+    private RegexValidator $regexValidator;
+
+    /**
+     * @param Context $context
      * @param Builder $productBuilder
      * @param Initialization\StockDataFilter $stockFilter
      * @param \Magento\Framework\View\Result\PageFactory $resultPageFactory
      * @param \Magento\Backend\Model\View\Result\ForwardFactory $resultForwardFactory
+     * @param RegexValidator|null $regexValidator
      */
     public function __construct(
         \Magento\Backend\App\Action\Context $context,
         Product\Builder $productBuilder,
         Initialization\StockDataFilter $stockFilter,
         \Magento\Framework\View\Result\PageFactory $resultPageFactory,
-        \Magento\Backend\Model\View\Result\ForwardFactory $resultForwardFactory
+        \Magento\Backend\Model\View\Result\ForwardFactory $resultForwardFactory,
+        RegexValidator $regexValidator = null
     ) {
         $this->stockFilter = $stockFilter;
         parent::__construct($context, $productBuilder);
         $this->resultPageFactory = $resultPageFactory;
         $this->resultForwardFactory = $resultForwardFactory;
+        $this->regexValidator = $regexValidator
+            ?: ObjectManager::getInstance()->get(RegexValidator::class);
     }

     /**
@@ -56,6 +68,11 @@
      */
     public function execute()
     {
+        $typeId = $this->getRequest()->getParam('type');
+        if (!$this->regexValidator->validateParamRegex($typeId)) {
+            return $this->resultForwardFactory->create()->forward('noroute');
+        }
+
         if (!$this->getRequest()->getParam('set')) {
             return $this->resultForwardFactory->create()->forward('noroute');
         }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/i18n/en_US.csv /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/i18n/en_US.csv
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/i18n/en_US.csv	2023-05-30 09:55:07.932893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/i18n/en_US.csv	2023-05-16 15:24:32.000000000 +0100
@@ -819,4 +819,5 @@
 "Failed to retrieve product links for ""%1""","Failed to retrieve product links for ""%1"""
 "The linked product SKU is invalid. Verify the data and try again.","The linked product SKU is invalid. Verify the data and try again."
 "The linked products data is invalid. Verify the data and try again.","The linked products data is invalid. Verify the data and try again."
+"The url has invalid characters. Please correct and try again.","The url has invalid characters. Please correct and try again."

diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Mftf/Test/EndToEndB2CAdminTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Mftf/Test/EndToEndB2CAdminTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Mftf/Test/EndToEndB2CAdminTest.xml	2023-05-30 09:55:07.904893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Mftf/Test/EndToEndB2CAdminTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -18,13 +18,16 @@
             <testCaseId value="MAGETWO-87014"/>
             <group value="pr_exclude"/>
         </annotations>
+        <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
+        </before>
         <after>
             <actionGroup ref="AdminLogoutActionGroup" stepKey="logoutOfAdmin"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!--Login to Admin Area-->
         <actionGroup ref="AdminLoginActionGroup" stepKey="loginToAdminArea"/>
-
         <!--Admin creates product-->
         <!--Create Simple Product-->
         <actionGroup ref="AdminOpenProductIndexPageActionGroup" stepKey="visitAdminProductPageSimple"/>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Unit/Controller/Adminhtml/Product/NewActionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Unit/Controller/Adminhtml/Product/NewActionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Unit/Controller/Adminhtml/Product/NewActionTest.php	2023-05-30 09:55:07.912893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Unit/Controller/Adminhtml/Product/NewActionTest.php	2023-05-16 15:24:32.000000000 +0100
@@ -16,6 +16,9 @@
 use Magento\Catalog\Controller\Adminhtml\Product\NewAction;
 use Magento\Catalog\Model\Product;
 use Magento\Catalog\Test\Unit\Controller\Adminhtml\ProductTest;
+use Magento\Framework\RegexValidator;
+use Magento\Framework\Validator\Regex;
+use Magento\Framework\Validator\RegexFactory;
 use Magento\Framework\TestFramework\Unit\Helper\ObjectManager;
 use Magento\Framework\View\Result\PageFactory;
 use PHPUnit\Framework\MockObject\MockObject;
@@ -42,6 +45,26 @@
      */
     protected $initializationHelper;

+    /**
+     * @var RegexValidator|MockObject
+     */
+    private $regexValidator;
+
+    /**
+     * @var RegexFactory
+     */
+    private $regexValidatorFactoryMock;
+
+    /**
+     * @var Regex|MockObject
+     */
+    private $regexValidatorMock;
+
+    /**
+     * @var ForwardFactory&MockObject|MockObject
+     */
+    private $resultForwardFactory;
+
     protected function setUp(): void
     {
         $this->productBuilder = $this->createPartialMock(
@@ -63,37 +86,78 @@
             ->disableOriginalConstructor()
             ->setMethods(['create'])
             ->getMock();
-        $resultPageFactory->expects($this->atLeastOnce())
-            ->method('create')
-            ->willReturn($this->resultPage);

         $this->resultForward = $this->getMockBuilder(Forward::class)
             ->disableOriginalConstructor()
             ->getMock();
-        $resultForwardFactory = $this->getMockBuilder(ForwardFactory::class)
+        $this->resultForwardFactory = $this->getMockBuilder(ForwardFactory::class)
+            ->disableOriginalConstructor()
+            ->onlyMethods(['create'])
+            ->getMock();
+
+        $this->regexValidatorFactoryMock = $this->getMockBuilder(RegexFactory::class)
             ->disableOriginalConstructor()
             ->setMethods(['create'])
             ->getMock();
-        $resultForwardFactory->expects($this->any())
-            ->method('create')
-            ->willReturn($this->resultForward);
+        $this->regexValidatorMock = $this->createMock(Regex::class);
+        $this->regexValidatorFactoryMock->method('create')
+            ->willReturn($this->regexValidatorMock);

+        $this->regexValidator = new regexValidator($this->regexValidatorFactoryMock);
         $this->action = (new ObjectManager($this))->getObject(
             NewAction::class,
             [
                 'context' => $this->initContext(),
                 'productBuilder' => $this->productBuilder,
                 'resultPageFactory' => $resultPageFactory,
-                'resultForwardFactory' => $resultForwardFactory,
+                'resultForwardFactory' => $this->resultForwardFactory,
+                'regexValidator' => $this->regexValidator,
             ]
         );
     }

-    public function testExecute()
+    /**
+     * Test execute method input validation.
+     *
+     * @param string $value
+     * @param bool $exceptionThrown
+     * @dataProvider validationCases
+     */
+    public function testExecute(string $value, bool $exceptionThrown): void
+    {
+        if ($exceptionThrown) {
+            $this->action->getRequest()->expects($this->any())
+                ->method('getParam')
+                ->willReturn($value);
+            $this->resultForwardFactory->expects($this->any())
+                ->method('create')
+                ->willReturn($this->resultForward);
+            $this->resultForward->expects($this->once())
+                ->method('forward')
+                ->with('noroute')
+                ->willReturn(true);
+            $this->assertTrue($this->action->execute());
+        } else {
+            $this->action->getRequest()->expects($this->any())->method('getParam')->willReturn($value);
+            $this->regexValidatorMock->expects($this->any())
+                ->method('isValid')
+                ->with($value)
+                ->willReturn(true);
+
+            $this->assertEquals(true, $this->regexValidator->validateParamRegex($value));
+        }
+    }
+
+    /**
+     * Validation cases.
+     *
+     * @return array
+     */
+    public function validationCases(): array
     {
-        $this->action->getRequest()->expects($this->any())->method('getParam')->willReturn(true);
-        $this->action->getRequest()->expects($this->any())->method('getFullActionName')
-            ->willReturn('catalog_product_new');
-        $this->action->execute();
+        return [
+            'execute-with-exception' => ['simple\' and true()]|*[self%3a%3ahandle%20or%20self%3a%3alayout',true],
+            'execute-without-exception' => ['catalog_product_new',false]
+        ];
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Unit/Pricing/Render/FinalPriceBoxTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Unit/Pricing/Render/FinalPriceBoxTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/Test/Unit/Pricing/Render/FinalPriceBoxTest.php	2023-05-30 09:55:07.928893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/Test/Unit/Pricing/Render/FinalPriceBoxTest.php	2023-05-16 15:24:32.000000000 +0100
@@ -15,8 +15,11 @@
 use Magento\Catalog\Pricing\Render\FinalPriceBox;
 use Magento\Framework\App\Cache\StateInterface;
 use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\DeploymentConfig;
 use Magento\Framework\App\State;
+use Magento\Framework\Config\ConfigOptionsListConstants;
 use Magento\Framework\Event\Test\Unit\ManagerStub;
+use Magento\Framework\ObjectManagerInterface;
 use Magento\Framework\Pricing\Amount\AmountInterface;
 use Magento\Framework\Pricing\Price\PriceInterface;
 use Magento\Framework\Pricing\PriceInfoInterface;
@@ -97,10 +100,26 @@
     private $minimalPriceCalculator;

     /**
+     * @var DeploymentConfig|MockObject
+     */
+    private $deploymentConfig;
+
+    /**
+     * @var ObjectManagerInterface|MockObject
+     */
+    private $objectManagerMock;
+
+    /**
      * @inheritDoc
+     * @SuppressWarnings(PHPMD.ExcessiveMethodLength)
      */
     protected function setUp(): void
     {
+        $this->objectManagerMock = $this->getMockBuilder(ObjectManagerInterface::class)
+            ->disableOriginalConstructor()
+            ->onlyMethods(['get'])
+            ->getMockForAbstractClass();
+        \Magento\Framework\App\ObjectManager::setInstance($this->objectManagerMock);
         $this->product = $this->getMockBuilder(Product::class)
             ->addMethods(['getCanShowPrice'])
             ->onlyMethods(['getPriceInfo', 'isSalable', 'getId'])
@@ -183,6 +202,11 @@
             ->disableOriginalConstructor()
             ->getMockForAbstractClass();

+        $this->deploymentConfig = $this->createPartialMock(
+            DeploymentConfig::class,
+            ['get']
+        );
+
         $this->minimalPriceCalculator = $this->getMockForAbstractClass(MinimalPriceCalculatorInterface::class);
         $this->object = $objectManager->getObject(
             FinalPriceBox::class,
@@ -455,6 +479,15 @@
      */
     public function testGetCacheKey(): void
     {
+        $this->objectManagerMock->expects($this->any())
+            ->method('get')
+            ->with(DeploymentConfig::class)
+            ->willReturn($this->deploymentConfig);
+
+        $this->deploymentConfig->expects($this->any())
+            ->method('get')
+            ->with(ConfigOptionsListConstants::CONFIG_PATH_CRYPT_KEY)
+            ->willReturn('448198e08af35844a42d3c93c1ef4e03');
         $result = $this->object->getCacheKey();
         $this->assertStringEndsWith('list-category-page', $result);
     }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/view/adminhtml/web/js/category-tree.js /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/view/adminhtml/web/js/category-tree.js
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog/view/adminhtml/web/js/category-tree.js	2023-05-30 09:55:07.940893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog/view/adminhtml/web/js/category-tree.js	2023-05-16 15:24:32.000000000 +0100
@@ -5,10 +5,9 @@

 define([
     'jquery',
-    'mageUtils',
     'jquery/ui',
     'jquery/jstree/jquery.jstree'
-], function ($, utils) {
+], function ($) {
     'use strict';

     $.widget('mage.categoryTree', {
@@ -87,7 +86,7 @@
             // jscs:disable requireCamelCaseOrUpperCaseIdentifiers
             result = {
                 id: node.id,
-                text: utils.unescape(node.name) + ' (' + node.product_count + ')',
+                text: node.name + ' (' + node.product_count + ')',
                 li_attr: {
                     class: node.cls + (!!node.disabled ? ' disabled' : '') //eslint-disable-line no-extra-boolean-cast
                 },
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-import-export/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-import-export/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-import-export/composer.json	2023-05-30 09:55:07.764892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-import-export/composer.json	2023-05-16 15:27:02.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.1.6",
+    "version": "101.1.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "ext-ctype": "*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-import-export/Model/Import/Product.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-import-export/Model/Import/Product.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-import-export/Model/Import/Product.php	2023-05-30 09:55:07.760892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-import-export/Model/Import/Product.php	2023-05-16 15:24:32.000000000 +0100
@@ -48,6 +48,7 @@
  */
 class Product extends AbstractEntity
 {
+    private const COL_NAME_FORMAT = '/[\x00-\x1F\x7F]/';
     private const DEFAULT_GLOBAL_MULTIPLE_VALUE_SEPARATOR = ',';
     public const CONFIG_KEY_PRODUCT_TYPES = 'global/importexport/import_product_types';

@@ -1624,6 +1625,12 @@
                         // the bunch of products will pass for the event with url_key column.
                         $bunch[$rowNum][self::URL_KEY] = $rowData[self::URL_KEY] = $urlKey;
                     }
+
+                    if (!empty($rowData[self::COL_NAME])) {
+                        // remove null byte character
+                        $rowData[self::COL_NAME] = preg_replace(self::COL_NAME_FORMAT, '', $rowData[self::COL_NAME]);
+                    }
+
                     $rowSku = $rowData[self::COL_SKU];
                     if (null === $rowSku) {
                         $this->getErrorAggregator()->addRowToSkip($rowNum);
@@ -1660,7 +1667,7 @@
                         $prevAttributeSet,
                         $attributes
                     );
-                // phpcs:ignore Magento2.CodeAnalysis.EmptyBlock.DetectedCatch
+                    // phpcs:ignore Magento2.CodeAnalysis.EmptyBlock.DetectedCatch
                 } catch (Skip $skip) {
                     // Product is skipped.  Go on to the next one.
                 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-url-rewrite-staging/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-url-rewrite-staging/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-catalog-url-rewrite-staging/composer.json	2023-05-30 09:55:07.824892000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-catalog-url-rewrite-staging/composer.json	2023-05-16 15:31:52.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.5",
+    "version": "100.4.5-p1",
     "require": {
         "magento/framework": "103.0.*",
         "magento/module-catalog": "104.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/composer.json	2023-05-30 09:55:07.976893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/composer.json	2023-05-16 15:27:06.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/etc/adminhtml/system.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/etc/adminhtml/system.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/etc/adminhtml/system.xml	2023-05-30 09:55:07.976893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/etc/adminhtml/system.xml	2023-05-16 15:24:32.000000000 +0100
@@ -13,6 +13,11 @@
             <resource>Magento_Checkout::checkout</resource>
             <group id="options" translate="label" type="text" sortOrder="1" showInDefault="1" showInWebsite="1" showInStore="1">
                 <label>Checkout Options</label>
+                <field id="enable_guest_checkout_login" translate="label" type="select" sortOrder="4" showInDefault="1" showInWebsite="1" showInStore="1" canRestore="1">
+                    <label>Enable Guest Checkout Login</label>
+                    <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
+                    <comment>Enabling this setting will allow unauthenticated users to query if an e-mail address is already associated with a customer account. This can be used to enhance the checkout workflow for guests that do not realize they already have an account but comes at the cost of exposing information to unauthenticated users.</comment>
+                </field>
                 <field id="onepage_checkout_enabled" translate="label" type="select" sortOrder="5" showInDefault="1" showInWebsite="1" showInStore="1" canRestore="1">
                     <label>Enable Onepage Checkout</label>
                     <source_model>Magento\Config\Model\Config\Source\Yesno</source_model>
@@ -23,7 +28,7 @@
                 </field>
                 <field id="display_billing_address_on" translate="label" type="select" sortOrder="20" showInDefault="1" showInWebsite="1" showInStore="1" canRestore="1">
                     <label>Display Billing Address On</label>
-                    <source_model>\Magento\Checkout\Model\Adminhtml\BillingAddressDisplayOptions</source_model>
+                    <source_model>Magento\Checkout\Model\Adminhtml\BillingAddressDisplayOptions</source_model>
                 </field>
                 <field id="max_items_display_count" translate="label" type="text" sortOrder="30" showInDefault="1" showInWebsite="1" showInStore="1" canRestore="1">
                     <label>Maximum Number of Items to Display in Order Summary</label>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/etc/config.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/etc/config.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/etc/config.xml	2023-05-30 09:55:07.976893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/etc/config.xml	2023-05-16 15:24:32.000000000 +0100
@@ -9,6 +9,7 @@
     <default>
         <checkout>
             <options>
+                <enable_guest_checkout_login>0</enable_guest_checkout_login>
                 <onepage_checkout_enabled>1</onepage_checkout_enabled>
                 <guest_checkout>1</guest_checkout>
                 <display_billing_address_on>0</display_billing_address_on>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Model/ShippingInformationManagement.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Model/ShippingInformationManagement.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Model/ShippingInformationManagement.php	2023-05-30 09:55:07.960893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Model/ShippingInformationManagement.php	2023-05-16 15:24:32.000000000 +0100
@@ -3,6 +3,7 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+declare(strict_types=1);

 namespace Magento\Checkout\Model;

@@ -39,60 +40,62 @@
     /**
      * @var PaymentMethodManagementInterface
      */
-    protected $paymentMethodManagement;
+    protected PaymentMethodManagementInterface $paymentMethodManagement;

     /**
      * @var PaymentDetailsFactory
      */
-    protected $paymentDetailsFactory;
+    protected PaymentDetailsFactory $paymentDetailsFactory;

     /**
      * @var CartTotalRepositoryInterface
      */
-    protected $cartTotalsRepository;
+    protected CartTotalRepositoryInterface $cartTotalsRepository;

     /**
      * @var CartRepositoryInterface
      */
-    protected $quoteRepository;
-
+    protected CartRepositoryInterface $quoteRepository;
     /**
      * @var Logger
      */
-    protected $logger;
+    protected Logger $logger;

     /**
      * @var QuoteAddressValidator
      */
-    protected $addressValidator;
+    protected QuoteAddressValidator $addressValidator;

     /**
      * @var AddressRepositoryInterface
      * @deprecated 100.2.0
+     * @see AddressRepositoryInterface
      */
-    protected $addressRepository;
+    protected AddressRepositoryInterface $addressRepository;

     /**
      * @var ScopeConfigInterface
      * @deprecated 100.2.0
+     * @see ScopeConfigInterface
      */
-    protected $scopeConfig;
+    protected ScopeConfigInterface $scopeConfig;

     /**
      * @var TotalsCollector
      * @deprecated 100.2.0
+     * @see TotalsCollector
      */
-    protected $totalsCollector;
+    protected TotalsCollector $totalsCollector;

     /**
      * @var CartExtensionFactory
      */
-    private $cartExtensionFactory;
+    private CartExtensionFactory $cartExtensionFactory;

     /**
      * @var ShippingAssignmentFactory
      */
-    protected $shippingAssignmentFactory;
+    protected ShippingAssignmentFactory $shippingAssignmentFactory;

     /**
      * @var ShippingFactory
@@ -262,8 +265,11 @@
      * @param string $method
      * @return CartInterface
      */
-    private function prepareShippingAssignment(CartInterface $quote, AddressInterface $address, $method): CartInterface
-    {
+    private function prepareShippingAssignment(
+        CartInterface $quote,
+        AddressInterface $address,
+        string $method
+    ): CartInterface {
         $cartExtension = $quote->getExtensionAttributes();
         if ($cartExtension === null) {
             $cartExtension = $this->cartExtensionFactory->create();
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingDefaultAddressTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingDefaultAddressTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingDefaultAddressTest.xml	2023-05-30 09:55:07.968893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingDefaultAddressTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -20,11 +20,11 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
             </createData>
-
             <!-- Create customer -->
             <createData entity="Simple_US_Customer_Multiple_Addresses" stepKey="createCustomer"/>
         </before>
@@ -40,6 +40,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Add Simple Product to cart -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingNonDefaultAddressTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingNonDefaultAddressTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingNonDefaultAddressTest.xml	2023-05-30 09:55:07.968893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/OnePageCheckoutAsCustomerUsingNonDefaultAddressTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -40,6 +41,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Add Simple Product to cart -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCheckoutWithSpecialPriceProductsTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCheckoutWithSpecialPriceProductsTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCheckoutWithSpecialPriceProductsTest.xml	2023-05-30 09:55:07.972893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCheckoutWithSpecialPriceProductsTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -18,6 +18,7 @@
         </annotations>

         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <actionGroup ref="AdminLoginActionGroup" stepKey="loginToAdminPanel"/>
             <createData entity="Simple_US_Customer" stepKey="createCustomer"/>
             <createData entity="defaultSimpleProduct" stepKey="simpleProduct">
@@ -105,6 +106,7 @@

             <!-- Reindex invalidated indices after product attribute has been created/deleted -->
             <magentoCron groups="index" stepKey="reindexInvalidatedIndices"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!--Open Product page in StoreFront and assert product and price range -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCustomerLoginDuringCheckoutTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCustomerLoginDuringCheckoutTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCustomerLoginDuringCheckoutTest.xml	2023-05-30 09:55:07.972893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-checkout/Test/Mftf/Test/StorefrontCustomerLoginDuringCheckoutTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -19,6 +19,7 @@
             <group value="OnePageCheckout"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create simple product -->
             <createData entity="SimpleProduct2" stepKey="createProduct"/>

@@ -39,9 +40,9 @@
             <actionGroup ref="AdminDeleteCustomerActionGroup" stepKey="deleteCustomer">
                 <argument name="customerEmail" value="CustomerEntityOne.email"/>
             </actionGroup>
-
             <!-- Logout admin -->
             <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>
         <!-- Go to Storefront as Guest and create new account -->
         <actionGroup ref="StorefrontOpenCustomerAccountCreatePageActionGroup" stepKey="openCreateAccountPage"/>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Api/AccountManagementInterface.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Api/AccountManagementInterface.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Api/AccountManagementInterface.php	2023-05-30 09:55:08.112894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Api/AccountManagementInterface.php	2023-05-16 15:24:32.000000000 +0100
@@ -8,6 +8,7 @@
 namespace Magento\Customer\Api;

 use Magento\Framework\Exception\InputException;
+use Magento\Framework\Exception\LocalizedException;

 /**
  * Interface for managing customers accounts.
@@ -194,7 +195,7 @@
      * Check if given email is associated with a customer account in given website.
      *
      * @param string $customerEmail
-     * @param int $websiteId If not set, will use the current websiteId
+     * @param int|null $websiteId If not set, will use the current websiteId
      * @return bool
      * @throws \Magento\Framework\Exception\LocalizedException
      */
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/composer.json	2023-05-30 09:55:08.152894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/composer.json	2023-05-16 15:27:10.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "103.0.6",
+    "version": "103.0.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Model/AccountManagement.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Model/AccountManagement.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Model/AccountManagement.php	2023-05-30 09:55:08.120894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Model/AccountManagement.php	2023-05-16 15:24:32.000000000 +0100
@@ -70,6 +70,11 @@
 class AccountManagement implements AccountManagementInterface
 {
     /**
+     * System Configuration Path for Enable/Disable Login at Guest Checkout
+     */
+    public const GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG = 'checkout/options/enable_guest_checkout_login';
+
+    /**
      * Configuration paths for create account email template
      *
      * @deprecated Get rid of Helpers in Password Security Management
@@ -719,7 +724,7 @@
         throw new InputException(
             __(
                 'Invalid value of "%value" provided for the %fieldName field. '
-                    . 'Possible values: %template1 or %template2.',
+                . 'Possible values: %template1 or %template2.',
                 [
                     'value' => $template,
                     'fieldName' => 'template',
@@ -1125,7 +1130,7 @@
         $result = $this->eavValidator->isValid($customerModel);
         if ($result === false && is_array($this->eavValidator->getMessages())) {
             return $validationResults->setIsValid(false)->setMessages(
-                // phpcs:ignore Magento2.Functions.DiscouragedFunction
+            // phpcs:ignore Magento2.Functions.DiscouragedFunction
                 call_user_func_array(
                     'array_merge',
                     array_values($this->eavValidator->getMessages())
@@ -1137,9 +1142,24 @@

     /**
      * @inheritdoc
+     *
+     * @param string $customerEmail
+     * @param int|null $websiteId
+     * @return bool
+     * @throws LocalizedException
      */
     public function isEmailAvailable($customerEmail, $websiteId = null)
     {
+        $guestLoginConfig = $this->scopeConfig->getValue(
+            self::GUEST_CHECKOUT_LOGIN_OPTION_SYS_CONFIG,
+            ScopeInterface::SCOPE_WEBSITE,
+            $websiteId
+        );
+
+        if (!$guestLoginConfig) {
+            return true;
+        }
+
         try {
             if ($websiteId === null) {
                 $websiteId = $this->storeManager->getStore()->getWebsiteId();
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Test/Mftf/Test/EndToEndB2CLoggedInUserTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Test/Mftf/Test/EndToEndB2CLoggedInUserTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer/Test/Mftf/Test/EndToEndB2CLoggedInUserTest.xml	2023-05-30 09:55:08.136894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer/Test/Mftf/Test/EndToEndB2CLoggedInUserTest.xml	2023-05-16 15:24:32.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="SearchEngine"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <resetCookie userInput="PHPSESSID" stepKey="resetCookieForCart"/>
             <actionGroup ref="AdminLoginActionGroup" after="resetCookieForCart" stepKey="loginAsAdmin"/>
         </before>
@@ -29,6 +30,7 @@
             <actionGroup ref="DeleteCustomerFromAdminActionGroup" stepKey="deleteCustomerFromAdmin"/>
             <actionGroup ref="ClearFiltersAdminDataGridActionGroup" stepKey="clearProductsGridFilters"/>
             <actionGroup ref="AdminLogoutActionGroup" stepKey="adminLogout"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>
         <!-- Step 0: User signs up an account -->
         <comment userInput="Start of signing up user account" stepKey="startOfSigningUpUserAccount" />
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/composer.json	2023-05-30 09:55:08.076893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/composer.json	2023-05-16 15:31:54.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "magento/framework": "103.0.*",
         "magento/module-backend": "102.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndCouponForAllCustomerGroupsTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndCouponForAllCustomerGroupsTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndCouponForAllCustomerGroupsTest.xml	2023-05-30 09:55:08.072893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndCouponForAllCustomerGroupsTest.xml	2023-05-16 15:30:50.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -70,6 +71,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Clean Invalidated Caches -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditTest.xml	2023-05-30 09:55:08.072893000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-customer-balance/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditTest.xml	2023-05-16 15:30:50.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -43,7 +44,6 @@
         <after>
             <!-- Disabled payment method -->
             <magentoCLI command="config:set {{BankTransferDisabledConfigData.path}} {{BankTransferDisabledConfigData.value}}" stepKey="disabledBankTransfer"/>
-
             <!-- Customer and admin logout -->
             <actionGroup ref="StorefrontCustomerLogoutActionGroup" stepKey="customerLogout"/>
             <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
@@ -54,6 +54,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Reindex and flush cache -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-email/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-email/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-email/composer.json	2023-05-30 09:55:08.220894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-email/composer.json	2023-05-16 15:27:14.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.1.6",
+    "version": "101.1.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-email/Model/Template/Filter.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-email/Model/Template/Filter.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-email/Model/Template/Filter.php	2023-05-30 09:55:08.216894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-email/Model/Template/Filter.php	2023-05-16 15:24:34.000000000 +0100
@@ -69,16 +69,23 @@
     /**
      * @var bool
      * @deprecated SID is not being used as query parameter anymore.
+     * @see Session ID's in URL
      */
     protected $_useSessionInUrl = false;

     /**
      * @var array
      * @deprecated 101.0.4 Use the new Directive Processor interfaces
+     * @see Directive Processor interfaces
      */
     protected $_modifiers = ['nl2br' => ''];

     /**
+     * @var string
+     */
+    private const CACHE_KEY_PREFIX = "EMAIL_FILTER_";
+
+    /**
      * @var bool
      */
     private $isChildTemplate = false;
@@ -281,6 +288,7 @@
      * @return $this
      * @SuppressWarnings(PHPMD.UnusedFormalParameter)
      * @deprecated SID query parameter is not used in URLs anymore.
+     * @see SessionId's in URL
      */
     public function setUseSessionInUrl($flag)
     {
@@ -404,6 +412,11 @@
     {
         $skipParams = ['class', 'id', 'output'];
         $blockParameters = $this->getParameters($construction[2]);
+
+        if (isset($blockParameters['cache_key'])) {
+            $blockParameters['cache_key'] = self::CACHE_KEY_PREFIX . $blockParameters['cache_key'];
+        }
+
         $block = null;

         if (isset($blockParameters['class'])) {
@@ -688,6 +701,7 @@
      * @param string $default assumed modifier if none present
      * @return array
      * @deprecated 101.0.4 Use the new FilterApplier or Directive Processor interfaces
+     * @see Directive Processor Interfaces
      */
     protected function explodeModifiers($value, $default = null)
     {
@@ -707,6 +721,7 @@
      * @param string $modifiers
      * @return string
      * @deprecated 101.0.4 Use the new FilterApplier or Directive Processor interfaces
+     * @see Directive Processor Interfaces
      */
     protected function applyModifiers($value, $modifiers)
     {
@@ -736,6 +751,7 @@
      * @param string $type
      * @return string
      * @deprecated 101.0.4 Use the new FilterApplier or Directive Processor interfaces
+     * @see Directive Processor Interfacees
      */
     public function modifierEscape($value, $type = 'html')
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/composer.json	2023-05-30 09:55:08.224894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/composer.json	2023-05-16 15:27:14.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.4",
+    "version": "100.4.4-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "lib-libxml": "*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/etc/adminhtml/system.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/etc/adminhtml/system.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/etc/adminhtml/system.xml	2023-05-30 09:55:08.224894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/etc/adminhtml/system.xml	2023-05-16 15:24:34.000000000 +0100
@@ -40,12 +40,14 @@
                 </field>
                 <field id="production_webservices_url" translate="label" type="text" sortOrder="90" showInDefault="1" showInWebsite="1" canRestore="1">
                     <label>Web-Services URL (Production)</label>
+                    <backend_model>Magento\Fedex\Model\Config\Backend\FedexUrl</backend_model>
                     <depends>
                         <field id="sandbox_mode">0</field>
                     </depends>
                 </field>
                 <field id="sandbox_webservices_url" translate="label" type="text" sortOrder="100" showInDefault="1" showInWebsite="1" canRestore="1">
                     <label>Web-Services URL (Sandbox)</label>
+                    <backend_model>Magento\Fedex\Model\Config\Backend\FedexUrl</backend_model>
                     <depends>
                         <field id="sandbox_mode">1</field>
                     </depends>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/i18n/en_US.csv /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/i18n/en_US.csv
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/i18n/en_US.csv	2023-05-30 09:55:08.228894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/i18n/en_US.csv	2023-05-16 15:24:34.000000000 +0100
@@ -78,3 +78,4 @@
 "Show Method if Not Applicable","Show Method if Not Applicable"
 "Sort Order","Sort Order"
 "Can't convert a shipping cost from ""%1-%2"" for FedEx carrier.","Can't convert a shipping cost from ""%1-%2"" for FedEx carrier."
+"Fedex API endpoint URL\'s must use fedex.com","Fedex API endpoint URL\'s must use fedex.com"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/Model/Config/Backend/FedexUrl.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/Model/Config/Backend/FedexUrl.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/Model/Config/Backend/FedexUrl.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/Model/Config/Backend/FedexUrl.php	2023-05-16 15:24:34.000000000 +0100
@@ -0,0 +1,76 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+
+declare(strict_types=1);
+
+namespace Magento\Fedex\Model\Config\Backend;
+
+use Magento\Framework\App\Cache\TypeListInterface;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\Config\Value;
+use Magento\Framework\Data\Collection\AbstractDb;
+use Magento\Framework\Exception\ValidatorException;
+use Magento\Framework\Model\AbstractModel;
+use Magento\Framework\Model\Context;
+use Magento\Framework\Model\ResourceModel\AbstractResource;
+use Magento\Framework\Registry;
+use Magento\Framework\Validator\Url;
+
+/**
+ * Represents a config URL that may point to a Fedex endpoint
+ */
+class FedexUrl extends Value
+{
+    /**
+     * @var Url
+     */
+    private Url $url;
+    /**
+     * @param Context $context
+     * @param Registry $registry
+     * @param ScopeConfigInterface $config
+     * @param TypeListInterface $cacheTypeList
+     * @param AbstractResource|null $resource
+     * @param AbstractDb|null $resourceCollection
+     * @param Url $url
+     * @param array $data
+     */
+    public function __construct(
+        Context $context,
+        Registry $registry,
+        ScopeConfigInterface $config,
+        TypeListInterface $cacheTypeList,
+        AbstractResource $resource = null,
+        AbstractDb $resourceCollection = null,
+        Url $url,
+        array $data = []
+    ) {
+        parent::__construct($context, $registry, $config, $cacheTypeList, $resource, $resourceCollection, $data);
+        $this->url = $url;
+    }
+
+    /**
+     * @inheritDoc
+     *
+     * @return AbstractModel
+     * @throws ValidatorException
+     */
+    public function beforeSave(): AbstractModel
+    {
+        $isValid = $this->url->isValid($this->getValue(), ['http', 'https']);
+
+        if ($isValid) {
+            // phpcs:ignore Magento2.Functions.DiscouragedFunction
+            $host = parse_url((string)$this->getValue(), \PHP_URL_HOST);
+
+            if (!empty($host) && !preg_match('/(?:.+\.|^)fedex\.com$/i', $host)) {
+                throw new ValidatorException(__('Fedex API endpoint URL\'s must use fedex.com'));
+            }
+        }
+
+        return parent::beforeSave();
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/Test/Unit/Model/Config/Backend/FedexUrlTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/Test/Unit/Model/Config/Backend/FedexUrlTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-fedex/Test/Unit/Model/Config/Backend/FedexUrlTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-fedex/Test/Unit/Model/Config/Backend/FedexUrlTest.php	2023-05-16 15:24:34.000000000 +0100
@@ -0,0 +1,131 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+
+declare(strict_types=1);
+
+namespace Magento\Fedex\Test\Unit\Model\Config\Backend;
+
+use Magento\Fedex\Model\Config\Backend\FedexUrl;
+use Magento\Framework\App\Cache\TypeListInterface;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\Data\Collection\AbstractDb;
+use Magento\Framework\Event\ManagerInterface;
+use Magento\Framework\Exception\ValidatorException;
+use Magento\Framework\Model\Context;
+use Magento\Framework\Registry;
+use Magento\Framework\TestFramework\Unit\Helper\ObjectManager;
+use Magento\Framework\Validator\Url;
+use Magento\Rule\Model\ResourceModel\AbstractResource;
+use PHPUnit\Framework\MockObject\MockObject;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Verify behavior of FedexUrl backend type
+ */
+class FedexUrlTest extends TestCase
+{
+
+    /**
+     * @var FedexUrl
+     */
+    private $urlConfig;
+
+    /**
+     * @var Url
+     */
+    private $url;
+
+    /**
+     * @var Context|MockObject
+     */
+    private $contextMock;
+
+    protected function setUp(): void
+    {
+        $objectManager = new ObjectManager($this);
+        $this->contextMock = $this->createMock(Context::class);
+        $registry = $this->createMock(Registry::class);
+        $config = $this->createMock(ScopeConfigInterface::class);
+        $cacheTypeList = $this->createMock(TypeListInterface::class);
+        $this->url = $this->createMock(Url::class);
+        $resource = $this->createMock(AbstractResource::class);
+        $resourceCollection = $this->createMock(AbstractDb::class);
+        $eventManagerMock = $this->getMockForAbstractClass(ManagerInterface::class);
+        $eventManagerMock->expects($this->any())->method('dispatch');
+        $this->contextMock->expects($this->any())->method('getEventDispatcher')->willReturn($eventManagerMock);
+
+        $this->urlConfig = $objectManager->getObject(
+            FedexUrl::class,
+            [
+                'url' => $this->url,
+                'context' => $this->contextMock,
+                'registry' => $registry,
+                'config' => $config,
+                'cacheTypeList' => $cacheTypeList,
+                'resource' => $resource,
+                'resourceCollection' => $resourceCollection,
+            ]
+        );
+    }
+
+    /**
+     * @dataProvider validDataProvider
+     * @param string|null $data The valid data
+     * @throws ValidatorException
+     */
+    public function testBeforeSave(string $data = null): void
+    {
+        $this->url->expects($this->any())->method('isValid')->willReturn(true);
+        $this->urlConfig->setValue($data);
+        $this->urlConfig->beforeSave();
+        $this->assertTrue($this->url->isValid($data));
+    }
+
+    /**
+     * @dataProvider invalidDataProvider
+     * @param string $data The invalid data
+     */
+    public function testBeforeSaveErrors(string $data): void
+    {
+        $this->url->expects($this->any())->method('isValid')->willReturn(true);
+        $this->expectException('Magento\Framework\Exception\ValidatorException');
+        $this->expectExceptionMessage('Fedex API endpoint URL\'s must use fedex.com');
+        $this->urlConfig->setValue($data);
+        $this->urlConfig->beforeSave();
+    }
+
+    /**
+     * Validator Data Provider
+     *
+     * @return array
+     */
+    public function validDataProvider(): array
+    {
+        return [
+            [],
+            [null],
+            [''],
+            ['http://fedex.com'],
+            ['https://foo.fedex.com'],
+            ['http://foo.fedex.com/foo/bar?baz=bash&fizz=buzz'],
+        ];
+    }
+
+    /**
+     * @return \string[][]
+     */
+    public function invalidDataProvider(): array
+    {
+        return [
+            ['http://fedexfoo.com'],
+            ['https://foofedex.com'],
+            ['https://fedex.com.fake.com'],
+            ['https://fedex.info'],
+            ['http://fedex.com.foo.com/foo/bar?baz=bash&fizz=buzz'],
+            ['http://foofedex.com/foo/bar?baz=bash&fizz=buzz'],
+        ];
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-card-account/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-card-account/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-card-account/composer.json	2023-05-30 09:55:08.232894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-card-account/composer.json	2023-05-16 15:31:56.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.2.6",
+    "version": "101.2.6-p1",
     "require": {
         "magento/framework": "103.0.*",
         "magento/module-backend": "102.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-card-account/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndGiftCardTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-card-account/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndGiftCardTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-card-account/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndGiftCardTest.xml	2023-05-30 09:55:08.232894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-card-account/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingStoreCreditAndGiftCardTest.xml	2023-05-16 15:30:52.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -52,6 +53,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/composer.json	2023-05-30 09:55:08.268894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/composer.json	2023-05-16 15:31:58.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.2.6",
+    "version": "101.2.6-p1",
     "require": {
         "magento/framework": "103.0.*",
         "magento/module-backend": "102.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/Controller/Index/EditPost.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/Controller/Index/EditPost.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/Controller/Index/EditPost.php	2023-05-30 09:55:08.260894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/Controller/Index/EditPost.php	2023-05-16 15:30:52.000000000 +0100
@@ -5,12 +5,27 @@
  * See COPYING.txt for license details.
  */

+declare(strict_types=1);
+
 namespace Magento\GiftRegistry\Controller\Index;

+use Magento\GiftRegistry\Controller\Index;
+use Magento\Customer\Model\Address;
+use Magento\Customer\Model\Customer;
+use Magento\Customer\Model\Session;
 use Magento\Framework\App\ResponseInterface;
 use Magento\Framework\Exception\LocalizedException;
-
-class EditPost extends \Magento\GiftRegistry\Controller\Index
+use Magento\GiftRegistry\Helper\Data;
+use Magento\GiftRegistry\Model\Entity;
+use Magento\GiftRegistry\Model\Person;
+use Psr\Log\LoggerInterface;
+
+/**
+ * EditPost class is used to add or update gift registry
+ *
+ * @SuppressWarnings(PHPMD.AllPurposeAction)
+ */
+class EditPost extends Index
 {
     /**
      * Strip tags from received data
@@ -60,20 +75,21 @@
             $isError = false;
             $isAddAction = true;
             try {
+                /* @var $model Entity */
+                $model = $this->_initEntity('entity_id');
                 if ($entityId) {
                     $isAddAction = false;
-                    $model = $this->_initEntity('entity_id');
                 }
                 if ($isAddAction) {
                     $entityId = null;
-                    $model = $this->_objectManager->create(\Magento\GiftRegistry\Model\Entity::class);
+                    $model = $this->_objectManager->create(Entity::class);
                     if ($model->setTypeById($typeId) === false) {
                         throw new LocalizedException(__('The type is incorrect. Verify and try again.'));
                     }
                 }

                 $data = $this->_objectManager->get(
-                    \Magento\GiftRegistry\Helper\Data::class
+                    Data::class
                 )->filterDatesByFormat(
                     $data,
                     $model->getDateFieldArray()
@@ -84,41 +100,37 @@

                 $registrantsPost = $this->getRequest()->getPost('registrant');
                 $persons = [];
-                if (is_array($registrantsPost)) {
-                    foreach ($registrantsPost as $registrant) {
-                        if (is_array($registrant)) {
-                            /* @var $person \Magento\GiftRegistry\Model\Person */
-                            $person = $this->_objectManager->create(\Magento\GiftRegistry\Model\Person::class);
-                            $idField = $person->getIdFieldName();
-                            if (!empty($registrant[$idField])) {
-                                $person->load($registrant[$idField]);
-                                if (!$person->getId()) {
-                                    throw new LocalizedException(
-                                        __('The registrant data is incorrect. Verify and try again.')
-                                    );
-                                }
-                            } else {
-                                unset($registrant['person_id']);
-                            }
-                            $person->setData($registrant);
-                            $errors = $person->validate();
-                            if ($errors !== true) {
-                                foreach ($errors as $err) {
-                                    $this->messageManager->addError($err);
-                                }
-                                $isError = true;
-                            } else {
-                                $persons[] = $person;
-                            }
+                foreach ($registrantsPost as $registrant) {
+                    /* @var $person Person */
+                    $person = $this->_objectManager->create(Person::class);
+                    $idField = $person->getIdFieldName();
+                    if (!empty($registrant[$idField])) {
+                        $person->load($registrant[$idField]);
+                        if (!$person->getId()) {
+                            throw new LocalizedException(
+                                __('The registrant data is incorrect. Verify and try again.')
+                            );
                         }
+                    } else {
+                        unset($registrant['person_id']);
+                    }
+                    $person->setData($registrant);
+                    $errors = $person->validate();
+                    if ($errors !== true) {
+                        foreach ($errors as $err) {
+                            $this->messageManager->addError($err);
+                        }
+                        $isError = true;
+                    } else {
+                        $persons[] = $person;
                     }
                 }
                 $addressTypeOrId = $this->getRequest()->getParam('address_type_or_id');
-                if (!$addressTypeOrId || $addressTypeOrId == \Magento\GiftRegistry\Helper\Data::ADDRESS_NEW) {
+                if (!$addressTypeOrId || $addressTypeOrId === Data::ADDRESS_NEW) {
                     // creating new address
                     if (!empty($data['address'])) {
-                        /* @var $address \Magento\Customer\Model\Address */
-                        $address = $this->_objectManager->create(\Magento\Customer\Model\Address::class);
+                        /* @var $address Address */
+                        $address = $this->_objectManager->create(Address::class);
                         $address->setData($data['address']);
                         $errors = $address->validate();
                         $model->importAddress($address);
@@ -131,14 +143,14 @@
                         }
                         $isError = true;
                     }
-                } elseif ($addressTypeOrId != \Magento\GiftRegistry\Helper\Data::ADDRESS_NONE) {
+                } elseif ($addressTypeOrId !== Data::ADDRESS_NONE) {
                     // using one of existing Customer addresses
                     $addressId = $addressTypeOrId;
                     if (!$addressId) {
                         throw new LocalizedException(__('An address needs to be selected. Select and try again.'));
                     }
-                    /* @var $customer \Magento\Customer\Model\Customer */
-                    $customer = $this->_objectManager->get(\Magento\Customer\Model\Session::class)->getCustomer();
+                    /* @var $customer Customer */
+                    $customer = $this->_objectManager->get(Session::class)->getCustomer();

                     $address = $customer->getAddressItemById($addressId);
                     if (!$address) {
@@ -156,21 +168,7 @@

                 if (!$isError) {
                     $model->save();
-                    $entityId = $model->getId();
-                    $personLeft = [];
-                    foreach ($persons as $person) {
-                        $person->setEntityId($entityId);
-                        $person->save();
-                        $personLeft[] = $person->getId();
-                    }
-                    if (!$isAddAction) {
-                        $this->_objectManager->create(
-                            \Magento\GiftRegistry\Model\Person::class
-                        )->getResource()->deleteOrphan(
-                            $entityId,
-                            $personLeft
-                        );
-                    }
+                    $this->updateRegistrantsForEntity($model, $persons, $isAddAction);
                     $this->messageManager->addSuccess(__('You saved this gift registry.'));
                     if ($isAddAction) {
                         $model->sendNewRegistryEmail();
@@ -181,7 +179,7 @@
                 $isError = true;
             } catch (\Exception $e) {
                 $this->messageManager->addError(__("We couldn't save this gift registry."));
-                $this->_objectManager->get(\Psr\Log\LoggerInterface::class)->critical($e);
+                $this->_objectManager->get(LoggerInterface::class)->critical($e);
                 $isError = true;
             }

@@ -195,4 +193,55 @@
         }
         $this->_redirect('*/*/');
     }
+
+    /**
+     * Update registrants for a gift registry
+     *
+     * @param Entity $entity
+     * @param array $persons
+     * @param bool $isAddAction
+     * @return void
+     */
+    private function updateRegistrantsForEntity(Entity $entity, array $persons, bool $isAddAction): void
+    {
+        $entityId = $entity->getId();
+        $personLeft = [];
+        $registrants = $this->getRegistrantsForEntity($entity);
+        foreach ($persons as $person) {
+            $person->setEntityId($entityId);
+            // Checking gift registry with only existing registrants
+            if (!$isAddAction) {
+                if ($person->getId() !== null && !in_array($person->getId(), $registrants)) {
+                    continue;
+                }
+            }
+            $person->save();
+            $personLeft[] = $person->getId();
+        }
+        // Remove orphan persons
+        if (!$isAddAction && !empty($personLeft)) {
+            $this->_objectManager->create(
+                Person::class
+            )->getResource()->deleteOrphan(
+                $entityId,
+                $personLeft
+            );
+        }
+    }
+
+    /**
+     * Get registrants for a gift registry
+     *
+     * @param Entity $entity
+     * @return array $registrants
+     */
+    private function getRegistrantsForEntity(Entity $entity): array
+    {
+        $registrants = [];
+        foreach ($entity->getRegistrantsCollection() as $registrant) {
+            $registrants[] = $registrant->getPersonId();
+        }
+
+        return $registrants;
+    }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/Model/ResourceModel/Person.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/Model/ResourceModel/Person.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-gift-registry/Model/ResourceModel/Person.php	2023-05-30 09:55:08.264894000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-gift-registry/Model/ResourceModel/Person.php	2023-05-16 15:30:52.000000000 +0100
@@ -3,15 +3,21 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+
+declare(strict_types=1);
+
 namespace Magento\GiftRegistry\Model\ResourceModel;

+use Magento\Framework\Model\AbstractModel;
+use Magento\Framework\Model\ResourceModel\Db\AbstractDb;
+
 /**
  * Gift registry entity registrants resource model
  *
  * @api
  * @since 100.0.2
  */
-class Person extends \Magento\Framework\Model\ResourceModel\Db\AbstractDb
+class Person extends AbstractDb
 {
     /**
      * Resource model initialization
@@ -26,10 +32,10 @@
     /**
      * Serialization for custom attributes
      *
-     * @param \Magento\Framework\Model\AbstractModel $object
+     * @param AbstractModel $object
      * @return $this
      */
-    protected function _beforeSave(\Magento\Framework\Model\AbstractModel $object)
+    protected function _beforeSave(AbstractModel $object)
     {
         $object->setCustomValues($this->getSerializer()->serialize($object->getCustom()));
         return parent::_beforeSave($object);
@@ -38,10 +44,10 @@
     /**
      * De-serialization for custom attributes
      *
-     * @param \Magento\Framework\Model\AbstractModel $object
+     * @param AbstractModel $object
      * @return $this
      */
-    protected function _afterLoad(\Magento\Framework\Model\AbstractModel $object)
+    protected function _afterLoad(AbstractModel $object)
     {
         $object->setCustom($this->getSerializer()->unserialize($object->getCustomValues()));
         return parent::_afterLoad($object);
@@ -60,9 +66,7 @@
         $connection = $this->getConnection();
         $condition = [];
         $condition[] = $connection->quoteInto('entity_id = ?', (int)$entityId);
-        if (is_array($personLeft) && !empty($personLeft)) {
-            $condition[] = $connection->quoteInto('person_id NOT IN (?)', $personLeft);
-        }
+        $condition[] = $connection->quoteInto('person_id NOT IN (?)', $personLeft);
         $connection->delete($this->getMainTable(), $condition);

         return $this;
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/composer.json	2023-05-30 09:55:08.776896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/composer.json	2023-05-16 15:27:28.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.2.6",
+    "version": "101.2.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/i18n/en_US.csv /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/i18n/en_US.csv
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/i18n/en_US.csv	2023-05-30 09:55:08.776896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/i18n/en_US.csv	2023-05-16 15:24:34.000000000 +0100
@@ -69,3 +69,4 @@
 "Validated Country Code","Validated Country Code"
 "Validated Vat Number","Validated Vat Number"
 "Invalid Quote Item id %1","Invalid Quote Item id %1"
+"Invalid quote address id %1","Invalid quote address id %1"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/Model/BillingAddressManagement.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/Model/BillingAddressManagement.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/Model/BillingAddressManagement.php	2023-05-30 09:55:08.768896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/Model/BillingAddressManagement.php	2023-05-16 15:24:34.000000000 +0100
@@ -3,14 +3,15 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+declare(strict_types=1);

 namespace Magento\Quote\Model;

+use Magento\Framework\App\ObjectManager;
 use Magento\Framework\Exception\InputException;
-use Magento\Quote\Model\Quote\Address\BillingAddressPersister;
-use Psr\Log\LoggerInterface as Logger;
 use Magento\Quote\Api\BillingAddressManagementInterface;
-use Magento\Framework\App\ObjectManager;
+use Magento\Quote\Api\Data\AddressInterface;
+use Psr\Log\LoggerInterface as Logger;

 /**
  * Quote billing address write service object.
@@ -25,14 +26,14 @@
     protected $addressValidator;

     /**
-     * Logger.
+     * Logger object.
      *
      * @var Logger
      */
     protected $logger;

     /**
-     * Quote repository.
+     * Quote repository object.
      *
      * @var \Magento\Quote\Api\CartRepositoryInterface
      */
@@ -72,10 +73,14 @@
      * @inheritdoc
      * @SuppressWarnings(PHPMD.NPathComplexity)
      */
-    public function assign($cartId, \Magento\Quote\Api\Data\AddressInterface $address, $useForShipping = false)
+    public function assign($cartId, AddressInterface $address, $useForShipping = false)
     {
         /** @var \Magento\Quote\Model\Quote $quote */
         $quote = $this->quoteRepository->getActive($cartId);
+
+        // validate the address
+        $this->addressValidator->validateWithExistingAddress($quote, $address);
+
         $address->setCustomerId($quote->getCustomerId());
         $quote->removeAddress($quote->getBillingAddress()->getId());
         $quote->setBillingAddress($address);
@@ -104,6 +109,7 @@
      *
      * @return \Magento\Quote\Model\ShippingAddressAssignment
      * @deprecated 101.0.0
+     * @see \Magento\Quote\Model\Quote\Address
      */
     private function getShippingAddressAssignment()
     {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/Model/QuoteAddressValidator.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/Model/QuoteAddressValidator.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote/Model/QuoteAddressValidator.php	2023-05-30 09:55:08.772896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote/Model/QuoteAddressValidator.php	2023-05-16 15:24:34.000000000 +0100
@@ -3,8 +3,15 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+declare(strict_types=1);
+
 namespace Magento\Quote\Model;

+use Magento\Customer\Api\AddressRepositoryInterface;
+use Magento\Customer\Api\CustomerRepositoryInterface;
+use Magento\Customer\Model\Session;
+use Magento\Framework\Exception\InputException;
+use Magento\Framework\Exception\LocalizedException;
 use Magento\Framework\Exception\NoSuchEntityException;
 use Magento\Quote\Api\Data\AddressInterface;
 use Magento\Quote\Api\Data\CartInterface;
@@ -17,35 +24,33 @@
 class QuoteAddressValidator
 {
     /**
-     * Address factory.
-     *
-     * @var \Magento\Customer\Api\AddressRepositoryInterface
+     * @var AddressRepositoryInterface
      */
-    protected $addressRepository;
+    protected AddressRepositoryInterface $addressRepository;

     /**
-     * Customer repository.
-     *
-     * @var \Magento\Customer\Api\CustomerRepositoryInterface
+     * @var CustomerRepositoryInterface
      */
-    protected $customerRepository;
+    protected CustomerRepositoryInterface $customerRepository;

     /**
+     * @var Session
      * @deprecated 101.1.1 This class is not a part of HTML presentation layer and should not use sessions.
+     * @see Session
      */
-    protected $customerSession;
+    protected Session $customerSession;

     /**
      * Constructs a quote shipping address validator service object.
      *
-     * @param \Magento\Customer\Api\AddressRepositoryInterface $addressRepository
-     * @param \Magento\Customer\Api\CustomerRepositoryInterface $customerRepository Customer repository.
-     * @param \Magento\Customer\Model\Session $customerSession
+     * @param AddressRepositoryInterface $addressRepository
+     * @param CustomerRepositoryInterface $customerRepository Customer repository.
+     * @param Session $customerSession
      */
     public function __construct(
-        \Magento\Customer\Api\AddressRepositoryInterface $addressRepository,
-        \Magento\Customer\Api\CustomerRepositoryInterface $customerRepository,
-        \Magento\Customer\Model\Session $customerSession
+        AddressRepositoryInterface $addressRepository,
+        CustomerRepositoryInterface $customerRepository,
+        Session $customerSession
     ) {
         $this->addressRepository = $addressRepository;
         $this->customerRepository = $customerRepository;
@@ -56,10 +61,10 @@
      * Validate address.
      *
      * @param AddressInterface $address
-     * @param int|null $customerId Cart belongs to
+     * @param int|null $customerId
      * @return void
-     * @throws \Magento\Framework\Exception\InputException The specified address belongs to another customer.
-     * @throws \Magento\Framework\Exception\NoSuchEntityException The specified customer ID or address ID is not valid.
+     * @throws LocalizedException The specified customer ID or address ID is not valid.
+     * @throws NoSuchEntityException The specified customer ID or address ID is not valid.
      */
     private function doValidate(AddressInterface $address, ?int $customerId): void
     {
@@ -67,7 +72,7 @@
         if ($customerId) {
             $customer = $this->customerRepository->getById($customerId);
             if (!$customer->getId()) {
-                throw new \Magento\Framework\Exception\NoSuchEntityException(
+                throw new NoSuchEntityException(
                     __('Invalid customer id %1', $customerId)
                 );
             }
@@ -76,7 +81,7 @@
         if ($address->getCustomerAddressId()) {
             //Existing address cannot belong to a guest
             if (!$customerId) {
-                throw new \Magento\Framework\Exception\NoSuchEntityException(
+                throw new NoSuchEntityException(
                     __('Invalid customer address id %1', $address->getCustomerAddressId())
                 );
             }
@@ -84,7 +89,7 @@
             try {
                 $this->addressRepository->getById($address->getCustomerAddressId());
             } catch (NoSuchEntityException $e) {
-                throw new \Magento\Framework\Exception\NoSuchEntityException(
+                throw new NoSuchEntityException(
                     __('Invalid address id %1', $address->getId())
                 );
             }
@@ -94,7 +99,7 @@
                 return $address->getId();
             }, $this->customerRepository->getById($customerId)->getAddresses());
             if (!in_array($address->getCustomerAddressId(), $applicableAddressIds)) {
-                throw new \Magento\Framework\Exception\NoSuchEntityException(
+                throw new NoSuchEntityException(
                     __('Invalid customer address id %1', $address->getCustomerAddressId())
                 );
             }
@@ -104,12 +109,12 @@
     /**
      * Validates the fields in a specified address data object.
      *
-     * @param \Magento\Quote\Api\Data\AddressInterface $addressData The address data object.
+     * @param AddressInterface $addressData The address data object.
      * @return bool
-     * @throws \Magento\Framework\Exception\InputException The specified address belongs to another customer.
-     * @throws \Magento\Framework\Exception\NoSuchEntityException The specified customer ID or address ID is not valid.
+     * @throws InputException The specified address belongs to another customer.
+     * @throws NoSuchEntityException|LocalizedException The specified customer ID or address ID is not valid.
      */
-    public function validate(AddressInterface $addressData)
+    public function validate(AddressInterface $addressData): bool
     {
         $this->doValidate($addressData, $addressData->getCustomerId());

@@ -117,16 +122,62 @@
     }

     /**
+     * Validate Quest Address for guest user
+     *
+     * @param AddressInterface $address
+     * @param CartInterface $cart
+     * @return void
+     * @throws NoSuchEntityException
+     */
+    private function doValidateForGuestQuoteAddress(AddressInterface $address, CartInterface $cart): void
+    {
+        //validate guest cart address
+        if ($address->getId() !== null) {
+            $old = $cart->getAddressById($address->getId());
+
+            if ($old === false) {
+                throw new NoSuchEntityException(
+                    __('Invalid quote address id %1', $address->getId())
+                );
+            }
+        }
+    }
+
+    /**
      * Validate address to be used for cart.
      *
      * @param CartInterface $cart
      * @param AddressInterface $address
      * @return void
-     * @throws \Magento\Framework\Exception\InputException The specified address belongs to another customer.
-     * @throws \Magento\Framework\Exception\NoSuchEntityException The specified customer ID or address ID is not valid.
+     * @throws InputException The specified address belongs to another customer.
+     * @throws NoSuchEntityException|LocalizedException The specified customer ID or address ID is not valid.
      */
     public function validateForCart(CartInterface $cart, AddressInterface $address): void
     {
-        $this->doValidate($address, $cart->getCustomerIsGuest() ? null : $cart->getCustomer()->getId());
+        if ($cart->getCustomerIsGuest()) {
+            $this->doValidateForGuestQuoteAddress($address, $cart);
+        }
+        $this->doValidate($address, $cart->getCustomerIsGuest() ? null : (int) $cart->getCustomer()->getId());
+    }
+
+    /**
+     * Validate address id to be used for cart.
+     *
+     * @param CartInterface $cart
+     * @param AddressInterface $address
+     * @return void
+     * @throws NoSuchEntityException The specified customer ID or address ID is not valid.
+     */
+    public function validateWithExistingAddress(CartInterface $cart, AddressInterface $address): void
+    {
+        // check if address belongs to quote.
+        if ($address->getId() !== null) {
+            $old = $cart->getAddressesCollection()->getItemById($address->getId());
+            if ($old === null) {
+                throw new NoSuchEntityException(
+                    __('Invalid quote address id %1', $address->getId())
+                );
+            }
+        }
     }
 }
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote-graph-ql/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote-graph-ql/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote-graph-ql/composer.json	2023-05-30 09:55:08.768896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote-graph-ql/composer.json	2023-05-16 15:27:28.000000000 +0100
@@ -6,7 +6,7 @@
         "OSL-3.0",
         "AFL-3.0"
     ],
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote-graph-ql/Model/Resolver/RemoveItemFromCart.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote-graph-ql/Model/Resolver/RemoveItemFromCart.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-quote-graph-ql/Model/Resolver/RemoveItemFromCart.php	2023-05-30 09:55:08.764896000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-quote-graph-ql/Model/Resolver/RemoveItemFromCart.php	2023-05-16 15:24:34.000000000 +0100
@@ -86,6 +86,8 @@
         $itemId = $processedArgs['input']['cart_item_id'];

         $storeId = (int)$context->getExtensionAttributes()->getStore()->getId();
+        /** Check if the current user is allowed to perform actions with the cart */
+        $cart = $this->getCartForUser->execute($maskedCartId, $context->getUserId(), $storeId);

         try {
             $this->cartItemRepository->deleteById($cartId, $itemId);
@@ -95,7 +97,6 @@
             throw new GraphQlInputException(__($e->getMessage()), $e);
         }

-        $cart = $this->getCartForUser->execute($maskedCartId, $context->getUserId(), $storeId);
         return [
             'cart' => [
                 'model' => $cart,
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reports/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reports/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reports/composer.json	2023-05-30 09:55:08.808897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reports/composer.json	2023-05-16 15:27:30.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reports/Test/Unit/Model/ResourceModel/Order/CollectionTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reports/Test/Unit/Model/ResourceModel/Order/CollectionTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reports/Test/Unit/Model/ResourceModel/Order/CollectionTest.php	2023-05-30 09:55:08.808897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reports/Test/Unit/Model/ResourceModel/Order/CollectionTest.php	2023-05-16 15:24:34.000000000 +0100
@@ -138,6 +138,10 @@
             ->getMock();
         $this->timezoneMock = $this->getMockBuilder(TimezoneInterface::class)
             ->getMock();
+        $this->timezoneMock
+            ->expects($this->any())
+            ->method('getConfigTimezone')
+            ->willReturn('America/Chicago');
         $this->configMock = $this->getMockBuilder(Config::class)
             ->disableOriginalConstructor()
             ->getMock();
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/composer.json	2023-05-30 09:55:08.832897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/composer.json	2023-05-16 15:32:02.000000000 +0100
@@ -8,7 +8,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "101.2.6",
+    "version": "101.2.6-p1",
     "require": {
         "magento/framework": "103.0.*",
         "magento/module-authorization": "100.4.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsAndCouponForAllCustomerGroupsTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsAndCouponForAllCustomerGroupsTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsAndCouponForAllCustomerGroupsTest.xml	2023-05-30 09:55:08.828897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsAndCouponForAllCustomerGroupsTest.xml	2023-05-16 15:30:52.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -84,6 +85,7 @@

             <!-- Delete customer -->
             <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Add Simple Product to cart -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsGiftCardCouponForAllCustomerGroupsTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsGiftCardCouponForAllCustomerGroupsTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsGiftCardCouponForAllCustomerGroupsTest.xml	2023-05-30 09:55:08.828897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingRewardPointsGiftCardCouponForAllCustomerGroupsTest.xml	2023-05-16 15:30:52.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -97,6 +98,7 @@
             <!-- Disable free shipping -->
             <createData entity="DefaultShippingMethodsConfig" stepKey="defaultShippingMethodsConfig"/>
             <createData entity="DisableFreeShippingConfig" stepKey="disableFreeShippingConfig"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Check gift card and grab generated code -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingSalesRuleWithRewardPointsTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingSalesRuleWithRewardPointsTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingSalesRuleWithRewardPointsTest.xml	2023-05-30 09:55:08.828897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-reward/Test/Mftf/Test/OnePageCheckoutAsRegisteredUSCustomerUsingSalesRuleWithRewardPointsTest.xml	2023-05-16 15:30:52.000000000 +0100
@@ -20,6 +20,7 @@
             <group value="mtf_migrated"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <!-- Create Simple Product -->
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct">
                 <field key="price">560</field>
@@ -63,6 +64,7 @@
             <!-- Disable free shipping -->
             <createData entity="DefaultShippingMethodsConfig" stepKey="defaultShippingMethodsConfig"/>
             <createData entity="DisableFreeShippingConfig" stepKey="disableFreeShippingConfig"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <!-- Search and go to cart price rule page -->
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-rma-graph-ql/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-rma-graph-ql/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-rma-graph-ql/composer.json	2023-05-30 09:55:08.836897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-rma-graph-ql/composer.json	2023-05-16 15:32:04.000000000 +0100
@@ -6,7 +6,7 @@
         "OSL-3.0",
         "AFL-3.0"
     ],
-    "version": "100.4.5",
+    "version": "100.4.5-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/composer.json	2023-05-30 09:55:08.936897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/composer.json	2023-05-16 15:27:32.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "103.0.6",
+    "version": "103.0.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/Controller/Adminhtml/Order/Create/LoadBlock.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/Controller/Adminhtml/Order/Create/LoadBlock.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/Controller/Adminhtml/Order/Create/LoadBlock.php	2023-05-30 09:55:08.896897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/Controller/Adminhtml/Order/Create/LoadBlock.php	2023-05-16 15:24:34.000000000 +0100
@@ -3,18 +3,26 @@
  * Copyright © Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
+declare(strict_types=1);
+
 namespace Magento\Sales\Controller\Adminhtml\Order\Create;

-use Magento\Framework\App\Action\HttpGetActionInterface;
-use Magento\Framework\App\Action\HttpPostActionInterface as HttpPostActionInterface;
 use Magento\Backend\App\Action;
+use Magento\Backend\App\Action\Context;
 use Magento\Backend\Model\View\Result\ForwardFactory;
-use Magento\Framework\View\Result\PageFactory;
+use Magento\Framework\App\Action\HttpGetActionInterface;
+use Magento\Framework\App\Action\HttpPostActionInterface as HttpPostActionInterface;
 use Magento\Framework\App\ObjectManager;
 use Magento\Framework\Controller\Result\RawFactory;
+use Magento\Framework\Exception\LocalizedException;
+use Magento\Framework\RegexValidator;
+use Magento\Framework\View\Result\PageFactory;
 use Magento\Sales\Controller\Adminhtml\Order\Create as CreateAction;
 use Magento\Store\Model\StoreManagerInterface;

+/**
+ * @SuppressWarnings(PHPMD.CouplingBetweenObjects)
+ */
 class LoadBlock extends CreateAction implements HttpPostActionInterface, HttpGetActionInterface
 {
     /**
@@ -28,13 +36,19 @@
     private $storeManager;

     /**
-     * @param Action\Context $context
-     * @param \Magento\Catalog\Helper\Product $productHelper
-     * @param \Magento\Framework\Escaper $escaper
+     * @var RegexValidator
+     */
+    private RegexValidator $regexValidator;
+
+    /**
+     * @param Context $context
+     * @param Product $productHelper
+     * @param Escaper $escaper
      * @param PageFactory $resultPageFactory
      * @param ForwardFactory $resultForwardFactory
      * @param RawFactory $resultRawFactory
      * @param StoreManagerInterface|null $storeManager
+     * @param RegexValidator|null $regexValidator
      */
     public function __construct(
         Action\Context $context,
@@ -43,7 +57,8 @@
         PageFactory $resultPageFactory,
         ForwardFactory $resultForwardFactory,
         RawFactory $resultRawFactory,
-        StoreManagerInterface $storeManager = null
+        StoreManagerInterface $storeManager = null,
+        RegexValidator $regexValidator = null
     ) {
         $this->resultRawFactory = $resultRawFactory;
         parent::__construct(
@@ -55,6 +70,8 @@
         );
         $this->storeManager = $storeManager ?: ObjectManager::getInstance()
             ->get(StoreManagerInterface::class);
+        $this->regexValidator = $regexValidator
+            ?: ObjectManager::getInstance()->get(RegexValidator::class);
     }

     /**
@@ -64,6 +81,7 @@
      *
      * @SuppressWarnings(PHPMD.CyclomaticComplexity)
      * @SuppressWarnings(PHPMD.NPathComplexity)
+     * @throws LocalizedException
      */
     public function execute()
     {
@@ -84,6 +102,12 @@
         $asJson = $request->getParam('json');
         $block = $request->getParam('block');

+        if ($block && !$this->regexValidator->validateParamRegex($block)) {
+            throw new LocalizedException(
+                __('The url has invalid characters. Please correct and try again.')
+            );
+        }
+
         /** @var \Magento\Framework\View\Result\Page $resultPage */
         $resultPage = $this->resultPageFactory->create();
         if ($asJson) {
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/Test/Mftf/Test/StorefrontCreateOrderWithDifferentAddressesTest.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/Test/Mftf/Test/StorefrontCreateOrderWithDifferentAddressesTest.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-sales/Test/Mftf/Test/StorefrontCreateOrderWithDifferentAddressesTest.xml	2023-05-30 09:55:08.924897000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-sales/Test/Mftf/Test/StorefrontCreateOrderWithDifferentAddressesTest.xml	2023-05-16 15:24:34.000000000 +0100
@@ -15,15 +15,16 @@
             <group value="sales"/>
         </annotations>
         <before>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 1" stepKey="EnablingGuestCheckoutLogin"/>
             <createData entity="SimpleProduct2" stepKey="createSimpleProduct"/>
             <createData entity="Customer_UK_US" stepKey="createCustomer"/>
         </before>
         <after>
             <deleteData createDataKey="createCustomer" stepKey="deleteCreateCustomer"/>
             <deleteData createDataKey="createSimpleProduct" stepKey="deleteSimpleProduct"/>
-
             <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
             <actionGroup ref="StorefrontCustomerLogoutActionGroup" stepKey="logoutCustomer"/>
+            <magentoCLI command="config:set checkout/options/enable_guest_checkout_login 0" stepKey="DisablingGuestCheckoutLogin"/>
         </after>

         <actionGroup ref="OpenStoreFrontProductPageActionGroup" stepKey="navigateToProductPage">
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-swatches/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-swatches/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-swatches/composer.json	2023-05-30 09:55:09.036898000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-swatches/composer.json	2023-05-16 15:27:36.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.6",
+    "version": "100.4.6-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "magento/framework": "103.0.*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-swatches/Test/Unit/Block/Product/Renderer/Listing/ConfigurableTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-swatches/Test/Unit/Block/Product/Renderer/Listing/ConfigurableTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-swatches/Test/Unit/Block/Product/Renderer/Listing/ConfigurableTest.php	2023-05-30 09:55:09.036898000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-swatches/Test/Unit/Block/Product/Renderer/Listing/ConfigurableTest.php	2023-05-16 15:24:34.000000000 +0100
@@ -23,8 +23,11 @@
 use Magento\Framework\App\Config\ScopeConfigInterface;
 use Magento\Framework\App\Request\Http;
 use Magento\Framework\App\RequestInterface;
+use Magento\Framework\App\DeploymentConfig;
+use Magento\Framework\Config\ConfigOptionsListConstants;
 use Magento\Framework\Json\EncoderInterface;
 use Magento\Framework\Model\AbstractModel;
+use Magento\Framework\ObjectManagerInterface;
 use Magento\Framework\Pricing\PriceCurrencyInterface;
 use Magento\Framework\Pricing\PriceInfo\Base;
 use Magento\Framework\Stdlib\ArrayUtils;
@@ -95,8 +98,23 @@
      */
     private $request;

+    /**
+     * @var ObjectManagerInterface|MockObject
+     */
+    private $objectManagerMock;
+
+    /**
+     * @var DeploymentConfig|MockObject
+     */
+    private $deploymentConfig;
+
     protected function setUp(): void
     {
+        $this->objectManagerMock = $this->getMockBuilder(ObjectManagerInterface::class)
+            ->disableOriginalConstructor()
+            ->onlyMethods(['get'])
+            ->getMockForAbstractClass();
+        \Magento\Framework\App\ObjectManager::setInstance($this->objectManagerMock);
         $this->arrayUtils = $this->createMock(ArrayUtils::class);
         $this->jsonEncoder = $this->getMockForAbstractClass(EncoderInterface::class);
         $this->helper = $this->createMock(Data::class);
@@ -127,6 +145,16 @@
         $context = $this->getContextMock();
         $context->method('getRequest')->willReturn($this->request);

+        $this->deploymentConfig = $this->createPartialMock(
+            DeploymentConfig::class,
+            ['get']
+        );
+
+        $this->deploymentConfig->expects($this->any())
+            ->method('get')
+            ->with(ConfigOptionsListConstants::CONFIG_PATH_CRYPT_KEY)
+            ->willReturn('448198e08af35844a42d3c93c1ef4e03');
+
         $objectManagerHelper = new ObjectManager($this);
         $this->configurable = $objectManagerHelper->getObject(
             ConfigurableRenderer::class,
@@ -146,7 +174,7 @@
                 'configurableAttributeData' => $this->configurableAttributeData,
                 'data' => [],
                 'variationPrices' => $this->variationPricesMock,
-                'customerSession' => $customerSession,
+                'customerSession' => $customerSession
             ]
         );
     }
@@ -308,6 +336,10 @@
             ->willReturn($configurableAttributes);

         $this->request->method('toArray')->willReturn($requestParams);
+        $this->objectManagerMock->expects($this->any())
+            ->method('get')
+            ->with(DeploymentConfig::class)
+            ->willReturn($this->deploymentConfig);
         $this->assertStringContainsString(
             sha1(json_encode(['color' => 59, 'size' => 1])),
             $this->configurable->getCacheKey()
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/composer.json /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/composer.json
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/composer.json	2023-05-30 09:55:09.132898000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/composer.json	2023-05-16 15:27:38.000000000 +0100
@@ -9,7 +9,7 @@
     "config": {
         "sort-packages": true
     },
-    "version": "100.4.5",
+    "version": "100.4.5-p1",
     "require": {
         "php": "~8.1.0||~8.2.0",
         "lib-libxml": "*",
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/etc/adminhtml/system.xml /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/etc/adminhtml/system.xml
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/etc/adminhtml/system.xml	2023-05-30 09:55:09.132898000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/etc/adminhtml/system.xml	2023-05-16 15:24:34.000000000 +0100
@@ -16,9 +16,11 @@
                 </field>
                 <field id="gateway_url" translate="label" type="text" sortOrder="20" showInDefault="1" showInWebsite="1" canRestore="1">
                     <label>Gateway URL</label>
+                    <backend_model>Magento\Usps\Model\Config\Backend\UspsUrl</backend_model>
                 </field>
                 <field id="gateway_secure_url" translate="label" type="text" sortOrder="30" showInDefault="1" showInWebsite="1" canRestore="1">
                     <label>Secure Gateway URL</label>
+                    <backend_model>Magento\Usps\Model\Config\Backend\UspsUrl</backend_model>
                 </field>
                 <field id="title" translate="label" type="text" sortOrder="40" showInDefault="1" showInWebsite="1" showInStore="1" canRestore="1">
                     <label>Title</label>
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/i18n/en_US.csv /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/i18n/en_US.csv
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/i18n/en_US.csv	2023-05-30 09:55:09.132898000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/i18n/en_US.csv	2023-05-16 15:24:34.000000000 +0100
@@ -137,3 +137,4 @@
 Debug,Debug
 "Show Method if Not Applicable","Show Method if Not Applicable"
 "Sort Order","Sort Order"
+"USPS API endpoint URL\'s must use usps.com or shippingapis.com","USPS API endpoint URL\'s must use usps.com or shippingapis.com"
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/Model/Config/Backend/UspsUrl.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/Model/Config/Backend/UspsUrl.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/Model/Config/Backend/UspsUrl.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/Model/Config/Backend/UspsUrl.php	2023-05-16 15:24:34.000000000 +0100
@@ -0,0 +1,76 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+
+declare(strict_types=1);
+
+namespace Magento\Usps\Model\Config\Backend;
+
+use Magento\Framework\App\Cache\TypeListInterface;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\App\Config\Value;
+use Magento\Framework\Data\Collection\AbstractDb;
+use Magento\Framework\Exception\ValidatorException;
+use Magento\Framework\Model\Context;
+use Magento\Framework\Model\ResourceModel\AbstractResource;
+use Magento\Framework\Registry;
+use Magento\Framework\Validator\Url;
+
+/**
+ * Represents a config URL that may point to a USPS endpoint
+ *
+ * @SuppressWarnings(PHPMD.Superglobals)
+ */
+class UspsUrl extends Value
+{
+    /**
+     * @var Url
+     */
+    private Url $url;
+
+    /**
+     * @param Context $context
+     * @param Registry $registry
+     * @param ScopeConfigInterface $config
+     * @param TypeListInterface $cacheTypeList
+     * @param Url $url
+     * @param AbstractResource|null $resource
+     * @param AbstractDb|null $resourceCollection
+     * @param array $data
+     */
+    public function __construct(
+        Context $context,
+        Registry $registry,
+        ScopeConfigInterface $config,
+        TypeListInterface $cacheTypeList,
+        Url $url,
+        AbstractResource $resource = null,
+        AbstractDb $resourceCollection = null,
+        array $data = []
+    ) {
+        $this->url = $url;
+        parent::__construct($context, $registry, $config, $cacheTypeList, $resource, $resourceCollection, $data);
+    }
+
+    /**
+     * @inheritdoc
+     *
+     * @throws ValidatorException
+     */
+    public function beforeSave()
+    {
+        $isValid = $this->url->isValid($this->getValue());
+        if ($isValid) {
+            // phpcs:ignore Magento2.Functions.DiscouragedFunction
+            $host = parse_url((string)$this->getValue(), \PHP_URL_HOST);
+
+            if (!empty($host) && !preg_match("/(?:.+\.|^)usps|shippingapis\.com$/i", $host)) {
+                throw new ValidatorException(__('USPS API endpoint URL\'s must use usps.com or shippingapis.com'));
+            }
+        }
+
+        return parent::beforeSave();
+    }
+}
diff -Naur /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/Test/Unit/Model/Config/Backend/UspsUrlTest.php /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/Test/Unit/Model/Config/Backend/UspsUrlTest.php
--- /home/daniel/projects/internal/magento-2/commerce/2.4.6/vendor/magento/module-usps/Test/Unit/Model/Config/Backend/UspsUrlTest.php	1970-01-01 01:00:00.000000000 +0100
+++ /home/daniel/projects/internal/magento-2/commerce/2.4.6-p1/vendor/magento/module-usps/Test/Unit/Model/Config/Backend/UspsUrlTest.php	2023-05-16 15:24:34.000000000 +0100
@@ -0,0 +1,124 @@
+<?php
+/**
+ * Copyright © Magento, Inc. All rights reserved.
+ * See COPYING.txt for license details.
+ */
+
+declare(strict_types=1);
+
+namespace Magento\Usps\Test\Unit\Model\Config\Backend;
+
+use Magento\Framework\App\Cache\TypeListInterface;
+use Magento\Framework\App\Config\ScopeConfigInterface;
+use Magento\Framework\Data\Collection\AbstractDb;
+use Magento\Framework\Event\ManagerInterface;
+use Magento\Framework\Exception\ValidatorException;
+use Magento\Framework\Model\Context;
+use Magento\Framework\Model\ResourceModel\AbstractResource;
+use Magento\Framework\Registry;
+use Magento\Framework\TestFramework\Unit\Helper\ObjectManager;
+use Magento\Framework\Validator\Url;
+use Magento\Usps\Model\Config\Backend\UspsUrl;
+use PHPUnit\Framework\TestCase;
+
+/**
+ * Verify behavior of UspsUrl backend type
+ *
+ * @SuppressWarnings(PHPMD.Superglobals)
+ */
+class UspsUrlTest extends TestCase
+{
+    /**
+     * @var UspsUrl
+     */
+    private $urlConfig;
+
+    /**
+     * @var Url
+     */
+    private $url;
+
+    /**
+     * @var Context
+     */
+    private $contextMock;
+
+    protected function setUp(): void
+    {
+        $objectManager = new ObjectManager($this);
+
+        $this->contextMock = $this->createMock(Context::class);
+        $registry = $this->createMock(Registry::class);
+        $config = $this->createMock(ScopeConfigInterface::class);
+        $cacheTypeList = $this->createMock(TypeListInterface::class);
+        $this->url = $this->createMock(Url::class);
+        $resource = $this->createMock(AbstractResource::class);
+        $resourceCollection = $this->createMock(AbstractDb::class);
+        $eventManagerMock = $this->getMockForAbstractClass(ManagerInterface::class);
+
+        $eventManagerMock->expects($this->any())->method('dispatch');
+        $this->contextMock->expects($this->any())->method('getEventDispatcher')->willReturn($eventManagerMock);
+
+        $this->urlConfig = $objectManager->getObject(
+            UspsUrl::class,
+            [
+                'url' => $this->url,
+                'context' => $this->contextMock,
+                'registry' => $registry,
+                'config' => $config,
+                'cacheTypeList' => $cacheTypeList,
+                'resource' => $resource,
+                'resourceCollection' => $resourceCollection,
+            ]
+        );
+    }
+
+    /**
+     * @dataProvider validDataProvider
+     * @param string $data The valid data
+     * @throws ValidatorException
+     */
+    public function testBeforeSave(string $data = ""): void
+    {
+        $this->url->expects($this->any())->method('isValid')->willReturn(true);
+        $this->urlConfig->setValue($data);
+        $this->urlConfig->beforeSave();
+        $this->assertTrue($this->url->isValid($data));
+    }
+
+    /**
+     * @dataProvider invalidDataProvider
+     * @param string $data The invalid data
+     */
+    public function testBeforeSaveErrors(string $data): void
+    {
+        $this->url->expects($this->any())->method('isValid')->willReturn(true);
+        $this->expectException('Magento\Framework\Exception\ValidatorException');
+        $this->expectExceptionMessage('USPS API endpoint URL\'s must use usps.com or shippingapis.com');
+        $this->urlConfig->setValue($data);
+        $this->urlConfig->beforeSave();
+    }
+
+    public function validDataProvider(): array
+    {
+        return [
+            [],
+            [''],
+            ['http://usps.com'],
+            ['https://foo.usps.com'],
+            ['http://foo.usps.com/foo/bar?baz=bash&fizz=buzz'],
+        ];
+    }
+
+    /**
+     * @return string[][]
+     */
+    public function invalidDataProvider(): array
+    {
+        return [
+            ['https://shippingapis.com.fake.com'],
+            ['https://shippingapis.info'],
+            ['http://shippingapis.com.foo.com/foo/bar?baz=bash&fizz=buzz'],
+        ];
+    }
+}
